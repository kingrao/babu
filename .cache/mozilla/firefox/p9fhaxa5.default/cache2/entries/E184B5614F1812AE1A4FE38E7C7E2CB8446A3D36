if (AjxPackage.define("ContactsCore")) {
/*
 * ***** BEGIN LICENSE BLOCK *****
 * Zimbra Collaboration Suite Web Client
 * Copyright (C) 2006, 2007, 2008, 2009, 2010, 2012, 2013, 2014, 2016 Synacor, Inc.
 *
 * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at: https://www.zimbra.com/license
 * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15
 * have been added to cover use of software over a computer network and provide for limited attribution
 * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B.
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied.
 * See the License for the specific language governing rights and limitations under the License.
 * The Original Code is Zimbra Open Source Web Client.
 * The Initial Developer of the Original Code is Zimbra, Inc.  All rights to the Original Code were
 * transferred by Zimbra, Inc. to Synacor, Inc. on September 14, 2015.
 *
 * All portions of the code are Copyright (C) 2006, 2007, 2008, 2009, 2010, 2012, 2013, 2014, 2016 Synacor, Inc. All Rights Reserved.
 * ***** END LICENSE BLOCK *****
 */
/*
 * Package: ContactsCore
 * 
 * Supports: Loading of contacts and address books
 * 
 * Loaded:
 * 	- When user contacts are loaded during startup
 * 	- If the <refresh> block has address books
 * 	- If a search for contacts returns results
 */

if (AjxPackage.define("zimbraMail.abook.model.ZmAddrBook")) {
/*
 * ***** BEGIN LICENSE BLOCK *****
 * Zimbra Collaboration Suite Web Client
 * Copyright (C) 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2016 Synacor, Inc.
 *
 * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at: https://www.zimbra.com/license
 * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15
 * have been added to cover use of software over a computer network and provide for limited attribution
 * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B.
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied.
 * See the License for the specific language governing rights and limitations under the License.
 * The Original Code is Zimbra Open Source Web Client.
 * The Initial Developer of the Original Code is Zimbra, Inc.  All rights to the Original Code were
 * transferred by Zimbra, Inc. to Synacor, Inc. on September 14, 2015.
 *
 * All portions of the code are Copyright (C) 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2016 Synacor, Inc. All Rights Reserved.
 * ***** END LICENSE BLOCK *****
 */

/**
 * @overview
 * This file contains the address book class.
 */

/**
 * Creates an address book.
 * @constructor
 * @class
 * This class represents an address book.
 * 
 * @author Parag Shah
 *
 * @param	{Hash}	params		a hash of parameters
 * @param {int}	params.id			a numeric ID
 * @param {String}	params.name		[string]	the name
 * @param {ZmOrganizer}	params.parent		the parent organizer
 * @param {ZmTree}	params.tree		a tree model that contains this organizer
 * @param {int}	params.color		the color of this address book
 * @param {String}	params.owner	the owner of the address book (if shared)
 * @param {String}	params.zid 		the the share ID of a shared address book
 * @param {String}	params.rid		the the remote folder id of a shared address book
 * @param {String}	params.restUrl	the REST URL of this organizer
 * 
 * @extends		ZmFolder
 */
ZmAddrBook = function(params) {
	params.type = ZmOrganizer.ADDRBOOK;
	ZmFolder.call(this, params);
};

ZmAddrBook.prototype = new ZmFolder;
ZmAddrBook.prototype.constructor = ZmAddrBook;

ZmAddrBook.prototype.isZmAddrBook = true;
ZmAddrBook.prototype.toString = function() { return "ZmAddrBook"; };


// Consts

ZmAddrBook.ID_ADDRESSBOOK = ZmOrganizer.ID_ADDRBOOK; 							// XXX: may not be necessary

// Public methods

ZmAddrBook.prototype.getIcon =
function() {
	if (this.nId == ZmFolder.ID_ROOT)			{ return null; }
	if (this.nId == ZmFolder.ID_TRASH)			{ return "Trash"; }
	if (this.link || this.isRemote())			{ return "SharedContactsFolder"; }
	if (this.nId == ZmFolder.ID_AUTO_ADDED)		{ return "EmailedContacts"; }
	return "ContactsFolder";
};

/**
 * Checks if the address book supports public access.
 * 
 * @return	{Boolean}		always returns <code>true</code>
 */
ZmAddrBook.prototype.supportsPublicAccess =
function() {
	// AddrBook's can be accessed outside of ZCS (i.e. REST)
	return true;
};

/**
 * @private
 */
ZmAddrBook.prototype.mayContain = function(what) {

	if (!what) {
		return true;
	}

	// Distribution Lists is a system-generated folder
	if (this.id == ZmOrganizer.ID_DLS) {
		return false;
	}

	if (what.isZmAddrBook) {
		return ZmFolder.prototype.mayContain.apply(this, arguments);
	}

	// An item or an array of items is being moved
	var items = AjxUtil.toArray(what);
	for (var i = 0; i < items.length; i++) {
		var item = items[i];
		if (item.type !== ZmItem.CONTACT && item.type !== ZmItem.GROUP) {
			// only contacts are valid for addr books.
			return false;
		}
	}

	return ZmFolder.prototype.mayContain.apply(this, arguments);
};
}
if (AjxPackage.define("zimbraMail.abook.model.ZmContact")) {
/*
 * ***** BEGIN LICENSE BLOCK *****
 * Zimbra Collaboration Suite Web Client
 * Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016 Synacor, Inc.
 *
 * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at: https://www.zimbra.com/license
 * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15
 * have been added to cover use of software over a computer network and provide for limited attribution
 * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B.
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied.
 * See the License for the specific language governing rights and limitations under the License.
 * The Original Code is Zimbra Open Source Web Client.
 * The Initial Developer of the Original Code is Zimbra, Inc.  All rights to the Original Code were
 * transferred by Zimbra, Inc. to Synacor, Inc. on September 14, 2015.
 *
 * All portions of the code are Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016 Synacor, Inc. All Rights Reserved.
 * ***** END LICENSE BLOCK *****
 */

/**
 * @overview
 * This file contains the contact class.
 */

if (!window.ZmContact) {
/**
 * Creates an empty contact.
 * @class
 * This class represents a contact (typically a person) with all its associated versions
 * of email address, home and work addresses, phone numbers, etc. Contacts can be filed/sorted
 * in different ways, with the default being Last, First. A contact is an item, so
 * it has tagging and flagging support, and belongs to a list.
 * <p>
 * Most of a contact's data is kept in attributes. These include name, phone, etc. Meta-data and
 * data common to items are not kept in attributes. These include flags, tags, folder, and
 * modified/created dates. Since the attribute data for contacts is loaded only once, a contact
 * gets its attribute values from that canonical list.
 * </p>
 *
 * @param {int}	id		the unique ID
 * @param {ZmContactList}	list		the list that contains this contact
 * @param {constant}	type		the item type
 * @param {object}	newDl		true if this is a new DL
 *
 * @extends		ZmItem
 */
ZmContact = function(id, list, type, newDl) {
	if (arguments.length == 0) { return; }

	type = type || ZmItem.CONTACT;
	ZmItem.call(this, type, id, list);

	this.attr = {};
	this.isGal = (this.list && this.list.isGal) || newDl;
	if (newDl) {
		this.folderId = ZmFolder.ID_DLS;
		this.dlInfo = {	isMember: false,
						isOwner: true,
						subscriptionPolicy: null,
						unsubscriptionPolicy: null,
						description: "",
						displayName: "",
						notes: "",
						hideInGal: false,
						mailPolicy: null,
						owners: [appCtxt.get(ZmSetting.USERNAME)]
		};

	}

	this.participants = new AjxVector(); // XXX: need to populate this guy (see ZmConv)
};

ZmContact.prototype = new ZmItem;
ZmContact.prototype.constructor = ZmContact;
ZmContact.prototype.isZmContact = true;

// fields
ZmContact.F_anniversary				= "anniversary";
ZmContact.F_assistantPhone			= "assistantPhone";
ZmContact.F_attachment				= "attachment";
ZmContact.F_birthday				= "birthday";
ZmContact.F_callbackPhone			= "callbackPhone";
ZmContact.F_carPhone				= "carPhone";
ZmContact.F_company					= "company";
ZmContact.F_companyPhone			= "companyPhone";
ZmContact.F_custom					= "custom";
ZmContact.F_description				= "description";
ZmContact.F_department				= "department";
ZmContact.F_dlist					= "dlist";				// Group fields
ZmContact.F_dlDisplayName			= "dldisplayname"; //DL
ZmContact.F_dlDesc					= "dldesc";  //DL
ZmContact.F_dlHideInGal				= "dlhideingal";  //DL
ZmContact.F_dlNotes					= "dlnotes";  //DL
ZmContact.F_dlSubscriptionPolicy	= "dlsubspolicy";  //DL
ZmContact.F_dlMailPolicy			= "dlmailpolicy";  //DL
ZmContact.F_dlMailPolicySpecificMailers	= "dlmailpolicyspecificmailers";  //DL
ZmContact.F_dlUnsubscriptionPolicy	= "dlunsubspolicy";  //DL
ZmContact.F_dlListOwners			= "dllistowners";  //DL
ZmContact.F_email					= "email";
ZmContact.F_email2					= "email2";
ZmContact.F_email3					= "email3";
ZmContact.F_email4					= "email4";
ZmContact.F_email5					= "email5";
ZmContact.F_email6					= "email6";
ZmContact.F_email7					= "email7";
ZmContact.F_email8					= "email8";
ZmContact.F_email9					= "email9";
ZmContact.F_email10					= "email10";
ZmContact.F_email11					= "email11";
ZmContact.F_email12					= "email12";
ZmContact.F_email13					= "email13";
ZmContact.F_email14					= "email14";
ZmContact.F_email15					= "email15";
ZmContact.F_email16					= "email16";
ZmContact.F_fileAs					= "fileAs";
ZmContact.F_firstName				= "firstName";
ZmContact.F_folderId				= "folderId";
ZmContact.F_groups                  = "groups";         //group members
ZmContact.F_homeCity				= "homeCity";
ZmContact.F_homeCountry				= "homeCountry";
ZmContact.F_homeFax					= "homeFax";
ZmContact.F_homePhone				= "homePhone";
ZmContact.F_homePhone2				= "homePhone2";
ZmContact.F_homePostalCode			= "homePostalCode";
ZmContact.F_homeState				= "homeState";
ZmContact.F_homeStreet				= "homeStreet";
ZmContact.F_homeURL					= "homeURL";
ZmContact.F_image					= "image";				// contact photo
ZmContact.F_imAddress 				= "imAddress";			// IM addresses
ZmContact.F_imAddress1 				= "imAddress1";			// IM addresses
ZmContact.F_imAddress2 				= "imAddress2";
ZmContact.F_imAddress3				= "imAddress3";
ZmContact.F_jobTitle				= "jobTitle";
ZmContact.F_lastName				= "lastName";
ZmContact.F_maidenName				= "maidenName";
ZmContact.F_memberC                 = "memberC";
ZmContact.F_memberG                 = "memberG";
ZmContact.F_memberI                 = "memberI";
ZmContact.F_middleName				= "middleName";
ZmContact.F_mobilePhone				= "mobilePhone";
ZmContact.F_namePrefix				= "namePrefix";
ZmContact.F_nameSuffix				= "nameSuffix";
ZmContact.F_nickname				= "nickname";
ZmContact.F_notes					= "notes";
ZmContact.F_otherCity				= "otherCity";
ZmContact.F_otherCountry			= "otherCountry";
ZmContact.F_otherFax				= "otherFax";
ZmContact.F_otherPhone				= "otherPhone";
ZmContact.F_otherPostalCode			= "otherPostalCode";
ZmContact.F_otherState				= "otherState";
ZmContact.F_otherStreet				= "otherStreet";
ZmContact.F_otherURL				= "otherURL";
ZmContact.F_pager					= "pager";
ZmContact.F_phoneticFirstName       = "phoneticFirstName";
ZmContact.F_phoneticLastName        = "phoneticLastName";
ZmContact.F_phoneticCompany         = "phoneticCompany";
ZmContact.F_type					= "type";
ZmContact.F_workAltPhone			= "workAltPhone";
ZmContact.F_workCity				= "workCity";
ZmContact.F_workCountry				= "workCountry";
ZmContact.F_workEmail1				= "workEmail1";
ZmContact.F_workEmail2				= "workEmail2";
ZmContact.F_workEmail3				= "workEmail3";
ZmContact.F_workFax					= "workFax";
ZmContact.F_workMobile				= "workMobile";
ZmContact.F_workPhone				= "workPhone";
ZmContact.F_workPhone2				= "workPhone2";
ZmContact.F_workPostalCode			= "workPostalCode";
ZmContact.F_workState				= "workState";
ZmContact.F_workStreet				= "workStreet";
ZmContact.F_workURL					= "workURL";
ZmContact.F_imagepart               = "imagepart";          // New field for bug 73146 - Contacts call does not return the image information
ZmContact.F_zimletImage				= "zimletImage";
ZmContact.X_fileAs					= "fileAs";				// extra fields
ZmContact.X_firstLast				= "firstLast";
ZmContact.X_fullName				= "fullName";
ZmContact.X_vcardXProps             = "vcardXProps";
ZmContact.X_outlookUserField        = "outlookUserField";
ZmContact.MC_cardOwner				= "cardOwner";			// My card fields
ZmContact.MC_workCardMessage		= "workCardMessage";
ZmContact.MC_homeCardMessage		= "homeCardMessage";
ZmContact.MC_homePhotoURL			= "homePhotoURL";
ZmContact.MC_workPhotoURL			= "workPhotoURL";
ZmContact.GAL_MODIFY_TIMESTAMP		= "modifyTimeStamp";	// GAL fields
ZmContact.GAL_CREATE_TIMESTAMP		= "createTimeStamp";
ZmContact.GAL_ZIMBRA_ID				= "zimbraId";
ZmContact.GAL_OBJECT_CLASS			= "objectClass";
ZmContact.GAL_MAIL_FORWARD_ADDRESS	= "zimbraMailForwardingAddress";
ZmContact.GAL_CAL_RES_TYPE			= "zimbraCalResType";
ZmContact.GAL_CAL_RES_LOC_NAME		= "zimbraCalResLocationDisplayName";

// file as
(function() {
	var i = 1;
	ZmContact.FA_LAST_C_FIRST			= i++;
	ZmContact.FA_FIRST_LAST 			= i++;
	ZmContact.FA_COMPANY 				= i++;
	ZmContact.FA_LAST_C_FIRST_COMPANY	= i++;
	ZmContact.FA_FIRST_LAST_COMPANY		= i++;
	ZmContact.FA_COMPANY_LAST_C_FIRST	= i++;
	ZmContact.FA_COMPANY_FIRST_LAST		= i++;
	ZmContact.FA_CUSTOM					= i++;
})();

// Field information

ZmContact.ADDRESS_FIELDS = [
    // NOTE: sync with field order in ZmEditContactView's templates
	ZmContact.F_homeCity,
	ZmContact.F_homeCountry,
	ZmContact.F_homePostalCode,
	ZmContact.F_homeState,
	ZmContact.F_homeStreet,
	ZmContact.F_workCity,
	ZmContact.F_workCountry,
	ZmContact.F_workPostalCode,
	ZmContact.F_workState,
	ZmContact.F_workStreet,
    ZmContact.F_otherCity,
    ZmContact.F_otherCountry,
    ZmContact.F_otherPostalCode,
    ZmContact.F_otherState,
    ZmContact.F_otherStreet
];
ZmContact.EMAIL_FIELDS = [
	ZmContact.F_email,
	ZmContact.F_workEmail1,
	ZmContact.F_workEmail2,
	ZmContact.F_workEmail3
];
ZmContact.IM_FIELDS = [
	ZmContact.F_imAddress
];
ZmContact.OTHER_FIELDS = [
    // NOTE: sync with field order in ZmEditContactView's templates
	ZmContact.F_birthday,
    ZmContact.F_anniversary,
	ZmContact.F_custom
];
ZmContact.PHONE_FIELDS = [
    // NOTE: sync with field order in ZmEditContactView's templates
    ZmContact.F_mobilePhone,
    ZmContact.F_workPhone,
    ZmContact.F_workFax,
    ZmContact.F_companyPhone,
    ZmContact.F_homePhone,
    ZmContact.F_homeFax,
    ZmContact.F_pager,
    ZmContact.F_callbackPhone,
	ZmContact.F_assistantPhone,
	ZmContact.F_carPhone,
	ZmContact.F_otherPhone,
    ZmContact.F_otherFax,
	ZmContact.F_workAltPhone,
	ZmContact.F_workMobile
];
ZmContact.PRIMARY_FIELDS = [
    // NOTE: sync with field order in ZmEditContactView's templates
    ZmContact.F_image,
    ZmContact.F_namePrefix,
    ZmContact.F_firstName,
    ZmContact.F_phoneticFirstName,
    ZmContact.F_middleName,
	ZmContact.F_maidenName,
    ZmContact.F_lastName,
    ZmContact.F_phoneticLastName,
    ZmContact.F_nameSuffix,
    ZmContact.F_nickname,
    ZmContact.F_jobTitle,
    ZmContact.F_department,
	ZmContact.F_company,
    ZmContact.F_phoneticCompany,
	ZmContact.F_fileAs,
	ZmContact.F_folderId,
	ZmContact.F_notes
];
ZmContact.URL_FIELDS = [
    // NOTE: sync with field order in ZmEditContactView's templates
	ZmContact.F_homeURL,
	ZmContact.F_workURL,
	ZmContact.F_otherURL
];
ZmContact.GAL_FIELDS = [
	ZmContact.GAL_MODIFY_TIMESTAMP,
	ZmContact.GAL_CREATE_TIMESTAMP,
	ZmContact.GAL_ZIMBRA_ID,
	ZmContact.GAL_OBJECT_CLASS,
	ZmContact.GAL_MAIL_FORWARD_ADDRESS,
	ZmContact.GAL_CAL_RES_TYPE,
	ZmContact.GAL_CAL_RES_LOC_NAME,
	ZmContact.F_type
];
ZmContact.MYCARD_FIELDS = [
	ZmContact.MC_cardOwner,
	ZmContact.MC_homeCardMessage,
	ZmContact.MC_homePhotoURL,
	ZmContact.MC_workCardMessage,
	ZmContact.MC_workPhotoURL
];
ZmContact.X_FIELDS = [
	ZmContact.X_firstLast,
	ZmContact.X_fullName,
    ZmContact.X_vcardXProps
];


ZmContact.IGNORE_NORMALIZATION = [];

ZmContact.ADDR_PREFIXES = ["work","home","other"];
ZmContact.ADDR_SUFFIXES = ["Street","City","State","PostalCode","Country"];

ZmContact.updateFieldConstants = function() {

	for (var i = 0; i < ZmContact.ADDR_PREFIXES.length; i++) {
		for (var j = 0; j < ZmContact.ADDR_SUFFIXES.length; j++) {
			ZmContact.IGNORE_NORMALIZATION.push(ZmContact.ADDR_PREFIXES[i] + ZmContact.ADDR_SUFFIXES[j]);
		}
	}

ZmContact.DISPLAY_FIELDS = [].concat(
	ZmContact.ADDRESS_FIELDS,
	ZmContact.EMAIL_FIELDS,
	ZmContact.IM_FIELDS,
	ZmContact.OTHER_FIELDS,
	ZmContact.PHONE_FIELDS,
	ZmContact.PRIMARY_FIELDS,
	ZmContact.URL_FIELDS
);

ZmContact.IGNORE_FIELDS = [].concat(
	ZmContact.GAL_FIELDS,
	ZmContact.MYCARD_FIELDS,
	ZmContact.X_FIELDS,
	[ZmContact.F_imagepart]
);

ZmContact.ALL_FIELDS = [].concat(
	ZmContact.DISPLAY_FIELDS, ZmContact.IGNORE_FIELDS
);

ZmContact.IS_DATE = {};
ZmContact.IS_DATE[ZmContact.F_birthday] = true;
ZmContact.IS_DATE[ZmContact.F_anniversary] = true;

ZmContact.IS_IGNORE = AjxUtil.arrayAsHash(ZmContact.IGNORE_FIELDS);

// number of distribution list members to fetch at a time
ZmContact.DL_PAGE_SIZE = 100;

ZmContact.GROUP_CONTACT_REF = "C";
ZmContact.GROUP_GAL_REF = "G";
ZmContact.GROUP_INLINE_REF = "I";	
}; // updateFieldConstants()
ZmContact.updateFieldConstants();

/**
 * This structure can be queried to determine if the first
 * entry in a multi-value entry is suffixed with "1". Most
 * attributes add a numerical suffix to all but the first
 * entry.
 * <p>
 * <strong>Note:</strong>
 * In most cases, {@link ZmContact#getAttributeName} is a better choice.
 */
ZmContact.IS_ADDONE = {};
ZmContact.IS_ADDONE[ZmContact.F_custom] = true;
ZmContact.IS_ADDONE[ZmContact.F_imAddress] = true;
ZmContact.IS_ADDONE[ZmContact.X_outlookUserField] = true;

/**
 * Gets an indexed attribute name taking into account if the field
 * with index 1 should append the "1" or not. Code should call this
 * function in lieu of accessing {@link ZmContact.IS_ADDONE} directly.
 */
ZmContact.getAttributeName = function(name, index) {
	index = index || 1;
	return index > 1 || ZmContact.IS_ADDONE[name] ? name+index : name;
};

/**
 * Returns a string representation of the object.
 * 
 * @return		{String}		a string representation of the object
 */
ZmContact.prototype.toString =
function() {
	return "ZmContact";
};

// Class methods

/**
 * Creates a contact from an XML node.
 *
 * @param {Object}	node		a "cn" XML node
 * @param {Hash}	args		args to pass to the constructor
 * @return	{ZmContact}	the contact
 */
ZmContact.createFromDom =
function(node, args) {
	// check global cache for this item first
	var contact = appCtxt.cacheGet(node.id);

	// make sure the revision hasnt changed, otherwise contact is out of date
	if (contact == null || (contact && contact.rev != node.rev)) {
		contact = new ZmContact(node.id, args.list);
		if (args.isGal) {
			contact.isGal = args.isGal;
		}
		contact._loadFromDom(node);
		//update the canonical list
		appCtxt.getApp(ZmApp.CONTACTS).getContactList().add(contact);
	} else {
		if (node.m) {
			contact.attr[ZmContact.F_groups] = node.m;
		}
		if (node.ref) {
			contact.ref = node.ref;
		}
		if (node.tn) {
			contact._parseTagNames(node.tn);
		}
		AjxUtil.hashUpdate(contact.attr, node._attrs);	// merge new attrs just in case we don't have them
		contact.list = args.list || new ZmContactList(null);
		contact._list = {};
		contact._list[contact.list.id] = true;
	}
	//S/MIME: If user certificate is present, include it into contact's object
	if (node.certificate) {
		contact.certificate = node.certificate;
	}

	return contact;
};

/**
 * Compares two contacts based on how they are filed. Intended for use by
 * sort methods.
 *
 * @param {ZmContact}		a		a contact
 * @param {ZmContact}		b		a contact
 * @return	{int}	0 if the contacts are the same; 1 if "a" is before "b"; -1 if "b" is before "a"
 */
ZmContact.compareByFileAs =
function(a, b) {
	var aFileAs = (a instanceof ZmContact) ? a.getFileAs(true) : ZmContact.computeFileAs(a._attrs).toLowerCase();
	var bFileAs = (b instanceof ZmContact) ? b.getFileAs(true) : ZmContact.computeFileAs(b._attrs).toLowerCase();

	if (!bFileAs || (aFileAs > bFileAs)) return 1;
	if (aFileAs < bFileAs) return -1;
	return 0;
};

/**
 * Figures out the filing string for the contact according to the chosen method.
 *
 * @param {ZmContact|Hash}	contact		a contact or a hash of contact attributes
 */
ZmContact.computeFileAs =
function(contact) {
	/*
	 * Bug 98176: To keep the same logic of generating the FileAs contact
	 *    label string between the Ajax client, and HTML client, when the
	 *    computeFileAs(), and fileAs*() functions are modified, please
	 *    change the corresponding functions defined in the autoComplete.tag
	 */
	var attr = (contact instanceof ZmContact) ? contact.getAttrs() : contact;
	if (!attr) return;

	if (attr[ZmContact.F_dlDisplayName]) {
		//this is only DL case. But since this is sometimes just the attrs,
		//I can't always use isDistributionList method.
		return attr[ZmContact.F_dlDisplayName];
	}

	var val = parseInt(attr.fileAs);
	var fa;
	var idx = 0;

	switch (val) {
		case ZmContact.FA_LAST_C_FIRST: 										// Last, First
		default: {
			// if GAL contact, use full name instead (bug fix #4850,4009)
			if (contact && contact.isGal) {
				if (attr.fullName) { // bug fix #27428 - if fullName is Array, return first
					return (attr.fullName instanceof Array) ? attr.fullName[0] : attr.fullName;
				}
				return ((attr.email instanceof Array) ? attr.email[0] : attr.email);
			}
			fa = ZmContact.fileAsLastFirst(attr.firstName, attr.lastName, attr.fullName, attr.nickname);
		}
		break;

		case ZmContact.FA_FIRST_LAST: { 										// First Last
			fa = ZmContact.fileAsFirstLast(attr.firstName, attr.lastName, attr.fullName, attr.nickname);
		}
		break;

		case ZmContact.FA_COMPANY: {											// Company
			if (attr.company) fa = attr.company;
		}
		break;

		case ZmContact.FA_LAST_C_FIRST_COMPANY: {								// Last, First (Company)
			var name = ZmContact.fileAsLastFirst(attr.firstName, attr.lastName, attr.fullName, attr.nickname);
			fa = ZmContact.fileAsNameCompany(name, attr.company);
		}
		break;

		case ZmContact.FA_FIRST_LAST_COMPANY: {									// First Last (Company)
			var name = ZmContact.fileAsFirstLast(attr.firstName, attr.lastName, attr.fullName, attr.nickname);
			fa = ZmContact.fileAsNameCompany(name, attr.company);
		}
		break;

		case ZmContact.FA_COMPANY_LAST_C_FIRST: {								// Company (Last, First)
			var name = ZmContact.fileAsLastFirst(attr.firstName, attr.lastName);
			fa = ZmContact.fileAsCompanyName(name, attr.company);
		}
		break;

		case ZmContact.FA_COMPANY_FIRST_LAST: {									// Company (First Last)
			var name = ZmContact.fileAsFirstLast(attr.firstName, attr.lastName);
			fa = ZmContact.fileAsCompanyName(name, attr.company);
		}
		break;

		case ZmContact.FA_CUSTOM: {												// custom looks like this: "8:foobar"
			return attr.fileAs.substring(2);
		}
		break;
	}
	return fa || attr.fullName || "";
};

/**
 * Name printing helper "First Last".
 * 
 * @param	{String}	first		the first name
 * @param	{String}	last		the last name
 * @param	{String}	fullname		the fullname
 * @param	{String}	nickname		the nickname
 * @return	{String}	the name format
 */
ZmContact.fileAsFirstLast =
function(first, last, fullname, nickname) {
	if (first && last)
		return AjxMessageFormat.format(ZmMsg.fileAsFirstLast, [first, last]);
	return first || last || fullname || nickname || "";
};

/**
 * Name printing helper "Last, First".
 * 
 * @param	{String}	first		the first name
 * @param	{String}	last		the last name
 * @param	{String}	fullname		the fullname
 * @param	{String}	nickname		the nickname
 * @return	{String}	the name format
 */
ZmContact.fileAsLastFirst =
function(first, last, fullname, nickname) {
	if (first && last)
		return AjxMessageFormat.format(ZmMsg.fileAsLastFirst, [first, last]);
	return last || first || fullname || nickname || "";
};

/**
 * Name printing helper "Name (Company)".
 *
 * @param	{String}	name		the contact name
 * @param	{String}	company		the company
 * @return	{String}	the name format
 */
ZmContact.fileAsNameCompany =
function(name, company) {
	if (name && company)
		return AjxMessageFormat.format(ZmMsg.fileAsNameCompany, [name, company]);
	if (company)
		return AjxMessageFormat.format(ZmMsg.fileAsCompanyAsSecondaryOnly, [company]);
	return name;
};

/**
 * Name printing helper "Company (Name)".
 * 
 * @param	{String}	name		the contact name
 * @param	{String}	company		the company
 * @return	{String}	the name format
 */
ZmContact.fileAsCompanyName =
function(name, company) {
	if (company && name)
		return AjxMessageFormat.format(ZmMsg.fileAsCompanyName, [name, company]);
	if (name)
		return AjxMessageFormat.format(ZmMsg.fileAsNameAsSecondaryOnly, [name]);
	return company;
};

/**
 * Computes the custom file as string by prepending "8:" to the given custom fileAs string.
 * 
 * @param {Hash}	customFileAs	a set of contact attributes
 * @return	{String}	the name format
 */
ZmContact.computeCustomFileAs =
function(customFileAs) {
	return [ZmContact.FA_CUSTOM, ":", customFileAs].join("");
};

/*
 * 
 * These next few static methods handle a contact that is either an anonymous
 * object or an actual ZmContact. The former is used to optimize loading. The
 * anonymous object is upgraded to a ZmContact when needed.
 *  
 */

/**
 * Gets an attribute.
 * 
 * @param	{ZmContact}	contact		the contact
 * @param	{String}	attr		the attribute
 * @return	{Object}	the attribute value or <code>null</code> for none
 */
ZmContact.getAttr =
function(contact, attr) {
	return (contact instanceof ZmContact)
		? contact.getAttr(attr)
		: (contact && contact._attrs) ? contact._attrs[attr] : null;
};

/**
 * returns the prefix of a string in the format "abc123". (would return "abc"). If the string is all number, it's a special case and returns the string itself. e.g. "234" would return "234".
 */
ZmContact.getPrefix = function(s) {
	var trimmed = s.replace(/\d+$/, "");
	if (trimmed === "") {
		//number only - don't trim. The number is the prefix.
		return s;
	}
	return trimmed;
};

/**
 * Normalizes the numbering of the given attribute names and
 * returns a new object with the re-numbered attributes. For
 * example, if the attributes contains a "foo2" but no "foo",
 * then the "foo2" attribute will be renamed to "foo" in the
 * returned object.
 *
 * @param {Hash}	attrs  a hash of attributes to normalize.
 * @param {String}	[prefix] if specified, only the the attributes that match the given prefix will be returned
 * @param {Array}	[ignore] if specified, the attributes that are present in the array will not be normalized
 * @return	{Hash}	a hash of normalized attributes
 */
ZmContact.getNormalizedAttrs = function(attrs, prefix, ignore) {
	var nattrs = {};
	if (attrs) {
		// normalize attribute numbering
		var names = AjxUtil.keys(attrs);
		names.sort(ZmContact.__BY_ATTRIBUTE);
		var a = {};
		for (var i = 0; i < names.length; i++) {
			var name = names[i];
			// get current count
			var nprefix = ZmContact.getPrefix(name);
			if (prefix && prefix != nprefix) continue;
			if (AjxUtil.isArray(ignore) && AjxUtil.indexOf(ignore, nprefix)!=-1) {
				nattrs[name] = attrs[name];
			} else {
				if (!a[nprefix]) a[nprefix] = 0;
				// normalize, if needed
				var nname = ZmContact.getAttributeName(nprefix, ++a[nprefix]);
				nattrs[nname] = attrs[name];
			}
		}
	}
	return nattrs;
};

ZmContact.__RE_ATTRIBUTE = /^(.*?)(\d+)$/;
ZmContact.__BY_ATTRIBUTE = function(a, b) {
	var aa = a.match(ZmContact.__RE_ATTRIBUTE) || [a,a,1];
	var bb = b.match(ZmContact.__RE_ATTRIBUTE) || [b,b,1];
	return aa[1] == bb[1] ? Number(aa[2]) - Number(bb[2]) : aa[1].localeCompare(bb[1]);
};

/**
 * Sets the attribute.
 * 
 * @param	{ZmContact}	contact		the contact
 * @param	{String}	attr		the attribute
 * @param	{Object}	value		the attribute value
 */
ZmContact.setAttr =
function(contact, attr, value) {
	if (contact instanceof ZmContact)
		contact.setAttr(attr, value);
	else
		contact._attrs[attr] = value;
};

/**
 * Checks if the contact is in the trash.
 * 
 * @param	{ZmContact}	contact		the contact
 * @return	{Boolean}	<code>true</code> if in trash
 */
ZmContact.isInTrash =
function(contact) {
	var folderId = (contact instanceof ZmContact) ? contact.folderId : contact.l;
	var folder = appCtxt.getById(folderId);
	return (folder && folder.isInTrash());
};

/**
 * @private
 */
ZmContact.prototype.load =
function(callback, errorCallback, batchCmd, deref) {
	var jsonObj = {GetContactsRequest:{_jsns:"urn:zimbraMail"}};
	if (deref) {
		jsonObj.GetContactsRequest.derefGroupMember = "1";
	}
	jsonObj.GetContactsRequest.returnCertInfo = "1"; //Fix for: ZCS-999 and ZCS-991
	var request = jsonObj.GetContactsRequest;
	request.cn = [{id:this.id}];

	var respCallback = new AjxCallback(this, this._handleLoadResponse, [callback]);

	if (batchCmd) {
		var jsonObj = {GetContactsRequest:{_jsns:"urn:zimbraMail"}};
		if (deref) {
			jsonObj.GetContactsRequest.derefGroupMember = "1";
		}
		jsonObj.GetContactsRequest.returnCertInfo = "1"; //Fix for: ZCS-999 and ZCS-991
		jsonObj.GetContactsRequest.cn = {id:this.id};
		batchCmd.addRequestParams(jsonObj, respCallback, errorCallback);
	} else {
		appCtxt.getAppController().sendRequest({jsonObj:jsonObj,
												asyncMode:true,
												callback:respCallback,
												errorCallback:errorCallback});
	}
};

/**
 * @private
 */
ZmContact.prototype._handleLoadResponse =
function(callback, result) {
	var resp = result.getResponse().GetContactsResponse;

	// for now, we just assume only one contact was requested at a time
	var contact = resp.cn[0];
	this.attr = contact._attrs;
	if (contact.m) {
		for (var i = 0; i < contact.m.length; i++) {
			//cache contacts from contact groups (e.g. GAL contacts, shared contacts have not already been cached)
			var member = contact.m[i];
			var isGal = false;
			if (member.type == ZmContact.GROUP_GAL_REF) {
				isGal = true;
			}
			if (member.cn && member.cn.length > 0) {
				var memberContact = member.cn[0];
				memberContact.ref = memberContact.ref || (isGal && member.value); //we sometimes don't get "ref" but the "value" for GAL is the ref.
				var loadMember = ZmContact.createFromDom(memberContact, {list: this.list, isGal: isGal}); //pass GAL so fileAS gets set correctly
				loadMember.isDL = isGal && loadMember.attr[ZmContact.F_type] == "group";
				appCtxt.cacheSet(member.value, loadMember);
			}
			
		}
		this._loadFromDom(contact); //load group
	}
	this.isLoaded = true;
	if (callback) {
		callback.run(contact, this);
	}
};

/**
 * @private
 */
ZmContact.prototype.clear =
function() {
	// bug fix #41666 - override base class method and do nothing
};

/**
 * Checks if the contact attributes are empty.
 * 
 * @return	{Boolean}	<code>true</code> if empty
 */
ZmContact.prototype.isEmpty =
function() {
	for (var i in this.attr) {
		return false;
	}
	return true;
};

/**
 * Checks if the contact is shared.
 * 
 * @return	{Boolean}	<code>true</code> if shared
 */
ZmContact.prototype.isShared =
function() {
	return this.addrbook && this.addrbook.link;
};

/**
 * Checks if the contact is read-only.
 * 
 * @return	{Boolean}	<code>true</code> if read-only
 */
ZmContact.prototype.isReadOnly =
function() {
	if (this.isGal) { return true; }

	return this.isShared()
		? this.addrbook && this.addrbook.isReadOnly()
		: false;
};

/**
 * Checks if the contact is locked. This is different for DLs than read-only.
 *
 * @return	{Boolean}	<code>true</code> if read-only
 */
ZmContact.prototype.isLocked =
function() {
	if (!this.isDistributionList()) {
		return this.isReadOnly();
	}
	if (!this.dlInfo) {
		return false; //rare case after editing by an owner if the fileAsChanged, the new dl Info still not read, and the layout re-done. So don't show the lock.
	}
	var dlInfo = this.dlInfo;
	if (dlInfo.isOwner) {
		return false;
	}
	if (dlInfo.isMember) {
    	return dlInfo.unsubscriptionPolicy == ZmContactSplitView.SUBSCRIPTION_POLICY_REJECT;
	}
	return dlInfo.subscriptionPolicy == ZmContactSplitView.SUBSCRIPTION_POLICY_REJECT;
};

/**
 * Checks if the contact is a group.
 * 
 * @return	{Boolean}	<code>true</code> if a group
 */
ZmContact.prototype.isGroup =
function() {
	return this.getAttr(ZmContact.F_type) == "group" || this.type == ZmItem.GROUP;
};

/**
 * Checks if the contact is a DL.
 *
 * @return	{Boolean}	<code>true</code> if a group
 */
ZmContact.prototype.isDistributionList =
function() {
	return this.isGal && this.isGroup();
};


// parses "groups" attr into AjxEmailAddress objects stored in 3 vectors (all, good, and bad)
/**
 * Gets the group members.
 *
 * @return	{AjxVector}		the group members or <code>null</code> if not group
 */
ZmContact.prototype.getGroupMembers =
function() {
	var allMembers = this.getAllGroupMembers();
	var addrs = [];
	for (var i = 0; i < allMembers.length; i++) {
		addrs.push(allMembers[i].toString());
	}
	return AjxEmailAddress.parseEmailString(addrs.join(", "));
};	

/**
 * parses "groups" attr into an AjxEmailAddress with a few extra attributes (see ZmContactsHelper._wrapInlineContact)
 * 
 * @return	{AjxVector}		the group members or <code>null</code> if not group
 */
ZmContact.prototype.getAllGroupMembers =
function() {

	if (this.isDistributionList()) {
		return this.dlMembers;
	}

	var addrs = [];

	var groupMembers = this.attr[ZmContact.F_groups];
	if (!groupMembers){
		return AjxEmailAddress.parseEmailString(this.attr[ZmContact.F_email]);  //I doubt this is needed or works correctly, but I keep this logic from before. If we don't have the group members, how can we return the group email instead?
	}
	for (var i = 0; i < groupMembers.length; i++) {
		var member = groupMembers[i];
		var type = member.type;
		var value = member.value;
		if (type == ZmContact.GROUP_INLINE_REF) {
			addrs.push(ZmContactsHelper._wrapInlineContact(value));
		}
		else {
			var contact = ZmContact.getContactFromCache(value);	 //TODO: handle contacts not cached?
			if (!contact) {
				DBG.println(AjxDebug.DBG1, "Disregarding uncached contact: " + value);
				continue;
			}
			var ajxEmailAddress = ZmContactsHelper._wrapContact(contact);
			if (ajxEmailAddress && type === ZmContact.GROUP_CONTACT_REF) {
				ajxEmailAddress.groupRefValue = value; //don't normalize value
			}
			if (ajxEmailAddress) {
				addrs.push(ajxEmailAddress);
			}
		}
	}
	return addrs;
};


ZmContact.prototype.gatherExtraDlStuff =
function(callback) {
	if (this.dlInfo && !this.dlInfo.isMinimal) {
		//already there, skip to next step, loading DL Members
		this.loadDlMembers(callback);
		return;
	}
	var callbackFromGettingInfo = this._handleGetDlInfoResponse.bind(this, callback);
	this.loadDlInfo(callbackFromGettingInfo);
};


ZmContact.prototype._handleGetDlInfoResponse =
function(callback, result) {
	var response = result._data.GetDistributionListResponse;
	var dl = response.dl[0];
	var attrs = dl._attrs;
	var isMember = dl.isMember;
	var isOwner = dl.isOwner;
	var mailPolicySpecificMailers = [];
	this.dlInfo = {	isMember: isMember,
						isOwner: isOwner,
						subscriptionPolicy: attrs.zimbraDistributionListSubscriptionPolicy,
						unsubscriptionPolicy: attrs.zimbraDistributionListUnsubscriptionPolicy,
						description: attrs.description || "",
						displayName: attrs.displayName || "",
						notes: attrs.zimbraNotes || "",
						hideInGal: attrs.zimbraHideInGal == "TRUE",
						mailPolicy: isOwner && this._getMailPolicy(dl, mailPolicySpecificMailers),
						owners: isOwner && this._getOwners(dl)};
	this.dlInfo.mailPolicySpecificMailers = mailPolicySpecificMailers;

	this.loadDlMembers(callback);
};

ZmContact.prototype.loadDlMembers =
function(callback) {
	if ((!appCtxt.get("EXPAND_DL_ENABLED") || this.dlInfo.hideInGal) && !this.dlInfo.isOwner) {
		// can't get members if dl has zimbraHideInGal true, and not owner
		//also, if zimbraFeatureDistributionListExpandMembersEnabled is false - also do not show the members (again unless it's the owner)
		this.dlMembers = [];
		if (callback) {
			callback();
		}
		return;
	}
	if (this.dlMembers) {
		//already there - just callback
		if (callback) {
			callback();
		}
		return;
	}
	var respCallback = this._handleGetDlMembersResponse.bind(this, callback);
	this.getAllDLMembers(respCallback);
};


ZmContact.prototype._handleGetDlMembersResponse =
function(callback, result) {
	var list = result.list;
	if (!list) {
		this.dlMembers = [];
		callback();
		return;
	}
	var members = [];
	for (var i = 0; i < list.length; i++) {
		members.push({type: ZmContact.GROUP_INLINE_REF,
						value: list[i],
						address: list[i]});
	}

	this.dlMembers = members;
	callback();
};

ZmContact.prototype._getOwners =
function(dl) {
	var owners = dl.owners[0].owner;
	var ownersArray = [];
	for (var i = 0; i < owners.length; i++) {
		var owner = owners[i].name;
		ownersArray.push(owner); //just the email address, I think and hope.
	}
	return ownersArray;
};

ZmContact.prototype._getMailPolicy =
function(dl, specificMailers) {
	var mailPolicy;

	var rights = dl.rights[0].right;
	var right = rights[0];
	var grantees = right.grantee;
	if (!grantees) {
		return ZmGroupView.MAIL_POLICY_ANYONE;
	}
	for (var i = 0; i < grantees.length; i++) {
		var grantee = grantees[i];

		mailPolicy = ZmGroupView.GRANTEE_TYPE_TO_MAIL_POLICY_MAP[grantee.type];

		if (mailPolicy == ZmGroupView.MAIL_POLICY_SPECIFIC) {
			specificMailers.push(grantee.name);
		}
		else if (mailPolicy == ZmGroupView.MAIL_POLICY_ANYONE) {
			break;
		}
		else if (mailPolicy == ZmGroupView.MAIL_POLICY_INTERNAL) {
			break;
		}
		else if (mailPolicy == ZmGroupView.MAIL_POLICY_MEMBERS) {
			if (grantee.name == this.getEmail()) {
				//this means only members of this DL can send.
				break;
			}
			else {
				//must be another DL, and we do allow it, so treat it as regular user.
				specificMailers.push(grantee.name);
				mailPolicy = ZmGroupView.MAIL_POLICY_SPECIFIC;
			}
		}
	}
	mailPolicy = mailPolicy || ZmGroupView.MAIL_POLICY_ANYONE;

	return mailPolicy;
};


ZmContact.prototype.loadDlInfo =
function(callback) {
	var soapDoc = AjxSoapDoc.create("GetDistributionListRequest", "urn:zimbraAccount", null);
	soapDoc.setMethodAttribute("needOwners", "1");
	soapDoc.setMethodAttribute("needRights", "sendToDistList");
	var elBy = soapDoc.set("dl", this.getEmail());
	elBy.setAttribute("by", "name");

	appCtxt.getAppController().sendRequest({soapDoc: soapDoc, asyncMode: true, callback: callback});
};

ZmContact.prototype.toggleSubscription =
function(callback) {
	var soapDoc = AjxSoapDoc.create("SubscribeDistributionListRequest", "urn:zimbraAccount", null);
	soapDoc.setMethodAttribute("op", this.dlInfo.isMember ? "unsubscribe" : "subscribe");
	var elBy = soapDoc.set("dl", this.getEmail());
	elBy.setAttribute("by", "name");
	appCtxt.getAppController().sendRequest({soapDoc: soapDoc, asyncMode: true, callback: callback});
};



/**
 *  Returns the contact id.  If includeUserZid is true it will return the format zid:id
 * @param includeUserZid {boolean} true to include the zid prefix for the contact id
 * @return {String} contact id string
 */
ZmContact.prototype.getId = 
function(includeUserZid) {

	if (includeUserZid) {
		return this.isShared() ? this.id : appCtxt.accountList.mainAccount.id + ":" + this.id; 
	}
	
	return this.id;
};
/**
 * Gets the icon.
 * @param 	{ZmAddrBook} addrBook	address book of contact 
 * @return	{String}	the icon
 */
ZmContact.prototype.getIcon =
function(addrBook) {
	if (this.isDistributionList()) 						{ return "DistributionList"; }
	if (this.isGal)										{ return "GALContact"; }
	if (this.isShared() || (addrBook && addrBook.link))	{ return "SharedContact"; }
	if (this.isGroup())									{ return "Group"; }
	return "Contact";
};

ZmContact.prototype.getIconLarge =
function() {
	if (this.isDistributionList()) {
		return "Group_48";
	}
	//todo - get a big version of ImgGalContact.png
//	if (this.isGal) {
//	}
	return "Person_48";
};

/**
 * Gets the folder id.
 * 
 * @return	{String}		the folder id	
 */
ZmContact.prototype.getFolderId =
function() {
	return this.isShared()
		? this.folderId.split(":")[0]
		: this.folderId;
};

/**
 * Gets the attribute.
 * 
 * @param	{String}	name		the attribute name
 * @return	{String}	the value
 */
ZmContact.prototype.getAttr =
function(name) {
	var val = this.attr[name];
	return val ? ((val instanceof Array) ? val[0] : val) : "";
};

/**
 * Sets the attribute.
 * 
 * @param	{String}	name		the attribute name
 * @param	{String}	value		the attribute value
 */
ZmContact.prototype.setAttr =
function(name, value) {
	this.attr[name] = value;
};

/**
 * Sets the participant status.
 *
 * @param	{String}	value the participant status value
 */
ZmContact.prototype.setParticipantStatus =
function(ptst) {
	this.participantStatus = ptst;
};

/**
 * gets the participant status.
 *
 * @return	{String}    the value
 */
ZmContact.prototype.getParticipantStatus =
function() {
	return this.participantStatus;
};

/**
 * Sets the participant role.
 *
 * @param	{String}	value the participant role value
 */
ZmContact.prototype.setParticipantRole =
function(role) {
	this.participantRole = role;
};

/**
 * gets the participant role.
 *
 * @return	{String}    the value
 */
ZmContact.prototype.getParticipantRole =
function() {
	return this.participantRole;
};

/**
 * Removes the attribute.
 * 
 * @param	{String}	name		the attribute name
 */
ZmContact.prototype.removeAttr =
function(name) {
	delete this.attr[name];
};

/**
 * Gets the contact attributes.
 *
 * @param {String}	[prefix] if specified, only the the attributes that match the given prefix will be returned
 * @return	{Hash}	a hash of attribute/value pairs
 */
ZmContact.prototype.getAttrs = function(prefix) {
	var attrs = this.attr;
	if (prefix) {
		attrs = {};
		for (var aname in this.attr) {
			var namePrefix = ZmContact.getPrefix(aname);
			if (namePrefix === prefix) {
				attrs[aname] = this.attr[aname];
			}
		}
	}
	return attrs;
};

/**
 * Gets a normalized set of attributes where the attribute
 * names have been re-numbered as needed. For example, if the
 * attributes contains a "foo2" but no "foo", then the "foo2"
 * attribute will be renamed to "foo" in the returned object.
 * <p>
 * <strong>Note:</strong>
 * This method is expensive so should be called once and
 * cached temporarily as needed instead of being called
 * for each normalized attribute that is needed.
 * 
 * @param {String}	[prefix]		if specified, only the
 *                        the attributes that match the given
 *                        prefix will be returned.
 * @return	{Hash}	a hash of attribute/value pairs
 */
ZmContact.prototype.getNormalizedAttrs = function(prefix) {
	return ZmContact.getNormalizedAttrs(this.attr, prefix, ZmContact.IGNORE_NORMALIZATION);
};

/**
* Creates a contact from the given set of attributes. Used to create contacts on
* the fly (rather than by loading them). This method is called by a list's <code>create()</code>
* method.
* <p>
* If this is a GAL contact, we assume it is being added to the contact list.</p>
*
* @param {Hash}	attr			the attribute/value pairs for this contact
* @param {ZmBatchCommand}	batchCmd	the batch command that contains this request
* @param {boolean} isAutoCreate true if this is a auto create and toast message should not be shown
*/
ZmContact.prototype.create =
function(attr, batchCmd, isAutoCreate) {

	if (this.isDistributionList()) {
		this._createDl(attr);
		return;
	}

	var jsonObj = {CreateContactRequest:{_jsns:"urn:zimbraMail"}};
	var request = jsonObj.CreateContactRequest;
	var cn = request.cn = {};

	var folderId = attr[ZmContact.F_folderId] || ZmFolder.ID_CONTACTS;
	var folder = appCtxt.getById(folderId);
	if (folder && folder.isRemote()) {
		folderId = folder.getRemoteId();
	}
	cn.l = folderId;
	cn.a = [];
	cn.m = [];

	for (var name in attr) {
		if (name == ZmContact.F_folderId ||
			name == "objectClass" ||
			name == "zimbraId" ||
			name == "createTimeStamp" ||
			name == "modifyTimeStamp") { continue; }

		if (name == ZmContact.F_groups) {
			this._addContactGroupAttr(cn, attr);
		}
		else {
			this._addRequestAttr(cn, name, attr[name]);
		}
	}

	this._addRequestAttr(cn, ZmContact.X_fullName, ZmContact.computeFileAs(attr));

	var respCallback = new AjxCallback(this, this._handleResponseCreate, [attr, batchCmd != null, isAutoCreate]);

	if (batchCmd) {
		batchCmd.addRequestParams(jsonObj, respCallback);
	} else {
		appCtxt.getAppController().sendRequest({jsonObj:jsonObj, asyncMode:true, callback:respCallback});
	}
};

/**
 * @private
 */
ZmContact.prototype._handleResponseCreate =
function(attr, isBatchMode, isAutoCreate, result) {
	// dont bother processing creates when in batch mode (just let create
	// notifications handle them)
	if (isBatchMode) { return; }

	var resp = result.getResponse().CreateContactResponse;
	cn = resp ? resp.cn[0] : null;
	var id = cn ? cn.id : null;
	if (id) {
		this._fileAs = null;
		this._fullName = null;
		this.id = id;
		this.modified = cn.md;
		this.folderId = cn.l || ZmOrganizer.ID_ADDRBOOK;
		for (var a in attr) {
			if (!(attr[a] == undefined || attr[a] == ''))
				this.setAttr(a, attr[a]);
		}
		var groupMembers = cn ? cn.m : null;
		if (groupMembers) {
			this.attr[ZmContact.F_groups] = groupMembers;
			cn._attrs[ZmContact.F_groups] = groupMembers;
		}
		if (!isAutoCreate) {
			var msg = this.isGroup() ? ZmMsg.groupCreated : ZmMsg.contactCreated;
			appCtxt.getAppController().setStatusMsg(msg);
		}
		//update the canonical list. (this includes adding to the _idHash like before (bug 44132) calling updateIdHash. But calling that left the list inconcistant.
		appCtxt.getApp(ZmApp.CONTACTS).getContactList().add(cn);
	} else {
		var msg = this.isGroup() ? ZmMsg.errorCreateGroup : ZmMsg.errorCreateContact;
		var detail = ZmMsg.errorTryAgain + "\n" + ZmMsg.errorContact;
		appCtxt.getAppController().setStatusMsg(msg, ZmStatusView.LEVEL_CRITICAL, detail);
	}
};

/**
 * Creates a contct from a VCF part of a message.
 * 
 * @param	{String}	msgId		the message
 * @param	{String}	vcardPartId	the vcard part id
 */
ZmContact.prototype.createFromVCard =
function(msgId, vcardPartId) {
	var jsonObj = {CreateContactRequest:{_jsns:"urn:zimbraMail"}};
	var cn = jsonObj.CreateContactRequest.cn = {l:ZmFolder.ID_CONTACTS};
	cn.vcard = {mid:msgId, part:vcardPartId};

	var params = {
		jsonObj: jsonObj,
		asyncMode: true,
		callback: (new AjxCallback(this, this._handleResponseCreateVCard)),
		errorCallback: (new AjxCallback(this, this._handleErrorCreateVCard))
	};

	appCtxt.getAppController().sendRequest(params);
};

/**
 * @private
 */
ZmContact.prototype._handleResponseCreateVCard =
function(result) {
	appCtxt.getAppController().setStatusMsg(ZmMsg.contactCreated);
};

/**
 * @private
 */
ZmContact.prototype._handleErrorCreateVCard =
function(ex) {
	appCtxt.getAppController().setStatusMsg(ZmMsg.errorCreateContact, ZmStatusView.LEVEL_CRITICAL);
};

/**
 * Updates contact attributes.
 *
 * @param {Hash}	attr		a set of attributes and new values
 * @param {AjxCallback}	callback	the callback
 * @param {boolean} isAutoSave  true if it is a auto save and toast should not be displayed.
 */
ZmContact.prototype.modify =
function(attr, callback, isAutoSave, batchCmd) {
	if (this.isDistributionList()) {
		this._modifyDl(attr);
		return;
	}
	if (this.list.isGal) { return; }

	// change force to 0 and put up dialog if we get a MODIFY_CONFLICT fault?
	var jsonObj = {ModifyContactRequest:{_jsns:"urn:zimbraMail", replace:"0", force:"1"}};
	var cn = jsonObj.ModifyContactRequest.cn = {id:this.id};
	cn.a = [];
	cn.m = [];
	var continueRequest = false;
	
	for (var name in attr) {
		if (name == ZmContact.F_folderId) { continue; }
		if (name == ZmContact.F_groups) {
			this._addContactGroupAttr(cn, attr);	
		}
		else {
			this._addRequestAttr(cn, name, (attr[name] && attr[name].value) || attr[name]);
		}
		continueRequest = true;
	}

    // bug: 45026
    if (ZmContact.F_firstName in attr || ZmContact.F_lastName in attr || ZmContact.F_company in attr || ZmContact.X_fileAs in attr) {
        var contact = {};
        var fields = [ZmContact.F_firstName, ZmContact.F_lastName, ZmContact.F_company, ZmContact.X_fileAs];
        for (var i = 0; i < fields.length; i++) {
            var field = fields[i];
            var value = attr[field];
            contact[field] = value != null ? value : this.getAttr(field);
        }
        var fullName = ZmContact.computeFileAs(contact); 
        this._addRequestAttr(cn, ZmContact.X_fullName, fullName);
    }

	if (continueRequest) {
		if (batchCmd) {
			batchCmd.addRequestParams(jsonObj, null, null); //no need for response callback for current use-case (batch modifying zimlet image)
		}
		else {
			var respCallback = this._handleResponseModify.bind(this, attr, callback, isAutoSave);
			appCtxt.getAppController().sendRequest({jsonObj: jsonObj, asyncMode: true, callback: respCallback});
		}

	} else {
		if (attr[ZmContact.F_folderId]) {
			this._setFolder(attr[ZmContact.F_folderId]);
		}
	}
};

ZmContact.prototype._createDl =
function(attr) {

	this.attr = attr; //this is mainly important for the email. attr is not set before this.

	var createDlReq = this._getCreateDlReq(attr);

	var reqs = [];

	this._addMemberModsReqs(reqs, attr);

	this._addMailPolicyAndOwnersReqs(reqs, attr);

	var jsonObj = {
		BatchRequest: {
			_jsns: "urn:zimbra",
			CreateDistributionListRequest: createDlReq,
			DistributionListActionRequest: reqs
		}
	};
	var respCallback = this._createDlResponseHandler.bind(this);
	appCtxt.getAppController().sendRequest({jsonObj: jsonObj, asyncMode: true, callback: respCallback});
	
};

ZmContact.prototype._addMailPolicyAndOwnersReqs =
function(reqs, attr) {

	var mailPolicy = attr[ZmContact.F_dlMailPolicy];
	if (mailPolicy) {
		reqs.push(this._getSetMailPolicyReq(mailPolicy, attr[ZmContact.F_dlMailPolicySpecificMailers]));
	}

	var listOwners = attr[ZmContact.F_dlListOwners];
	if (listOwners) {
		reqs.push(this._getSetOwnersReq(listOwners));
	}


};



ZmContact.prototype._addMemberModsReqs =
function(reqs, attr) {
	var memberModifications = attr[ZmContact.F_groups];
	var adds = [];
	var removes = [];
	if (memberModifications) {
		for (var i = 0; i < memberModifications.length; i++) {
			var mod = memberModifications[i];
			var col = (mod.op == "+" ? adds : removes);
			col.push(mod);
		}
	}

	if (adds.length > 0) {
		reqs.push(this._getAddOrRemoveReq(adds, true));
	}
	if (removes.length > 0) {
		reqs.push(this._getAddOrRemoveReq(removes, false));
	}
};

ZmContact.prototype._modifyDl =
function(attr) {
	var reqs = [];

	var newEmail = attr[ZmContact.F_email];

	var emailChanged = false;
	if (newEmail !== undefined) {
		emailChanged = true;
		reqs.push(this._getRenameDlReq(newEmail));
		this.setAttr(ZmContact.F_email, newEmail);
	}

	var modDlReq = this._getModifyDlAttributesReq(attr);
	if (modDlReq) {
		reqs.push(modDlReq);
	}

	var displayName = attr[ZmContact.F_dlDisplayName];
	if (displayName !== undefined) {
		this.setAttr(ZmContact.F_dlDisplayName, displayName);
	}

	var oldFileAs = this.getFileAs();
	this._resetCachedFields();
	var fileAsChanged = oldFileAs != this.getFileAs();

	this._addMemberModsReqs(reqs, attr);

	this._addMailPolicyAndOwnersReqs(reqs, attr);

	if (reqs.length == 0) {
		this._modifyDlResponseHandler(false, null); //pretend it was saved
		return;
	}
	var jsonObj = {
		BatchRequest: {
			_jsns: "urn:zimbra",
			DistributionListActionRequest: reqs
		}
	};
	var respCallback = this._modifyDlResponseHandler.bind(this, fileAsChanged || emailChanged); //there's some issue with fileAsChanged so adding the emailChanged to be on safe side
	appCtxt.getAppController().sendRequest({jsonObj: jsonObj, asyncMode: true, callback: respCallback});

};

ZmContact.prototype._getAddOrRemoveReq =
function(members, add) {
	var req = {
		_jsns: "urn:zimbraAccount",
		dl: {by: "name",
			 _content: this.getEmail()
		},
		action: {
			op: add ? "addMembers" : "removeMembers",
			dlm: []
		}
	};
	for (var i = 0; i < members.length; i++) {
		var member = members[i];
		req.action.dlm.push({_content: member.email});
	}
	return req;

};


ZmContact.prototype._getRenameDlReq =
function(name) {
	return {
		_jsns: "urn:zimbraAccount",
		dl: {by: "name",
			 _content: this.getEmail()
		},
		action: {
			op: "rename",
			newName: {_content: name}
		}
	};
};

ZmContact.prototype._getSetOwnersReq =
function(owners) {
	var ownersPart = [];
	for (var i = 0; i < owners.length; i++) {
		ownersPart.push({
			type: ZmGroupView.GRANTEE_TYPE_USER,
			by: "name",
			_content: owners[i]
		});
	}
	return {
		_jsns: "urn:zimbraAccount",
		dl: {by: "name",
			 _content: this.getEmail()
		},
		action: {
			op: "setOwners",
			owner: ownersPart
		}
	};
};

ZmContact.prototype._getSetMailPolicyReq =
function(mailPolicy, specificMailers) {
	var grantees = [];
	if (mailPolicy == ZmGroupView.MAIL_POLICY_SPECIFIC) {
		for (var i = 0; i < specificMailers.length; i++) {
			grantees.push({
				type: ZmGroupView.GRANTEE_TYPE_EMAIL,
				by: "name",
				_content: specificMailers[i]
			});
		}
	}
	else if (mailPolicy == ZmGroupView.MAIL_POLICY_ANYONE) {
		grantees.push({
			type: ZmGroupView.GRANTEE_TYPE_PUBLIC
		});
	}
	else if (mailPolicy == ZmGroupView.MAIL_POLICY_INTERNAL) {
		grantees.push({
			type: ZmGroupView.GRANTEE_TYPE_ALL
		});
	}
	else if (mailPolicy == ZmGroupView.MAIL_POLICY_MEMBERS) {
		grantees.push({
			type: ZmGroupView.GRANTEE_TYPE_GROUP,
			by: "name",
			_content: this.getEmail()
		});
	}
	else {
		throw "invalid mailPolicy value " + mailPolicy;
	}

	return {
		_jsns: "urn:zimbraAccount",
		dl: {by: "name",
			 _content: this.getEmail()
		},
		action: {
			op: "setRights",
			right: {
				right: "sendToDistList",
				grantee: grantees
			}
		}
	};

};

ZmContact.prototype._addDlAttribute =
function(attrs, mods, name, soapAttrName) {
	var attr = mods[name];
	if (attr === undefined) {
		return;
	}
	attrs.push({n: soapAttrName, _content: attr});
};

ZmContact.prototype._getDlAttributes =
function(mods) {
	var attrs = [];
	this._addDlAttribute(attrs, mods, ZmContact.F_dlDisplayName, "displayName");
	this._addDlAttribute(attrs, mods, ZmContact.F_dlDesc, "description");
	this._addDlAttribute(attrs, mods, ZmContact.F_dlNotes, "zimbraNotes");
	this._addDlAttribute(attrs, mods, ZmContact.F_dlHideInGal, "zimbraHideInGal");
	this._addDlAttribute(attrs, mods, ZmContact.F_dlSubscriptionPolicy, "zimbraDistributionListSubscriptionPolicy");
	this._addDlAttribute(attrs, mods, ZmContact.F_dlUnsubscriptionPolicy, "zimbraDistributionListUnsubscriptionPolicy");

	return attrs;
};


ZmContact.prototype._getCreateDlReq =
function(attr) {
	return {
		_jsns: "urn:zimbraAccount",
		name: attr[ZmContact.F_email],
		a: this._getDlAttributes(attr),
		dynamic: false
	};
};

ZmContact.prototype._getModifyDlAttributesReq =
function(attr) {
	var modAttrs = this._getDlAttributes(attr);
	if (modAttrs.length == 0) {
		return null;
	}
	return {
		_jsns: "urn:zimbraAccount",
		dl: {by: "name",
			 _content: this.getEmail()
		},
		action: {
			op: "modify",
			a: modAttrs
		}
	};
};

ZmContact.prototype._modifyDlResponseHandler =
function(fileAsChanged, result) {
	if (this._handleErrorDl(result)) {
		return;
	}
	appCtxt.setStatusMsg(ZmMsg.dlSaved);

	//for DLs we reload from the server since the server does not send notifications.
	this.clearDlInfo();

	var details = {
		fileAsChanged: fileAsChanged
	};

	this._popView(fileAsChanged);

	this._notify(ZmEvent.E_MODIFY, details);
};

ZmContact.prototype._createDlResponseHandler =
function(result) {
	if (this._handleErrorDl(result, true)) {
		this.attr = {}; //since above in _createDl, we set it to new values prematurely. which would affect next gathering of modified attributes.
		return;
	}
	appCtxt.setStatusMsg(ZmMsg.distributionListCreated);

	this._popView(true);
};

ZmContact.prototype._popView =
function(updateDlList) {
	var controller = AjxDispatcher.run("GetContactController");
	controller.popView(true);
	if (!updateDlList) {
		return;
	}
	var clc = AjxDispatcher.run("GetContactListController");
	if (clc.getFolderId() != ZmFolder.ID_DLS) {
		return;
	}
	ZmAddrBookTreeController.dlFolderClicked(); //This is important in case of new DL created OR a renamed DL, so it would reflect in the list.
};

ZmContact.prototype._handleErrorDl =
function(result, creation) {
	if (!result) {
		return false;
	}
	var batchResp = result.getResponse().BatchResponse;
	var faults = batchResp.Fault;
	if (!faults) {
		return false;
	}
	var ex = ZmCsfeCommand.faultToEx(faults[0]);
	var controller = AjxDispatcher.run("GetContactController");
	controller.popupErrorDialog(creation ? ZmMsg.dlCreateFailed : ZmMsg.dlModifyFailed, ex);
	return true;

};

ZmContact.prototype.clearDlInfo =
function () {
	this.dlMembers = null;
	this.dlInfo = null;
	var app = appCtxt.getApp(ZmApp.CONTACTS);
	app.cacheDL(this.getEmail(), null); //clear the cache for this DL.
	appCtxt.cacheRemove(this.getId()); //also some other cache.
};

/**
 * @private
 */
ZmContact.prototype._handleResponseModify =
function(attr, callback, isAutoSave, result) {
	var resp = result.getResponse().ModifyContactResponse;
	var cn = resp ? resp.cn[0] : null;
	var id = cn ? cn.id : null;
	var groupMembers = cn ? cn.m : null;
	if (groupMembers) {
		this.attr[ZmContact.F_groups] = groupMembers;
		cn._attrs[ZmContact.F_groups] = groupMembers;	
	}

	if (id && id == this.id) {
		if (!isAutoSave) {
			appCtxt.setStatusMsg(this.isGroup() ? ZmMsg.groupSaved : ZmMsg.contactSaved);
		}
		// was this contact moved to another folder?
		if (attr[ZmContact.F_folderId] && this.folderId != attr[ZmContact.F_folderId]) {
			this._setFolder(attr[ZmContact.F_folderId]);
		}
		appCtxt.getApp(ZmApp.CONTACTS).updateIdHash(cn, false);
	} else {
        var detail = ZmMsg.errorTryAgain + "\n" + ZmMsg.errorContact;
        appCtxt.getAppController().setStatusMsg(ZmMsg.errorModifyContact, ZmStatusView.LEVEL_CRITICAL, detail);
	}
	// NOTE: we no longer process callbacks here since notification handling
	//       takes care of everything
};

/**
 * @private
 */
ZmContact.prototype._handleResponseMove =
function(newFolderId, resp) {
	var newFolder = newFolderId && appCtxt.getById(newFolderId);
	var count = 1;
	if (newFolder) {
		appCtxt.setStatusMsg(ZmList.getActionSummary({
			actionTextKey:  'actionMove',
			numItems:       count,
			type:           ZmItem.CONTACT,
			actionArg:      newFolder.name
		}));
	}

	this._notify(ZmEvent.E_MODIFY, resp);
};

/**
 * @private
 */
ZmContact.prototype._setFolder =
function(newFolderId) {
	var folder = appCtxt.getById(this.folderId);
	var fId = folder ? folder.nId : null;
	if (fId == newFolderId) { return; }

	// moving out of a share or into one is handled differently (create then hard delete)
	var newFolder = appCtxt.getById(newFolderId);
	if (this.isShared() || (newFolder && newFolder.link)) {
		if (this.list) {
			this.list.moveItems({items:[this], folder:newFolder});
		}
	} else {
		var jsonObj = {ContactActionRequest:{_jsns:"urn:zimbraMail"}};
		jsonObj.ContactActionRequest.action = {id:this.id, op:"move", l:newFolderId};
		var respCallback = new AjxCallback(this, this._handleResponseMove, [newFolderId]);
		var accountName = appCtxt.multiAccounts && appCtxt.accountList.mainAccount.name;
		appCtxt.getAppController().sendRequest({jsonObj:jsonObj, asyncMode:true, callback:respCallback, accountName:accountName});
	}
};

/**
 * @private
 */
ZmContact.prototype.notifyModify =
function(obj, batchMode) {

	var result = ZmItem.prototype.notifyModify.apply(this, arguments);

	var context = window.parentAppCtxt || window.appCtxt;
	context.clearAutocompleteCache(ZmAutocomplete.AC_TYPE_CONTACT);

	if (result) {
		return result;
	}

	// cache old fileAs/fullName before resetting them
	var oldFileAs = this.getFileAs();
	var oldFullName = this.getFullName();
	this._resetCachedFields();

	var oldAttrCache = {};
	if (obj._attrs) {
		// remove attrs that were not returned back from the server
		var oldAttrs = this.getAttrs();
		for (var a in oldAttrs) {
			oldAttrCache[a] = oldAttrs[a];
			if (obj._attrs[a] == null)
				this.removeAttr(a);
		}

		// set attrs returned by server
		for (var a in obj._attrs) {
			this.setAttr(a, obj._attrs[a]);
		}
		if (obj.m) {
			this.setAttr(ZmContact.F_groups, obj.m);
		}
	}

	var details = {
		attr: obj._attrs,
		oldAttr: oldAttrCache,
		fullNameChanged: (this.getFullName() != oldFullName),
		fileAsChanged: (this.getFileAs() != oldFileAs),
		contact: this
	};

	// update this contact's list per old/new attrs
	for (var listId in this._list) {
		var list = listId && appCtxt.getById(listId);
		if (!list) { continue; }
		list.modifyLocal(obj, details);
	}

	this._notify(ZmEvent.E_MODIFY, obj);
};

/**
 * @private
 */
ZmContact.prototype.notifyDelete =
function() {
	ZmItem.prototype.notifyDelete.call(this);
	var context = window.parentAppCtxt || window.appCtxt;
	context.clearAutocompleteCache(ZmAutocomplete.AC_TYPE_CONTACT);
};

/**
 * Initializes this contact using an email address.
 *
 * @param {AjxEmailAddress|String}	email		an email address or an email string
 * @param {Boolean}	strictName	if <code>true</code>, do not try to set name from user portion of address
 */
ZmContact.prototype.initFromEmail =
function(email, strictName) {
	if (email instanceof AjxEmailAddress) {
		this.setAttr(ZmContact.F_email, email.getAddress());
		this._initFullName(email, strictName);
	} else {
		this.setAttr(ZmContact.F_email, email);
	}
};

/**
 * Initializes this contact using a phone number.
 *
 * @param {String}	phone		the phone string
 * @param {String}	field		the field or company phone if <code>null</code>
 */
ZmContact.prototype.initFromPhone =
function(phone, field) {
	this.setAttr(field || ZmContact.F_companyPhone, phone);
};

/**
 * Gets the email address.
 * 
 * @param {boolean}		asObj	if true, return an AjxEmailAddress
 * 
 * @return	the email address
 */
ZmContact.prototype.getEmail =
function(asObj) {

	var email = (this.getAttr(ZmContact.F_email) ||
				 this.getAttr(ZmContact.F_workEmail1) ||
				 this.getAttr(ZmContact.F_email2) ||
				 this.getAttr(ZmContact.F_workEmail2) ||
				 this.getAttr(ZmContact.F_email3) ||
				 this.getAttr(ZmContact.F_workEmail3));
	
	if (asObj) {
		email = AjxEmailAddress.parse(email);
        if(email){
		    email.isGroup = this.isGroup();
		    email.canExpand = this.canExpand;
        }
	}
	
	return email;
};

/**
 * Returns user's phone number
 * @return {String} phone number
 */
ZmContact.prototype.getPhone = 
function() {
	var phone = (this.getAttr(ZmContact.F_mobilePhone) ||
				this.getAttr(ZmContact.F_workPhone) || 
				this.getAttr(ZmContact.F_homePhone) ||
				this.getAttr(ZmContact.F_otherPhone));
	return phone;
};

    
/**
 * Gets the lookup email address, when an contact object is located using email address we store
 * the referred email address in this variable for easy lookup
 *
 * @param {boolean}		asObj	if true, return an AjxEmailAddress
 *
 * @return	the lookup address
 */
ZmContact.prototype.getLookupEmail =
function(asObj) {
    var email = this._lookupEmail;

    if (asObj && email) {
        email = AjxEmailAddress.parse(email);
        email.isGroup = this.isGroup();
        email.canExpand = this.canExpand;
    }

	return  email;
};

/**
 * Gets the emails.
 * 
 * @return	{Array}	 an array of all valid emails for this contact
 */
ZmContact.prototype.getEmails =
function() {
	var emails = [];
	var attrs = this.getAttrs();
	for (var index = 0; index < ZmContact.EMAIL_FIELDS.length; index++) {
		var field = ZmContact.EMAIL_FIELDS[index];
		for (var i = 1; true; i++) {
			var aname = ZmContact.getAttributeName(field, i);
			if (!attrs[aname]) break;
			emails.push(attrs[aname]);
		}
	}
	return emails;
};

/**
 * Gets the full name.
 * 
 * @return	{String}	the full name
 */
ZmContact.prototype.getFullName =
function(html) {
    var fullNameHtml = null;
	if (!this._fullName || html) {
		var fullName = this.getAttr(ZmContact.X_fullName); // present if GAL contact
		if (fullName) {
			this._fullName = (fullName instanceof Array) ? fullName[0] : fullName;
		}
        else {
            this._fullName = this.getFullNameForDisplay(false);
        }

        if (html) {
            fullNameHtml = this.getFullNameForDisplay(html);
        }
	}

	// as a last resort, set it to fileAs
	if (!this._fullName) {
		this._fullName = this.getFileAs();
	}

	return fullNameHtml || this._fullName;
};

/*
* Gets the fullname for display -- includes (if applicable): prefix, first, middle, maiden, last, suffix
*
* @param {boolean}  if phonetic fields should be used
* @return {String}  the fullname for display
*/
ZmContact.prototype.getFullNameForDisplay =
function(html){
	if (this.isDistributionList()) {
		//I'm not sure where that fullName is set sometime to the display name. This is so complicated
		// I'm trying to set attr[ZmContact.F_dlDisplayName] to the display name but in soem cases it's not.
		return this.getAttr(ZmContact.F_dlDisplayName) || this.getAttr("fullName");
	}
    var prefix = this.getAttr(ZmContact.F_namePrefix);
    var first = this.getAttr(ZmContact.F_firstName);
    var middle = this.getAttr(ZmContact.F_middleName);
    var maiden = this.getAttr(ZmContact.F_maidenName);
    var last = this.getAttr(ZmContact.F_lastName);
    var suffix = this.getAttr(ZmContact.F_nameSuffix);
    var pattern = ZmMsg.fullname;
    if (suffix) {
        pattern = maiden ? ZmMsg.fullnameMaidenSuffix : ZmMsg.fullnameSuffix;
    }
    else if (maiden) {
        pattern = ZmMsg.fullnameMaiden;
    }
    if (appCtxt.get(ZmSetting.LOCALE_NAME) === "ja") {
        var fileAsId = this.getAttr(ZmContact.F_fileAs);
        if (!AjxUtil.isEmpty(fileAsId) && fileAsId !== "1" && fileAsId !== "4" && fileAsId !== "6") {
            /* When Japanese locale is selected, in the most every case, the name should be
             * displayed as "Last First" which is set by the default pattern (ZmMsg_ja.fullname).
             * But if the contact entry's fileAs field explicitly specifies the display
             * format as "First Last", we should override the pattern to lay it out so.
             * For other locales, it is not necessary to override the pattern: The default pattern is
             * already set as "First Last", and even the FileAs specifies as "Last, First", the display
             * name is always expected to be displayed as "First Last".
             */
            pattern = "{0} {1} {2} {4}";
        }
    }
    var formatter = new AjxMessageFormat(pattern);
    var args = [prefix,first,middle,maiden,last,suffix];
    if (!html){
        return AjxStringUtil.trim(formatter.format(args), true);
    }

    return this._getFullNameHtml(formatter, args);
};

/**
 * @param formatter
 * @param parts {Array} Name parts: [prefix,first,middle,maiden,last,suffix]
 */
ZmContact.prototype._getFullNameHtml = function(formatter, parts) {
    var a = [];
    var segments = formatter.getSegments();
    for (var i = 0; i < segments.length; i++) {
        var segment = segments[i];
        if (segment instanceof AjxFormat.TextSegment) {
            a.push(segment.format());
            continue;
        }
        // NOTE: Assume that it's a AjxMessageFormat.MessageSegment
        // NOTE: if not a AjxFormat.TextSegment.
        var index = segment.getIndex();
        var base = parts[index];
        var text = ZmContact.__RUBY_FIELDS[index] && this.getAttr(ZmContact.__RUBY_FIELDS[index]);
        a.push(AjxStringUtil.htmlRubyEncode(base, text));
    }
    return a.join("");
};
ZmContact.__RUBY_FIELDS = [
    null, ZmContact.F_phoneticFirstName, null, null,
    ZmContact.F_phoneticLastName, null
];

/**
 * Gets the tool tip for this contact.
 * 
 * @param	{String}	email		the email address
 * @param	{Boolean}	isGal		(not used)
 * @param	{String}	hint		the hint text
 * @return	{String}	the tool tip in HTML
 */
ZmContact.prototype.getToolTip =
function(email, isGal, hint) {
	// XXX: we dont cache tooltip info anymore since its too dynamic :/
	// i.e. IM status can change anytime so always rebuild tooltip and bug 13834
	var subs = {
		contact: this,
		entryTitle: this.getFileAs(),
		hint: hint
	};

	return (AjxTemplate.expand("abook.Contacts#Tooltip", subs));
};

/**
 * Gets the filing string for this contact, computing it if necessary.
 * 
 * @param	{Boolean}	lower		<code>true</code> to use lower case
 * @return	{String}	the file as string
 */
ZmContact.prototype.getFileAs =
function(lower) {
	// update/null if modified
	if (!this._fileAs) {
		this._fileAs = ZmContact.computeFileAs(this);
		this._fileAsLC = this._fileAs ? this._fileAs.toLowerCase() : null;
	}
	// if for some reason fileAsLC is not set even though fileAs is, reset it
	if (lower && !this._fileAsLC) {
		this._fileAsLC = this._fileAs.toLowerCase();
	}
	return lower ? this._fileAsLC : this._fileAs;
};

/**
 * Gets the filing string for this contact, from the email address (used in case no name exists).
 * todo - maybe return this from getFileAs, but there are a lot of callers to getFileAs, and not sure
 * of the implications on all the use-cases.
 *
 * @return	{String}	the file as string
 */
ZmContact.prototype.getFileAsNoName = function() {
	return [ZmMsg.noName, this.getEmail()].join(" ");
};

/**
 * Gets the header.
 * 
 * @return	{String}	the header
 */
ZmContact.prototype.getHeader =
function() {
	return this.id ? this.getFileAs() : ZmMsg.newContact;
};

ZmContact.NO_MAX_IMAGE_WIDTH = ZmContact.NO_MAX_IMAGE_HEIGHT = - 1;

/**
 * Get the image URL.
 *
 * Please note that maxWidth and maxHeight are hints, as they have no
 * effect on Zimlet-supplied images.
 *
 * maxWidth {int} max pixel width (optional - default 48, or pass ZmContact.NO_MAX_IMAGE_WIDTH if full size image is required)
 * maxHeight {int} max pixel height (optional - default to maxWidth, or pass ZmContact.NO_MAX_IMAGE_HEIGHT if full size image is required)
 * @return	{String}	the image URL
 */
ZmContact.prototype.getImageUrl =
function(maxWidth, maxHeight) {
  	var image = this.getAttr(ZmContact.F_image);
	var imagePart  = image && image.part || this.getAttr(ZmContact.F_imagepart); //see bug 73146

	if (!imagePart) {
		return this.getAttr(ZmContact.F_zimletImage);  //return zimlet populated image only if user-uploaded image is not there.
	}
  	var msgFetchUrl = appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI);
	var maxWidthStyle = "";
	if (maxWidth !== ZmContact.NO_MAX_IMAGE_WIDTH) {
		maxWidth = maxWidth || 48;
		maxWidthStyle = ["&max_width=", maxWidth].join("");
	}
	var maxHeightStyle = "";
	if (maxHeight !== ZmContact.NO_MAX_IMAGE_HEIGHT) {
		maxHeight = maxHeight ||
			(maxWidth !== ZmContact.NO_MAX_IMAGE_WIDTH ? maxWidth : 48);
		maxHeightStyle = ["&max_height=", maxHeight].join("");
	}
  	return  [msgFetchUrl, "&id=", this.id, "&part=", imagePart, maxWidthStyle, maxHeightStyle, "&t=", (new Date()).getTime()].join("");
};

ZmContact.prototype.addModifyZimletImageToBatch =
function(batchCmd, image) {
	var attr = {};
	if (this.getAttr(ZmContact.F_zimletImage) === image) {
		return; //no need to update if same
	}
	attr[ZmContact.F_zimletImage] = image;
	batchCmd.add(this.modify.bind(this, attr, null, true));
};

/**
 * Gets the company field. Company field has a getter b/c fileAs may be the Company name so
 * company field should return "last, first" name instead *or* prepend the title
 * if fileAs is not Company (assuming it exists).
 * 
 * @return	{String}	the company
 */
ZmContact.prototype.getCompanyField =
function() {

	var attrs = this.getAttrs();
	if (attrs == null) return null;

	var fa = parseInt(attrs.fileAs);
	var val = [];
	var idx = 0;

	if (fa == ZmContact.FA_LAST_C_FIRST || fa == ZmContact.FA_FIRST_LAST) {
		// return the title, company name
		if (attrs.jobTitle) {
			val[idx++] = attrs.jobTitle;
			if (attrs.company)
				val[idx++] = ", ";
		}
		if (attrs.company)
			val[idx++] = attrs.company;

	} else if (fa == ZmContact.FA_COMPANY) {
		// return the first/last name
		if (attrs.lastName) {
			val[idx++] = attrs.lastName;
			if (attrs.firstName)
				val[idx++] = ", ";
		}

		if (attrs.firstName)
			val[idx++] = attrs.firstName;

		if (attrs.jobTitle)
			val[idx++] = " (" + attrs.jobTitle + ")";

	} else {
		// just return the title
		if (attrs.jobTitle) {
			val[idx++] = attrs.jobTitle;
			// and/or company name if applicable
			if (attrs.company && (attrs.fileAs == null || fa == ZmContact.FA_LAST_C_FIRST || fa == ZmContact.FA_FIRST_LAST))
				val[idx++] = ", ";
		}
		if (attrs.company && (attrs.fileAs == null || fa == ZmContact.FA_LAST_C_FIRST || fa == ZmContact.FA_FIRST_LAST))
			 val[idx++] = attrs.company;
	}
	if (val.length == 0) return null;
	return val.join("");
};

/**
 * Gets the work address.
 * 
 * @param	{Object}	instance		(not used)
 * @return	{String}	the work address
 */
ZmContact.prototype.getWorkAddrField =
function(instance) {
	var attrs = this.getAttrs();
	return this._getAddressField(attrs.workStreet, attrs.workCity, attrs.workState, attrs.workPostalCode, attrs.workCountry);
};

/**
 * Gets the home address.
 * 
 * @param	{Object}	instance		(not used)
 * @return	{String}	the home address
 */
ZmContact.prototype.getHomeAddrField =
function(instance) {
	var attrs = this.getAttrs();
	return this._getAddressField(attrs.homeStreet, attrs.homeCity, attrs.homeState, attrs.homePostalCode, attrs.homeCountry);
};

/**
 * Gets the other address.
 * 
 * @param	{Object}	instance		(not used)
 * @return	{String}	the other address
 */
ZmContact.prototype.getOtherAddrField =
function(instance) {
	var attrs = this.getAttrs();
	return this._getAddressField(attrs.otherStreet, attrs.otherCity, attrs.otherState, attrs.otherPostalCode, attrs.otherCountry);
};

/**
 * Gets the address book.
 * 
 * @return	{ZmAddrBook}	the address book
 */
ZmContact.prototype.getAddressBook =
function() {
	if (!this.addrbook) {
		this.addrbook = appCtxt.getById(this.folderId);
	}
	return this.addrbook;
};

/**
 * @private
 */
ZmContact.prototype._getAddressField =
function(street, city, state, zipcode, country) {
	if (street == null && city == null && state == null && zipcode == null && country == null) return null;

	var html = [];
	var idx = 0;

	if (street) {
		html[idx++] = street;
		if (city || state || zipcode)
			html[idx++] = "\n";
	}

	if (city) {
		html[idx++] = city;
		if (state)
			html[idx++] = ", ";
		else if (zipcode)
			html[idx++] = " ";
	}

	if (state) {
		html[idx++] = state;
		if (zipcode)
			html[idx++] = " ";
	}

	if (zipcode)
		html[idx++] = zipcode;

	if (country)
		html[idx++] = "\n" + country;

	return html.join("");
};

/**
 * Sets the full name based on an email address.
 * 
 * @private
 */
ZmContact.prototype._initFullName =
function(email, strictName) {
	var name = email.getName();
	name = AjxStringUtil.trim(name.replace(AjxEmailAddress.commentPat, '')); // strip comment (text in parens)

	if (name && name.length) {
		this._setFullName(name, [" "]);
	} else if (!strictName) {
		name = email.getAddress();
		if (name && name.length) {
			var i = name.indexOf("@");
			if (i == -1) return;
			name = name.substr(0, i);
			this._setFullName(name, [".", "_"]);
		}
	}
};

/**
 * Tries to extract a set of name components from the given text, with the
 * given list of possible delimiters. The first delimiter contained in the
 * text will be used. If none are found, the first delimiter in the list is used.
 * 
 * @private
 */
ZmContact.prototype._setFullName =
function(text, delims) {
	var delim = delims[0];
	for (var i = 0; i < delims.length; i++) {
		if (text.indexOf(delims[i]) != -1) {
			delim = delims[i];
			break;
		}
	}
    var parts = text.split(delim);
    var func = this["__setFullName_"+AjxEnv.DEFAULT_LOCALE] || this.__setFullName;
    func.call(this, parts, text, delims);
};

ZmContact.prototype.__setFullName = function(parts, text, delims) {
    this.setAttr(ZmContact.F_firstName, parts[0]);
    if (parts.length == 2) {
        this.setAttr(ZmContact.F_lastName, parts[1]);
    } else if (parts.length == 3) {
        this.setAttr(ZmContact.F_middleName, parts[1]);
        this.setAttr(ZmContact.F_lastName, parts[2]);
    }
};
ZmContact.prototype.__setFullName_ja = function(parts, text, delims) {
    if (parts.length > 2) {
        this.__setFullName(parts, text, delims);
        return;
    }
    // TODO: Perhaps do some analysis to auto-detect Japanese vs.
    // TODO: non-Japanese names. For example, if the name text is
    // TODO: comprised of kanji, treat it as "last first"; else if
    // TODO: first part is all uppercase, treat it as "last first";
    // TODO: else treat it as "first last".
    this.setAttr(ZmContact.F_lastName, parts[0]);
    if (parts.length > 1) {
        this.setAttr(ZmContact.F_firstName, parts[1]);
    }
};
ZmContact.prototype.__setFullName_ja_JP = ZmContact.prototype.__setFullName_ja;

/**
 * @private
 */
ZmContact.prototype._addRequestAttr =
function(cn, name, value) {
	var a = {n:name};
	if (name == ZmContact.F_image && AjxUtil.isString(value) && value.length) {
		// handle contact photo
		if (value.indexOf("aid_") != -1) {
			a.aid = value.substring(4);
		} else {
			a.part = value.substring(5);
		}
	} else {
		a._content = value || "";
	}

    if (value instanceof Array) {
        if (!cn._attrs)
            cn._attrs = {};
        cn._attrs[name] = value || "";
    }
    else  {
        if (!cn.a)
            cn.a = [];
        cn.a.push(a);
    }
};
	
ZmContact.prototype._addContactGroupAttr = 
function(cn, group) {
	var groupMembers = group[ZmContact.F_groups];
	for (var i = 0; i < groupMembers.length; i++) {
		var member = groupMembers[i];
		if (!cn.m) {
			cn.m = [];
		}

		var m = {type: member.type,	value: member.value}; //for the JSON object this is all we need.
		if (member.op) {
			m.op = member.op; //this is only for modify, not for create.
		}
		cn.m.push(m);
	}
};

/**
 * Reset computed fields.
 * 
 * @private
 */
ZmContact.prototype._resetCachedFields =
function() {
	this._fileAs = this._fileAsLC = this._fullName = null;
};

/**
 * Parse contact node.
 * 
 * @private
 */
ZmContact.prototype._loadFromDom =
function(node) {
	this.isLoaded = true;
	this.rev = node.rev;
	this.sf = node.sf || node._attrs.sf;
	if (!this.isGal) {
		this.folderId = node.l;
	}
	this.created = node.cd;
	this.modified = node.md;

	this.attr = node._attrs || {};
	if (node.m) {
		this.attr[ZmContact.F_groups] = node.m;
	}

	this.ref = node.ref || this.attr.dn; //bug 78425
	
	// for shared contacts, we get these fields outside of the attr part
	if (node.email)		{ this.attr[ZmContact.F_email] = node.email; }
	if (node.email2)	{ this.attr[ZmContact.F_email2] = node.email2; }
	if (node.email3)	{ this.attr[ZmContact.F_email3] = node.email3; }

	// in case attrs are coming in from an external GAL, make an effort to map them, including multivalued ones
	this.attr = ZmContact.mapAttrs(this.attr);

    //the attr groups is returned as [] so check both null and empty array to set the type
    var groups = this.attr[ZmContact.F_groups];
    if(!groups || (groups instanceof Array && groups.length == 0)) {
        this.type = ZmItem.CONTACT;
    }
    else {
        this.type = ZmItem.GROUP;
    }

	// check if the folderId is found in our address book (otherwise, we assume
	// this contact to be a shared contact)
	var ac = window.parentAppCtxt || window.appCtxt;
	this.addrbook = ac.getById(this.folderId);

	this._parseTagNames(node.tn);

	// dont process flags for shared contacts until we get server support
	if (!this.isShared()) {
		this._parseFlags(node.f);
	} else {
		// shared contacts are never fully loaded since we never cache them
		this.isLoaded = false;
	}

	// bug: 22174
	// We ignore the server's computed file-as property and instead
	// format it based on the user's locale.
	this._fileAs = ZmContact.computeFileAs(this);

	// Is this a distribution list?
	this.isDL = this.isDistributionList();
	if (this.isDL) {
		this.dlInfo = { //this is minimal DL info, available mainly to allow to know whether to show the lock or not.
			isMinimal: true,
			isMember: node.isMember,
			isOwner: node.isOwner,
			subscriptionPolicy: this.attr.zimbraDistributionListSubscriptionPolicy,
			unsubscriptionPolicy: this.attr.zimbraDistributionListUnsubscriptionPolicy,
			displayName: node.d || "",
			hideInGal: this.attr.zimbraHideInGal == "TRUE"
		};

		this.canExpand = node.exp !== false; //default to true, since most cases this is implicitly true if not returned. See bug 94867
		var emails = this.getEmails();
		var ac = window.parentAppCtxt || window.appCtxt;
		for (var i = 0; i < emails.length; i++) {
			ac.setIsExpandableDL(emails[i], this.canExpand);
		}
	}
	//S/MIME: If user certificate is present, include it into contact's object
	if (node.certificate) {
		this.certificate = node.certificate;
	}
};

/**
 * Gets display text for an attendee. Prefers name over email.
 *
 * @param {constant}	type		the attendee type
 * @param {Boolean}	shortForm		if <code>true</code>, return only name or email
 * @return	{String}	the attendee
 */
ZmContact.prototype.getAttendeeText =
function(type, shortForm) {
	var email = this.getEmail(true);
	return (email?email.toString(shortForm || (type && type != ZmCalBaseItem.PERSON)):"");
};

/**
 * Gets display text for an attendee. Prefers name over email.
 *
 * @param {constant}	type		the attendee type
 * @param {Boolean}	shortForm		if <code>true</code>, return only name or email
 * @return	{String}	the attendee
 */
ZmContact.prototype.getAttendeeKey =
function() {
	var email = this.getLookupEmail() || this.getEmail();
	var name = this.getFullName();
	return email ? email : name;
};

/**
 * Gets the unknown fields.
 * 
 * @param	{function}	[sortByNameFunc]	sort by function
 * @return	{Array}	an array of field name/value pairs
 */
ZmContact.prototype.getUnknownFields = function(sortByNameFunc) {
	var map = ZmContact.__FIELD_MAP;
	if (!map) {
		map = ZmContact.__FIELD_MAP = {};
		for (var i = 0; i < ZmContact.DISPLAY_FIELDS; i++) {
			map[ZmContact.DISPLAY_FIELDS[i]] = true;
		}
	}
	var fields = [];
	var attrs = this.getAttrs();
	for (var aname in attrs) {
		var field = ZmContact.getPrefix(aname);
		if (map[aname]) continue;
		fields.push(field);
	}
	return this.getFields(fields, sortByNameFunc);
};

/**
 * Gets the fields.
 * 
 * @param	{Array}	field		the fields
 * @param	{function}	[sortByNameFunc]	sort by function
 * @return	{Array}	an array of field name/value pairs
 */
ZmContact.prototype.getFields =
function(fields, sortByNameFunc) {
	// TODO: [Q] Should sort function handle just the field names or the attribute names?
	var selection;
	var attrs = this.getAttrs();
	for (var index = 0; index < fields.length; index++) {
		for (var i = 1; true; i++) {
			var aname = ZmContact.getAttributeName(fields[index], i);
			if (!attrs[aname]) break;
			if (!selection) selection = {};
			selection[aname] = attrs[aname];
		}
	}
	if (sortByNameFunc && selection) {
		var keys = AjxUtil.keys(selection);
		keys.sort(sortByNameFunc);
		var nfields = {};
		for (var i = 0; i < keys; i++) {
			var key = keys[i];
			nfields[key] = fields[key];
		}
		selection = nfields;
	}
	return selection;
};

/**
 * Returns a list of distribution list members for this contact. Only the
 * requested range is returned.
 *
 * @param offset	{int}			offset into list to start at
 * @param limit		{int}			number of members to fetch and return
 * @param callback	{AjxCallback}	callback to run with results
 */
ZmContact.prototype.getDLMembers =
function(offset, limit, callback) {

	var result = {list:[], more:false, isDL:{}};
	if (!this.isDL) { return result; }

	var email = this.getEmail();
	var app = appCtxt.getApp(ZmApp.CONTACTS);
	var dl = app.getDL(email);
	if (!dl) {
		dl = result;
		dl.more = true;
		app.cacheDL(email, dl);
	}

	limit = limit || ZmContact.DL_PAGE_SIZE;
	var start = offset || 0;
	var end = (offset + limit) - 1;

	// see if we already have the requested members, or know that we don't
	if (dl.list.length >= end + 1 || !dl.more) {
		var list = dl.list.slice(offset, end + 1);
		result = {list:list, more:dl.more || (dl.list.length > end + 1), isDL:dl.isDL};
		DBG.println("dl", "found cached DL members");
		this._handleResponseGetDLMembers(start, limit, callback, result);
		return;
	}

	DBG.println("dl", "server call " + offset + " / " + limit);
	if (!dl.total || (offset < dl.total)) {
		var jsonObj = {GetDistributionListMembersRequest:{_jsns:"urn:zimbraAccount", offset:offset, limit:limit}};
		var request = jsonObj.GetDistributionListMembersRequest;
		request.dl = {_content: this.getEmail()};
		var respCallback = new AjxCallback(this, this._handleResponseGetDLMembers, [offset, limit, callback]);
		appCtxt.getAppController().sendRequest({jsonObj:jsonObj, asyncMode:true, callback:respCallback});
	} else {
		this._handleResponseGetDLMembers(start, limit, callback, result);
	}
};

ZmContact.prototype._handleResponseGetDLMembers =
function(offset, limit, callback, result, resp) {

	if (resp || !result.list) {
		var list = [];
		resp = resp || result.getResponse();  //if response is passed, take it. Otherwise get it from result
		resp = resp.GetDistributionListMembersResponse;
		var dl = appCtxt.getApp(ZmApp.CONTACTS).getDL(this.getEmail());
		var more = dl.more = resp.more;
		var isDL = {};
		var members = resp.dlm;
		if (members && members.length) {
			for (var i = 0, len = members.length; i < len; i++) {
				var member = members[i]._content;
				list.push(member);
				dl.list[offset + i] = member;
				if (members[i].isDL) {
					isDL[member] = dl.isDL[member] = true;
				}
			}
		}
		dl.total = resp.total;
		DBG.println("dl", list.join("<br>"));
		var result = {list:list, more:more, isDL:isDL};
	}
	DBG.println("dl", "returning list of " + result.list.length + ", more is " + result.more);
	if (callback) {
		callback.run(result);
	}
	else { //synchronized case - see ZmContact.prototype.getDLMembers above
		return result;
	}
};

/**
 * Returns a list of all the distribution list members for this contact.
 *
 * @param callback	{AjxCallback}	callback to run with results
 */
ZmContact.prototype.getAllDLMembers =
function(callback) {

	var result = {list:[], more:false, isDL:{}};
	if (!this.isDL) { return result; }

	var dl = appCtxt.getApp(ZmApp.CONTACTS).getDL(this.getEmail());
	if (dl && !dl.more) {
		result = {list:dl.list.slice(), more:false, isDL:dl.isDL};
		callback.run(result);
		return;
	}

	var nextCallback = new AjxCallback(this, this._getNextDLChunk, [callback]);
	this.getDLMembers(dl ? dl.list.length : 0, null, nextCallback);
};

ZmContact.prototype._getNextDLChunk =
function(callback, result) {

	var dl = appCtxt.getApp(ZmApp.CONTACTS).getDL(this.getEmail());
	if (result.more) {
		var nextCallback = new AjxCallback(this, this._getNextDLChunk, [callback]);
		this.getDLMembers(dl.list.length, null, nextCallback);
	} else {
		result.list = dl.list.slice();
		callback.run(result);
	}
};

/**
 * Gets the contact from cache handling parsing of contactId
 * 
 * @param contactId {String} contact id
 * @return contact {ZmContact} contact or null
 * @private
 */
ZmContact.getContactFromCache =
function(contactId) {
	var userZid = appCtxt.accountList.mainAccount.id;
	var contact = null;
	if (contactId && contactId.indexOf(userZid + ":") !=-1) {
		//strip off the usersZid to pull from cache
		var arr = contactId.split(userZid + ":");
		contact = arr && arr.length > 1 ? appCtxt.cacheGet(arr[1]) : appCtxt.cacheGet(contactId);
	}
	else {
		contact = appCtxt.cacheGet(contactId);
	}
	if (contact instanceof ZmContact) {
		return contact;
	}
	return null;
};

// For mapAttrs(), prepare a hash where each key is the base name of an attr (without an ending number and lowercased),
// and the value is a numerically sorted list of attr names in their original form.
ZmContact.ATTR_VARIANTS = {};
ZmContact.IGNORE_ATTR_VARIANT = {};
ZmContact.IGNORE_ATTR_VARIANT[ZmContact.F_groups] = true;

ZmContact.initAttrVariants = function(attrClass) {
	var keys = Object.keys(attrClass),
		len = keys.length, key, i, attr,
		attrs = [];

	// first, grab all the attr names
	var ignoreVariant = attrClass.IGNORE_ATTR_VARIANT || {};
	for (i = 0; i < len; i++) {
		key = keys[i];
		if (key.indexOf('F_') === 0) {
			attr = attrClass[key];
			if (!ignoreVariant[attr]) {
				attrs.push(attr);
			}
		}
	}

	// sort numerically, eg so that we get ['email', 'email2', 'email10'] in right order
	var numRegex = /^([a-zA-Z]+)(\d+)$/;
	attrs.sort(function(a, b) {
		var aMatch = a.match(numRegex),
			bMatch = b.match(numRegex);
		// check if both are numbered attrs with same base
		if (aMatch && bMatch && aMatch[1] === bMatch[1]) {
			return aMatch[2] - bMatch[2];
		}
		else {
			return a > b ? 1 : (a < b ? -1 : 0);
		}
	});

	// construct hash mapping generic base name to its iterated attr names
	var attr, base;
	for (i = 0; i < attrs.length; i++) {
		attr = attrs[i];
		base = attr.replace(/\d+$/, '').toLowerCase();
		if (!ZmContact.ATTR_VARIANTS[base]) {
			ZmContact.ATTR_VARIANTS[base] = [];
		}
		ZmContact.ATTR_VARIANTS[base].push(attr);
	}
};
ZmContact.initAttrVariants(ZmContact);

/**
 * Takes a hash of attrs and values and maps it to our attr names as best as it can. Scalar attrs will map if they
 * have the same name or only differ by case. A multivalued attr will map to a set of our attributes that share the
 * same case-insensitive base name. Some examples:
 *
 *      FIRSTNAME: "Mildred"    =>      firstName: "Mildred"
 *      email: ['a', 'b']       =>      email: 'a',
 *                                      email2: 'b'
 *      WorkEmail: ['y', 'z']   =>      workEmail1: 'y',
 *                                      workEmail2: 'z'
 *      IMaddress: ['f', 'g']   =>      imAddress1: 'f',
 *                                      imAddress2: 'g'
 *
 * @param   {Object}    attrs       hash of attr names/values
 *
 * @returns {Object}    hash of attr names/values using known attr names ZmContact.F_*
 */
ZmContact.mapAttrs = function(attrs) {

	var attr, value, baseAttrs, newAttrs = {};
	for (attr in attrs) {
		value = attrs[attr];
		if (value) {
			baseAttrs = ZmContact.ATTR_VARIANTS[attr.toLowerCase()];
			if (baseAttrs) {
				value = AjxUtil.toArray(value);
				var len = Math.min(value.length, baseAttrs.length), i;
				for (i = 0; i < len; i++) {
					newAttrs[baseAttrs[i]] = value[i];
				}
			} else {
				// Any overlooked/ignored attributes are simply passed along
				newAttrs[attr] = value;
			}
		}
	}
	return newAttrs;
};

// these need to be kept in sync with ZmContact.F_*
ZmContact._AB_FIELD = {
	firstName:				ZmMsg.AB_FIELD_firstName,		// file as info
	lastName:				ZmMsg.AB_FIELD_lastName,
	middleName:				ZmMsg.AB_FIELD_middleName,
	fullName:				ZmMsg.AB_FIELD_fullName,
	jobTitle:				ZmMsg.AB_FIELD_jobTitle,
	company:				ZmMsg.AB_FIELD_company,
	department:				ZmMsg.AB_FIELD_department,
	email:					ZmMsg.AB_FIELD_email,			// email addresses
	email2:					ZmMsg.AB_FIELD_email2,
	email3:					ZmMsg.AB_FIELD_email3,
	imAddress1:				ZmMsg.AB_FIELD_imAddress1,		// IM addresses
	imAddress2:				ZmMsg.AB_FIELD_imAddress2,
	imAddress3:				ZmMsg.AB_FIELD_imAddress3,
	image: 					ZmMsg.AB_FIELD_image,			// contact photo
	attachment:				ZmMsg.AB_FIELD_attachment,
	workStreet:				ZmMsg.AB_FIELD_street,			// work address info
	workCity:				ZmMsg.AB_FIELD_city,
	workState:				ZmMsg.AB_FIELD_state,
	workPostalCode:			ZmMsg.AB_FIELD_postalCode,
	workCountry:			ZmMsg.AB_FIELD_country,
	workURL:				ZmMsg.AB_FIELD_URL,
	workPhone:				ZmMsg.AB_FIELD_workPhone,
	workPhone2:				ZmMsg.AB_FIELD_workPhone2,
	workFax:				ZmMsg.AB_FIELD_workFax,
	assistantPhone:			ZmMsg.AB_FIELD_assistantPhone,
	companyPhone:			ZmMsg.AB_FIELD_companyPhone,
	callbackPhone:			ZmMsg.AB_FIELD_callbackPhone,
	homeStreet:				ZmMsg.AB_FIELD_street,			// home address info
	homeCity:				ZmMsg.AB_FIELD_city,
	homeState:				ZmMsg.AB_FIELD_state,
	homePostalCode:			ZmMsg.AB_FIELD_postalCode,
	homeCountry:			ZmMsg.AB_FIELD_country,
	homeURL:				ZmMsg.AB_FIELD_URL,
	homePhone:				ZmMsg.AB_FIELD_homePhone,
	homePhone2:				ZmMsg.AB_FIELD_homePhone2,
	homeFax:				ZmMsg.AB_FIELD_homeFax,
	mobilePhone:			ZmMsg.AB_FIELD_mobilePhone,
	pager:					ZmMsg.AB_FIELD_pager,
	carPhone:				ZmMsg.AB_FIELD_carPhone,
	otherStreet:			ZmMsg.AB_FIELD_street,			// other info
	otherCity:				ZmMsg.AB_FIELD_city,
	otherState:				ZmMsg.AB_FIELD_state,
	otherPostalCode:		ZmMsg.AB_FIELD_postalCode,
	otherCountry:			ZmMsg.AB_FIELD_country,
	otherURL:				ZmMsg.AB_FIELD_URL,
	otherPhone:				ZmMsg.AB_FIELD_otherPhone,
	otherFax:				ZmMsg.AB_FIELD_otherFax,
	notes:					ZmMsg.notes,					// misc fields
	birthday:				ZmMsg.AB_FIELD_birthday
};

ZmContact._AB_FILE_AS = {
	1:						ZmMsg.AB_FILE_AS_lastFirst,
	2:						ZmMsg.AB_FILE_AS_firstLast,
	3:						ZmMsg.AB_FILE_AS_company,
	4:						ZmMsg.AB_FILE_AS_lastFirstCompany,
	5:						ZmMsg.AB_FILE_AS_firstLastCompany,
	6:						ZmMsg.AB_FILE_AS_companyLastFirst,
	7:						ZmMsg.AB_FILE_AS_companyFirstLast
};

} // if (!window.ZmContact)
}
if (AjxPackage.define("zimbraMail.abook.model.ZmContactList")) {
/*
 * ***** BEGIN LICENSE BLOCK *****
 * Zimbra Collaboration Suite Web Client
 * Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016 Synacor, Inc.
 *
 * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at: https://www.zimbra.com/license
 * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15
 * have been added to cover use of software over a computer network and provide for limited attribution
 * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B.
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied.
 * See the License for the specific language governing rights and limitations under the License.
 * The Original Code is Zimbra Open Source Web Client.
 * The Initial Developer of the Original Code is Zimbra, Inc.  All rights to the Original Code were
 * transferred by Zimbra, Inc. to Synacor, Inc. on September 14, 2015.
 *
 * All portions of the code are Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016 Synacor, Inc. All Rights Reserved.
 * ***** END LICENSE BLOCK *****
 */

/**
 * @overview
 * This file contains the contact list class.
 * 
 */

/**
 * Create a new, empty contact list.
 * @class
 * This class represents a list of contacts. In general, the list is the result of a
 * search. It may be the result of a <code>&lt;GetContactsRequest&gt;</code>, which returns all of the user's
 * local contacts. That list is considered to be canonical.
 * <p>
 * Loading of all local contacts has been optimized by delaying the creation of {@link ZmContact} objects until
 * they are needed. That has a big impact on IE, and not much on Firefox. Loading a subset
 * of attributes did not have much impact on load time, probably because a large majority
 * of contacts contain only those minimal fields.</p>
 *
 * @author Conrad Damon
 *
 * @param {ZmSearch}	search	the search that generated this list
 * @param {Boolean}	isGal		if <code>true</code>, this is a list of GAL contacts
 * @param {constant}	type		the item type
 * 
 * @extends		ZmList
 */
ZmContactList = function(search, isGal, type) {

	if (arguments.length == 0) { return; }
	type = type || ZmItem.CONTACT;
	ZmList.call(this, type, search);

	this.isGal = (isGal === true);
	this.isCanonical = false;
	this.isLoaded = false;

	this._app = appCtxt.getApp(ZmApp.CONTACTS);
	if (!this._app) { 
		this._emailToContact = this._phoneToContact = {};
		return;
	}
	this._emailToContact = this._app._byEmail;
	this._phoneToContact = this._app._byPhone;

	this._alwaysUpdateHashes = true; // Should we update the phone & IM fast-lookup hashes even when account features don't require it? (bug #60411)
};

ZmContactList.prototype = new ZmList;
ZmContactList.prototype.constructor = ZmContactList;

ZmContactList.prototype.isZmContactList = true;
ZmContactList.prototype.toString = function() { return "ZmContactList"; };




// Constants

// Support for loading user's local contacts from a large string

ZmContactList.URL = "/Contacts";	// REST URL for loading user's local contacts
ZmContactList.URL_ARGS = { fmt: 'cf', t: 2, all: 'all' }; // arguments for the URL above
ZmContactList.CONTACT_SPLIT_CHAR	= '\u001E';	// char for splitting string into contacts
ZmContactList.FIELD_SPLIT_CHAR		= '\u001D';	// char for splitting contact into fields
// fields that belong to a contact rather than its attrs
ZmContactList.IS_CONTACT_FIELD = {"id":true, "l":true, "d":true, "fileAsStr":true, "rev":true};



/**
 * @private
 */
ZmContactList.prototype.addLoadedCallback =
function(callback) {
	if (this.isLoaded) {
		callback.run();
		return;
	}
	if (!this._loadedCallbacks) {
		this._loadedCallbacks = [];
	}
	this._loadedCallbacks.push(callback);
};

/**
 * @private
 */
ZmContactList.prototype._finishLoading =
function() {
	DBG.timePt("done loading " + this.size() + " contacts");
	this.isLoaded = true;
	if (this._loadedCallbacks) {
		var callback;
		while (callback = this._loadedCallbacks.shift()) {
			callback.run();
		}
	}
};

/**
 * Retrieves the contacts from the back end, and parses the response. The list is then sorted.
 * This method is used only by the canonical list of contacts, in order to load their content.
 * <p>
 * Loading a minimal set of attributes did not result in a significant performance gain.
 * </p>
 * 
 * @private
 */
ZmContactList.prototype.load =
function(callback, errorCallback, accountName) {
	// only the canonical list gets loaded
	this.isCanonical = true;
	var respCallback = new AjxCallback(this, this._handleResponseLoad, [callback]);
	DBG.timePt("requesting contact list", true);
    if(appCtxt.isExternalAccount()) {
        //Do not make a call in case of external user
        //The rest url constructed wont exist in case of external user
        if (callback) {
		    callback.run();
	    }
        return;
    }
	var args = ZmContactList.URL_ARGS;

	// bug 74609: suppress overzealous caching by IE
	if (AjxEnv.isIE) {
		args = AjxUtil.hashCopy(args);
		args.sid = ZmCsfeCommand.getSessionId();
	}

	var params = {asyncMode:true, noBusyOverlay:true, callback:respCallback, errorCallback:errorCallback, offlineCallback:callback};
	params.restUri = AjxUtil.formatUrl({
		path:["/home/", (accountName || appCtxt.getUsername()),
	          ZmContactList.URL].join(""),
	    qsArgs: args, qsReset:true
	});
	DBG.println(AjxDebug.DBG1, "loading contacts from " + params.restUri);
	appCtxt.getAppController().sendRequest(params);

	ZmContactList.addDlFolder();
	
};

/**
 * @private
 */
ZmContactList.prototype._handleResponseLoad =
function(callback, result) {
	DBG.timePt("got contact list");
	var text = result.getResponse();
    if (text && typeof text !== 'string'){
        text = text._data;
    }
	var derefList = [];
	if (text) {
		var contacts = text.split(ZmContactList.CONTACT_SPLIT_CHAR);
		var derefBatchCmd = new ZmBatchCommand(true, null, true);
		for (var i = 0, len = contacts.length; i < len; i++) {
			var fields = contacts[i].split(ZmContactList.FIELD_SPLIT_CHAR);
			var contact = {}, attrs = {};
			var groupMembers = [];
			var foundDeref = false;
			for (var j = 0, len1 = fields.length; j < len1; j += 2) {
				if (ZmContactList.IS_CONTACT_FIELD[fields[j]]) {
					contact[fields[j]] = fields[j + 1];
				} else {
					var value = fields[j+1];
					switch (fields[j]) {
						case ZmContact.F_memberC:
							groupMembers.push({type: ZmContact.GROUP_CONTACT_REF, value: value});
							foundDeref = true; //load shared contacts
							break;
						case ZmContact.F_memberG:
							groupMembers.push({type: ZmContact.GROUP_GAL_REF, value: value});
							foundDeref = true;
							break;
						case ZmContact.F_memberI:
							groupMembers.push({type: ZmContact.GROUP_INLINE_REF, value: value});
							foundDeref = true;
							break;
						default:
							attrs[fields[j]] = value;
					}
				}
			}
			if (attrs[ZmContact.F_type] === "group") { //set only for group.
				attrs[ZmContact.F_groups] = groupMembers;
			}
			if (foundDeref) {
				//batch group members for deref loading
				var dummy = new ZmContact(contact["id"], this);
				derefBatchCmd.add(new AjxCallback(dummy, dummy.load, [null, null, derefBatchCmd, true]));
			}
			contact._attrs = attrs;
			this._addContact(contact);
		}
		derefBatchCmd.run();
	}

	this._finishLoading();

	if (callback) {
		callback.run();
	}
};

/**
 * @static
 */
ZmContactList.addDlFolder =
function() {

	if (!appCtxt.get(ZmSetting.DLS_FOLDER_ENABLED)) {
		return;
	}

	var dlsFolder = appCtxt.getById(ZmOrganizer.ID_DLS);

	var root = appCtxt.getById(ZmOrganizer.ID_ROOT);
	if (!root) { return; }

	if (dlsFolder && root.getById(ZmOrganizer.ID_DLS)) {
		//somehow (after a refresh block, can be reprod using $set:refresh. ZmClientCmdHandler.prototype.execute_refresh) the DLs folder object is removed from under the root (but still cached in appCtxt). So making sure it's there.
		return;
	}

	if (!dlsFolder) {
		var params = {
			id: ZmOrganizer.ID_DLS,
			name: ZmMsg.distributionLists,
			parent: root,
			tree: root.tree,
			type: ZmOrganizer.ADDRBOOK,
			numTotal: null, //we don't know how many
			noTooltip: true //so don't show tooltip
		};

		dlsFolder = new ZmAddrBook(params);
		root.children.add(dlsFolder);
		dlsFolder._isDL = true;
	}
	else {
		//the dls folder object exists but no longer as a child of the root.
		dlsFolder.parent = root;
		root.children.add(dlsFolder); //any better way to do this?
	}

};

ZmContactList.prototype.add = 
function(item, index) {
	if (!item.id || !this._idHash[item.id]) {
		this._vector.add(item, index);
		if (item.id) {
			this._idHash[item.id] = item;
		}
		this._updateHashes(item, true);
	}
};

ZmContactList.prototype.cache = 
function(offset, newList) {
	var getId = function(){
		return this.id;
	}
	var exists = function(obj) {
		return this._vector.containsLike(obj, getId);
	}
	var unique = newList.sub(exists, this);

	this.getVector().merge(offset, unique);
	// reparent each item within new list, and add it to ID hash
	var list = unique.getArray();
	for (var i = 0; i < list.length; i++) {
		var item = list[i];
		item.list = this;
		if (item.id) {
			this._idHash[item.id] = item;
		}
	}
};

/**
 * @private
 */
ZmContactList.prototype._addContact =
function(contact) {

	// note that we don't create a ZmContact here (optimization)
	contact.list = this;
	this._updateHashes(contact, true);
	var fn = [], fl = [];
	if (contact._attrs[ZmContact.F_firstName])	{ fn.push(contact._attrs[ZmContact.F_firstName]); }
	if (contact._attrs[ZmContact.F_middleName])	{ fn.push(contact._attrs[ZmContact.F_middleName]); }
	if (contact._attrs[ZmContact.F_lastName])	{ fn.push(contact._attrs[ZmContact.F_lastName]); }
	if (fn.length) {
		contact._attrs[ZmContact.X_fullName] = fn.join(" ");
	}
	if (contact._attrs[ZmContact.F_firstName])	{ fl.push(contact._attrs[ZmContact.F_firstName]); }
	if (contact._attrs[ZmContact.F_lastName])	{ fl.push(contact._attrs[ZmContact.F_lastName]); }
	contact._attrs[ZmContact.X_firstLast] = fl.join(" ");

	this.add(contact);
};

/**
 * Converts an anonymous contact object (contained by the JS returned by load request)
 * into a ZmContact, and updates the containing list if it is the canonical one.
 *
 * @param {Object}	contact		a contact
 * @param {int}	idx		the index of contact in canonical list
 * 
 * @private
 */
ZmContactList.prototype._realizeContact =
function(contact, idx) {

	if (contact instanceof ZmContact) { return contact; }
	if (contact && contact.type == ZmItem.CONTACT) { return contact; }	// instanceof often fails in new window

	var args = {list:this};
	var obj = eval(ZmList.ITEM_CLASS[this.type]);
	var realContact = obj && obj.createFromDom(contact, args);

	if (this.isCanonical) {
		var a = this.getArray();
		idx = idx || this.getIndexById(contact.id);
		a[idx] = realContact;
		this._updateHashes(realContact, true);
		this._idHash[contact.id] = realContact;
	}

	return realContact;
};

/**
 * Finds the array index for the contact with the given ID.
 *
 * @param {int}	id		the contact ID
 * @return	{int}	the index
 * @private
 */
ZmContactList.prototype.getIndexById =
function(id) {
	var a = this.getArray();
	for (var i = 0; i < a.length; i++) {
		if (a[i].id == id) {
			return i;
		}
	}
	return null;
};

/**
 * Override in order to make sure the contacts have been realized. We don't
 * call realizeContact() since this is not the canonical list.
 *
 * @param {int}	offset		the starting index
 * @param {int}	limit		the size of sublist
 * @return	{AjxVector}	a vector of {@link ZmContact} objects
 */
ZmContactList.prototype.getSubList =
function(offset, limit, folderId) {
	if (folderId && this.isCanonical) {
		// only collect those contacts that belong to the given folderId if provided
		var newlist = [];
		var sublist = this.getArray();
		var offsetCount = 0;
		this.setHasMore(false);

		for (var i = 0; i < sublist.length; i++) {
			sublist[i] = this._realizeContact(sublist[i], i);
			var folder = appCtxt.getById(sublist[i].folderId);
			if (folder && folder.nId == ZmOrganizer.normalizeId(folderId)) {
				if (offsetCount >= offset) {
					if (newlist.length == limit) {
						this.setHasMore(true);
						break;
					}
					newlist.push(sublist[i]);
				}
				offsetCount++;
			}
		}

		return AjxVector.fromArray(newlist);
	} else {
		var vec = ZmList.prototype.getSubList.call(this, offset, limit);
		if (vec) {
			var a = vec.getArray();
			for (var i = 0; i < a.length; i++) {
				a[i] = this._realizeContact(a[i], offset + i);
			}
		}

		return vec;
	}
};

/**
 * Override in order to make sure the contact has been realized. Canonical list only.
 *
 * @param {int}	id		the contact ID
 * @return	{ZmContact}	the contact or <code>null</code> if not found
 */
ZmContactList.prototype.getById =
function(id) {
	if (!id || !this.isCanonical) return null;

	var contact = this._idHash[id];
	return contact ? this._realizeContact(contact) : null;
};

/**
 * Gets the contact with the given address, if any (canonical list only).
 *
 * @param {String}	address	an email address
 * @return	{ZmContact}	the contact or <code>null</code> if not found
 */
ZmContactList.prototype.getContactByEmail =
function(address) {
	if (!address || !this.isCanonical) return null;

	var contact = this._emailToContact[address.toLowerCase()];
	if (contact) {
		contact = this._realizeContact(contact);
		contact._lookupEmail = address;	// so caller knows which address matched
		return contact;
	} else {
		return null;
	}
};

/**
 * Gets information about the contact with the given phone number, if any (canonical list only).
 *
 * @param {String}	phone	the phone number
 * @return	{Hash}	an object with <code>contact</code> = the contact & <code>field</code> = the field with the matching phone number
 */
ZmContactList.prototype.getContactByPhone =
function(phone) {
	if (!phone || !this.isCanonical) return null;

	var digits = this._getPhoneDigits(phone);
	var data = this._phoneToContact[digits];
	if (data) {
		data.contact = this._realizeContact(data.contact);
		return data;
	} else {
		return null;
	}
};

/**
 * Moves a list of items to the given folder.
 * <p>
 * This method calls the base class for normal "moves" UNLESS we're dealing w/
 * shared items (or folder) in which case we must send a CREATE request for the
 * given folder to the server followed by a hard delete of the shared contact.
 * </p>
 *
 * @param {Hash}	params		a hash of parameters
 * @param	{Array}       params.items			a list of items to move
 * @param	{ZmFolder}	params.folder		the destination folder
 * @param	{Hash}	       params.attrs		the additional attrs for SOAP command
 * @param	{Boolean}	params.outOfTrash	if <code>true</code>, we are moving contacts out of trash
 */
ZmContactList.prototype.moveItems =
function(params) {

	params = Dwt.getParams(arguments, ["items", "folder", "attrs", "outOfTrash"]);
	params.items = AjxUtil.toArray(params.items);

	var moveBatchCmd = new ZmBatchCommand(true, null, true);
	var loadBatchCmd = new ZmBatchCommand(true, null, true);
	var softMove = [];

	// if the folder we're moving contacts to is a shared folder, then dont bother
	// checking whether each item is shared or not
	if (params.items[0] && params.items[0] instanceof ZmItem) {
		for (var i = 0; i < params.items.length; i++) {
			var contact = params.items[i];

			if (contact.isReadOnly()) { continue; }

			softMove.push(contact);
		}
	} else {
		softMove = params.items;
	}

	// for "soft" moves, handle moving out of Trash differently
	if (softMove.length > 0) {
		var params1 = AjxUtil.hashCopy(params);
		params1.attrs = params.attrs || {};
		var toFolder = params.folder;
		params1.attrs.l = toFolder.isRemote() ? toFolder.getRemoteId() : toFolder.id;
		params1.action = "move";
        params1.accountName = appCtxt.multiAccounts && appCtxt.accountList.mainAccount.name;
        if (params1.folder.id == ZmFolder.ID_TRASH) {
            params1.actionTextKey = 'actionTrash';
            // bug: 47389 avoid moving to local account's Trash folder.
            params1.accountName = appCtxt.multiAccounts && params.items[0].getAccount().name;
        } else {
            params1.actionTextKey = 'actionMove';
            params1.actionArg = toFolder.getName(false, false, true);
        }
		params1.callback = params.outOfTrash && new AjxCallback(this, this._handleResponseMoveItems, params);

		this._itemAction(params1);
	}
};

/**
 * @private
 */
ZmContactList.prototype._handleResponseMoveBatchCmd =
function(result) {
	var resp = result.getResponse().BatchResponse.ContactActionResponse;
	// XXX: b/c the server does not return notifications for actions done on
	//      shares, we manually notify - TEMP UNTIL WE GET BETTER SERVER SUPPORT
	var ids = resp[0].action.id.split(",");
	for (var i = 0; i < ids.length; i++) {
		var contact = appCtxt.cacheGet(ids[i]);
		if (contact && contact.isShared()) {
			contact.notifyDelete();
			appCtxt.cacheRemove(ids[i]);
		}
	}
};

/**
 * @private
 */
ZmContactList.prototype._handleResponseLoadMove =
function(moveBatchCmd, params) {
	var deleteCmd = new AjxCallback(this, this._itemAction, [params]);
	moveBatchCmd.add(deleteCmd);

	var respCallback = new AjxCallback(this, this._handleResponseMoveBatchCmd);
	moveBatchCmd.run(respCallback);
};

/**
 * @private
 */
ZmContactList.prototype._handleResponseBatchLoad =
function(batchCmd, folder, result, contact) {
	batchCmd.add(this._getCopyCmd(contact, folder));
};

/**
 * @private
 */
ZmContactList.prototype._getCopyCmd =
function(contact, folder) {
	var temp = new ZmContact(null, this);
	for (var j in contact.attr) {
		temp.attr[j] = contact.attr[j];
	}
	temp.attr[ZmContact.F_folderId] = folder.id;

	return new AjxCallback(temp, temp.create, [temp.attr]);
};

/**
 * Deletes contacts after checking that this is not a GAL list.
 *
 * @param {Hash}	params		a hash of parameters
 * @param	{Array}	       params.items			the list of items to delete
 * @param	{Boolean}	params.hardDelete	if <code>true</code>, force physical removal of items
 * @param	{Object}	params.attrs			the additional attrs for SOAP command
 */
ZmContactList.prototype.deleteItems =
function(params) {
	if (this.isGal) {
		if (ZmContactList.deleteGalItemsAllowed(params.items)) {
			this._deleteDls(params.items);
			return;
		}
		DBG.println(AjxDebug.DBG1, "Cannot delete GAL contacts that are not DLs");
		return;
	}
	ZmList.prototype.deleteItems.call(this, params);
};

ZmContactList.deleteGalItemsAllowed =
function(items) {
	var deleteDomainsAllowed = appCtxt.createDistListAllowedDomainsMap;
	if (items.length == 0) {
		return false; //need a special case since we don't want to enable the "delete" button for 0 items.
	}
	for (var i = 0; i < items.length; i++) {
		var contact = items[i];
		var email = contact.getEmail();
		var domain = email.split("@")[1];
		var isDL = contact && contact.isDistributionList();
		//see bug 71368 and also bug 79672 - the !contact.dlInfo is in case somehow dlInfo is missing - so unfortunately if that happens (can't repro) - let's not allow to delete since we do not know if it's an owner
		if (!isDL || !deleteDomainsAllowed[domain] || !contact.dlInfo || !contact.dlInfo.isOwner) {
			return false;
		}
	}
	return true;
};

ZmContactList.prototype._deleteDls =
function(items, confirmDelete) {

	if (!confirmDelete) {
		var callback = this._deleteDls.bind(this, items, true);
		this._popupDeleteWarningDialog(callback, false, items.length);
		return;
	}

	var reqs = [];
	for (var i = 0; i < items.length; i++) {
		var contact = items[i];
		var email = contact.getEmail();
		reqs.push({
				_jsns: "urn:zimbraAccount",
				dl: {by: "name",
					 _content: contact.getEmail()
				},
				action: {
					op: "delete"
				}
			});
	}
	var jsonObj = {
		BatchRequest: {
			_jsns: "urn:zimbra",
			DistributionListActionRequest: reqs
		}
	};
	var respCallback = this._deleteDlsResponseHandler.bind(this, items);
	appCtxt.getAppController().sendRequest({jsonObj: jsonObj, asyncMode: true, callback: respCallback});

};

ZmContactList.prototype._deleteDlsResponseHandler =
function(items) {
	if (appCtxt.getCurrentView().isZmGroupView) {
		//this is the case we were editing the DL (different than viewing it in the DL list, in which case it's the contactListController).
		//so we now need to pop up the view.
		this.controller.popView();
	}

	appCtxt.setStatusMsg(items.length == 1 ? ZmMsg.dlDeleted : ZmMsg.dlsDeleted);

	for (var i = 0; i < items.length; i++) {
		var item = items[i];
		item.clearDlInfo();
		item._notify(ZmEvent.E_DELETE);
	}
};



/**
 * Sets the is GAL flag.
 * 
 * @param	{Boolean}	isGal		<code>true</code> if contact list is GAL
 */
ZmContactList.prototype.setIsGal =
function(isGal) {
	this.isGal = isGal;
};

ZmContactList.prototype.notifyCreate =
function(node) {
	var obj = eval(ZmList.ITEM_CLASS[this.type]);
	if (obj) {
		var item = obj.createFromDom(node, {list:this});
		var index = this._sortIndex(item);
		// only add if it sorts into this list
		var listSize = this.size();
		var visible = false;
		if (index < listSize || listSize == 0 || (index==listSize && !this._hasMore)) {
			this.add(item, index);
			this.createLocal(item);
			visible = true;
		}
		this._notify(ZmEvent.E_CREATE, {items: [item], sortIndex: index, visible: visible});
	}
};

/**
 * Moves the items.
 * 
 * @param	{Array}	items		an array of {@link ZmContact} objects
 * @param	{String}	folderId	the folder id
 */
ZmContactList.prototype.moveLocal =
function(items, folderId) {
	// don't remove any contacts from the canonical list
	if (!this.isCanonical)
		ZmList.prototype.moveLocal.call(this, items, folderId);
	if (folderId == ZmFolder.ID_TRASH) {
		for (var i = 0; i < items.length; i++) {
			this._updateHashes(items[i], false);
		}
	}
};

/**
 * Deletes the items.
 * 
 * @param	{Array}	items		an array of {@link ZmContact} objects
 */
ZmContactList.prototype.deleteLocal =
function(items) {
	ZmList.prototype.deleteLocal.call(this, items);
	for (var i = 0; i < items.length; i++) {
		this._updateHashes(items[i], false);
	}
};

/**
 * Handle modified contact.
 * 
 * @private
 */
ZmContactList.prototype.modifyLocal =
function(item, details) {
	if (details) {
		// notify item's list
		this._evt.items = details.items = [item];
		this._evt.item = details.contact; //somehow this was set to something obsolete. What a mess. Also note that item is Object while details.contact is ZmContact
		this._notify(ZmEvent.E_MODIFY, details);
	}

	var contact = details.contact;
	if (this.isCanonical || contact.attr[ZmContact.F_email] != details.oldAttr[ZmContact.F_email]) {
		// Remove traces of old contact - NOTE: we pass in null for the ID on
		// PURPOSE to avoid overwriting the existing cached contact
		var oldContact = new ZmContact(null, this);
		oldContact.id = details.contact.id;
		oldContact.attr = details.oldAttr;
		this._updateHashes(oldContact, false);

		// add new contact to hashes
		this._updateHashes(contact, true);
	}

	// place in correct position in list
	if (details.fileAsChanged) {
		this.remove(contact);
		var index = this._sortIndex(contact);
		var listSize = this.size();
		if (index < listSize || listSize == 0 || (index == listSize && !this._hasMore)) {
			this.add(contact, index);
		}
	}

	// reset addrbook property
	if (contact.addrbook && (contact.addrbook.id != contact.folderId)) {
		contact.addrbook = appCtxt.getById(contact.folderId);
	}
};

/**
 * Creates the item local.
 * 
 * @param	{ZmContact}	item		the item
 */
ZmContactList.prototype.createLocal =
function(item) {
	this._updateHashes(item, true);
};

/**
 * @private
 */
ZmContactList.prototype._updateHashes =
function(contact, doAdd) {

	this._app.updateCache(contact, doAdd);

	// Update email hash.
	for (var index = 0; index < ZmContact.EMAIL_FIELDS.length; index++) {
		var field = ZmContact.EMAIL_FIELDS[index];
		for (var i = 1; true; i++) {
			var aname = ZmContact.getAttributeName(field, i);
			var avalue = ZmContact.getAttr(contact, aname);
			if (!avalue) break;
			if (doAdd) {
				this._emailToContact[avalue.toLowerCase()] = contact;
			} else {
				delete this._emailToContact[avalue.toLowerCase()];
			}
		}
	}

	// Update phone hash.
	if (appCtxt.get(ZmSetting.VOICE_ENABLED) || this._alwaysUpdateHashes) {
		for (var index = 0; index < ZmContact.PHONE_FIELDS.length; index++) {
			var field = ZmContact.PHONE_FIELDS[index];
			for (var i = 1; true; i++) {
				var aname = ZmContact.getAttributeName(field, i);
				var avalue = ZmContact.getAttr(contact, aname);
				if (!avalue) break;
				var digits = this._getPhoneDigits(avalue);
				if (digits) {
					if (doAdd) {
						this._phoneToContact[avalue] = {contact: contact, field: aname};
					} else {
						delete this._phoneToContact[avalue];
					}
				}
			}
		}
	}
};

/**
 * Strips all non-digit characters from a phone number.
 * 
 * @private
 */
ZmContactList.prototype._getPhoneDigits =
function(phone) {
	return phone.replace(/[^\d]/g, '');
};

/**
 * Returns the position at which the given contact should be inserted in this list.
 * 
 * @private
 */
ZmContactList.prototype._sortIndex =
function(contact) {
	var a = this._vector.getArray();
	for (var i = 0; i < a.length; i++) {
		if (ZmContact.compareByFileAs(a[i], contact) > 0) {
			return i;
		}
	}
	return a.length;
};

/**
 * Gets the list ID hash
 * @return idHash {Ojbect} list ID hash
 */
ZmContactList.prototype.getIdHash =
function() {
	return this._idHash;
}

/**
 * @private
 */
ZmContactList.prototype._handleResponseModifyItem =
function(item, result) {
	// NOTE: we overload and do nothing b/c base class does more than we want
	//       (since everything is handled by notifications)
};
}
if (AjxPackage.define("zimbraMail.abook.view.ZmContactsHelper")) {
/*
 * ***** BEGIN LICENSE BLOCK *****
 * Zimbra Collaboration Suite Web Client
 * Copyright (C) 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2016 Synacor, Inc.
 *
 * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at: https://www.zimbra.com/license
 * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15
 * have been added to cover use of software over a computer network and provide for limited attribution
 * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B.
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied.
 * See the License for the specific language governing rights and limitations under the License.
 * The Original Code is Zimbra Open Source Web Client.
 * The Initial Developer of the Original Code is Zimbra, Inc.  All rights to the Original Code were
 * transferred by Zimbra, Inc. to Synacor, Inc. on September 14, 2015.
 *
 * All portions of the code are Copyright (C) 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2016 Synacor, Inc. All Rights Reserved.
 * ***** END LICENSE BLOCK *****
 */

/**
 * @overview
 * This file contains a contact helper class.
 * 
 */

/**
 * Default constructor for helper class.
 * @class
 * Miscellaneous contacts-related utility functions. So far, mostly things that
 * {@link ZmContactPicker} and {@link ZmGroupView} both need to perform a contacts search and
 * display results in a list view.
 *
 * @author Conrad Damon
 */
ZmContactsHelper = function() {};

/**
 * Performs a contact search (in either personal contacts or in the GAL) and populates
 * the source list view with the results.
 *
 * @param	{Hash}	params		a hash of parameters
 * @param {Object}	params.obj			the object that is doing the search
 * @param {String}	params.query			the query string to search on
 * @param {String}	params.queryHint		the query hint (i.e. searching shared folders)
 * @param {Boolean}	params.ascending		if <code>true</code>, sort in ascending order
 * @param {int}	params.lastId		the ID of last item displayed (for pagination)
 * @param {String}	params.lastSortVal	the value of sort field for above item
 * @param {AjxCallback}	params.respCallback	the callback to call once response comes back from server
 * @param {AjxCallback}	params.errorCallback	the callback to call if error returned from server
 * @param {String}	params.accountName	the account to make search request on behalf of
 * @param {Array}   params.conds	the conds to restrict the search by (array of {attr:"", op:"", value:""} hashes)
 */
ZmContactsHelper.search =
function(params) {
	var o = params.obj;
	if (o._searchButton) {
		o._searchButton.setEnabled(false);
	}

	params.sortBy = params.ascending ? ZmSearch.NAME_ASC : ZmSearch.NAME_DESC;
	params.types = AjxVector.fromArray([ZmItem.CONTACT]);
	params.offset = params.offset || 0;
	params.limit = ZmContactsApp.SEARCHFOR_MAX;
	params.contactSource = o._contactSource;
	params.field = "contact";

	var search = new ZmSearch(params);
	search.execute({callback:params.respCallback, errorCallback:params.errorCallback});
};

/**
 * Take the contacts and create a list of their email addresses (a contact may have more than one)
 * 
 * @private
 */
ZmContactsHelper._processSearchResponse = 
function(resp, includeContactsWithNoEmail) {
	var vec = resp.getResults(ZmItem.CONTACT);

	// Take the contacts and create a list of their email addresses (a contact may have more than one)
	var list = [];
	var a = vec.getArray();
	for (var i = 0; i < a.length; i++) {
		var contact = a[i];
		if (contact.isGroup() && !contact.isDL) {
			var members = contact.getGroupMembers().good.toString(AjxEmailAddress.SEPARATOR);
			ZmContactsHelper._addContactToList(list, contact, members, true);
		} else {
			var emails = contact.isGal ? [contact.getEmail()] : contact.getEmails();
			for (var j = 0; j < emails.length; j++) {
				ZmContactsHelper._addContactToList(list, contact, emails[j]);
			}
			if (includeContactsWithNoEmail && emails.length == 0) {
				ZmContactsHelper._addContactToList(list, contact, null);
			}
		}
	}
	
	return list;
};

/**
 * @private
 */
ZmContactsHelper._addContactToList = 
function(list, contact, addr, isGroup) {

	var email = ZmContactsHelper._wrapContact(contact, addr, isGroup);  
	list.push(email);
};

/**
 * wrapps the contact inside a AjxEmailAddress object, and adds a couple extra fields to the AjxEmailAddress instance (value, contact, icon [which I'm not sure is used])
 *
 * @param contact
 * @param addr {String} optional.
 * @param isGroup
 */
ZmContactsHelper._wrapContact =
function(contact, addr, isGroup) {

	addr = addr || contact.getEmail();
	var fileAs = contact.getFileAs();
	var name = (fileAs != addr) ? fileAs : "";  //todo ??? this is weird.
	var	type = contact.isGal ? ZmContact.GROUP_GAL_REF : ZmContact.GROUP_CONTACT_REF;
	var	value = contact.isGal ? (contact.ref || contact.id) : contact.id;  //defaulting to contact.id in the gal case since from GetContactsResponse the ref is not returned and we can end up with it cached without the ref. Probably need to fix that.
	var displayName = contact.getFullNameForDisplay();

	var email = new AjxEmailAddress(addr, type, name, displayName, isGroup);

	email.value = value;
	email.id = Dwt.getNextId();
	email.__contact = contact;
	email.icon = contact.getIcon();
	if (contact.isDL) {
		email.isGroup = true;
		email.canExpand = contact.canExpand;
		var ac = window.parentAppCtxt || window.appCtxt;
		ac.setIsExpandableDL(addr, email.canExpand);
	}
	return email;
};

/**
 * wrapps the inline address (there's no real ZmContact object) inside AjxEmailAddress and adds the value attribute to it.
 * this is so we treat real contacts and inline contacts consistently throughout the rest of the code.
 *
 * @param value  {String} - the inline email address and/or name (e.g. "john doe <john@doe.com>" or "john@doe.com")
 */
ZmContactsHelper._wrapInlineContact =
function(value) {
	var email = AjxEmailAddress.parse(value); //from legacy data at least (not sure about new), the format might be something like "Inigo Montoya <inigo@theprincessbride.com>" so we have to parse.
	if (!email) {
		//this can happen when creating inline in contact group edit, and the user did not suply email address in the inline value
		email = new AjxEmailAddress(value, null, value);
	}
	email.type = ZmContact.GROUP_INLINE_REF;
	email.value = value;
	email.id = Dwt.getNextId();
	return email;
};


/**
 * The items are AjxEmailAddress objects
 * 
 * @private
 */
ZmContactsHelper._getEmailField =
function(html, idx, item, field, colIdx) {
	if (field == ZmItem.F_TYPE) {
		html[idx++] = AjxImg.getImageHtml(item.icon);
	} else if (field == ZmItem.F_NAME) {
		html[idx++] = '<span style="white-space:nowrap">';
		html[idx++] = AjxStringUtil.htmlEncode(item.name || ZmMsg.noName);
		html[idx++] = "</span>";
	} else if (field == ZmItem.F_EMAIL) {
		html[idx++] = AjxStringUtil.htmlEncode(item.address);
	} else if (field == ZmItem.F_DEPARTMENT) {
		if (item.__contact) {
			html[idx++] = AjxStringUtil.htmlEncode(ZmContact.getAttr(item.__contact, ZmContact.F_department));
		}
	}
	return idx;
};
}
if (AjxPackage.define("zimbraMail.abook.view.ZmContactPicker")) {
/*
 * ***** BEGIN LICENSE BLOCK *****
 * Zimbra Collaboration Suite Web Client
 * Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016 Synacor, Inc.
 *
 * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at: https://www.zimbra.com/license
 * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15
 * have been added to cover use of software over a computer network and provide for limited attribution
 * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B.
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied.
 * See the License for the specific language governing rights and limitations under the License.
 * The Original Code is Zimbra Open Source Web Client.
 * The Initial Developer of the Original Code is Zimbra, Inc.  All rights to the Original Code were
 * transferred by Zimbra, Inc. to Synacor, Inc. on September 14, 2015.
 *
 * All portions of the code are Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016 Synacor, Inc. All Rights Reserved.
 * ***** END LICENSE BLOCK *****
 */

/**
 * @overview
 * This file contains the contact picker classes.
 * 
 */

/**
 * Creates a dialog that lets the user select addresses from a contact list.
 * @constructor
 * @class
 * This class creates and manages a dialog that lets the user select addresses
 * from a contact list. Two lists are maintained, one with contacts to select
 * from, and one that contains the selected addresses. Between them are buttons
 * to shuffle addresses back and forth between the two lists.
 *
 * @author Conrad Damon
 * 
 * @param {Array}	buttonInfo		the transfer button IDs and labels
 * 
 * @extends		DwtDialog
 */
ZmContactPicker = function(buttonInfo) {

	DwtDialog.call(this, {parent:appCtxt.getShell(), title:ZmMsg.selectAddresses, id: "ZmContactPicker"});

	this._buttonInfo = buttonInfo;
	this._initialized = false;
	this._emailListOffset = 0; //client side paginating over email list. Offset of current page of email addresses. Quite different than _lastServerOffset if contacts have 0 or more than 1 email addresses.
	this._serverContactOffset = 0; //server side paginating over contact list. Offset of last contact block we got from the server (each contact could have 0, 1, or more emails so we have to keep track of this separate from the view offset.
	this._ascending = true; //asending or descending search. Keep it stored for pagination to do the right sort.
	this._emailList = new AjxVector();
	this._detailedSearch = appCtxt.get(ZmSetting.DETAILED_CONTACT_SEARCH_ENABLED);
	this._ignoreSetDragBoundries = true;

	this.setSize(Dwt.DEFAULT, this._getDialogHeight());

	this._searchErrorCallback = new AjxCallback(this, this._handleErrorSearch);
};

ZmContactPicker.prototype = new DwtDialog;
ZmContactPicker.prototype.constructor = ZmContactPicker;

ZmContactPicker.prototype.isZmContactPicker = true;
ZmContactPicker.prototype.toString = function() { return "ZmContactPicker"; };

// Consts

ZmContactPicker.DIALOG_HEIGHT = 460;

ZmContactPicker.SEARCH_BASIC = "search";
ZmContactPicker.SEARCH_NAME = "name";
ZmContactPicker.SEARCH_EMAIL = "email";
ZmContactPicker.SEARCH_DEPT = "dept";
ZmContactPicker.SEARCH_PHONETIC = "phonetic";

ZmContactPicker.SHOW_ON_GAL = [ZmContactPicker.SEARCH_BASIC, ZmContactPicker.SEARCH_NAME, ZmContactPicker.SEARCH_EMAIL, ZmContactPicker.SEARCH_DEPT];
ZmContactPicker.SHOW_ON_NONGAL = [ZmContactPicker.SEARCH_BASIC, ZmContactPicker.SEARCH_NAME, ZmContactPicker.SEARCH_PHONETIC, ZmContactPicker.SEARCH_EMAIL];
ZmContactPicker.ALL = [ ZmContactPicker.SEARCH_BASIC, ZmContactPicker.SEARCH_NAME, ZmContactPicker.SEARCH_PHONETIC, ZmContactPicker.SEARCH_EMAIL, ZmContactPicker.SEARCH_DEPT ];

// Public methods


/**
* Displays the contact picker dialog. The source list is populated with
* contacts, and the target list is populated with any addresses that are
* passed in. The address button that was used to popup the dialog is set
* as the active button.
*
* @param {String}	buttonId	the button ID of the button that called us
* @param {Hash}	addrs		a hash of 3 vectors (one for each type of address)
* @param {String}	str		initial search string
*/
ZmContactPicker.prototype.popup =
function(buttonId, addrs, str, account) {

	if (!this._initialized) {
		this._initialize(account);
		this._initialized = true;
	}
	else if (appCtxt.multiAccounts && this._account != account) {
		this._account = account;
		this._resetSelectDiv();
	}
	this._emailListOffset = 0;

	var searchFor = this._searchInSelect ? this._searchInSelect.getValue() : ZmContactsApp.SEARCHFOR_CONTACTS;

	// reset column sorting preference
	this._chooser.sourceListView.setSortByAsc(ZmItem.F_NAME, true);

	// reset button states
	this._chooser.reset();
	if (buttonId) {
		this._chooser._setActiveButton(buttonId);
	}

	// populate target list if addrs were passed in
	if (addrs) {
		for (var id in addrs) {
			this._chooser.addItems(addrs[id], DwtChooserListView.TARGET, true, id);
		}
	}

	for (var fieldId in this._searchField) {
		var field = this._searchField[fieldId];
		field.disabled = false;
		field.value = (AjxUtil.isObject(str) ? str[fieldId] : str) || "";
	}

	// reset paging buttons
	this._prevButton.setEnabled(false);
	this._nextButton.setEnabled(false);

	this.search(null, true, true);

    DwtDialog.prototype.popup.call(this);

	this._resizeChooser();

    if ((this.getLocation().x < 0 ||  this.getLocation().y < 0) ){
                // parent window size is smaller than Dialog size
                this.setLocation(0,30);
                var size = Dwt.getWindowSize();
                var currentSize = this.getSize();
                var dragElement = document.getElementById(this._dragHandleId);
                DwtDraggable.setDragBoundaries(dragElement, 100 - currentSize.x, size.x - 100, 0, size.y - 100);
    }

	var focusField = this._searchField[ZmContactPicker.SEARCH_BASIC] || this._searchField[ZmContactPicker.SEARCH_NAME];
	appCtxt.getKeyboardMgr().grabFocus(focusField);

};


ZmContactPicker.prototype._resetResults =
function() {
	this._emailList.removeAll();
	this._serverContactOffset = 0;
	this._emailListOffset = 0;
};

/**
 * Closes the dialog.
 * 
 */
ZmContactPicker.prototype.popdown =
function() {
	// disable search field (hack to fix bleeding cursor)

	for (var fieldId in this._searchField) {
		this._searchField[fieldId].disabled = true;
	}

	this._contactSource = null;
	this._resetResults();

	DwtDialog.prototype.popdown.call(this);
};

/**
 * Performs a search.
 * 
 * @private
 */
ZmContactPicker.prototype.search =
function(colItem, ascending, firstTime, lastId, lastSortVal, offset) {
	if (offset == undefined) {
		//this could be a call from DwtChooserListView.prototype._sortColumn, which means we have to reset the result and both server and client pagination.
		//In any case the results should be reset or are already reset so doesn't hurt to reset.
		this._resetResults();
	}

	if (ascending === null || ascending === undefined) {
		ascending = this._ascending;
	}
	else {
		this._ascending = ascending;
	}
	
	var query;
	var queryHint = [];
	var emailQueryTerm = "";
	var phoneticQueryTerms = [];
	var nameQueryTerms = [];
	var conds = [];
	if (this._detailedSearch) {
		var nameQuery = this.getSearchFieldValue(ZmContactPicker.SEARCH_NAME);
		var emailQuery = this.getSearchFieldValue(ZmContactPicker.SEARCH_EMAIL);
		var deptQuery = this.getSearchFieldValue(ZmContactPicker.SEARCH_DEPT);
		var phoneticQuery = this.getSearchFieldValue(ZmContactPicker.SEARCH_PHONETIC);
		var isGal = this._searchInSelect && (this._searchInSelect.getValue() == ZmContactsApp.SEARCHFOR_GAL);
		if (nameQuery && !isGal) {
			var nameQueryPieces = nameQuery.split(/\s+/);
			for (var i = 0; i < nameQueryPieces.length; i++) {
				var nameQueryPiece = nameQueryPieces[i];
				nameQueryTerms.push("#"+ZmContact.F_firstName + ":" + nameQueryPiece);
				nameQueryTerms.push("#"+ZmContact.F_lastName + ":" + nameQueryPiece);
				nameQueryTerms.push("#"+ZmContact.F_middleName + ":" + nameQueryPiece);
				nameQueryTerms.push("#"+ZmContact.F_nickname + ":" + nameQueryPiece);
			}
			query = "(" + nameQueryTerms.join(" OR ") + ")";
		} else {
			if (nameQuery && isGal) {
				conds.push([{attr:ZmContact.F_firstName, op:"has", value: nameQuery},
				            {attr:ZmContact.F_lastName,  op:"has", value: nameQuery},
				            {attr:ZmContact.F_middleName, op:"has", value: nameQuery},
				            {attr:ZmContact.F_nickname,  op:"has", value: nameQuery},
				            {attr:ZmContact.F_phoneticFirstName, op:"has", value: nameQuery},
				            {attr:ZmContact.F_phoneticLastName,  op:"has", value: nameQuery}]);
			}
			query = "";
		}
		if (emailQuery) {
			if (isGal) {
				conds.push([{attr:ZmContact.F_email, op:"has", value: emailQuery},
				{attr:ZmContact.F_email2, op:"has", value: emailQuery},
				{attr:ZmContact.F_email3, op:"has", value: emailQuery},
				{attr:ZmContact.F_email4, op:"has", value: emailQuery},
				{attr:ZmContact.F_email5, op:"has", value: emailQuery},
				{attr:ZmContact.F_email6, op:"has", value: emailQuery},
				{attr:ZmContact.F_email7, op:"has", value: emailQuery},
				{attr:ZmContact.F_email8, op:"has", value: emailQuery},
				{attr:ZmContact.F_email9, op:"has", value: emailQuery},
				{attr:ZmContact.F_email10, op:"has", value: emailQuery},
				{attr:ZmContact.F_email11, op:"has", value: emailQuery},
				{attr:ZmContact.F_email12, op:"has", value: emailQuery},
				{attr:ZmContact.F_email13, op:"has", value: emailQuery},
				{attr:ZmContact.F_email14, op:"has", value: emailQuery},
				{attr:ZmContact.F_email15, op:"has", value: emailQuery},
				{attr:ZmContact.F_email16, op:"has", value: emailQuery}
				]);
			} else {
				emailQueryTerm = "to:"+emailQuery+"*";
			}
		}
		if (deptQuery && isGal) {
			conds.push({attr:ZmContact.F_department, op:"has", value: deptQuery});
		}
		if (phoneticQuery && !isGal) {
			var phoneticQueryPieces = phoneticQuery.split(/\s+/);
			for (var i=0; i<phoneticQueryPieces.length; i++) {
				phoneticQueryTerms.push("#"+ZmContact.F_phoneticFirstName + ":" + phoneticQueryPieces[i]);
				phoneticQueryTerms.push("#"+ZmContact.F_phoneticLastName + ":" + phoneticQueryPieces[i]);
			}
		}
	} else {
		query = this.getSearchFieldValue(ZmContactPicker.SEARCH_BASIC);
	}
	

	if (this._searchInSelect) {
		var searchFor = this._searchInSelect.getValue();
		this._contactSource = (searchFor == ZmContactsApp.SEARCHFOR_CONTACTS || searchFor == ZmContactsApp.SEARCHFOR_PAS)
			? ZmItem.CONTACT
			: ZmId.SEARCH_GAL;

		if (searchFor == ZmContactsApp.SEARCHFOR_PAS) {
			queryHint.push(ZmSearchController.generateQueryForShares(ZmId.ITEM_CONTACT) || "is:local");
		} else if (searchFor == ZmContactsApp.SEARCHFOR_CONTACTS) {
			queryHint.push("is:local");
		} else if (searchFor == ZmContactsApp.SEARCHFOR_GAL) {
            ascending = true;
        }
	} else {
		this._contactSource = appCtxt.get(ZmSetting.CONTACTS_ENABLED, null, this._account)
			? ZmItem.CONTACT
			: ZmId.SEARCH_GAL;

		if (this._contactSource == ZmItem.CONTACT) {
			queryHint.push("is:local");
		}
	}

	if (this._contactSource == ZmItem.CONTACT && query != "" && !query.startsWith ("(")) {
		query = query.replace(/\"/g, '\\"');
		query = "\"" + query + "\"";
	}
	if (phoneticQueryTerms.length) {
		query = query + " (" + phoneticQueryTerms.join(" OR ") + ")";
	}
	if (emailQueryTerm.length) {
		query = query + " " + emailQueryTerm;  // MUST match email term, hence AND rather than OR
	}

	if (this._searchIcon) { //does not exist in ZmGroupView case
		this._searchIcon.className = "DwtWait16Icon";
	}

	// XXX: line below doesn't have intended effect (turn off column sorting for GAL search)
	if (this._chooser) { //_chooser not defined in ZmGroupView but we also do not support sorting there anyway
		this._chooser.sourceListView.sortingEnabled = (this._contactSource == ZmItem.CONTACT);
	}

	var params = {
		obj:			this,
		ascending:		ascending,
		query:			query,
		queryHint:		queryHint.join(" "),
		conds:			conds,
		offset:			offset || 0,
		lastId:			lastId,
		lastSortVal:	lastSortVal,
		respCallback:	(new AjxCallback(this, this._handleResponseSearch, [firstTime])),
		errorCallback:	this._searchErrorCallback,
		accountName:	(this._account && this._account.name),
		expandDL:		true
	};
	ZmContactsHelper.search(params);
};

/**
 * @private
 */
ZmContactPicker.prototype._contentHtml =
function(account) {
	var showSelect;
	if (appCtxt.multiAccounts) {
		var list = appCtxt.accountList.visibleAccounts;
		for (var i = 0; i < list.length; i++) {
			var account = list[i];
			if (appCtxt.get(ZmSetting.CONTACTS_ENABLED, null, account) &&
				(appCtxt.get(ZmSetting.GAL_ENABLED, null, account) ||
				 appCtxt.get(ZmSetting.SHARING_ENABLED, null, account)))
			{
				showSelect = true;
				break;
			}
		}
	} else {
		showSelect = (appCtxt.get(ZmSetting.CONTACTS_ENABLED) &&
					  (appCtxt.get(ZmSetting.GAL_ENABLED) ||
					   appCtxt.get(ZmSetting.SHARING_ENABLED)));
	}

	var subs = {
		id: this._htmlElId,
		showSelect: showSelect,
		detailed: this._detailedSearch
	};

	return (AjxTemplate.expand("abook.Contacts#ZmContactPicker", subs));
};

/**
 * @private
 */
ZmContactPicker.prototype._resetSelectDiv =
function() {
    this._searchInSelect.clearOptions();

    if (appCtxt.multiAccounts) {
        var accts = appCtxt.accountList.visibleAccounts;
        var org = ZmOrganizer.ITEM_ORGANIZER;
        org = ZmOrganizer.ITEM_ORGANIZER[ZmItem.CONTACT];

        for (var i = 0; i < accts.length; i++) {
            this._searchInSelect.addOption(accts[i].displayName, false, accts[i].id);
            var folderTree = appCtxt.getFolderTree(accts[i]);
            var data = [];
            data = data.concat(folderTree.getByType(org));
            for (var j = 0; j < data.length; j++) {
                var addrsbk = data[j];
                if(addrsbk.noSuchFolder) { continue; }
                this._searchInSelect.addOption(addrsbk.getName(), false, addrsbk.id, "ImgContact");
            }
            if(accts[i].isZimbraAccount && !accts[i].isMain) {
                if (appCtxt.get(ZmSetting.CONTACTS_ENABLED, null, this._account)) {
                    if (appCtxt.get(ZmSetting.SHARING_ENABLED, null, this._account))
                        this._searchInSelect.addOption(ZmMsg.searchPersonalSharedContacts, false, ZmContactsApp.SEARCHFOR_PAS, "ImgContact");
                }

                if (appCtxt.get(ZmSetting.GAL_ENABLED, null, this._account)) {
                    this._searchInSelect.addOption(ZmMsg.GAL, true, ZmContactsApp.SEARCHFOR_GAL, "ImgContact");
                }

                if (!appCtxt.get(ZmSetting.INITIALLY_SEARCH_GAL, null, this._account) ||
                        !appCtxt.get(ZmSetting.GAL_ENABLED, null, this._account))
                {
                    this._searchInSelect.setSelectedValue(ZmContactsApp.SEARCHFOR_CONTACTS);
                }
            }
        }

        for (var k = 0; k < accts.length; k++) {
            this._searchInSelect.enableOption(accts[k].id, false);
        }
    } else {

        if (appCtxt.get(ZmSetting.CONTACTS_ENABLED, null, this._account)) {
            this._searchInSelect.addOption(ZmMsg.contacts, false, ZmContactsApp.SEARCHFOR_CONTACTS);

            if (appCtxt.get(ZmSetting.SHARING_ENABLED, null, this._account))
                this._searchInSelect.addOption(ZmMsg.searchPersonalSharedContacts, false, ZmContactsApp.SEARCHFOR_PAS);
        }

        if (appCtxt.get(ZmSetting.GAL_ENABLED, null, this._account)) {
            this._searchInSelect.addOption(ZmMsg.GAL, true, ZmContactsApp.SEARCHFOR_GAL);
        }

        if (!appCtxt.get(ZmSetting.INITIALLY_SEARCH_GAL, null, this._account) ||
                !appCtxt.get(ZmSetting.GAL_ENABLED, null, this._account))
        {
            this._searchInSelect.setSelectedValue(ZmContactsApp.SEARCHFOR_CONTACTS);
        }

    }
};

ZmContactPicker.prototype.getSearchFieldValue =
function(fieldId) {
	if (!fieldId && !this._detailedSearch) {
		fieldId = ZmContactPicker.SEARCH_BASIC;
	}
	var field = this._searchField[fieldId];
	return field && AjxStringUtil.trim(field.value) || "";
};


ZmContactPicker.prototype._getDialogHeight =
function() {
	return ZmContactPicker.DIALOG_HEIGHT - (appCtxt.isChildWindow ? 100 : 0);
};

ZmContactPicker.prototype._getSectionHeight =
function(idSuffix) {
	return Dwt.getSize(document.getElementById(this._htmlElId + idSuffix)).y;

};

ZmContactPicker.prototype._resizeChooser =
function() {

	var chooserHeight = this._getDialogHeight()
			- this._getSectionHeight("_handle")  //the header
			- this._getSectionHeight("_searchTable")
			- this._getSectionHeight("_paging")
			- this._getSectionHeight("_buttonsSep")
			- this._getSectionHeight("_buttons")
			- 30; //still need some magic to account for some margins etc.

	this._chooser.resize(this.getSize().x - 25, chooserHeight);
};

/**
 * called only when ZmContactPicker is first created. Sets up initial layout.
 * 
 * @private
 */
ZmContactPicker.prototype._initialize =
function(account) {

	// create static content and append to dialog parent
	this.setContent(this._contentHtml(account));

	this._searchIcon = document.getElementById(this._htmlElId + "_searchIcon");

	// add search button
	this._searchButton = new DwtButton({parent:this, parentElement:(this._htmlElId+"_searchButton")});
	this._searchButton.setText(ZmMsg.search);
	this._searchButton.addSelectionListener(new AjxListener(this, this._searchButtonListener));

	// add select menu
	var selectCellId = this._htmlElId + "_listSelect";
	var selectCell = document.getElementById(selectCellId);
	if (selectCell) {
		this._searchInSelect = new DwtSelect({
			parent:         this,
			parentElement:  selectCellId,
			id:             Dwt.getNextId("ZmContactPickerSelect_"),
			legendId:       this._htmlElId + '_listSelectLbl'
		});
		this._resetSelectDiv();
		this._searchInSelect.addChangeListener(new AjxListener(this, this._searchTypeListener));
	} else {
		this.setSize("600");
	}

	// add chooser
	this._chooser = new ZmContactChooser({parent:this, buttonInfo:this._buttonInfo});
	this._chooser.reparentHtmlElement(this._htmlElId + "_chooser");

	// add paging buttons
	var pageListener = new AjxListener(this, this._pageListener);
	this._prevButton = new DwtButton({parent:this, parentElement:(this._htmlElId+"_pageLeft")});
	this._prevButton.setText(ZmMsg.previous);
	this._prevButton.setImage("LeftArrow");
	this._prevButton.addSelectionListener(pageListener);

	this._nextButton = new DwtButton({parent:this, style:DwtLabel.IMAGE_RIGHT, parentElement:(this._htmlElId+"_pageRight")});
	this._nextButton.setText(ZmMsg.next);
	this._nextButton.setImage("RightArrow");
	this._nextButton.addSelectionListener(pageListener);

	var pageContainer = document.getElementById(this._htmlElId + "_paging");
	if (pageContainer) {
		Dwt.setSize(pageContainer, this._chooser.sourceListView.getSize().x);
	}

	// init listeners
	this.setButtonListener(DwtDialog.OK_BUTTON, new AjxListener(this, this._okButtonListener));
	this.setButtonListener(DwtDialog.CANCEL_BUTTON, new AjxListener(this, this._cancelButtonListener));

	var fieldMap = {};
	var rowMap = {};
	this.mapFields(fieldMap, rowMap);

	this._searchField = {};
	for (var fieldId in fieldMap) {
		var field = Dwt.byId(fieldMap[fieldId]);
		if (field) {
			this._searchField[fieldId] = field;
			Dwt.setHandler(field, DwtEvent.ONKEYUP, ZmContactPicker._keyPressHdlr);
		}
	}

	this._searchRow = {};
	for (var rowId in rowMap) {
		var row = Dwt.byId(rowMap[rowId]);
		if (row) {
			this._searchRow[rowId] = row;
		}
	}
	this._updateSearchRows(this._searchInSelect && this._searchInSelect.getValue() || ZmContactsApp.SEARCHFOR_CONTACTS);
	this._keyPressCallback = new AjxCallback(this, this._searchButtonListener);
    this.sharedContactGroups = [];

	//add tabgroups for keyboard navigation
	this._tabGroup = new DwtTabGroup(this.toString());
	this._tabGroup.removeAllMembers();
	for (var i = 0; i < ZmContactPicker.ALL.length; i++) {
		field = Dwt.byId(fieldMap[ZmContactPicker.ALL[i]]);
		if (Dwt.getVisible(field)) {
			this._tabGroup.addMember(field);
		}
	}
	this._tabGroup.addMember(this._searchButton);
	this._tabGroup.addMember(this._searchInSelect);
	this._tabGroup.addMember(this._chooser.getTabGroupMember());
	this._tabGroup.addMember(this._prevButton);
	this._tabGroup.addMember(this._nextButton);
	for (var i = 0; i < this._buttonList.length; i++) {
		this._tabGroup.addMember(this._button[this._buttonList[i]]);
	}
};

ZmContactPicker.prototype.mapFields =
function(fieldMap, rowMap) {
	if (this._detailedSearch) {
		fieldMap[ZmContactPicker.SEARCH_NAME] = this._htmlElId + "_searchNameField";
		fieldMap[ZmContactPicker.SEARCH_EMAIL] = this._htmlElId + "_searchEmailField";
		fieldMap[ZmContactPicker.SEARCH_DEPT] = this._htmlElId + "_searchDepartmentField";
		fieldMap[ZmContactPicker.SEARCH_PHONETIC] = this._htmlElId + "_searchPhoneticField";
		rowMap[ZmContactPicker.SEARCH_NAME] = this._htmlElId + "_searchNameRow";
		rowMap[ZmContactPicker.SEARCH_PHONETIC] = this._htmlElId + "_searchPhoneticRow";
		rowMap[ZmContactPicker.SEARCH_EMAIL] = this._htmlElId + "_searchEmailRow";
		rowMap[ZmContactPicker.SEARCH_DEPT] = this._htmlElId + "_searchDepartmentRow";
	}
	else {
		fieldMap[ZmContactPicker.SEARCH_BASIC] = this._htmlElId + "_searchField";
		rowMap[ZmContactPicker.SEARCH_BASIC] = this._htmlElId + "_searchRow";
	}
};		

// Listeners

/**
 * @private
 */
ZmContactPicker.prototype._searchButtonListener =
function(ev) {
	this._resetResults();
	this.search();
};

/**
 * @private
 */
ZmContactPicker.prototype._handleResponseSearch =
function(firstTime, result) {
	var resp = result.getResponse();
	var serverHasMore = resp.getAttribute("more");
	var serverPaginationSupported = resp.getAttribute("paginationSupported") !== false; //if it's not specified (such as the case of SearchResponse, i.e. not Gal) it IS supported.
	this._serverHasMoreAndPaginationSupported = serverHasMore && serverPaginationSupported;
	var offset = resp.getAttribute("offset");
	this._serverContactOffset = offset || 0;
	var info = resp.getAttribute("info");
	var expanded = info && info[0].wildcard[0].expanded == "0";

	//the check for firstTime is so when the picker is popped up we probably don't want to overwhelm them with a warning message. So only show it if the user plays with the picker, using the drop-down or the search box.
	if (!firstTime && !serverPaginationSupported && (serverHasMore || expanded)) { //no idea what the expanded case is
		var d = appCtxt.getMsgDialog();
		d.setMessage(ZmMsg.errorSearchNotExpanded);
		d.popup();
		if (expanded) { return; }
	}

	// this method will expand the list depending on the number of email
	// addresses per contact.
	var emailArray = ZmContactsHelper._processSearchResponse(resp, this._includeContactsWithNoEmail); //this._includeContactsWithNoEmail - true in the ZmGroupView case 
	var emailList = AjxVector.fromArray(emailArray);

	if (serverPaginationSupported) {
		this._emailList.addList(emailArray); //this internally calls concat. we do not need "merge" here because we use the _serverContactOffset as a marker of where to search next, never searching a block we already did.
	}
	else {
		this._emailList = emailList;
	}
    var list = this.getSubList();
    if (this.toString() === "ZmContactPicker") {
        list = this.loadSharedGroupContacts(list) || list;
    }
	this._showResults(list);

};

ZmContactPicker.prototype._showResults =
function(aList) {
    var list = aList || this.getSubList();
	// special case 1 - search forward another server block, to fill up a page. Could search several times.
	if (list.size() < ZmContactsApp.SEARCHFOR_MAX && this._serverHasMoreAndPaginationSupported) {
		this.search(null, null, null, null, null, this._serverContactOffset + ZmContactsApp.SEARCHFOR_MAX); //search another page
		return;
	}

	if (this._searchIcon) { //does not exist in ZmGroupView case
		this._searchIcon.className = "";
	}
	this._searchButton.setEnabled(true);

	// special case 2 - no results, and no more to search (that was covered in special case 1) - so display the "no results" text.
	if (list.size() == 0 && this._emailListOffset == 0) {
		this._setResultsInView(list); //empty the list
		this._nextButton.setEnabled(false);
		this._prevButton.setEnabled(false);
		this._setNoResultsHtml();
		return;
	}

	// special case 3 - If the AB ends with a long list of contacts w/o addresses,
	// we may get an empty list.  If that's the case, roll back the offset
	// not 100% sure this case could still happen after all my changes but it was there in the code, so I keep it just in case.
	if (list.size() == 0) {
		this._emailListOffset -= ZmContactsApp.SEARCHFOR_MAX;
		this._emailListOffset  = Math.max(0, this._emailListOffset);
	}

	var more = this._serverHasMoreAndPaginationSupported  //we can get more from the server
				|| (this._emailListOffset + ZmContactsApp.SEARCHFOR_MAX) < this._emailList.size(); //or we have more on the client we didn't yet show
	this._prevButton.setEnabled(this._emailListOffset > 0);
	this._nextButton.setEnabled(more);

	this._resetSearchColHeaders(); // bug #2269 - enable/disable sort column per type of search
	this._setResultsInView(list);
};

ZmContactPicker.prototype.loadSharedGroupContacts =
    function(aList) {

    var listLen,
        listArray,
        contact,
        item,
        i,
        j,
        k,
        sharedContactGroupArray,
        len1,
        jsonObj,
        batchRequest,
        request,
        response;

        listArray = aList.getArray();
        listLen = aList.size();
        sharedContactGroupArray = [];

    for (i = 0 ; i < listLen; i++) {
        item = listArray[i];
        contact = item.__contact;
        if (contact.isGroup() && contact.isShared()) {
            if (this.sharedContactGroups.indexOf(item.value) !== -1) {
                return;
            }
            this.sharedContactGroups.push(item.value);
            sharedContactGroupArray.push(item.value);
        }
    }

    len1 = sharedContactGroupArray.length;
    jsonObj = {BatchRequest:{GetContactsRequest:[],_jsns:"urn:zimbra", onerror:'continue'}};
    batchRequest = jsonObj.BatchRequest;
    request = batchRequest.GetContactsRequest;

    for (j = 0,k =0; j < len1; j++) {
        request.push({ cn: {id: sharedContactGroupArray[j]}, _jsns: 'urn:zimbraMail', derefGroupMember: '1', returnCertInfo: '1', requestId: k++ }); //See ZCS-999 and ZCS-991 for returnCertInfo param
    }
        var respCallback = new AjxCallback(this, this.handleSharedContactResponse,[aList]);
       response =  appCtxt.getAppController().sendRequest({
            jsonObj:jsonObj,
            asyncMode:true,
            callback:respCallback
        });
   };

ZmContactPicker.prototype.handleSharedContactResponse =
    function(aList,response) {

     var contactResponse,
         contactResponseLength,
         listArray,
         listArrayLength,
         sharedGroupMembers,
         i,
         j,
         k,
         resp,
         contact,
         member,
         isGal,
         memberContact,
         loadMember,
         listArrElement,
         sharedGroupMembers;

        if (response && response.getResponse() && response.getResponse().BatchResponse) {
            contactResponse = response.getResponse().BatchResponse.GetContactsResponse;
        }
        if (!contactResponse) {
            return;
        }
        contactResponseLength = contactResponse.length;
        listArray = aList.getArray();
        listArrayLength = aList.size();

        for (k= 0; k < listArrayLength; k++) {
            sharedGroupMembers = [];
            for (j = 0; j < contactResponseLength; j++) {
                resp = contactResponse[j];
                contact = resp.cn[0];

                if (contact.m) {
                    for (i = 0; i < contact.m.length; i++) {
                        member = contact.m[i];
                        isGal = false;
                        if (member.type == ZmContact.GROUP_GAL_REF) {
                            isGal = true;
                        }
                        if (member.cn && member.cn.length > 0) {
                            memberContact = member.cn[0];
                            memberContact.ref = memberContact.ref || (isGal && member.value);
                            loadMember = ZmContact.createFromDom(memberContact, {list: this.list, isGal: isGal});
                            loadMember.isDL = isGal && loadMember.attr[ZmContact.F_type] === "group";
                            appCtxt.cacheSet(member.value, loadMember);
                            listArrElement = listArray[k];
                            if (listArrElement.value === contact.id) {
                                sharedGroupMembers.push( '"'+loadMember.getFullName()+'"' +' <' + loadMember.getEmails() +'>;' ); // Updating the original list with shared members of shared contact group that comes in 'contactResponse'.
                                aList._array[k].address = sharedGroupMembers.join("");
                            }
                        }
                    }
                    ZmContact.prototype._loadFromDom(contact);
                }
            }
        }
        this._showResults(aList); // As async = true, when the response has come, again we render/update the  list with  contactResponse shared contact members,
    };


/**
 * extracted this so it can be used in ZmGroupView where this is different.
 * @param list
 */
ZmContactPicker.prototype._setResultsInView =
function(list) {
	this._chooser.setItems(list);
};

/**
 * extracted this so it can be used in ZmGroupView where this is different.
 * @param list
 */
ZmContactPicker.prototype._setNoResultsHtml =
function(list) {
	this._chooser.sourceListView._setNoResultsHtml();
};


ZmContactPicker.prototype._updateSearchRows =
function(searchFor) {
	var fieldIds = (searchFor == ZmContactsApp.SEARCHFOR_GAL) ? ZmContactPicker.SHOW_ON_GAL : ZmContactPicker.SHOW_ON_NONGAL;
	for (var fieldId in this._searchRow) {
		Dwt.setVisible(this._searchRow[fieldId], AjxUtil.indexOf(fieldIds, fieldId)!=-1);
	}
	for (var fieldId in this._searchField) {
		var field = this._searchField[fieldId];
		if (this._tabGroup.contains(field))
			this._tabGroup.removeMember(field);
	}
	for (var i=0; i<fieldIds.length; i++) {
		this._tabGroup.addMember(this._searchField[fieldIds[i]]);
	}

	this._resizeChooser();
};

/**
 * @private
 */
ZmContactPicker.prototype._handleErrorSearch =
function() {
	this._searchButton.setEnabled(true);
	return false;
};

/**
 * @private
 */
ZmContactPicker.prototype._pageListener =
function(ev) {
	if (ev.item == this._prevButton) {
		this._emailListOffset -= ZmContactsApp.SEARCHFOR_MAX;
		this._emailListOffset  = Math.max(0, this._emailListOffset);
	}
	else {
		this._emailListOffset += ZmContactsApp.SEARCHFOR_MAX;
	}
	this._showResults();
};

/**
 * Gets a sub-list of contacts.
 * 
 * @return	{AjxVector}		a vector of {ZmContact} objects
 */
ZmContactPicker.prototype.getSubList =
function() {
	var size = this._emailList.size();

	var end = this._emailListOffset + ZmContactsApp.SEARCHFOR_MAX;

	if (end > size) {
		end = size;
	}

	var a = (this._emailListOffset < end) ? this._emailList.getArray().slice(this._emailListOffset, end) : [];
	return AjxVector.fromArray(a);
};

/**
 * @private
 */
ZmContactPicker.prototype._searchTypeListener =
function(ev) {
	var oldValue = ev._args.oldValue;
	var newValue = ev._args.newValue;

	if (oldValue != newValue) {
		this._updateSearchRows(newValue);
		this._searchButtonListener();
	}
};

/**
 * @private
 */
ZmContactPicker.prototype._resetSearchColHeaders =
function () {
    var slv = this._chooser.sourceListView;
    var tlv = this._chooser.targetListView;
    slv.headerColCreated = false;
    tlv.headerColCreated = false;
    var isGal = this._searchInSelect && (this._searchInSelect.getValue() == ZmContactsApp.SEARCHFOR_GAL);

    // find the participant column
    var part = 0;
    for (var i = 0; i < slv._headerList.length; i++) {
        var field = slv._headerList[i]._field;
        if (field == ZmItem.F_NAME) {
            part = i;
        }
        if (field == ZmItem.F_DEPARTMENT) {
            slv._headerList[i]._visible = isGal && this._detailedSearch;
        }
    }

    var sortable = isGal ? null : ZmItem.F_NAME;
    slv._headerList[part]._sortable = sortable;
    slv.createHeaderHtml(sortable);

    for (i = 0; i < tlv._headerList.length; i++) {
        if (tlv._headerList[i]._field == ZmItem.F_DEPARTMENT) {
            tlv._headerList[i]._visible = isGal && this._detailedSearch;
        }
    }
    tlv.createHeaderHtml();
};

/**
 * Done choosing addresses, add them to the compose form.
 * 
 * @private
 */
ZmContactPicker.prototype._okButtonListener =
function(ev) {
	var data = this._chooser.getItems();
	DwtDialog.prototype._buttonListener.call(this, ev, [data]);
};

/**
 * Call custom popdown method.
 * 
 * @private
 */
ZmContactPicker.prototype._cancelButtonListener =
function(ev) {
	DwtDialog.prototype._buttonListener.call(this, ev);
	this.popdown();
};

/**
 * @private
 */
ZmContactPicker._keyPressHdlr =
function(ev) {
	var stb = DwtControl.getTargetControl(ev);
	var charCode = DwtKeyEvent.getCharCode(ev);
	if (stb._keyPressCallback && (charCode == 13 || charCode == 3)) {
		stb._keyPressCallback.run();
		return false;
	}
	return true;
};


/***********************************************************************************/

/**
 * Creates a contact chooser.
 * @class
 * This class creates a specialized chooser for the contact picker.
 *
 * @param {DwtComposite}	parent			the contact picker
 * @param {Array}		buttonInfo		transfer button IDs and labels
 * 
 * @extends		DwtChooser
 * 
 * @private
 */
ZmContactChooser = function(params) {
	DwtChooser.call(this, params);
};

ZmContactChooser.prototype = new DwtChooser;
ZmContactChooser.prototype.constructor = ZmContactChooser;

/**
 * @private
 */
ZmContactChooser.prototype._createSourceListView =
function() {
	return new ZmContactChooserSourceListView(this);
};

/**
 * @private
 */
ZmContactChooser.prototype._createTargetListView =
function() {
	return new ZmContactChooserTargetListView(this, (this._buttonInfo.length > 1));
};

/**
 * The item is a AjxEmailAddress. Its address is used for comparison.
 *
 * @param {AjxEmailAddress}	item	an email address
 * @param {AjxVector}	list	list to check in
 * 
 * @private
 */
ZmContactChooser.prototype._isDuplicate =
function(item, list) {
	return list.containsLike(item, item.getAddress);
};

/***********************************************************************************/

/**
 * Creates a source list view.
 * @class
 * This class creates a specialized source list view for the contact chooser.
 * 
 * @param {DwtComposite}	parent			the contact picker
 * 
 * @extends		DwtChooserListView
 * 
 * @private
 */
ZmContactChooserSourceListView = function(parent) {
	DwtChooserListView.call(this, {parent:parent, type:DwtChooserListView.SOURCE});
	this.setScrollStyle(Dwt.CLIP);
};

ZmContactChooserSourceListView.prototype = new DwtChooserListView;
ZmContactChooserSourceListView.prototype.constructor = ZmContactChooserSourceListView;

/**
 * Returns a string representation of the object.
 * 
 * @return		{String}		a string representation of the object
 * @private
 */
ZmContactChooserSourceListView.prototype.toString =
function() {
	return "ZmContactChooserSourceListView";
};

ZmContactChooserSourceListView.prototype.getToolTipContent =
function(ev) {
	
	if (this._hoveredItem) {
		var ttParams = {
			address:		this._hoveredItem.address,
			contact:		this._hoveredItem.__contact,
			ev:				ev,
			noRightClick:	true
		};
		var ttCallback = new AjxCallback(this,
			function(callback) {
				appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON, ttParams, callback);
			});
		return {callback:ttCallback};
	}
	else {
		return "";
	}
};

/**
 * @private
 */
ZmContactChooserSourceListView.prototype._getHeaderList =
function() {
	var headerList = [];
	headerList.push(new DwtListHeaderItem({field:ZmItem.F_TYPE, icon:"Folder", width:ZmMsg.COLUMN_WIDTH_FOLDER_CN}));
	headerList.push(new DwtListHeaderItem({field:ZmItem.F_NAME, text:ZmMsg._name, width:ZmMsg.COLUMN_WIDTH_NAME_CN, resizeable: true}));
	headerList.push(new DwtListHeaderItem({field:ZmItem.F_DEPARTMENT, text:ZmMsg.department, width:ZmMsg.COLUMN_WIDTH_DEPARTMENT_CN, resizeable: true}));
	headerList.push(new DwtListHeaderItem({field:ZmItem.F_EMAIL, text:ZmMsg.email, resizeable: true}));


	return headerList;
};

 
// Override of DwtListView.prototype._resetColWidth to set width; without overrriding causes vertical scrollbars to disapper
// on header resize
ZmContactChooserSourceListView.prototype._resetColWidth =
function() {

	if (!this.headerColCreated) { return; }

	var lastColIdx = this._getLastColumnIndex();
    if (lastColIdx) {
        var lastCol = this._headerList[lastColIdx];
        var lastCell = document.getElementById(lastCol._id);
		if (lastCell) {
			var div = lastCell.firstChild;
			lastCell.style.width = div.style.width = (lastCol._width || ""); 
		}
    }
};

/**
 * override for scrollbars in IE
 * @param headerIdx
 */
ZmContactChooserSourceListView.prototype._calcRelativeWidth =
function(headerIdx) {
	var column = this._headerList[headerIdx];
	if (!column._width || (column._width && column._width == "auto")) {
		var cell = document.getElementById(column._id);
		// UGH: clientWidth is 5px more than HTML-width (20px for IE to deal with scrollbars)
		return (cell) ? (cell.clientWidth - (AjxEnv.isIE ? Dwt.SCROLLBAR_WIDTH : 5)) : null;
	}
	return column._width;
};

/**
 * @private
 */
ZmContactChooserSourceListView.prototype._mouseOverAction =
function(ev, div) {
	DwtChooserListView.prototype._mouseOverAction.call(this, ev, div);
	var id = ev.target.id || div.id;
	var item = this.getItemFromElement(div);
	this._hoveredItem = (id && item) ? item : null;
	return true;
};

/**
 * @private
 */
ZmContactChooserSourceListView.prototype._getCellContents =
function(html, idx, item, field, colIdx, params) {
	if (field == ZmItem.F_EMAIL && AjxEnv.isIE) {
		var maxWidth = AjxStringUtil.getWidth(item.address);
		html[idx++] = "<div style='float; left; overflow: visible; width: " + maxWidth + ";'>";
		idx = ZmContactsHelper._getEmailField(html, idx, item, field, colIdx, params);
		html[idx++] = "</div>";		
	}
	else {
		idx = ZmContactsHelper._getEmailField(html, idx, item, field, colIdx, params);
	}
	return idx;
};

/**
 * Returns a string of any extra attributes to be used for the TD.
 *
 * @param item		[object]	item to render
 * @param field		[constant]	column identifier
 * @param params	[hash]*		hash of optional params
 * 
 * @private
 */
ZmContactChooserSourceListView.prototype._getCellAttrText =
function(item, field, params) {
	if (field == ZmItem.F_EMAIL) {
		return "style='position: relative; overflow: visible;'";
	}
};

/***********************************************************************************/

/**
 * Creates the target list view.
 * @class
 * This class creates a specialized target list view for the contact chooser.
 * 
 * @param {DwtComposite}	parent			the contact picker
 * @param {constant}		showType		the show type
 * @extends		DwtChooserListView
 * 
 * @private
 */
ZmContactChooserTargetListView = function(parent, showType) {
	this._showType = showType; // call before base class since base calls getHeaderList

	DwtChooserListView.call(this, {parent:parent, type:DwtChooserListView.TARGET});

	this.setScrollStyle(Dwt.CLIP);
};

ZmContactChooserTargetListView.prototype = new DwtChooserListView;
ZmContactChooserTargetListView.prototype.constructor = ZmContactChooserTargetListView;

/**
 * Returns a string representation of the object.
 * 
 * @return		{String}		a string representation of the object
 */
ZmContactChooserTargetListView.prototype.toString =
function() {
	return "ZmContactChooserTargetListView";
};

/**
 * @private
 */
ZmContactChooserTargetListView.prototype._getHeaderList =
function() {
	var headerList = [];
	var view = this._view;
	if (this._showType) {
		headerList.push(new DwtListHeaderItem({field:ZmItem.F_TYPE, icon:"ContactsPicker", width:ZmMsg.COLUMN_WIDTH_TYPE_CN}));
	}
	headerList.push(new DwtListHeaderItem({field:ZmItem.F_NAME, text:ZmMsg._name, width:ZmMsg.COLUMN_WIDTH_NAME_CN, resizeable: true}));
    headerList.push(new DwtListHeaderItem({field:ZmItem.F_DEPARTMENT, text:ZmMsg.department, width:ZmMsg.COLUMN_WIDTH_DEPARTMENT_CN, resizeable: true}));
    headerList.push(new DwtListHeaderItem({field:ZmItem.F_EMAIL, text:ZmMsg.email, resizeable: true}));

	return headerList;
};

ZmContactChooserTargetListView.prototype._mouseOverAction =
ZmContactChooserSourceListView.prototype._mouseOverAction;

/**
 * The items are AjxEmailAddress objects.
 * 
 * @private
 */
ZmContactChooserTargetListView.prototype._getCellContents =
function(html, idx, item, field, colIdx, params) {
	if (field == ZmItem.F_TYPE) {
		item.setType(item._buttonId);
		html[idx++] = ZmMsg[item.getTypeAsString()];
		html[idx++] = ":";
	}
	else if (field == ZmItem.F_EMAIL && AjxEnv.isIE) {
		var maxWidth = AjxStringUtil.getWidth(item.address) + 10;
		html[idx++] = "<div style='float; left;  width: " + maxWidth + ";'>";
		idx = ZmContactsHelper._getEmailField(html, idx, item, field, colIdx, params);
		html[idx++] = "</div>";
	}
	else {
		idx = ZmContactsHelper._getEmailField(html, idx, item, field, colIdx);
	}
	return idx;
};


// Override of DwtListView.prototype._resetColWidth to set width; without overrriding causes vertical scrollbars to disapper
// on header resize
ZmContactChooserTargetListView.prototype._resetColWidth =
function() {

	if (!this.headerColCreated) { return; }

	var lastColIdx = this._getLastColumnIndex();

	
    if (lastColIdx) {
        var lastCol = this._headerList[lastColIdx];
        var lastCell = document.getElementById(lastCol._id);
		if (lastCell) {
			var div = lastCell.firstChild;
			lastCell.style.width = div.style.width = (lastCol._width || "");
		}
    }
};

/**
 * override for scrollbars in IE
 * @param headerIdx
 */
ZmContactChooserTargetListView.prototype._calcRelativeWidth =
function(headerIdx) {
	var column = this._headerList[headerIdx];
	if (!column._width || (column._width && column._width == "auto")) {
		var cell = document.getElementById(column._id);
		// UGH: clientWidth is 5px more than HTML-width (20px for IE to deal with scrollbars)
		return (cell) ? (cell.clientWidth - (AjxEnv.isIE ? Dwt.SCROLLBAR_WIDTH : 5)) : null;
	}
	return column._width;
};

/**
 * Returns a string of any extra attributes to be used for the TD.
 *
 * @param item		[object]	item to render
 * @param field		[constant]	column identifier
 * @param params	[hash]*		hash of optional params
 * 
 * @private
 */
ZmContactChooserTargetListView.prototype._getCellAttrText =
function(item, field, params) {
	if (field == ZmItem.F_EMAIL) {
		return "style='position: relative; overflow: visible;'";
	}
};
}
}
if (AjxPackage.define("abook.Contacts")) {
AjxTemplate.register("abook.Contacts#ZmEditContactView", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_DEBUG'></div><table role=\"presentation\" valign='top' width='100%'>";
	buffer[_i++] =  AjxTemplate.expand("#ZmEditContactView_header", data) ;
	buffer[_i++] =  AjxTemplate.expand("#ZmEditContactView_body", data) ;
	buffer[_i++] = "</table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactView"
}, false);
AjxTemplate.register("abook.Contacts", AjxTemplate.getTemplate("abook.Contacts#ZmEditContactView"), AjxTemplate.getParams("abook.Contacts#ZmEditContactView"));

AjxTemplate.register("abook.Contacts#ZmEditContactView_header", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<tr valign='top' class='contactHeaderRow'><td class='contactHeaderCell' align='center'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_IMAGE' tabindex='100'></div><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_REMOVE_IMAGE_row' style='padding-left:7px;font-size:.8em;white-space:nowrap;'><a id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_VIEW_IMAGE' href='#view' tabindex='101'>";
	buffer[_i++] = ZmMsg.view;
	buffer[_i++] = "</a>\n";
	buffer[_i++] = "\t\t\t\t\t|\n";
	buffer[_i++] = "\t\t\t\t\t<a id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_REMOVE_IMAGE' href='#remove' tabindex='102'>";
	buffer[_i++] = ZmMsg.remove;
	buffer[_i++] = "</a></div></td><td class='contactHeaderCell' valign='bottom'><div style='padding:.125em;'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_FULLNAME'></div></div>";
	 if (appCtxt.get(ZmSetting.TAGGING_ENABLED)) { 
	buffer[_i++] = "<div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_TAG' class='contactHeaderCellRow'></div>";
	 } 
	buffer[_i++] =  AjxTemplate.expand("#ZmEditContactView_headerName", data) ;
	buffer[_i++] =  AjxTemplate.expand("#ZmEditContactView_headerJobInfo", data) ;
	buffer[_i++] = "</td><td class='contactHeaderCell'><table role=\"presentation\" class='ZPropertySheet' cellspacing='6'><tr><td style='text-align:right;white-space:nowrap;'>";
	buffer[_i++] = ZmMsg.fileAsLabel;
	buffer[_i++] = "</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_FILE_AS' tabindex='400'></div></td></tr><tr><td style='text-align:right;white-space:nowrap;'>";
	buffer[_i++] = ZmMsg.locationLabel;
	buffer[_i++] = "</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_FOLDER' tabindex='401'></div></td></tr>";
	 if (appCtxt.multiAccounts) { 
	buffer[_i++] = "<tr><td style='text-align:right;'>";
	buffer[_i++] = ZmMsg.accountLabel;
	buffer[_i++] = "</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_ACCOUNT' tabindex='402'></div></td></tr>";
	 } 
	buffer[_i++] = "</table></td></tr>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactView_header"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactView_headerName", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_NAME_row' class='contactHeaderCellRow'><table role=\"presentation\">";
	 if (appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS)) { 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_row'><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_PREFIX' class='inlineInput'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_FIRST_row' class='inlineInput'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_FIRST' tabindex='190'></div></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_MIDDLE' class='inlineInput'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_MAIDEN' class='inlineInput'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_LAST_row' class='inlineInput'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_LAST' tabindex='191'></div></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_SUFFIX' class='inlineInput'></td></tr>";
	 } 
	buffer[_i++] = "<tr><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PREFIX_row' class='inlineInput'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PREFIX' tabindex='200'></div></td><td class='inlineInput'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_FIRST' tabindex='201'></div></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_MIDDLE_row' class='inlineInput'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_MIDDLE' tabindex='202'></div></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_MAIDEN_row' class='inlineInput'><table role=\"presentation\"><tr><td class='inlineInputWrapper'>(</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_MAIDEN' tabindex='203'></div></td><td class='inlineInputWrapper'>)</td></tr></table></td><td class='inlineInput'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_LAST' tabindex='204'></div></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_SUFFIX_row' class='inlineInput'><table role=\"presentation\"><tr><td class='inlineInputWrapper'>,</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_SUFFIX' tabindex='205'></div></td></tr></table></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_DETAILS' tabindex='206'></div></td></tr></table></div><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_NICKNAME_row' class='contactHeaderCellRow'><table role=\"presentation\"><tr><td class='inlineInputWrapper'>&ldquo;</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_NICKNAME' tabindex='250'></div></td><td class='inlineInputWrapper'>&rdquo;</td></tr></table></div>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactView_headerName"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactView_headerJobInfo", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_JOB_row' class='contactHeaderCellRow'><table role=\"presentation\"><tr><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_TITLE_row' class='inlineInput'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_TITLE' tabindex='301'></div></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_TITLE_DEPARTMENT_SEP' class='inlineInputWrapper'>&ndash;</td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_DEPARTMENT_row' class='inlineInput'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_DEPARTMENT' tabindex='302'></div></td></tr></table></div><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_COMPANY_row' class='contactHeaderCellRow'><table role=\"presentation\">";
	 if (appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS)) { 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_COMPANY_row'><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONETIC_COMPANY' tabindex='304'></div></td></tr>";
	 } 
	buffer[_i++] = "<tr><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_COMPANY' tabindex='305'></div></td></tr></table></div>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactView_headerJobInfo"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactView_body", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<tr><td class=rowLabel>";
	buffer[_i++] = ZmMsg.emailLabel;
	buffer[_i++] = "</td><td class=rowValue><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_EMAIL' tabindex='500'></div></td></tr><tr><td class=rowLabel>";
	buffer[_i++] = ZmMsg.phoneLabel;
	buffer[_i++] = "</td><td class=rowValue><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_PHONE' tabindex='600'></div></td></tr><tr><td class=rowLabel>";
	buffer[_i++] = ZmMsg.imLabel;
	buffer[_i++] = "</td><td class=rowValue><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_IM' tabindex='700'></div></td></tr><tr><td class=rowLabel>";
	buffer[_i++] = ZmMsg.addressLabel;
	buffer[_i++] = "</td><td class=rowValue><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_ADDRESS' tabindex='800'></div></td></tr><tr><td class=rowLabel>";
	buffer[_i++] = ZmMsg.urlLabel;
	buffer[_i++] = "</td><td class=rowValue><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_URL' tabindex='900'></div></td></tr><tr><td class=rowLabel>";
	buffer[_i++] = ZmMsg.otherLabel;
	buffer[_i++] = "</td><td class=rowValue><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_OTHER' tabindex='1000'></div></td></tr><tr><td class=rowLabel>";
	buffer[_i++] = ZmMsg.notesLabel;
	buffer[_i++] = "</td><td class=rowValue><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_NOTES' tabindex='1100'></div></td></tr>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactView_body"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactViewRows", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\"><tbody id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_rows' tabindex='100'></tbody></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactViewRows"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactViewDetailsButton", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<span class='ScreenReaderOnly'>";
	buffer[_i++] =  ZmMsg.chooseFields ;
	buffer[_i++] = "</span><span aria-hidden='true' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_title' class='ZButtonBorder ZWidgetTitle'></span>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactViewDetailsButton"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactViewInputSelect", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" class='inputTable'><tr><td class='inputElement'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_input' tabindex='100'></div></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_select' tabindex='200'></div></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactViewInputSelect"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactViewInputDoubleSelect", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" class='inputTable'><tr><td class='inputElement'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_input' tabindex='100'></div></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_select' tabindex='200'></div></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_select2' tabindex='300'></div></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactViewInputDoubleSelect"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactViewOther", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" class='inputTable'><tr><td class='inputElement'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_input' tabindex='100'></div></td><td class='inputElement' style='width:47px;'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_picker' tabindex='200'></div></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_select' tabindex='300'></div></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactViewOther"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactViewAddressRow", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" class='inputTable'><tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_row' class='DwtFormRow' valign='top'><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "' tabindex='100'></div></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_add' class='DwtFormRowAdd' tabindex='200'></div></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_remove' class='DwtFormRowRemove' tabindex='300'></div></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactViewAddressRow"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactViewAddressSelect", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" class='inputTable'><tr valign='top'><td class='inputElement'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_input' tabindex='100' style=\"padding:1px 3px;\"></div></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_select' tabindex='200'></div></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactViewAddressSelect"
}, false);

AjxTemplate.register("abook.Contacts#ZmEditContactViewAddress", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" class='addressTable' width='100%'><tr><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_STREET' tabindex='100'></div></td></tr></table><table role=\"presentation\" class='addressTable' width='100%' style='margin-bottom:3px;'><tr><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_CITY' tabindex='200'></div></td><td>,&nbsp;</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_STATE' tabindex='300'></div></td><td>&nbsp;&nbsp;</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_ZIP' tabindex='400'></div></td></tr></table><table role=\"presentation\" class='addressTable' width='100%'><tr><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_COUNTRY' tabindex='500'></div></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmEditContactViewAddress",
	"class": "DwtForm ZmEditContactViewAddress"
}, false);

AjxTemplate.register("abook.Contacts#SplitView", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" width='100%' height='100%' class='ZPropertySheet' cellspacing='6'><col width='230'></col><tr><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_alphabetbar'></td></tr><tr height='100%'><td valign='top'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_splitview' style='position:relative;width:100%;height:100%;'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_listview' style='position:absolute;width:230px;height:100%;left:0;'></div><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_sash' style='position:absolute;width:8px;height:100%;left:230px;'></div><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_contentCell' style='position:absolute;left:238px;'><div class='ZmContactInfoView' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_content'></div></div></div></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_content", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_details' class='contactContentTable'>";
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#SplitView_header", data) ;
	buffer[_i++] =  ZmContactSplitView.showContactEmails(data) ;
	buffer[_i++] =  ZmContactSplitView.showContactPhones(data) ;
	buffer[_i++] =  ZmContactSplitView.showContactIMs(data) ;
	buffer[_i++] =  ZmContactSplitView.showContactAddresses(data) ;
	buffer[_i++] =  ZmContactSplitView.showContactUrls(data) ;
	buffer[_i++] =  ZmContactSplitView.showContactOther(data) ;
	buffer[_i++] =  ZmContactSplitView.showContactNotes(data) ;
	buffer[_i++] =  ZmContactSplitView.showContactDLMembers(data) ;
	buffer[_i++] = "</table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_content"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_group", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	
			var imageUrl = data.imageUrl;
			var defaultImageUrl = data.defaultImageUrl;
			var email = data.email;
			var title = data.title;
			var fullName = data.fullName;
			var phone = data.phone;
			var location = data.location;
			var imgClassName = data.imgClassName || "Person_48";
			var quickAdd = "id='" + data.quickAddId + "'";
			var isEdit = data.isEdit;
			var delId = "id='" + data.delButtonId + "'";
		
	buffer[_i++] = "<table role=\"presentation\" class='contactGroupTable'><tr>";
	 if (imageUrl) { 
	buffer[_i++] = "<td class='contactGroupTableImage' width='48'><img src='";
	buffer[_i++] =  imageUrl ;
	buffer[_i++] = "'\n";
	buffer[_i++] = "\t\t\t";
	 if (AjxEnv.isIE) { 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t\theight='48'\n";
	buffer[_i++] = "\t\t\t";
	 } else { 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t\tstyle='max-width:48px;max-height:48px;'\n";
	buffer[_i++] = "\t\t\t";
	 } 
	 if (defaultImageUrl) { 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t\tonerror='this.onerror=null;this.src=\"";
	buffer[_i++] = data["defaultImageUrl"];
	buffer[_i++] = "\";'\n";
	buffer[_i++] = "\t\t\t";
	 } 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\tborder='0'></td>";
	 } else { 
	buffer[_i++] = "<td class='contactGroupTableImage' width='48'>";
	buffer[_i++] =  AjxImg.getImageHtml(imgClassName) ;
	buffer[_i++] = "</td>";
	 } 
	buffer[_i++] = "<td class='contactGroupTableContent'>";
	 if (fullName) {
	buffer[_i++] = "<div><strong>";
	buffer[_i++] = fullName;
	buffer[_i++] = "</strong></div>";
	 } 
	 if (title) { 
	buffer[_i++] = "<div><span>";
	buffer[_i++] = title;
	buffer[_i++] = "</span></div>";
	}
	 if (email) {
	buffer[_i++] = "<div>";
	buffer[_i++] = email;
	 if (data.isInline) {
	buffer[_i++] = AjxImg.getImageHtml("Plus", "", quickAdd);
	 }
	buffer[_i++] = "</div>";
	}
	 if (phone) {
	buffer[_i++] = "<div>";
	buffer[_i++] = phone;
	buffer[_i++] = "</div>";
	}
	 if (location) {
	buffer[_i++] = "<div>";
	buffer[_i++] = location;
	buffer[_i++] = "</div>";
	}
	buffer[_i++] = "</td>";
	 if (isEdit) {
	buffer[_i++] = "<td width='36' valign='top'>";
	buffer[_i++] = AjxImg.getImageHtml("Delete", "", delId);
	buffer[_i++] = "</td>";
	}
	buffer[_i++] = "</tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_group"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_header", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	
			var contact = data.contact;
			var imageUrl = contact.getImageUrl();
			var imageLabel = contact.isDistributionList() ? ZmMsg.distributionList : contact.isGroup() ? ZmMsg.group : ZmMsg.contact;
			var defaultImageUrl = data.defaultImageUrl;
			var accountName = appCtxt.multiAccounts && contact.account && contact.account.getDisplayName();
			var tagsId = data.id + '_tags_contact'; 
			var imgClassName = contact.isDistributionList() ? 'Group_48' : contact.isGroup() ? 'GroupPerson_48' : 'Person_48';
			var isEdit = data.isEdit;
		
	buffer[_i++] = "<tr class='headerRow' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_headerRow'>";
	 if (imageUrl) { 
	buffer[_i++] = "<td class='rowLabel'><div class='headerRowImage'><img src='";
	buffer[_i++] =  imageUrl ;
	buffer[_i++] = "'\n";
	buffer[_i++] = "\t\t\t\t";
	 if (AjxEnv.isIE) { 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t\t\theight='48'\n";
	buffer[_i++] = "\t\t\t\t";
	 } else { 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t\t\tstyle='max-width:48px;max-height:48px;'\n";
	buffer[_i++] = "\t\t\t\t";
	 } 
	 if (defaultImageUrl) { 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t\t\tonerror='this.onerror=null;this.src=\"";
	buffer[_i++] = data["defaultImageUrl"];
	buffer[_i++] = "\";'\n";
	buffer[_i++] = "\t\t\t\t";
	 } 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t\t\tborder=0 alt='";
	buffer[_i++] =  imageLabel ;
	buffer[_i++] = "'></div></td>";
	 } else { 
	buffer[_i++] = "<td class='rowLabel'><div class='headerRowImage'>";
	buffer[_i++] =  AjxImg.getImageHtml({
							imageName: imgClassName, altText: imageLabel
						}) ;
	buffer[_i++] = "</div></td>";
	 } 
	buffer[_i++] = "<td class='rowValue'>";
	buffer[_i++] =  AjxTemplate.expand("#SplitView_headerName", data) ;
	buffer[_i++] =  AjxTemplate.expand("#SplitView_headerJobInfo", data) ;
	 if (data.dlInfo && data.dlInfo.description) { 
	buffer[_i++] = "<div>";
	buffer[_i++] =  AjxStringUtil.htmlEncode(data.dlInfo.description) ;
	buffer[_i++] = "</div>";
	 } 
	 if (!isEdit) {
	buffer[_i++] = "<div class='contactHeaderTags' id='";
	buffer[_i++] =  tagsId ;
	buffer[_i++] = "'></div>";
	 } 
	buffer[_i++] = "</td><td class='rowType' valign='top'>";
	 if (accountName) { 
	buffer[_i++] = "<table role=\"presentation\" class='ZPropertySheet' cellspacing='6'><tr><td class='contactLocation'>";
	buffer[_i++] =  ZmMsg.accountLabel ;
	buffer[_i++] = "</td><td class='companyFolder'>";
	buffer[_i++] =  AjxStringUtil.htmlEncode(accountName) ;
	buffer[_i++] = "</td></tr></table>";
	 } 
	 if (!isEdit) { 
	 if (data.addrbook) { 
	buffer[_i++] =  AjxImg.getImageHtml({
								imageName: data.addrbook.getIconWithColor(),
								altText: ZmMsg.locationLabel
							}) ;
	buffer[_i++] = "&nbsp;";
	buffer[_i++] =  data.addrbook.getName() ;
	 } else { 
	buffer[_i++] =  AjxImg.getImageHtml('GAL') ;
	buffer[_i++] = "&nbsp;";
	buffer[_i++] =  ZmMsg.GAL ;
	 } 
	 } else { 
	buffer[_i++] = "<table role=\"presentation\" class='ZPropertySheet' cellspacing='6'><tr><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_locationLabel' class='contactLocation'>";
	buffer[_i++] =  ZmMsg.locationLabel ;
	buffer[_i++] = "</td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_LOCATION_FOLDER'></td></tr></table>";
	 } 
	buffer[_i++] = "</td></tr>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_header"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_headerName", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	
			var contact = data.contact;
			var isPhonetic = appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS);
			var fullnameHtml = contact.getFullNameForDisplay(isPhonetic);
			if (!isPhonetic) {
				fullnameHtml = AjxStringUtil.htmlEncode(fullnameHtml);
			}
			var nickname = contact.getAttr(ZmContact.F_nickname);
			var isEdit = data.isEdit;
			if (isEdit && data.contact.isDistributionList()) {
				fullnameHtml = '';
			}
		
	buffer[_i++] = "<div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_contactName' class='contactHeader ";
	buffer[_i++] =  data.isInTrash ? "Trash" : "" ;
	buffer[_i++] = "'>";
	buffer[_i++] =  fullnameHtml ;
	buffer[_i++] = "</div>";
	 if (nickname && !isEdit) { 
	buffer[_i++] = "<div class='contactHeader'>&ldquo;";
	buffer[_i++] =  AjxStringUtil.htmlEncode(nickname) ;
	buffer[_i++] = "&rdquo;</div>";
	 } 
	 else if (isEdit) {
	buffer[_i++] = "<div class='contactHeader2'>";
		if (data.contact.isDistributionList()) {
				
	buffer[_i++] = "<table role=\"presentation\"><tr><td class='contactHeader2'>";
	
						if (data.usernameEditable) { 
	buffer[_i++] = "<div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_groupNameParent'></div>";
			} else { 
	buffer[_i++] =  AjxStringUtil.htmlEncode(data.username);
			}
				
	buffer[_i++] = "</td><td class='contactHeader2'>&nbsp;@\n";
	buffer[_i++] = "\t\t\t";
	
						if (data.domainEditable) { 
	buffer[_i++] = "<input type='text' autocomplete='off' size='20' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_groupNameDomain' class='Text'>";
			} else { 
	buffer[_i++] =  AjxStringUtil.htmlEncode(data.domain);
			} 
	buffer[_i++] = "</td></tr></table>";
	 } else { 
	buffer[_i++] = "<div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_groupNameParent'></div>";
	 } 
	buffer[_i++] = "</div><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_tags' style='padding-top:5px;'></div>";
	 } 

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_headerName"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_headerJobInfo", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	
			var contact = data.contact;
			var isPhonetic = appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS);
			var company = contact.getAttr(ZmContact.F_company);
			var title = contact.getAttr(ZmContact.F_jobTitle);
			var department = contact.getAttr(ZmContact.F_department);
		
	 if (title || department) { 
	buffer[_i++] = "<div class='contactHeader2'>";
	 if (title) { 
	buffer[_i++] = "<span>";
	buffer[_i++] =  AjxStringUtil.htmlEncode(title) ;
	buffer[_i++] = "</span>";
	 } 
	 if (department) { 
	 if (title) { 
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t\t&nbsp;&ndash;&nbsp;\n";
	buffer[_i++] = "\t\t\t";
	 } 
	buffer[_i++] = "<span>";
	buffer[_i++] =  AjxStringUtil.htmlEncode(department) ;
	buffer[_i++] = "</span>";
	 } 
	buffer[_i++] = "</div>";
	 } 
	 if (company) {
			var phoneticCompany = isPhonetic && contact.getAttr(ZmContact.F_phoneticCompany);
			var companyHtml = AjxStringUtil.htmlRubyEncode(company, phoneticCompany);
			
	buffer[_i++] = "<div class='contactHeader2'>";
	buffer[_i++] =  companyHtml;
	buffer[_i++] = "</div>";
	 } 

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_headerJobInfo"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_dlmember-collapsed", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<td ";
	buffer[_i++] =  data.expandTdText ;
	buffer[_i++] = ">";
	buffer[_i++] =  data.html.join("") ;
	buffer[_i++] = "</td><td class=rowLabel>";
	buffer[_i++] =  data.contact.canExpand ? ZmMsg.membersLabel : "" ;
	buffer[_i++] = "</td><td colspan='2' class='rowValue'>";
	buffer[_i++] =  data.value ;
	buffer[_i++] = "</td>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_dlmember-collapsed"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_dlmember-expanded", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<td ";
	buffer[_i++] =  data.first ? data.expandTdText : ""  ;
	buffer[_i++] = ">";
	buffer[_i++] =  data.html.join("") ;
	buffer[_i++] = "</td><td class='rowLabel'>";
	buffer[_i++] =  data.first ? ZmMsg.membersLabel : "" ;
	buffer[_i++] = "</td><td colspan='2' class='rowValue'>";
	buffer[_i++] =  data.value ;
	buffer[_i++] = "</td>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_dlmember-expanded"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_address_value", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<tr valign='top'><td class='rowLabel'><!-- only show the first label visually --><label for='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "' class='";
	buffer[_i++] =  data.first ? "" : "ScreenReaderOnly" ;
	buffer[_i++] = "'>\n";
	buffer[_i++] = "\t\t\t\t";
	buffer[_i++] = data["label"];
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t</label></td><td id='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "' class='rowValue'>";
	 var address = data.address;
				if (address.Street) { 
	buffer[_i++] = "<div>";
	buffer[_i++] = address.Street;
	buffer[_i++] = "</div>";
	 }
				if (address.City || address.State || address.PostalCode) { 
	buffer[_i++] = "<div><span>";
	buffer[_i++] = address.City;
	buffer[_i++] = "</span>";
	 if (address.City && address.State) { 
	buffer[_i++] = ", ";
	 } 
	buffer[_i++] = "<span>";
	buffer[_i++] = address.State;
	buffer[_i++] = "</span>";
	 if (address.City || address.State) { 
	buffer[_i++] = "&nbsp;";
	 } 
	buffer[_i++] = "<span>";
	buffer[_i++] = address.PostalCode;
	buffer[_i++] = "</span></div>";
	 }
				if (address.Country) { 
	buffer[_i++] = "<div>";
	buffer[_i++] = address.Country;
	buffer[_i++] = "</div>";
	 } 
	buffer[_i++] = "</td><td class='rowType'><label for='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "'>\n";
	buffer[_i++] = "\t\t\t\t&nbsp;";
	buffer[_i++] =  data.type ;
	buffer[_i++] = "</label></td></tr>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_address_value"
}, false);

AjxTemplate.register("abook.Contacts#SplitView_list_item", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<tr valign='top'>";
	 if (data.isDL) { 
	buffer[_i++] = "<td><div class='ImgBlank_16'></div></td>";
	 } 
	buffer[_i++] = "<td class='rowLabel' id='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "_label'><!-- only show the first label visually --><label for='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "_label' class='";
	buffer[_i++] =  data.first ? "" : "ScreenReaderOnly" ;
	buffer[_i++] = "'>\n";
	buffer[_i++] = "\t\t\t";
	buffer[_i++] = data["label"];
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t</label></td><td id='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "_value' ";
	buffer[_i++] =  data.type ? "" : "colspan='2'" ;
	buffer[_i++] = " class='rowValue' aria-labelledby='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "_label ";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "_type'>";
	buffer[_i++] =  data.value ;
	buffer[_i++] = "</td>";
	 if (data.type) { 
	buffer[_i++] = "<td id='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "_type' class='rowType'><label for='";
	buffer[_i++] = data["labelId"];
	buffer[_i++] = "_label'>\n";
	buffer[_i++] = "\t\t\t\t&nbsp;";
	buffer[_i++] = data["type"];
	buffer[_i++] = "\n";
	buffer[_i++] = "\t\t\t</label></td>";
	 } 
	buffer[_i++] = "</tr>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitView_list_item"
}, false);

AjxTemplate.register("abook.Contacts#SplitViewGroup", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table class='contactContentTable'>";
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#SplitView_header", data) ;
	buffer[_i++] = "</table>";
	 if (data.dlInfo) { 
	buffer[_i++] = "<table role=\"presentation\" class='contactHeaderSubTable NoneBg ZPropertySheet' width='100%' cellspacing='6'><tr><td><ul id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_subscriptionMsg' style='margin:.5em 0;padding-left:53px;'></ul></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_subscriptionButton'></td></tr></table>";
	 } 
	buffer[_i++] = "<div class='contactGroupList' style='overflow:auto;'>";
	buffer[_i++] =  ZmContactSplitView.showContactGroup(data) ;
	buffer[_i++] = "</div>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SplitViewGroup"
}, false);

AjxTemplate.register("abook.Contacts#SimpleView-NoResults", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" width='100%'><tr><td class='NoResults'>";
	buffer[_i++] =  AjxMsg.noResults ;
	buffer[_i++] = "</td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#SimpleView-NoResults"
}, false);

AjxTemplate.register("abook.Contacts#GroupView", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table class='ZPropertySheet'>";
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#SplitView_header", data) ;
	buffer[_i++] = "</table>";
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#GroupViewMembers", data) ;

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#GroupView"
}, false);

AjxTemplate.register("abook.Contacts#DlView", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table class='ZPropertySheet'>";
	buffer[_i++] =  AjxTemplate.expand('abook.Contacts#SplitView_header', data) ;
	buffer[_i++] = "</table><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_tabViewContainer'></div>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#DlView"
}, false);

AjxTemplate.register("abook.Contacts#DlPropertiesView", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	 if (data.contact.isDistributionList()) { 
	buffer[_i++] = "<table role=\"presentation\" width='100%' class='ZmEditContactView'><tr><td class='rowLabel'>";
	buffer[_i++] =  ZmMsg.displayNameLabel ;
	buffer[_i++] = "</td><td class='rowValue'><div class='DwtInputField'><input type='text' autocomplete='off' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlDisplayName' class='Text' style='width:45em;'></div></td></tr><tr><td class='rowLabel'>";
	buffer[_i++] =  ZmMsg.descriptionLabel ;
	buffer[_i++] = "</td><td class='rowValue'><div class='DwtInputField'><textarea rows='4' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlDesc' style='width:45em;'></textarea></div></td></tr><tr><td class='rowLabel'>";
	buffer[_i++] =  ZmMsg.directoryLabel ;
	buffer[_i++] = "</td><td class='rowValue rowCheckGroup'><input type='checkbox' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlHideInGal'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlHideInGal'>";
	buffer[_i++] =  ZmMsg.hiddenInGlobal ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'>";
	buffer[_i++] =  ZmMsg.mailLabel ;
	buffer[_i++] = "</td><td class='rowValue rowRadioGroup'><input type='radio' name='mailPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlMailPolicyANYONE'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlMailPolicyANYONE'>";
	buffer[_i++] =  ZmMsg.mailAnyone ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'></td><td class='rowValue'><input type='radio' name='mailPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlMailPolicyMEMBERS'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlMailPolicyMEMBERS'>";
	buffer[_i++] =  ZmMsg.mailOnlyMembers ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'></td><td class='rowValue'><input type='radio' name='mailPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlMailPolicyINTERNAL'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlMailPolicyINTERNAL'>";
	buffer[_i++] =  ZmMsg.mailOnlyInternal ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'></td><td class='rowValue'><input type='radio' name='mailPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlMailPolicySPECIFIC'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlMailPolicySPECIFIC'>";
	buffer[_i++] =  ZmMsg.mailOnlySpecific ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'></td><td class='rowValue'><div class='DwtInputField'><input type='text' autocomplete='off' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlListSpecificMailers' class='Text' style='margin-left:2em;width:43em;'></div></td></tr><tr><td class='rowLabel'>";
	buffer[_i++] =  ZmMsg.newSubscriptionsLabel ;
	buffer[_i++] = "</td><td class='rowValue rowRadioGroup'><input type='radio' name='subscriptionPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlSubscriptionPolicyACCEPT'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlSubscriptionPolicyACCEPT'>";
	buffer[_i++] =  ZmMsg.policyAccept ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'></td><td class='rowValue'><input type='radio' name='subscriptionPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlSubscriptionPolicyAPPROVAL'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlSubscriptionPolicyAPPROVAL'>";
	buffer[_i++] =  ZmMsg.policyApproval ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'></td><td class='rowValue'><input type='radio' name='subscriptionPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlSubscriptionPolicyREJECT'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlSubscriptionPolicyREJECT'>";
	buffer[_i++] =  ZmMsg.policyReject ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'>";
	buffer[_i++] =  ZmMsg.unsubscriptionsRequestLabel ;
	buffer[_i++] = "</td><td class='rowValue rowRadioGroup' ><input type='radio' name='unsubscriptionPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlUnsubscriptionPolicyACCEPT'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlUnsubscriptionPolicyACCEPT'>";
	buffer[_i++] =  ZmMsg.policyAccept ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'></td><td class='rowValue'><input type='radio' name='unsubscriptionPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlUnsubscriptionPolicyAPPROVAL'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlUnsubscriptionPolicyAPPROVAL'>";
	buffer[_i++] =  ZmMsg.policyApproval ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'></td><td class='rowValue'><input type='radio' name='unsubscriptionPolicy' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlUnsubscriptionPolicyREJECT'><label for='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlUnsubscriptionPolicyREJECT'>";
	buffer[_i++] =  ZmMsg.policyReject ;
	buffer[_i++] = "</label></td></tr><tr><td class='rowLabel'>";
	buffer[_i++] =  ZmMsg.listOwnersLabel ;
	buffer[_i++] = "</td><td class='rowValue'><div class='DwtInputField'><input type='text' autocomplete='off' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlListOwners' class='Text' style='width:45em;'></div></td></tr><tr><td class='rowLabel'>";
	buffer[_i++] =  ZmMsg.notesLabel ;
	buffer[_i++] = "</td><td class='rowValue'><div class='DwtInputField'><textarea rows='4' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_dlNotes' style='width:45em;'></textarea></div></td></tr></table>";
	 } 

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#DlPropertiesView"
}, false);

AjxTemplate.register("abook.Contacts#GroupViewMembers", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" width='100%' height='100%' class='ZPropertySheet' cellspacing='6'><tr><!-- content: left pane --><td width='50%' valign='top'><div class='groupMembers' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_groupMembers'></div></td><!-- content: right pane --><td width='50%' valign='top'><table role=\"presentation\" width='100%'><tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchFieldsRow'><td width='50'>&nbsp;</td><td><table role=\"presentation\" class='ZPropertySheet' cellspacing='6'>";
	 if (data.detailed) { 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchNameRow'><td align='right'>";
	buffer[_i++] =  ZmMsg.nameLabel ;
	buffer[_i++] = "</td><td><input type='text' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchNameField'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchButton' valign='top' rowspan='3'></td></tr>";
	 if (appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS)) { 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchPhoneticRow'><td align='right'>";
	buffer[_i++] =  ZmMsg.phoneticNameLabel ;
	buffer[_i++] = "</td><td><input type='text' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchPhoneticField'></td></tr>";
	 } 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchEmailRow'><td align='right'>";
	buffer[_i++] =  ZmMsg.emailAddrLabel ;
	buffer[_i++] = "</td><td><input type='text' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchEmailField'></td></tr><tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchDepartmentRow'><td align='right'>";
	buffer[_i++] =  ZmMsg.departmentLabel ;
	buffer[_i++] = "</td><td><input type='text' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchDepartmentField'></td></tr>";
	 } else { 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchRow'><td align='right'>";
	buffer[_i++] =  ZmMsg.findLabel ;
	buffer[_i++] = "</td><td><input type='text' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchField'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchButton'></td></tr>";
	 } 
	 if (data.showSearchIn) { 
	buffer[_i++] = "<tr><td align='right'>";
	buffer[_i++] =  ZmMsg.searchIn ;
	buffer[_i++] = "</td><td colspan='2' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_listSelect'></td></tr>";
	 } 
	buffer[_i++] = "</table></td></tr><tr><td width='50'><table role=\"presentation\" width='100%' class='ZPropertySheet' cellspacing='6'><tr><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_addButton'></td></tr><tr><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_addAllButton'></td></tr></table></td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_listView'></div><table role=\"presentation\" width='100%' class='ZPropertySheet' cellspacing='6'><tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_navButtonsRow'><td width='100%'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_prevButton'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_nextButton'></td></tr></table></td></tr><tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_manualAddRow'><td width='50'><table role=\"presentation\" width='100%' class='ZPropertySheet' cellspacing='6'><tr><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_addNewButton'></td></tr></table></td><td><table role=\"presentation\" width='100%' class='ZPropertySheet' cellspacing='6'><tr><td>";
	buffer[_i++] = ZmMsg.enterAddrBelow;
	buffer[_i++] = "</td></tr><tr><td><textarea class='groupMembers' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_addNewField'></textarea></td></tr></table></td></tr></table></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#GroupViewMembers"
}, false);

AjxTemplate.register("abook.Contacts#ZmAlphabetBar", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<center><table role=\"presentation\" id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_alphabet' width='80%' class='AlphabetBarTable'' cellspacing='0'><tr>";
	 for (var i = 0; i < data.numLetters; i++) { 
	buffer[_i++] = "<td _idx=\"";
	buffer[_i++] =  i ;
	buffer[_i++] = "\"\trole='button'\n";
	buffer[_i++] = "\t\t\t\t\t\tclass='DwtButton AlphabetBarCell'";
	 if (data.alphabet[i].length > 1) { 
	buffer[_i++] = " colspan='";
	buffer[_i++] =  data.alphabet[i].length/2 + 1 ;
	buffer[_i++] = "' ";
	 } 
	buffer[_i++] = " >";
	buffer[_i++] =  data.alphabet[i] ;
	buffer[_i++] = "</td>";
	 } 
	buffer[_i++] = "</tr></table></center>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmAlphabetBar"
}, false);

AjxTemplate.register("abook.Contacts#Tooltip", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" width='250'><tr><td colspan='2' valign='top'><div style='border-bottom:1px solid black;margin-bottom:2px;'><table role=\"presentation\" width='100%'><tr valign='bottom'><td style='font-weight:bold;'>";
	buffer[_i++] =  AjxStringUtil.htmlEncode(data.entryTitle); ;
	buffer[_i++] = "</td><td align='right'>";
	buffer[_i++] =  AjxImg.getImageHtml(data.contact.getIcon()); ;
	buffer[_i++] = "</td></tr></table></div></td></tr>";
	 if (data.contact.isGroup()) {
				var members = data.contact.getGroupMembers().good.getArray();
				for (var i = 0; i < members.length; i++) {
			
	buffer[_i++] = "<tr><td width=20>";
	buffer[_i++] =  AjxImg.getImageHtml("Message") ;
	buffer[_i++] = "</td><td>";
	buffer[_i++] =  AjxStringUtil.htmlEncode(members[i].toString()) ;
	buffer[_i++] = "</td></tr>";
		} 
			} else {
			
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#AddTooltipEntry", {data:data, field:"fullName"}) ;
	 var fields = ZmMsg.contactTooltipWorkInfoOrder.split(",");
				   var i;
				   for (i = 0; i < fields.length; i++) {
				
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#AddTooltipEntry", {data:data, field:fields[i]}) ;
	
				   }
				
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#AddTooltipEntry", {data:data, field:"mobilePhone"}) ;
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#AddTooltipEntry", {data:data, field:"workPhone"}) ;
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#AddTooltipEntry", {data:data, field:"homePhone"}) ;
	 if (data.contact.isGal) {
					var emails = data.contact.getEmails();
					for (var i = 0; i < emails.length && emails.length <= 3; i++) {
				
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#AddTooltipEntry", {data:data, field:"email", val:emails[i]}) ;
		} 
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#AddTooltipEntry", {data:data, field:"notes", truncate:500}) ;
		} else { 
	buffer[_i++] =  AjxTemplate.expand("abook.Contacts#AddTooltipEntry", {data:data, field:"email", val:data.contact._lookupEmail || data.email}) ;
		} 
		} 
	 if (data.hint) { 
	buffer[_i++] = "<tr><td colspan='2'><div class='TooltipHint'><hr color=black size=1>";
	buffer[_i++] =  data.hint ;
	buffer[_i++] = "</div></td></tr>";
	 } 
	buffer[_i++] = "</table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#Tooltip"
}, false);

AjxTemplate.register("abook.Contacts#TooltipNotInAddrBook", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	 if (data.hint) { 
	buffer[_i++] = "<table role=\"presentation\" width='250'><tr><td valign='top'>";
	 if (appCtxt.get(ZmSetting.CONTACTS_ENABLED)) { 
	buffer[_i++] = "<div style='border-bottom:1px solid black;'><table role=\"presentation\" width='100%'><tr valign='bottom'><td style='font-weight:bold;'>";
	buffer[_i++] =  ZmMsg.newContact ;
	buffer[_i++] = "</td><td align='right'>";
	buffer[_i++] =  AjxImg.getImageHtml("NewContact"); ;
	buffer[_i++] = "</td></tr></table></div>";
	 } 
	buffer[_i++] = "<div class='TooltipNotInAddrBook'>";
	buffer[_i++] =  AjxStringUtil.htmlEncode(data.addrstr) ;
	buffer[_i++] = "</div><hr color='black' size='1'><div class='TooltipHint'>";
	buffer[_i++] =  data.hint ;
	buffer[_i++] = "</div></td></tr></table>";
	 } else { 
	buffer[_i++] = "<span style='font-weight:bold;'> ";
	buffer[_i++] =  ZmMsg.emailLabel ;
	buffer[_i++] = " </span>";
	buffer[_i++] =  AjxStringUtil.htmlEncode(data.addrstr) ;
	 } 

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#TooltipNotInAddrBook"
}, false);

AjxTemplate.register("abook.Contacts#AddTooltipEntry", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	 if (data.val == null) {
			var isPhonetic = appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS);
			data.val = data.field == "fullName" ? data.data.contact.getFullNameForDisplay(isPhonetic) : data.data.contact.getAttr(data.field);
		} 
	 if (data.val != null && data.val != "") { 
	buffer[_i++] = "<tr valign='top'><td class='ZmTooltipLabel'>";
	buffer[_i++] =  AjxMessageFormat.format(ZmMsg.makeLabel,
											 AjxStringUtil.htmlEncode(ZmContact._AB_FIELD[data.field])) ;
	buffer[_i++] = "</td>";
	 if (data.truncate) { 
	buffer[_i++] = "<td>";
	buffer[_i++] =  AjxMessageFormat.format(ZmMsg.makeLabel,
											AjxStringUtil.htmlEncode(data.val.substring(0,data.truncate))) ;
	buffer[_i++] = "</td>";
	 } else {
				var field = "";
				if (data.field == "fullName" ) {
					field = isPhonetic ? data.val : AjxStringUtil.htmlEncode(data.val); 
				}
				else {
					field = AjxStringUtil.htmlEncode(data.val);
				}
			
	buffer[_i++] = "<td style='white-space:nowrap;'>";
	buffer[_i++] =  field ;
	buffer[_i++] = "</td>";
	 } 
	buffer[_i++] = "</tr>";
	 } 

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#AddTooltipEntry"
}, false);

AjxTemplate.register("abook.Contacts#ZmContactPicker", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<div class='ZmContactPicker'><table role=\"presentation\" width='100%'><tr><td width='600'><table role=\"presentation\" class='ZPropertySheet' cellspacing='6' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchTable'>";
	 if (data.detailed) { 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchNameRow'><td align='right'><span id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchNameFieldLbl'>";
	buffer[_i++] =  ZmMsg.nameLabel ;
	buffer[_i++] = "</span></td><td><input type='text' placeholder=\"";
	buffer[_i++] =  ZmMsg.contactPickerHint ;
	buffer[_i++] = "\" autocomplete='off' size='30' nowrap id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchNameField' aria-labelledby='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchNameFieldLbl'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchButton' rowspan='3' valign='top'></td><td width='20' valign='middle'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchIcon' class='ImgSearch'></div></td></tr>";
	 if (appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS)) { 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchPhoneticRow'><td align='right'><span id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchPhoneticNameFieldLbl'>";
	buffer[_i++] =  ZmMsg.phoneticNameLabel ;
	buffer[_i++] = "</span></td><td><input type='text' placeholder=\"";
	buffer[_i++] =  ZmMsg.contactPickerPhoneticHint ;
	buffer[_i++] = "\" autocomplete='off' size='30' nowrap id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchPhoneticField' aria-labelledby='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchPhoneticNameFieldLbl'></td></tr>";
	 } 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchEmailRow'><td align='right'><span id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchEmailFieldLbl'>";
	buffer[_i++] =  ZmMsg.emailAddrLabel ;
	buffer[_i++] = "</span></td><td><input type='text' placeholder=\"";
	buffer[_i++] =  ZmMsg.contactPickerEmailHint ;
	buffer[_i++] = "\"autocomplete='off' size='30' nowrap id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchEmailField' aria-labelledby='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchEmailFieldLbl'></td></tr><tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchDepartmentRow'><td align='right'><span id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchDepartmentFieldLbl'>";
	buffer[_i++] =  ZmMsg.departmentLabel ;
	buffer[_i++] = "</span></td><td><input type='text' placeholder=\"";
	buffer[_i++] =  ZmMsg.contactPickerDepartmentHint ;
	buffer[_i++] = "\" autocomplete='off' size='30' nowrap id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchDepartmentField' aria-labelledby='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchDepartmentFieldLbl'></td></tr>";
	 } else { 
	buffer[_i++] = "<tr id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchRow'><td><input type='text' placeholder=\"";
	buffer[_i++] =  ZmMsg.contactPickerHint ;
	buffer[_i++] = "\" autocomplete='off' nowrap id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchField' style='width:25em;' aria-label='";
	buffer[_i++] = ZmMsg.search;
	buffer[_i++] = "'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchButton'></td><td width='20' valign='middle'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchIcon' class='ImgSearch'></div></td></tr>";
	 } 
	buffer[_i++] = "</table></td><td align='right' valign='bottom'>";
	 if (data.showSelect) { 
	buffer[_i++] = "<table role=\"presentation\" class='ZPropertySheet' cellspacing='6'><tr><td class='Label nobreak' id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_listSelectLbl'>";
	buffer[_i++] =  ZmMsg.showNames ;
	buffer[_i++] = "</td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_listSelect'></td></tr></table>";
	 } 
	buffer[_i++] = "</td></tr></table><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_chooser'></div><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_paging' style='margin-left:5px;'><table role=\"presentation\" width='100%'><tr><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_pageLeft'></td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_pageRight' align='right'></td></tr></table></div></div>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmContactPicker"
}, false);

AjxTemplate.register("abook.Contacts#ZmContactSearch", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_preamble'></div><table role=\"presentation\" width='100%'><tr><td><table role=\"presentation\"><tr><td width='20' valign='middle'><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchIcon' class='ImgSearch'></div></td><td><input type='text' autocomplete='off' size='30' nowrap id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchField'>&nbsp;</td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_searchButton'></td></tr></table></td><td align='right'>";
	 if (data.showSelect) { 
	buffer[_i++] = "<table role=\"presentation\"><tr><td class='Label nobreak'>";
	buffer[_i++] =  ZmMsg.showNames ;
	buffer[_i++] = "&nbsp;</td><td id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_folders'></td></tr></table>";
	 } 
	buffer[_i++] = "</td></tr></table><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_results' class='contactSearchResultsDiv'></div>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#ZmContactSearch"
}, false);

AjxTemplate.register("abook.Contacts#QuickAddPrompt", 
function(name, params, data, buffer) {
	var _hasBuffer = Boolean(buffer);
	data = (typeof data == "string" ? { id: data } : data) || {};
	buffer = buffer || [];
	var _i = buffer.length;

	buffer[_i++] = "<table role=\"presentation\" class='ZPropertySheet' cellspacing='6'><tr><td class='ZmFieldLabelRight'>";
	buffer[_i++] = ZmMsg.firstNameLabel;
	buffer[_i++] = "</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_FIRST_NAME'></div></td></tr><tr><td class='ZmFieldLabelRight'>";
	buffer[_i++] = ZmMsg.lastNameLabel;
	buffer[_i++] = " </td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_LAST_NAME'></div></td></tr><tr><td class='ZmFieldLabelRight'>";
	buffer[_i++] = ZmMsg.emailLabel;
	buffer[_i++] = "</td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_EMAIL'></div></td></tr><tr><td class='ZmFieldLabelRight'>";
	buffer[_i++] = ZmMsg.addressBookLabel;
	buffer[_i++] = " </td><td><div id='";
	buffer[_i++] = data["id"];
	buffer[_i++] = "_ADDR_BOOK'></div></td></tr></table>";

	return _hasBuffer ? buffer.length : buffer.join("");
},
{
	"id": "abook.Contacts#QuickAddPrompt"
}, false);

}
        20190620092152                                !          i f   ( A j x P a c k a g e . d e f i n e ( " C o n t a c t s C o r e " ) )   { 
 / * 
   *   * * * * *   B E G I N   L I C E N S E   B L O C K   * * * * * 
   *   Z i m b r a   C o l l a b o r a t i o n   S u i t e   W e b   C l i e n t 
   *   C o p y r i g h t   ( C )   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 6   S y n a c o r ,   I n c . 
   * 
   *   T h e   c o n t e n t s   o f   t h i s   f i l e   a r e   s u b j e c t   t o   t h e   C o m m o n   P u b l i c   A t t r i b u t i o n   L i c e n s e   V e r s i o n   1 . 0   ( t h e   " L i c e n s e " ) ; 
   *   y o u   m a y   n o t   u s e   t h i s   f i l e   e x c e p t   i n   c o m p l i a n c e   w i t h   t h e   L i c e n s e . 
   *   Y o u   m a y   o b t a i n   a   c o p y   o f   t h e   L i c e n s e   a t :   h t t p s : / / w w w . z i m b r a . c o m / l i c e n s e 
   *   T h e   L i c e n s e   i s   b a s e d   o n   t h e   M o z i l l a   P u b l i c   L i c e n s e   V e r s i o n   1 . 1   b u t   S e c t i o n s   1 4   a n d   1 5 
   *   h a v e   b e e n   a d d e d   t o   c o v e r   u s e   o f   s o f t w a r e   o v e r   a   c o m p u t e r   n e t w o r k   a n d   p r o v i d e   f o r   l i m i t e d   a t t r i b u t i o n 
   *   f o r   t h e   O r i g i n a l   D e v e l o p e r .   I n   a d d i t i o n ,   E x h i b i t   A   h a s   b e e n   m o d i f i e d   t o   b e   c o n s i s t e n t   w i t h   E x h i b i t   B . 
   * 
   *   S o f t w a r e   d i s t r i b u t e d   u n d e r   t h e   L i c e n s e   i s   d i s t r i b u t e d   o n   a n   " A S   I S "   b a s i s , 
   *   W I T H O U T   W A R R A N T Y   O F   A N Y   K I N D ,   e i t h e r   e x p r e s s   o r   i m p l i e d . 
   *   S e e   t h e   L i c e n s e   f o r   t h e   s p e c i f i c   l a n g u a g e   g o v e r n i n g   r i g h t s   a n d   l i m i t a t i o n s   u n d e r   t h e   L i c e n s e . 
   *   T h e   O r i g i n a l   C o d e   i s   Z i m b r a   O p e n   S o u r c e   W e b   C l i e n t . 
   *   T h e   I n i t i a l   D e v e l o p e r   o f   t h e   O r i g i n a l   C o d e   i s   Z i m b r a ,   I n c .     A l l   r i g h t s   t o   t h e   O r i g i n a l   C o d e   w e r e 
   *   t r a n s f e r r e d   b y   Z i m b r a ,   I n c .   t o   S y n a c o r ,   I n c .   o n   S e p t e m b e r   1 4 ,   2 0 1 5 . 
   * 
   *   A l l   p o r t i o n s   o f   t h e   c o d e   a r e   C o p y r i g h t   ( C )   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 6   S y n a c o r ,   I n c .   A l l   R i g h t s   R e s e r v e d . 
   *   * * * * *   E N D   L I C E N S E   B L O C K   * * * * * 
   * / 
 / * 
   *   P a c k a g e :   C o n t a c t s C o r e 
   *   
   *   S u p p o r t s :   L o a d i n g   o f   c o n t a c t s   a n d   a d d r e s s   b o o k s 
   *   
   *   L o a d e d : 
   *   	 -   W h e n   u s e r   c o n t a c t s   a r e   l o a d e d   d u r i n g   s t a r t u p 
   *   	 -   I f   t h e   < r e f r e s h >   b l o c k   h a s   a d d r e s s   b o o k s 
   *   	 -   I f   a   s e a r c h   f o r   c o n t a c t s   r e t u r n s   r e s u l t s 
   * / 
 
 i f   ( A j x P a c k a g e . d e f i n e ( " z i m b r a M a i l . a b o o k . m o d e l . Z m A d d r B o o k " ) )   { 
 / * 
   *   * * * * *   B E G I N   L I C E N S E   B L O C K   * * * * * 
   *   Z i m b r a   C o l l a b o r a t i o n   S u i t e   W e b   C l i e n t 
   *   C o p y r i g h t   ( C )   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 6   S y n a c o r ,   I n c . 
   * 
   *   T h e   c o n t e n t s   o f   t h i s   f i l e   a r e   s u b j e c t   t o   t h e   C o m m o n   P u b l i c   A t t r i b u t i o n   L i c e n s e   V e r s i o n   1 . 0   ( t h e   " L i c e n s e " ) ; 
   *   y o u   m a y   n o t   u s e   t h i s   f i l e   e x c e p t   i n   c o m p l i a n c e   w i t h   t h e   L i c e n s e . 
   *   Y o u   m a y   o b t a i n   a   c o p y   o f   t h e   L i c e n s e   a t :   h t t p s : / / w w w . z i m b r a . c o m / l i c e n s e 
   *   T h e   L i c e n s e   i s   b a s e d   o n   t h e   M o z i l l a   P u b l i c   L i c e n s e   V e r s i o n   1 . 1   b u t   S e c t i o n s   1 4   a n d   1 5 
   *   h a v e   b e e n   a d d e d   t o   c o v e r   u s e   o f   s o f t w a r e   o v e r   a   c o m p u t e r   n e t w o r k   a n d   p r o v i d e   f o r   l i m i t e d   a t t r i b u t i o n 
   *   f o r   t h e   O r i g i n a l   D e v e l o p e r .   I n   a d d i t i o n ,   E x h i b i t   A   h a s   b e e n   m o d i f i e d   t o   b e   c o n s i s t e n t   w i t h   E x h i b i t   B . 
   * 
   *   S o f t w a r e   d i s t r i b u t e d   u n d e r   t h e   L i c e n s e   i s   d i s t r i b u t e d   o n   a n   " A S   I S "   b a s i s , 
   *   W I T H O U T   W A R R A N T Y   O F   A N Y   K I N D ,   e i t h e r   e x p r e s s   o r   i m p l i e d . 
   *   S e e   t h e   L i c e n s e   f o r   t h e   s p e c i f i c   l a n g u a g e   g o v e r n i n g   r i g h t s   a n d   l i m i t a t i o n s   u n d e r   t h e   L i c e n s e . 
   *   T h e   O r i g i n a l   C o d e   i s   Z i m b r a   O p e n   S o u r c e   W e b   C l i e n t . 
   *   T h e   I n i t i a l   D e v e l o p e r   o f   t h e   O r i g i n a l   C o d e   i s   Z i m b r a ,   I n c .     A l l   r i g h t s   t o   t h e   O r i g i n a l   C o d e   w e r e 
   *   t r a n s f e r r e d   b y   Z i m b r a ,   I n c .   t o   S y n a c o r ,   I n c .   o n   S e p t e m b e r   1 4 ,   2 0 1 5 . 
   * 
   *   A l l   p o r t i o n s   o f   t h e   c o d e   a r e   C o p y r i g h t   ( C )   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 6   S y n a c o r ,   I n c .   A l l   R i g h t s   R e s e r v e d . 
   *   * * * * *   E N D   L I C E N S E   B L O C K   * * * * * 
   * / 
 
 / * * 
   *   @ o v e r v i e w 
   *   T h i s   f i l e   c o n t a i n s   t h e   a d d r e s s   b o o k   c l a s s . 
   * / 
 
 / * * 
   *   C r e a t e s   a n   a d d r e s s   b o o k . 
   *   @ c o n s t r u c t o r 
   *   @ c l a s s 
   *   T h i s   c l a s s   r e p r e s e n t s   a n   a d d r e s s   b o o k . 
   *   
   *   @ a u t h o r   P a r a g   S h a h 
   * 
   *   @ p a r a m 	 { H a s h } 	 p a r a m s 	 	 a   h a s h   o f   p a r a m e t e r s 
   *   @ p a r a m   { i n t } 	 p a r a m s . i d 	 	 	 a   n u m e r i c   I D 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . n a m e 	 	 [ s t r i n g ] 	 t h e   n a m e 
   *   @ p a r a m   { Z m O r g a n i z e r } 	 p a r a m s . p a r e n t 	 	 t h e   p a r e n t   o r g a n i z e r 
   *   @ p a r a m   { Z m T r e e } 	 p a r a m s . t r e e 	 	 a   t r e e   m o d e l   t h a t   c o n t a i n s   t h i s   o r g a n i z e r 
   *   @ p a r a m   { i n t } 	 p a r a m s . c o l o r 	 	 t h e   c o l o r   o f   t h i s   a d d r e s s   b o o k 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . o w n e r 	 t h e   o w n e r   o f   t h e   a d d r e s s   b o o k   ( i f   s h a r e d ) 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . z i d   	 	 t h e   t h e   s h a r e   I D   o f   a   s h a r e d   a d d r e s s   b o o k 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . r i d 	 	 t h e   t h e   r e m o t e   f o l d e r   i d   o f   a   s h a r e d   a d d r e s s   b o o k 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . r e s t U r l 	 t h e   R E S T   U R L   o f   t h i s   o r g a n i z e r 
   *   
   *   @ e x t e n d s 	 	 Z m F o l d e r 
   * / 
 Z m A d d r B o o k   =   f u n c t i o n ( p a r a m s )   { 
 	 p a r a m s . t y p e   =   Z m O r g a n i z e r . A D D R B O O K ; 
 	 Z m F o l d e r . c a l l ( t h i s ,   p a r a m s ) ; 
 } ; 
 
 Z m A d d r B o o k . p r o t o t y p e   =   n e w   Z m F o l d e r ; 
 Z m A d d r B o o k . p r o t o t y p e . c o n s t r u c t o r   =   Z m A d d r B o o k ; 
 
 Z m A d d r B o o k . p r o t o t y p e . i s Z m A d d r B o o k   =   t r u e ; 
 Z m A d d r B o o k . p r o t o t y p e . t o S t r i n g   =   f u n c t i o n ( )   {   r e t u r n   " Z m A d d r B o o k " ;   } ; 
 
 
 / /   C o n s t s 
 
 Z m A d d r B o o k . I D _ A D D R E S S B O O K   =   Z m O r g a n i z e r . I D _ A D D R B O O K ;   	 	 	 	 	 	 	 / /   X X X :   m a y   n o t   b e   n e c e s s a r y 
 
 / /   P u b l i c   m e t h o d s 
 
 Z m A d d r B o o k . p r o t o t y p e . g e t I c o n   = 
 f u n c t i o n ( )   { 
 	 i f   ( t h i s . n I d   = =   Z m F o l d e r . I D _ R O O T ) 	 	 	 {   r e t u r n   n u l l ;   } 
 	 i f   ( t h i s . n I d   = =   Z m F o l d e r . I D _ T R A S H ) 	 	 	 {   r e t u r n   " T r a s h " ;   } 
 	 i f   ( t h i s . l i n k   | |   t h i s . i s R e m o t e ( ) ) 	 	 	 {   r e t u r n   " S h a r e d C o n t a c t s F o l d e r " ;   } 
 	 i f   ( t h i s . n I d   = =   Z m F o l d e r . I D _ A U T O _ A D D E D ) 	 	 {   r e t u r n   " E m a i l e d C o n t a c t s " ;   } 
 	 r e t u r n   " C o n t a c t s F o l d e r " ; 
 } ; 
 
 / * * 
   *   C h e c k s   i f   t h e   a d d r e s s   b o o k   s u p p o r t s   p u b l i c   a c c e s s . 
   *   
   *   @ r e t u r n 	 { B o o l e a n } 	 	 a l w a y s   r e t u r n s   < c o d e > t r u e < / c o d e > 
   * / 
 Z m A d d r B o o k . p r o t o t y p e . s u p p o r t s P u b l i c A c c e s s   = 
 f u n c t i o n ( )   { 
 	 / /   A d d r B o o k ' s   c a n   b e   a c c e s s e d   o u t s i d e   o f   Z C S   ( i . e .   R E S T ) 
 	 r e t u r n   t r u e ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m A d d r B o o k . p r o t o t y p e . m a y C o n t a i n   =   f u n c t i o n ( w h a t )   { 
 
 	 i f   ( ! w h a t )   { 
 	 	 r e t u r n   t r u e ; 
 	 } 
 
 	 / /   D i s t r i b u t i o n   L i s t s   i s   a   s y s t e m - g e n e r a t e d   f o l d e r 
 	 i f   ( t h i s . i d   = =   Z m O r g a n i z e r . I D _ D L S )   { 
 	 	 r e t u r n   f a l s e ; 
 	 } 
 
 	 i f   ( w h a t . i s Z m A d d r B o o k )   { 
 	 	 r e t u r n   Z m F o l d e r . p r o t o t y p e . m a y C o n t a i n . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
 	 } 
 
 	 / /   A n   i t e m   o r   a n   a r r a y   o f   i t e m s   i s   b e i n g   m o v e d 
 	 v a r   i t e m s   =   A j x U t i l . t o A r r a y ( w h a t ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   i t e m s . l e n g t h ;   i + + )   { 
 	 	 v a r   i t e m   =   i t e m s [ i ] ; 
 	 	 i f   ( i t e m . t y p e   ! = =   Z m I t e m . C O N T A C T   & &   i t e m . t y p e   ! = =   Z m I t e m . G R O U P )   { 
 	 	 	 / /   o n l y   c o n t a c t s   a r e   v a l i d   f o r   a d d r   b o o k s . 
 	 	 	 r e t u r n   f a l s e ; 
 	 	 } 
 	 } 
 
 	 r e t u r n   Z m F o l d e r . p r o t o t y p e . m a y C o n t a i n . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
 } ; 
 } 
 i f   ( A j x P a c k a g e . d e f i n e ( " z i m b r a M a i l . a b o o k . m o d e l . Z m C o n t a c t " ) )   { 
 / * 
   *   * * * * *   B E G I N   L I C E N S E   B L O C K   * * * * * 
   *   Z i m b r a   C o l l a b o r a t i o n   S u i t e   W e b   C l i e n t 
   *   C o p y r i g h t   ( C )   2 0 0 4 ,   2 0 0 5 ,   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 5 ,   2 0 1 6   S y n a c o r ,   I n c . 
   * 
   *   T h e   c o n t e n t s   o f   t h i s   f i l e   a r e   s u b j e c t   t o   t h e   C o m m o n   P u b l i c   A t t r i b u t i o n   L i c e n s e   V e r s i o n   1 . 0   ( t h e   " L i c e n s e " ) ; 
   *   y o u   m a y   n o t   u s e   t h i s   f i l e   e x c e p t   i n   c o m p l i a n c e   w i t h   t h e   L i c e n s e . 
   *   Y o u   m a y   o b t a i n   a   c o p y   o f   t h e   L i c e n s e   a t :   h t t p s : / / w w w . z i m b r a . c o m / l i c e n s e 
   *   T h e   L i c e n s e   i s   b a s e d   o n   t h e   M o z i l l a   P u b l i c   L i c e n s e   V e r s i o n   1 . 1   b u t   S e c t i o n s   1 4   a n d   1 5 
   *   h a v e   b e e n   a d d e d   t o   c o v e r   u s e   o f   s o f t w a r e   o v e r   a   c o m p u t e r   n e t w o r k   a n d   p r o v i d e   f o r   l i m i t e d   a t t r i b u t i o n 
   *   f o r   t h e   O r i g i n a l   D e v e l o p e r .   I n   a d d i t i o n ,   E x h i b i t   A   h a s   b e e n   m o d i f i e d   t o   b e   c o n s i s t e n t   w i t h   E x h i b i t   B . 
   * 
   *   S o f t w a r e   d i s t r i b u t e d   u n d e r   t h e   L i c e n s e   i s   d i s t r i b u t e d   o n   a n   " A S   I S "   b a s i s , 
   *   W I T H O U T   W A R R A N T Y   O F   A N Y   K I N D ,   e i t h e r   e x p r e s s   o r   i m p l i e d . 
   *   S e e   t h e   L i c e n s e   f o r   t h e   s p e c i f i c   l a n g u a g e   g o v e r n i n g   r i g h t s   a n d   l i m i t a t i o n s   u n d e r   t h e   L i c e n s e . 
   *   T h e   O r i g i n a l   C o d e   i s   Z i m b r a   O p e n   S o u r c e   W e b   C l i e n t . 
   *   T h e   I n i t i a l   D e v e l o p e r   o f   t h e   O r i g i n a l   C o d e   i s   Z i m b r a ,   I n c .     A l l   r i g h t s   t o   t h e   O r i g i n a l   C o d e   w e r e 
   *   t r a n s f e r r e d   b y   Z i m b r a ,   I n c .   t o   S y n a c o r ,   I n c .   o n   S e p t e m b e r   1 4 ,   2 0 1 5 . 
   * 
   *   A l l   p o r t i o n s   o f   t h e   c o d e   a r e   C o p y r i g h t   ( C )   2 0 0 4 ,   2 0 0 5 ,   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 5 ,   2 0 1 6   S y n a c o r ,   I n c .   A l l   R i g h t s   R e s e r v e d . 
   *   * * * * *   E N D   L I C E N S E   B L O C K   * * * * * 
   * / 
 
 / * * 
   *   @ o v e r v i e w 
   *   T h i s   f i l e   c o n t a i n s   t h e   c o n t a c t   c l a s s . 
   * / 
 
 i f   ( ! w i n d o w . Z m C o n t a c t )   { 
 / * * 
   *   C r e a t e s   a n   e m p t y   c o n t a c t . 
   *   @ c l a s s 
   *   T h i s   c l a s s   r e p r e s e n t s   a   c o n t a c t   ( t y p i c a l l y   a   p e r s o n )   w i t h   a l l   i t s   a s s o c i a t e d   v e r s i o n s 
   *   o f   e m a i l   a d d r e s s ,   h o m e   a n d   w o r k   a d d r e s s e s ,   p h o n e   n u m b e r s ,   e t c .   C o n t a c t s   c a n   b e   f i l e d / s o r t e d 
   *   i n   d i f f e r e n t   w a y s ,   w i t h   t h e   d e f a u l t   b e i n g   L a s t ,   F i r s t .   A   c o n t a c t   i s   a n   i t e m ,   s o 
   *   i t   h a s   t a g g i n g   a n d   f l a g g i n g   s u p p o r t ,   a n d   b e l o n g s   t o   a   l i s t . 
   *   < p > 
   *   M o s t   o f   a   c o n t a c t ' s   d a t a   i s   k e p t   i n   a t t r i b u t e s .   T h e s e   i n c l u d e   n a m e ,   p h o n e ,   e t c .   M e t a - d a t a   a n d 
   *   d a t a   c o m m o n   t o   i t e m s   a r e   n o t   k e p t   i n   a t t r i b u t e s .   T h e s e   i n c l u d e   f l a g s ,   t a g s ,   f o l d e r ,   a n d 
   *   m o d i f i e d / c r e a t e d   d a t e s .   S i n c e   t h e   a t t r i b u t e   d a t a   f o r   c o n t a c t s   i s   l o a d e d   o n l y   o n c e ,   a   c o n t a c t 
   *   g e t s   i t s   a t t r i b u t e   v a l u e s   f r o m   t h a t   c a n o n i c a l   l i s t . 
   *   < / p > 
   * 
   *   @ p a r a m   { i n t } 	 i d 	 	 t h e   u n i q u e   I D 
   *   @ p a r a m   { Z m C o n t a c t L i s t } 	 l i s t 	 	 t h e   l i s t   t h a t   c o n t a i n s   t h i s   c o n t a c t 
   *   @ p a r a m   { c o n s t a n t } 	 t y p e 	 	 t h e   i t e m   t y p e 
   *   @ p a r a m   { o b j e c t } 	 n e w D l 	 	 t r u e   i f   t h i s   i s   a   n e w   D L 
   * 
   *   @ e x t e n d s 	 	 Z m I t e m 
   * / 
 Z m C o n t a c t   =   f u n c t i o n ( i d ,   l i s t ,   t y p e ,   n e w D l )   { 
 	 i f   ( a r g u m e n t s . l e n g t h   = =   0 )   {   r e t u r n ;   } 
 
 	 t y p e   =   t y p e   | |   Z m I t e m . C O N T A C T ; 
 	 Z m I t e m . c a l l ( t h i s ,   t y p e ,   i d ,   l i s t ) ; 
 
 	 t h i s . a t t r   =   { } ; 
 	 t h i s . i s G a l   =   ( t h i s . l i s t   & &   t h i s . l i s t . i s G a l )   | |   n e w D l ; 
 	 i f   ( n e w D l )   { 
 	 	 t h i s . f o l d e r I d   =   Z m F o l d e r . I D _ D L S ; 
 	 	 t h i s . d l I n f o   =   { 	 i s M e m b e r :   f a l s e , 
 	 	 	 	 	 	 i s O w n e r :   t r u e , 
 	 	 	 	 	 	 s u b s c r i p t i o n P o l i c y :   n u l l , 
 	 	 	 	 	 	 u n s u b s c r i p t i o n P o l i c y :   n u l l , 
 	 	 	 	 	 	 d e s c r i p t i o n :   " " , 
 	 	 	 	 	 	 d i s p l a y N a m e :   " " , 
 	 	 	 	 	 	 n o t e s :   " " , 
 	 	 	 	 	 	 h i d e I n G a l :   f a l s e , 
 	 	 	 	 	 	 m a i l P o l i c y :   n u l l , 
 	 	 	 	 	 	 o w n e r s :   [ a p p C t x t . g e t ( Z m S e t t i n g . U S E R N A M E ) ] 
 	 	 } ; 
 
 	 } 
 
 	 t h i s . p a r t i c i p a n t s   =   n e w   A j x V e c t o r ( ) ;   / /   X X X :   n e e d   t o   p o p u l a t e   t h i s   g u y   ( s e e   Z m C o n v ) 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e   =   n e w   Z m I t e m ; 
 Z m C o n t a c t . p r o t o t y p e . c o n s t r u c t o r   =   Z m C o n t a c t ; 
 Z m C o n t a c t . p r o t o t y p e . i s Z m C o n t a c t   =   t r u e ; 
 
 / /   f i e l d s 
 Z m C o n t a c t . F _ a n n i v e r s a r y 	 	 	 	 =   " a n n i v e r s a r y " ; 
 Z m C o n t a c t . F _ a s s i s t a n t P h o n e 	 	 	 =   " a s s i s t a n t P h o n e " ; 
 Z m C o n t a c t . F _ a t t a c h m e n t 	 	 	 	 =   " a t t a c h m e n t " ; 
 Z m C o n t a c t . F _ b i r t h d a y 	 	 	 	 =   " b i r t h d a y " ; 
 Z m C o n t a c t . F _ c a l l b a c k P h o n e 	 	 	 =   " c a l l b a c k P h o n e " ; 
 Z m C o n t a c t . F _ c a r P h o n e 	 	 	 	 =   " c a r P h o n e " ; 
 Z m C o n t a c t . F _ c o m p a n y 	 	 	 	 	 =   " c o m p a n y " ; 
 Z m C o n t a c t . F _ c o m p a n y P h o n e 	 	 	 =   " c o m p a n y P h o n e " ; 
 Z m C o n t a c t . F _ c u s t o m 	 	 	 	 	 =   " c u s t o m " ; 
 Z m C o n t a c t . F _ d e s c r i p t i o n 	 	 	 	 =   " d e s c r i p t i o n " ; 
 Z m C o n t a c t . F _ d e p a r t m e n t 	 	 	 	 =   " d e p a r t m e n t " ; 
 Z m C o n t a c t . F _ d l i s t 	 	 	 	 	 =   " d l i s t " ; 	 	 	 	 / /   G r o u p   f i e l d s 
 Z m C o n t a c t . F _ d l D i s p l a y N a m e 	 	 	 =   " d l d i s p l a y n a m e " ;   / / D L 
 Z m C o n t a c t . F _ d l D e s c 	 	 	 	 	 =   " d l d e s c " ;     / / D L 
 Z m C o n t a c t . F _ d l H i d e I n G a l 	 	 	 	 =   " d l h i d e i n g a l " ;     / / D L 
 Z m C o n t a c t . F _ d l N o t e s 	 	 	 	 	 =   " d l n o t e s " ;     / / D L 
 Z m C o n t a c t . F _ d l S u b s c r i p t i o n P o l i c y 	 =   " d l s u b s p o l i c y " ;     / / D L 
 Z m C o n t a c t . F _ d l M a i l P o l i c y 	 	 	 =   " d l m a i l p o l i c y " ;     / / D L 
 Z m C o n t a c t . F _ d l M a i l P o l i c y S p e c i f i c M a i l e r s 	 =   " d l m a i l p o l i c y s p e c i f i c m a i l e r s " ;     / / D L 
 Z m C o n t a c t . F _ d l U n s u b s c r i p t i o n P o l i c y 	 =   " d l u n s u b s p o l i c y " ;     / / D L 
 Z m C o n t a c t . F _ d l L i s t O w n e r s 	 	 	 =   " d l l i s t o w n e r s " ;     / / D L 
 Z m C o n t a c t . F _ e m a i l 	 	 	 	 	 =   " e m a i l " ; 
 Z m C o n t a c t . F _ e m a i l 2 	 	 	 	 	 =   " e m a i l 2 " ; 
 Z m C o n t a c t . F _ e m a i l 3 	 	 	 	 	 =   " e m a i l 3 " ; 
 Z m C o n t a c t . F _ e m a i l 4 	 	 	 	 	 =   " e m a i l 4 " ; 
 Z m C o n t a c t . F _ e m a i l 5 	 	 	 	 	 =   " e m a i l 5 " ; 
 Z m C o n t a c t . F _ e m a i l 6 	 	 	 	 	 =   " e m a i l 6 " ; 
 Z m C o n t a c t . F _ e m a i l 7 	 	 	 	 	 =   " e m a i l 7 " ; 
 Z m C o n t a c t . F _ e m a i l 8 	 	 	 	 	 =   " e m a i l 8 " ; 
 Z m C o n t a c t . F _ e m a i l 9 	 	 	 	 	 =   " e m a i l 9 " ; 
 Z m C o n t a c t . F _ e m a i l 1 0 	 	 	 	 	 =   " e m a i l 1 0 " ; 
 Z m C o n t a c t . F _ e m a i l 1 1 	 	 	 	 	 =   " e m a i l 1 1 " ; 
 Z m C o n t a c t . F _ e m a i l 1 2 	 	 	 	 	 =   " e m a i l 1 2 " ; 
 Z m C o n t a c t . F _ e m a i l 1 3 	 	 	 	 	 =   " e m a i l 1 3 " ; 
 Z m C o n t a c t . F _ e m a i l 1 4 	 	 	 	 	 =   " e m a i l 1 4 " ; 
 Z m C o n t a c t . F _ e m a i l 1 5 	 	 	 	 	 =   " e m a i l 1 5 " ; 
 Z m C o n t a c t . F _ e m a i l 1 6 	 	 	 	 	 =   " e m a i l 1 6 " ; 
 Z m C o n t a c t . F _ f i l e A s 	 	 	 	 	 =   " f i l e A s " ; 
 Z m C o n t a c t . F _ f i r s t N a m e 	 	 	 	 =   " f i r s t N a m e " ; 
 Z m C o n t a c t . F _ f o l d e r I d 	 	 	 	 =   " f o l d e r I d " ; 
 Z m C o n t a c t . F _ g r o u p s                                     =   " g r o u p s " ;                   / / g r o u p   m e m b e r s 
 Z m C o n t a c t . F _ h o m e C i t y 	 	 	 	 =   " h o m e C i t y " ; 
 Z m C o n t a c t . F _ h o m e C o u n t r y 	 	 	 	 =   " h o m e C o u n t r y " ; 
 Z m C o n t a c t . F _ h o m e F a x 	 	 	 	 	 =   " h o m e F a x " ; 
 Z m C o n t a c t . F _ h o m e P h o n e 	 	 	 	 =   " h o m e P h o n e " ; 
 Z m C o n t a c t . F _ h o m e P h o n e 2 	 	 	 	 =   " h o m e P h o n e 2 " ; 
 Z m C o n t a c t . F _ h o m e P o s t a l C o d e 	 	 	 =   " h o m e P o s t a l C o d e " ; 
 Z m C o n t a c t . F _ h o m e S t a t e 	 	 	 	 =   " h o m e S t a t e " ; 
 Z m C o n t a c t . F _ h o m e S t r e e t 	 	 	 	 =   " h o m e S t r e e t " ; 
 Z m C o n t a c t . F _ h o m e U R L 	 	 	 	 	 =   " h o m e U R L " ; 
 Z m C o n t a c t . F _ i m a g e 	 	 	 	 	 =   " i m a g e " ; 	 	 	 	 / /   c o n t a c t   p h o t o 
 Z m C o n t a c t . F _ i m A d d r e s s   	 	 	 	 =   " i m A d d r e s s " ; 	 	 	 / /   I M   a d d r e s s e s 
 Z m C o n t a c t . F _ i m A d d r e s s 1   	 	 	 	 =   " i m A d d r e s s 1 " ; 	 	 	 / /   I M   a d d r e s s e s 
 Z m C o n t a c t . F _ i m A d d r e s s 2   	 	 	 	 =   " i m A d d r e s s 2 " ; 
 Z m C o n t a c t . F _ i m A d d r e s s 3 	 	 	 	 =   " i m A d d r e s s 3 " ; 
 Z m C o n t a c t . F _ j o b T i t l e 	 	 	 	 =   " j o b T i t l e " ; 
 Z m C o n t a c t . F _ l a s t N a m e 	 	 	 	 =   " l a s t N a m e " ; 
 Z m C o n t a c t . F _ m a i d e n N a m e 	 	 	 	 =   " m a i d e n N a m e " ; 
 Z m C o n t a c t . F _ m e m b e r C                                   =   " m e m b e r C " ; 
 Z m C o n t a c t . F _ m e m b e r G                                   =   " m e m b e r G " ; 
 Z m C o n t a c t . F _ m e m b e r I                                   =   " m e m b e r I " ; 
 Z m C o n t a c t . F _ m i d d l e N a m e 	 	 	 	 =   " m i d d l e N a m e " ; 
 Z m C o n t a c t . F _ m o b i l e P h o n e 	 	 	 	 =   " m o b i l e P h o n e " ; 
 Z m C o n t a c t . F _ n a m e P r e f i x 	 	 	 	 =   " n a m e P r e f i x " ; 
 Z m C o n t a c t . F _ n a m e S u f f i x 	 	 	 	 =   " n a m e S u f f i x " ; 
 Z m C o n t a c t . F _ n i c k n a m e 	 	 	 	 =   " n i c k n a m e " ; 
 Z m C o n t a c t . F _ n o t e s 	 	 	 	 	 =   " n o t e s " ; 
 Z m C o n t a c t . F _ o t h e r C i t y 	 	 	 	 =   " o t h e r C i t y " ; 
 Z m C o n t a c t . F _ o t h e r C o u n t r y 	 	 	 =   " o t h e r C o u n t r y " ; 
 Z m C o n t a c t . F _ o t h e r F a x 	 	 	 	 =   " o t h e r F a x " ; 
 Z m C o n t a c t . F _ o t h e r P h o n e 	 	 	 	 =   " o t h e r P h o n e " ; 
 Z m C o n t a c t . F _ o t h e r P o s t a l C o d e 	 	 	 =   " o t h e r P o s t a l C o d e " ; 
 Z m C o n t a c t . F _ o t h e r S t a t e 	 	 	 	 =   " o t h e r S t a t e " ; 
 Z m C o n t a c t . F _ o t h e r S t r e e t 	 	 	 	 =   " o t h e r S t r e e t " ; 
 Z m C o n t a c t . F _ o t h e r U R L 	 	 	 	 =   " o t h e r U R L " ; 
 Z m C o n t a c t . F _ p a g e r 	 	 	 	 	 =   " p a g e r " ; 
 Z m C o n t a c t . F _ p h o n e t i c F i r s t N a m e               =   " p h o n e t i c F i r s t N a m e " ; 
 Z m C o n t a c t . F _ p h o n e t i c L a s t N a m e                 =   " p h o n e t i c L a s t N a m e " ; 
 Z m C o n t a c t . F _ p h o n e t i c C o m p a n y                   =   " p h o n e t i c C o m p a n y " ; 
 Z m C o n t a c t . F _ t y p e 	 	 	 	 	 =   " t y p e " ; 
 Z m C o n t a c t . F _ w o r k A l t P h o n e 	 	 	 =   " w o r k A l t P h o n e " ; 
 Z m C o n t a c t . F _ w o r k C i t y 	 	 	 	 =   " w o r k C i t y " ; 
 Z m C o n t a c t . F _ w o r k C o u n t r y 	 	 	 	 =   " w o r k C o u n t r y " ; 
 Z m C o n t a c t . F _ w o r k E m a i l 1 	 	 	 	 =   " w o r k E m a i l 1 " ; 
 Z m C o n t a c t . F _ w o r k E m a i l 2 	 	 	 	 =   " w o r k E m a i l 2 " ; 
 Z m C o n t a c t . F _ w o r k E m a i l 3 	 	 	 	 =   " w o r k E m a i l 3 " ; 
 Z m C o n t a c t . F _ w o r k F a x 	 	 	 	 	 =   " w o r k F a x " ; 
 Z m C o n t a c t . F _ w o r k M o b i l e 	 	 	 	 =   " w o r k M o b i l e " ; 
 Z m C o n t a c t . F _ w o r k P h o n e 	 	 	 	 =   " w o r k P h o n e " ; 
 Z m C o n t a c t . F _ w o r k P h o n e 2 	 	 	 	 =   " w o r k P h o n e 2 " ; 
 Z m C o n t a c t . F _ w o r k P o s t a l C o d e 	 	 	 =   " w o r k P o s t a l C o d e " ; 
 Z m C o n t a c t . F _ w o r k S t a t e 	 	 	 	 =   " w o r k S t a t e " ; 
 Z m C o n t a c t . F _ w o r k S t r e e t 	 	 	 	 =   " w o r k S t r e e t " ; 
 Z m C o n t a c t . F _ w o r k U R L 	 	 	 	 	 =   " w o r k U R L " ; 
 Z m C o n t a c t . F _ i m a g e p a r t                               =   " i m a g e p a r t " ;                     / /   N e w   f i e l d   f o r   b u g   7 3 1 4 6   -   C o n t a c t s   c a l l   d o e s   n o t   r e t u r n   t h e   i m a g e   i n f o r m a t i o n 
 Z m C o n t a c t . F _ z i m l e t I m a g e 	 	 	 	 =   " z i m l e t I m a g e " ; 
 Z m C o n t a c t . X _ f i l e A s 	 	 	 	 	 =   " f i l e A s " ; 	 	 	 	 / /   e x t r a   f i e l d s 
 Z m C o n t a c t . X _ f i r s t L a s t 	 	 	 	 =   " f i r s t L a s t " ; 
 Z m C o n t a c t . X _ f u l l N a m e 	 	 	 	 =   " f u l l N a m e " ; 
 Z m C o n t a c t . X _ v c a r d X P r o p s                           =   " v c a r d X P r o p s " ; 
 Z m C o n t a c t . X _ o u t l o o k U s e r F i e l d                 =   " o u t l o o k U s e r F i e l d " ; 
 Z m C o n t a c t . M C _ c a r d O w n e r 	 	 	 	 =   " c a r d O w n e r " ; 	 	 	 / /   M y   c a r d   f i e l d s 
 Z m C o n t a c t . M C _ w o r k C a r d M e s s a g e 	 	 =   " w o r k C a r d M e s s a g e " ; 
 Z m C o n t a c t . M C _ h o m e C a r d M e s s a g e 	 	 =   " h o m e C a r d M e s s a g e " ; 
 Z m C o n t a c t . M C _ h o m e P h o t o U R L 	 	 	 =   " h o m e P h o t o U R L " ; 
 Z m C o n t a c t . M C _ w o r k P h o t o U R L 	 	 	 =   " w o r k P h o t o U R L " ; 
 Z m C o n t a c t . G A L _ M O D I F Y _ T I M E S T A M P 	 	 =   " m o d i f y T i m e S t a m p " ; 	 / /   G A L   f i e l d s 
 Z m C o n t a c t . G A L _ C R E A T E _ T I M E S T A M P 	 	 =   " c r e a t e T i m e S t a m p " ; 
 Z m C o n t a c t . G A L _ Z I M B R A _ I D 	 	 	 	 =   " z i m b r a I d " ; 
 Z m C o n t a c t . G A L _ O B J E C T _ C L A S S 	 	 	 =   " o b j e c t C l a s s " ; 
 Z m C o n t a c t . G A L _ M A I L _ F O R W A R D _ A D D R E S S 	 =   " z i m b r a M a i l F o r w a r d i n g A d d r e s s " ; 
 Z m C o n t a c t . G A L _ C A L _ R E S _ T Y P E 	 	 	 =   " z i m b r a C a l R e s T y p e " ; 
 Z m C o n t a c t . G A L _ C A L _ R E S _ L O C _ N A M E 	 	 =   " z i m b r a C a l R e s L o c a t i o n D i s p l a y N a m e " ; 
 
 / /   f i l e   a s 
 ( f u n c t i o n ( )   { 
 	 v a r   i   =   1 ; 
 	 Z m C o n t a c t . F A _ L A S T _ C _ F I R S T 	 	 	 =   i + + ; 
 	 Z m C o n t a c t . F A _ F I R S T _ L A S T   	 	 	 =   i + + ; 
 	 Z m C o n t a c t . F A _ C O M P A N Y   	 	 	 	 =   i + + ; 
 	 Z m C o n t a c t . F A _ L A S T _ C _ F I R S T _ C O M P A N Y 	 =   i + + ; 
 	 Z m C o n t a c t . F A _ F I R S T _ L A S T _ C O M P A N Y 	 	 =   i + + ; 
 	 Z m C o n t a c t . F A _ C O M P A N Y _ L A S T _ C _ F I R S T 	 =   i + + ; 
 	 Z m C o n t a c t . F A _ C O M P A N Y _ F I R S T _ L A S T 	 	 =   i + + ; 
 	 Z m C o n t a c t . F A _ C U S T O M 	 	 	 	 	 =   i + + ; 
 } ) ( ) ; 
 
 / /   F i e l d   i n f o r m a t i o n 
 
 Z m C o n t a c t . A D D R E S S _ F I E L D S   =   [ 
         / /   N O T E :   s y n c   w i t h   f i e l d   o r d e r   i n   Z m E d i t C o n t a c t V i e w ' s   t e m p l a t e s 
 	 Z m C o n t a c t . F _ h o m e C i t y , 
 	 Z m C o n t a c t . F _ h o m e C o u n t r y , 
 	 Z m C o n t a c t . F _ h o m e P o s t a l C o d e , 
 	 Z m C o n t a c t . F _ h o m e S t a t e , 
 	 Z m C o n t a c t . F _ h o m e S t r e e t , 
 	 Z m C o n t a c t . F _ w o r k C i t y , 
 	 Z m C o n t a c t . F _ w o r k C o u n t r y , 
 	 Z m C o n t a c t . F _ w o r k P o s t a l C o d e , 
 	 Z m C o n t a c t . F _ w o r k S t a t e , 
 	 Z m C o n t a c t . F _ w o r k S t r e e t , 
         Z m C o n t a c t . F _ o t h e r C i t y , 
         Z m C o n t a c t . F _ o t h e r C o u n t r y , 
         Z m C o n t a c t . F _ o t h e r P o s t a l C o d e , 
         Z m C o n t a c t . F _ o t h e r S t a t e , 
         Z m C o n t a c t . F _ o t h e r S t r e e t 
 ] ; 
 Z m C o n t a c t . E M A I L _ F I E L D S   =   [ 
 	 Z m C o n t a c t . F _ e m a i l , 
 	 Z m C o n t a c t . F _ w o r k E m a i l 1 , 
 	 Z m C o n t a c t . F _ w o r k E m a i l 2 , 
 	 Z m C o n t a c t . F _ w o r k E m a i l 3 
 ] ; 
 Z m C o n t a c t . I M _ F I E L D S   =   [ 
 	 Z m C o n t a c t . F _ i m A d d r e s s 
 ] ; 
 Z m C o n t a c t . O T H E R _ F I E L D S   =   [ 
         / /   N O T E :   s y n c   w i t h   f i e l d   o r d e r   i n   Z m E d i t C o n t a c t V i e w ' s   t e m p l a t e s 
 	 Z m C o n t a c t . F _ b i r t h d a y , 
         Z m C o n t a c t . F _ a n n i v e r s a r y , 
 	 Z m C o n t a c t . F _ c u s t o m 
 ] ; 
 Z m C o n t a c t . P H O N E _ F I E L D S   =   [ 
         / /   N O T E :   s y n c   w i t h   f i e l d   o r d e r   i n   Z m E d i t C o n t a c t V i e w ' s   t e m p l a t e s 
         Z m C o n t a c t . F _ m o b i l e P h o n e , 
         Z m C o n t a c t . F _ w o r k P h o n e , 
         Z m C o n t a c t . F _ w o r k F a x , 
         Z m C o n t a c t . F _ c o m p a n y P h o n e , 
         Z m C o n t a c t . F _ h o m e P h o n e , 
         Z m C o n t a c t . F _ h o m e F a x , 
         Z m C o n t a c t . F _ p a g e r , 
         Z m C o n t a c t . F _ c a l l b a c k P h o n e , 
 	 Z m C o n t a c t . F _ a s s i s t a n t P h o n e , 
 	 Z m C o n t a c t . F _ c a r P h o n e , 
 	 Z m C o n t a c t . F _ o t h e r P h o n e , 
         Z m C o n t a c t . F _ o t h e r F a x , 
 	 Z m C o n t a c t . F _ w o r k A l t P h o n e , 
 	 Z m C o n t a c t . F _ w o r k M o b i l e 
 ] ; 
 Z m C o n t a c t . P R I M A R Y _ F I E L D S   =   [ 
         / /   N O T E :   s y n c   w i t h   f i e l d   o r d e r   i n   Z m E d i t C o n t a c t V i e w ' s   t e m p l a t e s 
         Z m C o n t a c t . F _ i m a g e , 
         Z m C o n t a c t . F _ n a m e P r e f i x , 
         Z m C o n t a c t . F _ f i r s t N a m e , 
         Z m C o n t a c t . F _ p h o n e t i c F i r s t N a m e , 
         Z m C o n t a c t . F _ m i d d l e N a m e , 
 	 Z m C o n t a c t . F _ m a i d e n N a m e , 
         Z m C o n t a c t . F _ l a s t N a m e , 
         Z m C o n t a c t . F _ p h o n e t i c L a s t N a m e , 
         Z m C o n t a c t . F _ n a m e S u f f i x , 
         Z m C o n t a c t . F _ n i c k n a m e , 
         Z m C o n t a c t . F _ j o b T i t l e , 
         Z m C o n t a c t . F _ d e p a r t m e n t , 
 	 Z m C o n t a c t . F _ c o m p a n y , 
         Z m C o n t a c t . F _ p h o n e t i c C o m p a n y , 
 	 Z m C o n t a c t . F _ f i l e A s , 
 	 Z m C o n t a c t . F _ f o l d e r I d , 
 	 Z m C o n t a c t . F _ n o t e s 
 ] ; 
 Z m C o n t a c t . U R L _ F I E L D S   =   [ 
         / /   N O T E :   s y n c   w i t h   f i e l d   o r d e r   i n   Z m E d i t C o n t a c t V i e w ' s   t e m p l a t e s 
 	 Z m C o n t a c t . F _ h o m e U R L , 
 	 Z m C o n t a c t . F _ w o r k U R L , 
 	 Z m C o n t a c t . F _ o t h e r U R L 
 ] ; 
 Z m C o n t a c t . G A L _ F I E L D S   =   [ 
 	 Z m C o n t a c t . G A L _ M O D I F Y _ T I M E S T A M P , 
 	 Z m C o n t a c t . G A L _ C R E A T E _ T I M E S T A M P , 
 	 Z m C o n t a c t . G A L _ Z I M B R A _ I D , 
 	 Z m C o n t a c t . G A L _ O B J E C T _ C L A S S , 
 	 Z m C o n t a c t . G A L _ M A I L _ F O R W A R D _ A D D R E S S , 
 	 Z m C o n t a c t . G A L _ C A L _ R E S _ T Y P E , 
 	 Z m C o n t a c t . G A L _ C A L _ R E S _ L O C _ N A M E , 
 	 Z m C o n t a c t . F _ t y p e 
 ] ; 
 Z m C o n t a c t . M Y C A R D _ F I E L D S   =   [ 
 	 Z m C o n t a c t . M C _ c a r d O w n e r , 
 	 Z m C o n t a c t . M C _ h o m e C a r d M e s s a g e , 
 	 Z m C o n t a c t . M C _ h o m e P h o t o U R L , 
 	 Z m C o n t a c t . M C _ w o r k C a r d M e s s a g e , 
 	 Z m C o n t a c t . M C _ w o r k P h o t o U R L 
 ] ; 
 Z m C o n t a c t . X _ F I E L D S   =   [ 
 	 Z m C o n t a c t . X _ f i r s t L a s t , 
 	 Z m C o n t a c t . X _ f u l l N a m e , 
         Z m C o n t a c t . X _ v c a r d X P r o p s 
 ] ; 
 
 
 Z m C o n t a c t . I G N O R E _ N O R M A L I Z A T I O N   =   [ ] ; 
 
 Z m C o n t a c t . A D D R _ P R E F I X E S   =   [ " w o r k " , " h o m e " , " o t h e r " ] ; 
 Z m C o n t a c t . A D D R _ S U F F I X E S   =   [ " S t r e e t " , " C i t y " , " S t a t e " , " P o s t a l C o d e " , " C o u n t r y " ] ; 
 
 Z m C o n t a c t . u p d a t e F i e l d C o n s t a n t s   =   f u n c t i o n ( )   { 
 
 	 f o r   ( v a r   i   =   0 ;   i   <   Z m C o n t a c t . A D D R _ P R E F I X E S . l e n g t h ;   i + + )   { 
 	 	 f o r   ( v a r   j   =   0 ;   j   <   Z m C o n t a c t . A D D R _ S U F F I X E S . l e n g t h ;   j + + )   { 
 	 	 	 Z m C o n t a c t . I G N O R E _ N O R M A L I Z A T I O N . p u s h ( Z m C o n t a c t . A D D R _ P R E F I X E S [ i ]   +   Z m C o n t a c t . A D D R _ S U F F I X E S [ j ] ) ; 
 	 	 } 
 	 } 
 
 Z m C o n t a c t . D I S P L A Y _ F I E L D S   =   [ ] . c o n c a t ( 
 	 Z m C o n t a c t . A D D R E S S _ F I E L D S , 
 	 Z m C o n t a c t . E M A I L _ F I E L D S , 
 	 Z m C o n t a c t . I M _ F I E L D S , 
 	 Z m C o n t a c t . O T H E R _ F I E L D S , 
 	 Z m C o n t a c t . P H O N E _ F I E L D S , 
 	 Z m C o n t a c t . P R I M A R Y _ F I E L D S , 
 	 Z m C o n t a c t . U R L _ F I E L D S 
 ) ; 
 
 Z m C o n t a c t . I G N O R E _ F I E L D S   =   [ ] . c o n c a t ( 
 	 Z m C o n t a c t . G A L _ F I E L D S , 
 	 Z m C o n t a c t . M Y C A R D _ F I E L D S , 
 	 Z m C o n t a c t . X _ F I E L D S , 
 	 [ Z m C o n t a c t . F _ i m a g e p a r t ] 
 ) ; 
 
 Z m C o n t a c t . A L L _ F I E L D S   =   [ ] . c o n c a t ( 
 	 Z m C o n t a c t . D I S P L A Y _ F I E L D S ,   Z m C o n t a c t . I G N O R E _ F I E L D S 
 ) ; 
 
 Z m C o n t a c t . I S _ D A T E   =   { } ; 
 Z m C o n t a c t . I S _ D A T E [ Z m C o n t a c t . F _ b i r t h d a y ]   =   t r u e ; 
 Z m C o n t a c t . I S _ D A T E [ Z m C o n t a c t . F _ a n n i v e r s a r y ]   =   t r u e ; 
 
 Z m C o n t a c t . I S _ I G N O R E   =   A j x U t i l . a r r a y A s H a s h ( Z m C o n t a c t . I G N O R E _ F I E L D S ) ; 
 
 / /   n u m b e r   o f   d i s t r i b u t i o n   l i s t   m e m b e r s   t o   f e t c h   a t   a   t i m e 
 Z m C o n t a c t . D L _ P A G E _ S I Z E   =   1 0 0 ; 
 
 Z m C o n t a c t . G R O U P _ C O N T A C T _ R E F   =   " C " ; 
 Z m C o n t a c t . G R O U P _ G A L _ R E F   =   " G " ; 
 Z m C o n t a c t . G R O U P _ I N L I N E _ R E F   =   " I " ; 	 
 } ;   / /   u p d a t e F i e l d C o n s t a n t s ( ) 
 Z m C o n t a c t . u p d a t e F i e l d C o n s t a n t s ( ) ; 
 
 / * * 
   *   T h i s   s t r u c t u r e   c a n   b e   q u e r i e d   t o   d e t e r m i n e   i f   t h e   f i r s t 
   *   e n t r y   i n   a   m u l t i - v a l u e   e n t r y   i s   s u f f i x e d   w i t h   " 1 " .   M o s t 
   *   a t t r i b u t e s   a d d   a   n u m e r i c a l   s u f f i x   t o   a l l   b u t   t h e   f i r s t 
   *   e n t r y . 
   *   < p > 
   *   < s t r o n g > N o t e : < / s t r o n g > 
   *   I n   m o s t   c a s e s ,   { @ l i n k   Z m C o n t a c t # g e t A t t r i b u t e N a m e }   i s   a   b e t t e r   c h o i c e . 
   * / 
 Z m C o n t a c t . I S _ A D D O N E   =   { } ; 
 Z m C o n t a c t . I S _ A D D O N E [ Z m C o n t a c t . F _ c u s t o m ]   =   t r u e ; 
 Z m C o n t a c t . I S _ A D D O N E [ Z m C o n t a c t . F _ i m A d d r e s s ]   =   t r u e ; 
 Z m C o n t a c t . I S _ A D D O N E [ Z m C o n t a c t . X _ o u t l o o k U s e r F i e l d ]   =   t r u e ; 
 
 / * * 
   *   G e t s   a n   i n d e x e d   a t t r i b u t e   n a m e   t a k i n g   i n t o   a c c o u n t   i f   t h e   f i e l d 
   *   w i t h   i n d e x   1   s h o u l d   a p p e n d   t h e   " 1 "   o r   n o t .   C o d e   s h o u l d   c a l l   t h i s 
   *   f u n c t i o n   i n   l i e u   o f   a c c e s s i n g   { @ l i n k   Z m C o n t a c t . I S _ A D D O N E }   d i r e c t l y . 
   * / 
 Z m C o n t a c t . g e t A t t r i b u t e N a m e   =   f u n c t i o n ( n a m e ,   i n d e x )   { 
 	 i n d e x   =   i n d e x   | |   1 ; 
 	 r e t u r n   i n d e x   >   1   | |   Z m C o n t a c t . I S _ A D D O N E [ n a m e ]   ?   n a m e + i n d e x   :   n a m e ; 
 } ; 
 
 / * * 
   *   R e t u r n s   a   s t r i n g   r e p r e s e n t a t i o n   o f   t h e   o b j e c t . 
   *   
   *   @ r e t u r n 	 	 { S t r i n g } 	 	 a   s t r i n g   r e p r e s e n t a t i o n   o f   t h e   o b j e c t 
   * / 
 Z m C o n t a c t . p r o t o t y p e . t o S t r i n g   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   " Z m C o n t a c t " ; 
 } ; 
 
 / /   C l a s s   m e t h o d s 
 
 / * * 
   *   C r e a t e s   a   c o n t a c t   f r o m   a n   X M L   n o d e . 
   * 
   *   @ p a r a m   { O b j e c t } 	 n o d e 	 	 a   " c n "   X M L   n o d e 
   *   @ p a r a m   { H a s h } 	 a r g s 	 	 a r g s   t o   p a s s   t o   t h e   c o n s t r u c t o r 
   *   @ r e t u r n 	 { Z m C o n t a c t } 	 t h e   c o n t a c t 
   * / 
 Z m C o n t a c t . c r e a t e F r o m D o m   = 
 f u n c t i o n ( n o d e ,   a r g s )   { 
 	 / /   c h e c k   g l o b a l   c a c h e   f o r   t h i s   i t e m   f i r s t 
 	 v a r   c o n t a c t   =   a p p C t x t . c a c h e G e t ( n o d e . i d ) ; 
 
 	 / /   m a k e   s u r e   t h e   r e v i s i o n   h a s n t   c h a n g e d ,   o t h e r w i s e   c o n t a c t   i s   o u t   o f   d a t e 
 	 i f   ( c o n t a c t   = =   n u l l   | |   ( c o n t a c t   & &   c o n t a c t . r e v   ! =   n o d e . r e v ) )   { 
 	 	 c o n t a c t   =   n e w   Z m C o n t a c t ( n o d e . i d ,   a r g s . l i s t ) ; 
 	 	 i f   ( a r g s . i s G a l )   { 
 	 	 	 c o n t a c t . i s G a l   =   a r g s . i s G a l ; 
 	 	 } 
 	 	 c o n t a c t . _ l o a d F r o m D o m ( n o d e ) ; 
 	 	 / / u p d a t e   t h e   c a n o n i c a l   l i s t 
 	 	 a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) . g e t C o n t a c t L i s t ( ) . a d d ( c o n t a c t ) ; 
 	 }   e l s e   { 
 	 	 i f   ( n o d e . m )   { 
 	 	 	 c o n t a c t . a t t r [ Z m C o n t a c t . F _ g r o u p s ]   =   n o d e . m ; 
 	 	 } 
 	 	 i f   ( n o d e . r e f )   { 
 	 	 	 c o n t a c t . r e f   =   n o d e . r e f ; 
 	 	 } 
 	 	 i f   ( n o d e . t n )   { 
 	 	 	 c o n t a c t . _ p a r s e T a g N a m e s ( n o d e . t n ) ; 
 	 	 } 
 	 	 A j x U t i l . h a s h U p d a t e ( c o n t a c t . a t t r ,   n o d e . _ a t t r s ) ; 	 / /   m e r g e   n e w   a t t r s   j u s t   i n   c a s e   w e   d o n ' t   h a v e   t h e m 
 	 	 c o n t a c t . l i s t   =   a r g s . l i s t   | |   n e w   Z m C o n t a c t L i s t ( n u l l ) ; 
 	 	 c o n t a c t . _ l i s t   =   { } ; 
 	 	 c o n t a c t . _ l i s t [ c o n t a c t . l i s t . i d ]   =   t r u e ; 
 	 } 
 	 / / S / M I M E :   I f   u s e r   c e r t i f i c a t e   i s   p r e s e n t ,   i n c l u d e   i t   i n t o   c o n t a c t ' s   o b j e c t 
 	 i f   ( n o d e . c e r t i f i c a t e )   { 
 	 	 c o n t a c t . c e r t i f i c a t e   =   n o d e . c e r t i f i c a t e ; 
 	 } 
 
 	 r e t u r n   c o n t a c t ; 
 } ; 
 
 / * * 
   *   C o m p a r e s   t w o   c o n t a c t s   b a s e d   o n   h o w   t h e y   a r e   f i l e d .   I n t e n d e d   f o r   u s e   b y 
   *   s o r t   m e t h o d s . 
   * 
   *   @ p a r a m   { Z m C o n t a c t } 	 	 a 	 	 a   c o n t a c t 
   *   @ p a r a m   { Z m C o n t a c t } 	 	 b 	 	 a   c o n t a c t 
   *   @ r e t u r n 	 { i n t } 	 0   i f   t h e   c o n t a c t s   a r e   t h e   s a m e ;   1   i f   " a "   i s   b e f o r e   " b " ;   - 1   i f   " b "   i s   b e f o r e   " a " 
   * / 
 Z m C o n t a c t . c o m p a r e B y F i l e A s   = 
 f u n c t i o n ( a ,   b )   { 
 	 v a r   a F i l e A s   =   ( a   i n s t a n c e o f   Z m C o n t a c t )   ?   a . g e t F i l e A s ( t r u e )   :   Z m C o n t a c t . c o m p u t e F i l e A s ( a . _ a t t r s ) . t o L o w e r C a s e ( ) ; 
 	 v a r   b F i l e A s   =   ( b   i n s t a n c e o f   Z m C o n t a c t )   ?   b . g e t F i l e A s ( t r u e )   :   Z m C o n t a c t . c o m p u t e F i l e A s ( b . _ a t t r s ) . t o L o w e r C a s e ( ) ; 
 
 	 i f   ( ! b F i l e A s   | |   ( a F i l e A s   >   b F i l e A s ) )   r e t u r n   1 ; 
 	 i f   ( a F i l e A s   <   b F i l e A s )   r e t u r n   - 1 ; 
 	 r e t u r n   0 ; 
 } ; 
 
 / * * 
   *   F i g u r e s   o u t   t h e   f i l i n g   s t r i n g   f o r   t h e   c o n t a c t   a c c o r d i n g   t o   t h e   c h o s e n   m e t h o d . 
   * 
   *   @ p a r a m   { Z m C o n t a c t | H a s h } 	 c o n t a c t 	 	 a   c o n t a c t   o r   a   h a s h   o f   c o n t a c t   a t t r i b u t e s 
   * / 
 Z m C o n t a c t . c o m p u t e F i l e A s   = 
 f u n c t i o n ( c o n t a c t )   { 
 	 / * 
 	   *   B u g   9 8 1 7 6 :   T o   k e e p   t h e   s a m e   l o g i c   o f   g e n e r a t i n g   t h e   F i l e A s   c o n t a c t 
 	   *         l a b e l   s t r i n g   b e t w e e n   t h e   A j a x   c l i e n t ,   a n d   H T M L   c l i e n t ,   w h e n   t h e 
 	   *         c o m p u t e F i l e A s ( ) ,   a n d   f i l e A s * ( )   f u n c t i o n s   a r e   m o d i f i e d ,   p l e a s e 
 	   *         c h a n g e   t h e   c o r r e s p o n d i n g   f u n c t i o n s   d e f i n e d   i n   t h e   a u t o C o m p l e t e . t a g 
 	   * / 
 	 v a r   a t t r   =   ( c o n t a c t   i n s t a n c e o f   Z m C o n t a c t )   ?   c o n t a c t . g e t A t t r s ( )   :   c o n t a c t ; 
 	 i f   ( ! a t t r )   r e t u r n ; 
 
 	 i f   ( a t t r [ Z m C o n t a c t . F _ d l D i s p l a y N a m e ] )   { 
 	 	 / / t h i s   i s   o n l y   D L   c a s e .   B u t   s i n c e   t h i s   i s   s o m e t i m e s   j u s t   t h e   a t t r s , 
 	 	 / / I   c a n ' t   a l w a y s   u s e   i s D i s t r i b u t i o n L i s t   m e t h o d . 
 	 	 r e t u r n   a t t r [ Z m C o n t a c t . F _ d l D i s p l a y N a m e ] ; 
 	 } 
 
 	 v a r   v a l   =   p a r s e I n t ( a t t r . f i l e A s ) ; 
 	 v a r   f a ; 
 	 v a r   i d x   =   0 ; 
 
 	 s w i t c h   ( v a l )   { 
 	 	 c a s e   Z m C o n t a c t . F A _ L A S T _ C _ F I R S T :   	 	 	 	 	 	 	 	 	 	 / /   L a s t ,   F i r s t 
 	 	 d e f a u l t :   { 
 	 	 	 / /   i f   G A L   c o n t a c t ,   u s e   f u l l   n a m e   i n s t e a d   ( b u g   f i x   # 4 8 5 0 , 4 0 0 9 ) 
 	 	 	 i f   ( c o n t a c t   & &   c o n t a c t . i s G a l )   { 
 	 	 	 	 i f   ( a t t r . f u l l N a m e )   {   / /   b u g   f i x   # 2 7 4 2 8   -   i f   f u l l N a m e   i s   A r r a y ,   r e t u r n   f i r s t 
 	 	 	 	 	 r e t u r n   ( a t t r . f u l l N a m e   i n s t a n c e o f   A r r a y )   ?   a t t r . f u l l N a m e [ 0 ]   :   a t t r . f u l l N a m e ; 
 	 	 	 	 } 
 	 	 	 	 r e t u r n   ( ( a t t r . e m a i l   i n s t a n c e o f   A r r a y )   ?   a t t r . e m a i l [ 0 ]   :   a t t r . e m a i l ) ; 
 	 	 	 } 
 	 	 	 f a   =   Z m C o n t a c t . f i l e A s L a s t F i r s t ( a t t r . f i r s t N a m e ,   a t t r . l a s t N a m e ,   a t t r . f u l l N a m e ,   a t t r . n i c k n a m e ) ; 
 	 	 } 
 	 	 b r e a k ; 
 
 	 	 c a s e   Z m C o n t a c t . F A _ F I R S T _ L A S T :   {   	 	 	 	 	 	 	 	 	 	 / /   F i r s t   L a s t 
 	 	 	 f a   =   Z m C o n t a c t . f i l e A s F i r s t L a s t ( a t t r . f i r s t N a m e ,   a t t r . l a s t N a m e ,   a t t r . f u l l N a m e ,   a t t r . n i c k n a m e ) ; 
 	 	 } 
 	 	 b r e a k ; 
 
 	 	 c a s e   Z m C o n t a c t . F A _ C O M P A N Y :   { 	 	 	 	 	 	 	 	 	 	 	 / /   C o m p a n y 
 	 	 	 i f   ( a t t r . c o m p a n y )   f a   =   a t t r . c o m p a n y ; 
 	 	 } 
 	 	 b r e a k ; 
 
 	 	 c a s e   Z m C o n t a c t . F A _ L A S T _ C _ F I R S T _ C O M P A N Y :   { 	 	 	 	 	 	 	 	 / /   L a s t ,   F i r s t   ( C o m p a n y ) 
 	 	 	 v a r   n a m e   =   Z m C o n t a c t . f i l e A s L a s t F i r s t ( a t t r . f i r s t N a m e ,   a t t r . l a s t N a m e ,   a t t r . f u l l N a m e ,   a t t r . n i c k n a m e ) ; 
 	 	 	 f a   =   Z m C o n t a c t . f i l e A s N a m e C o m p a n y ( n a m e ,   a t t r . c o m p a n y ) ; 
 	 	 } 
 	 	 b r e a k ; 
 
 	 	 c a s e   Z m C o n t a c t . F A _ F I R S T _ L A S T _ C O M P A N Y :   { 	 	 	 	 	 	 	 	 	 / /   F i r s t   L a s t   ( C o m p a n y ) 
 	 	 	 v a r   n a m e   =   Z m C o n t a c t . f i l e A s F i r s t L a s t ( a t t r . f i r s t N a m e ,   a t t r . l a s t N a m e ,   a t t r . f u l l N a m e ,   a t t r . n i c k n a m e ) ; 
 	 	 	 f a   =   Z m C o n t a c t . f i l e A s N a m e C o m p a n y ( n a m e ,   a t t r . c o m p a n y ) ; 
 	 	 } 
 	 	 b r e a k ; 
 
 	 	 c a s e   Z m C o n t a c t . F A _ C O M P A N Y _ L A S T _ C _ F I R S T :   { 	 	 	 	 	 	 	 	 / /   C o m p a n y   ( L a s t ,   F i r s t ) 
 	 	 	 v a r   n a m e   =   Z m C o n t a c t . f i l e A s L a s t F i r s t ( a t t r . f i r s t N a m e ,   a t t r . l a s t N a m e ) ; 
 	 	 	 f a   =   Z m C o n t a c t . f i l e A s C o m p a n y N a m e ( n a m e ,   a t t r . c o m p a n y ) ; 
 	 	 } 
 	 	 b r e a k ; 
 
 	 	 c a s e   Z m C o n t a c t . F A _ C O M P A N Y _ F I R S T _ L A S T :   { 	 	 	 	 	 	 	 	 	 / /   C o m p a n y   ( F i r s t   L a s t ) 
 	 	 	 v a r   n a m e   =   Z m C o n t a c t . f i l e A s F i r s t L a s t ( a t t r . f i r s t N a m e ,   a t t r . l a s t N a m e ) ; 
 	 	 	 f a   =   Z m C o n t a c t . f i l e A s C o m p a n y N a m e ( n a m e ,   a t t r . c o m p a n y ) ; 
 	 	 } 
 	 	 b r e a k ; 
 
 	 	 c a s e   Z m C o n t a c t . F A _ C U S T O M :   { 	 	 	 	 	 	 	 	 	 	 	 	 / /   c u s t o m   l o o k s   l i k e   t h i s :   " 8 : f o o b a r " 
 	 	 	 r e t u r n   a t t r . f i l e A s . s u b s t r i n g ( 2 ) ; 
 	 	 } 
 	 	 b r e a k ; 
 	 } 
 	 r e t u r n   f a   | |   a t t r . f u l l N a m e   | |   " " ; 
 } ; 
 
 / * * 
   *   N a m e   p r i n t i n g   h e l p e r   " F i r s t   L a s t " . 
   *   
   *   @ p a r a m 	 { S t r i n g } 	 f i r s t 	 	 t h e   f i r s t   n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 l a s t 	 	 t h e   l a s t   n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 f u l l n a m e 	 	 t h e   f u l l n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 n i c k n a m e 	 	 t h e   n i c k n a m e 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   n a m e   f o r m a t 
   * / 
 Z m C o n t a c t . f i l e A s F i r s t L a s t   = 
 f u n c t i o n ( f i r s t ,   l a s t ,   f u l l n a m e ,   n i c k n a m e )   { 
 	 i f   ( f i r s t   & &   l a s t ) 
 	 	 r e t u r n   A j x M e s s a g e F o r m a t . f o r m a t ( Z m M s g . f i l e A s F i r s t L a s t ,   [ f i r s t ,   l a s t ] ) ; 
 	 r e t u r n   f i r s t   | |   l a s t   | |   f u l l n a m e   | |   n i c k n a m e   | |   " " ; 
 } ; 
 
 / * * 
   *   N a m e   p r i n t i n g   h e l p e r   " L a s t ,   F i r s t " . 
   *   
   *   @ p a r a m 	 { S t r i n g } 	 f i r s t 	 	 t h e   f i r s t   n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 l a s t 	 	 t h e   l a s t   n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 f u l l n a m e 	 	 t h e   f u l l n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 n i c k n a m e 	 	 t h e   n i c k n a m e 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   n a m e   f o r m a t 
   * / 
 Z m C o n t a c t . f i l e A s L a s t F i r s t   = 
 f u n c t i o n ( f i r s t ,   l a s t ,   f u l l n a m e ,   n i c k n a m e )   { 
 	 i f   ( f i r s t   & &   l a s t ) 
 	 	 r e t u r n   A j x M e s s a g e F o r m a t . f o r m a t ( Z m M s g . f i l e A s L a s t F i r s t ,   [ f i r s t ,   l a s t ] ) ; 
 	 r e t u r n   l a s t   | |   f i r s t   | |   f u l l n a m e   | |   n i c k n a m e   | |   " " ; 
 } ; 
 
 / * * 
   *   N a m e   p r i n t i n g   h e l p e r   " N a m e   ( C o m p a n y ) " . 
   * 
   *   @ p a r a m 	 { S t r i n g } 	 n a m e 	 	 t h e   c o n t a c t   n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 c o m p a n y 	 	 t h e   c o m p a n y 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   n a m e   f o r m a t 
   * / 
 Z m C o n t a c t . f i l e A s N a m e C o m p a n y   = 
 f u n c t i o n ( n a m e ,   c o m p a n y )   { 
 	 i f   ( n a m e   & &   c o m p a n y ) 
 	 	 r e t u r n   A j x M e s s a g e F o r m a t . f o r m a t ( Z m M s g . f i l e A s N a m e C o m p a n y ,   [ n a m e ,   c o m p a n y ] ) ; 
 	 i f   ( c o m p a n y ) 
 	 	 r e t u r n   A j x M e s s a g e F o r m a t . f o r m a t ( Z m M s g . f i l e A s C o m p a n y A s S e c o n d a r y O n l y ,   [ c o m p a n y ] ) ; 
 	 r e t u r n   n a m e ; 
 } ; 
 
 / * * 
   *   N a m e   p r i n t i n g   h e l p e r   " C o m p a n y   ( N a m e ) " . 
   *   
   *   @ p a r a m 	 { S t r i n g } 	 n a m e 	 	 t h e   c o n t a c t   n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 c o m p a n y 	 	 t h e   c o m p a n y 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   n a m e   f o r m a t 
   * / 
 Z m C o n t a c t . f i l e A s C o m p a n y N a m e   = 
 f u n c t i o n ( n a m e ,   c o m p a n y )   { 
 	 i f   ( c o m p a n y   & &   n a m e ) 
 	 	 r e t u r n   A j x M e s s a g e F o r m a t . f o r m a t ( Z m M s g . f i l e A s C o m p a n y N a m e ,   [ n a m e ,   c o m p a n y ] ) ; 
 	 i f   ( n a m e ) 
 	 	 r e t u r n   A j x M e s s a g e F o r m a t . f o r m a t ( Z m M s g . f i l e A s N a m e A s S e c o n d a r y O n l y ,   [ n a m e ] ) ; 
 	 r e t u r n   c o m p a n y ; 
 } ; 
 
 / * * 
   *   C o m p u t e s   t h e   c u s t o m   f i l e   a s   s t r i n g   b y   p r e p e n d i n g   " 8 : "   t o   t h e   g i v e n   c u s t o m   f i l e A s   s t r i n g . 
   *   
   *   @ p a r a m   { H a s h } 	 c u s t o m F i l e A s 	 a   s e t   o f   c o n t a c t   a t t r i b u t e s 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   n a m e   f o r m a t 
   * / 
 Z m C o n t a c t . c o m p u t e C u s t o m F i l e A s   = 
 f u n c t i o n ( c u s t o m F i l e A s )   { 
 	 r e t u r n   [ Z m C o n t a c t . F A _ C U S T O M ,   " : " ,   c u s t o m F i l e A s ] . j o i n ( " " ) ; 
 } ; 
 
 / * 
   *   
   *   T h e s e   n e x t   f e w   s t a t i c   m e t h o d s   h a n d l e   a   c o n t a c t   t h a t   i s   e i t h e r   a n   a n o n y m o u s 
   *   o b j e c t   o r   a n   a c t u a l   Z m C o n t a c t .   T h e   f o r m e r   i s   u s e d   t o   o p t i m i z e   l o a d i n g .   T h e 
   *   a n o n y m o u s   o b j e c t   i s   u p g r a d e d   t o   a   Z m C o n t a c t   w h e n   n e e d e d . 
   *     
   * / 
 
 / * * 
   *   G e t s   a n   a t t r i b u t e . 
   *   
   *   @ p a r a m 	 { Z m C o n t a c t } 	 c o n t a c t 	 	 t h e   c o n t a c t 
   *   @ p a r a m 	 { S t r i n g } 	 a t t r 	 	 t h e   a t t r i b u t e 
   *   @ r e t u r n 	 { O b j e c t } 	 t h e   a t t r i b u t e   v a l u e   o r   < c o d e > n u l l < / c o d e >   f o r   n o n e 
   * / 
 Z m C o n t a c t . g e t A t t r   = 
 f u n c t i o n ( c o n t a c t ,   a t t r )   { 
 	 r e t u r n   ( c o n t a c t   i n s t a n c e o f   Z m C o n t a c t ) 
 	 	 ?   c o n t a c t . g e t A t t r ( a t t r ) 
 	 	 :   ( c o n t a c t   & &   c o n t a c t . _ a t t r s )   ?   c o n t a c t . _ a t t r s [ a t t r ]   :   n u l l ; 
 } ; 
 
 / * * 
   *   r e t u r n s   t h e   p r e f i x   o f   a   s t r i n g   i n   t h e   f o r m a t   " a b c 1 2 3 " .   ( w o u l d   r e t u r n   " a b c " ) .   I f   t h e   s t r i n g   i s   a l l   n u m b e r ,   i t ' s   a   s p e c i a l   c a s e   a n d   r e t u r n s   t h e   s t r i n g   i t s e l f .   e . g .   " 2 3 4 "   w o u l d   r e t u r n   " 2 3 4 " . 
   * / 
 Z m C o n t a c t . g e t P r e f i x   =   f u n c t i o n ( s )   { 
 	 v a r   t r i m m e d   =   s . r e p l a c e ( / \ d + $ / ,   " " ) ; 
 	 i f   ( t r i m m e d   = = =   " " )   { 
 	 	 / / n u m b e r   o n l y   -   d o n ' t   t r i m .   T h e   n u m b e r   i s   t h e   p r e f i x . 
 	 	 r e t u r n   s ; 
 	 } 
 	 r e t u r n   t r i m m e d ; 
 } ; 
 
 / * * 
   *   N o r m a l i z e s   t h e   n u m b e r i n g   o f   t h e   g i v e n   a t t r i b u t e   n a m e s   a n d 
   *   r e t u r n s   a   n e w   o b j e c t   w i t h   t h e   r e - n u m b e r e d   a t t r i b u t e s .   F o r 
   *   e x a m p l e ,   i f   t h e   a t t r i b u t e s   c o n t a i n s   a   " f o o 2 "   b u t   n o   " f o o " , 
   *   t h e n   t h e   " f o o 2 "   a t t r i b u t e   w i l l   b e   r e n a m e d   t o   " f o o "   i n   t h e 
   *   r e t u r n e d   o b j e c t . 
   * 
   *   @ p a r a m   { H a s h } 	 a t t r s     a   h a s h   o f   a t t r i b u t e s   t o   n o r m a l i z e . 
   *   @ p a r a m   { S t r i n g } 	 [ p r e f i x ]   i f   s p e c i f i e d ,   o n l y   t h e   t h e   a t t r i b u t e s   t h a t   m a t c h   t h e   g i v e n   p r e f i x   w i l l   b e   r e t u r n e d 
   *   @ p a r a m   { A r r a y } 	 [ i g n o r e ]   i f   s p e c i f i e d ,   t h e   a t t r i b u t e s   t h a t   a r e   p r e s e n t   i n   t h e   a r r a y   w i l l   n o t   b e   n o r m a l i z e d 
   *   @ r e t u r n 	 { H a s h } 	 a   h a s h   o f   n o r m a l i z e d   a t t r i b u t e s 
   * / 
 Z m C o n t a c t . g e t N o r m a l i z e d A t t r s   =   f u n c t i o n ( a t t r s ,   p r e f i x ,   i g n o r e )   { 
 	 v a r   n a t t r s   =   { } ; 
 	 i f   ( a t t r s )   { 
 	 	 / /   n o r m a l i z e   a t t r i b u t e   n u m b e r i n g 
 	 	 v a r   n a m e s   =   A j x U t i l . k e y s ( a t t r s ) ; 
 	 	 n a m e s . s o r t ( Z m C o n t a c t . _ _ B Y _ A T T R I B U T E ) ; 
 	 	 v a r   a   =   { } ; 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   n a m e s . l e n g t h ;   i + + )   { 
 	 	 	 v a r   n a m e   =   n a m e s [ i ] ; 
 	 	 	 / /   g e t   c u r r e n t   c o u n t 
 	 	 	 v a r   n p r e f i x   =   Z m C o n t a c t . g e t P r e f i x ( n a m e ) ; 
 	 	 	 i f   ( p r e f i x   & &   p r e f i x   ! =   n p r e f i x )   c o n t i n u e ; 
 	 	 	 i f   ( A j x U t i l . i s A r r a y ( i g n o r e )   & &   A j x U t i l . i n d e x O f ( i g n o r e ,   n p r e f i x ) ! = - 1 )   { 
 	 	 	 	 n a t t r s [ n a m e ]   =   a t t r s [ n a m e ] ; 
 	 	 	 }   e l s e   { 
 	 	 	 	 i f   ( ! a [ n p r e f i x ] )   a [ n p r e f i x ]   =   0 ; 
 	 	 	 	 / /   n o r m a l i z e ,   i f   n e e d e d 
 	 	 	 	 v a r   n n a m e   =   Z m C o n t a c t . g e t A t t r i b u t e N a m e ( n p r e f i x ,   + + a [ n p r e f i x ] ) ; 
 	 	 	 	 n a t t r s [ n n a m e ]   =   a t t r s [ n a m e ] ; 
 	 	 	 } 
 	 	 } 
 	 } 
 	 r e t u r n   n a t t r s ; 
 } ; 
 
 Z m C o n t a c t . _ _ R E _ A T T R I B U T E   =   / ^ ( . * ? ) ( \ d + ) $ / ; 
 Z m C o n t a c t . _ _ B Y _ A T T R I B U T E   =   f u n c t i o n ( a ,   b )   { 
 	 v a r   a a   =   a . m a t c h ( Z m C o n t a c t . _ _ R E _ A T T R I B U T E )   | |   [ a , a , 1 ] ; 
 	 v a r   b b   =   b . m a t c h ( Z m C o n t a c t . _ _ R E _ A T T R I B U T E )   | |   [ b , b , 1 ] ; 
 	 r e t u r n   a a [ 1 ]   = =   b b [ 1 ]   ?   N u m b e r ( a a [ 2 ] )   -   N u m b e r ( b b [ 2 ] )   :   a a [ 1 ] . l o c a l e C o m p a r e ( b b [ 1 ] ) ; 
 } ; 
 
 / * * 
   *   S e t s   t h e   a t t r i b u t e . 
   *   
   *   @ p a r a m 	 { Z m C o n t a c t } 	 c o n t a c t 	 	 t h e   c o n t a c t 
   *   @ p a r a m 	 { S t r i n g } 	 a t t r 	 	 t h e   a t t r i b u t e 
   *   @ p a r a m 	 { O b j e c t } 	 v a l u e 	 	 t h e   a t t r i b u t e   v a l u e 
   * / 
 Z m C o n t a c t . s e t A t t r   = 
 f u n c t i o n ( c o n t a c t ,   a t t r ,   v a l u e )   { 
 	 i f   ( c o n t a c t   i n s t a n c e o f   Z m C o n t a c t ) 
 	 	 c o n t a c t . s e t A t t r ( a t t r ,   v a l u e ) ; 
 	 e l s e 
 	 	 c o n t a c t . _ a t t r s [ a t t r ]   =   v a l u e ; 
 } ; 
 
 / * * 
   *   C h e c k s   i f   t h e   c o n t a c t   i s   i n   t h e   t r a s h . 
   *   
   *   @ p a r a m 	 { Z m C o n t a c t } 	 c o n t a c t 	 	 t h e   c o n t a c t 
   *   @ r e t u r n 	 { B o o l e a n } 	 < c o d e > t r u e < / c o d e >   i f   i n   t r a s h 
   * / 
 Z m C o n t a c t . i s I n T r a s h   = 
 f u n c t i o n ( c o n t a c t )   { 
 	 v a r   f o l d e r I d   =   ( c o n t a c t   i n s t a n c e o f   Z m C o n t a c t )   ?   c o n t a c t . f o l d e r I d   :   c o n t a c t . l ; 
 	 v a r   f o l d e r   =   a p p C t x t . g e t B y I d ( f o l d e r I d ) ; 
 	 r e t u r n   ( f o l d e r   & &   f o l d e r . i s I n T r a s h ( ) ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . l o a d   = 
 f u n c t i o n ( c a l l b a c k ,   e r r o r C a l l b a c k ,   b a t c h C m d ,   d e r e f )   { 
 	 v a r   j s o n O b j   =   { G e t C o n t a c t s R e q u e s t : { _ j s n s : " u r n : z i m b r a M a i l " } } ; 
 	 i f   ( d e r e f )   { 
 	 	 j s o n O b j . G e t C o n t a c t s R e q u e s t . d e r e f G r o u p M e m b e r   =   " 1 " ; 
 	 } 
 	 j s o n O b j . G e t C o n t a c t s R e q u e s t . r e t u r n C e r t I n f o   =   " 1 " ;   / / F i x   f o r :   Z C S - 9 9 9   a n d   Z C S - 9 9 1 
 	 v a r   r e q u e s t   =   j s o n O b j . G e t C o n t a c t s R e q u e s t ; 
 	 r e q u e s t . c n   =   [ { i d : t h i s . i d } ] ; 
 
 	 v a r   r e s p C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e L o a d R e s p o n s e ,   [ c a l l b a c k ] ) ; 
 
 	 i f   ( b a t c h C m d )   { 
 	 	 v a r   j s o n O b j   =   { G e t C o n t a c t s R e q u e s t : { _ j s n s : " u r n : z i m b r a M a i l " } } ; 
 	 	 i f   ( d e r e f )   { 
 	 	 	 j s o n O b j . G e t C o n t a c t s R e q u e s t . d e r e f G r o u p M e m b e r   =   " 1 " ; 
 	 	 } 
 	 	 j s o n O b j . G e t C o n t a c t s R e q u e s t . r e t u r n C e r t I n f o   =   " 1 " ;   / / F i x   f o r :   Z C S - 9 9 9   a n d   Z C S - 9 9 1 
 	 	 j s o n O b j . G e t C o n t a c t s R e q u e s t . c n   =   { i d : t h i s . i d } ; 
 	 	 b a t c h C m d . a d d R e q u e s t P a r a m s ( j s o n O b j ,   r e s p C a l l b a c k ,   e r r o r C a l l b a c k ) ; 
 	 }   e l s e   { 
 	 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { j s o n O b j : j s o n O b j , 
 	 	 	 	 	 	 	 	 	 	 	 	 a s y n c M o d e : t r u e , 
 	 	 	 	 	 	 	 	 	 	 	 	 c a l l b a c k : r e s p C a l l b a c k , 
 	 	 	 	 	 	 	 	 	 	 	 	 e r r o r C a l l b a c k : e r r o r C a l l b a c k } ) ; 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e L o a d R e s p o n s e   = 
 f u n c t i o n ( c a l l b a c k ,   r e s u l t )   { 
 	 v a r   r e s p   =   r e s u l t . g e t R e s p o n s e ( ) . G e t C o n t a c t s R e s p o n s e ; 
 
 	 / /   f o r   n o w ,   w e   j u s t   a s s u m e   o n l y   o n e   c o n t a c t   w a s   r e q u e s t e d   a t   a   t i m e 
 	 v a r   c o n t a c t   =   r e s p . c n [ 0 ] ; 
 	 t h i s . a t t r   =   c o n t a c t . _ a t t r s ; 
 	 i f   ( c o n t a c t . m )   { 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   c o n t a c t . m . l e n g t h ;   i + + )   { 
 	 	 	 / / c a c h e   c o n t a c t s   f r o m   c o n t a c t   g r o u p s   ( e . g .   G A L   c o n t a c t s ,   s h a r e d   c o n t a c t s   h a v e   n o t   a l r e a d y   b e e n   c a c h e d ) 
 	 	 	 v a r   m e m b e r   =   c o n t a c t . m [ i ] ; 
 	 	 	 v a r   i s G a l   =   f a l s e ; 
 	 	 	 i f   ( m e m b e r . t y p e   = =   Z m C o n t a c t . G R O U P _ G A L _ R E F )   { 
 	 	 	 	 i s G a l   =   t r u e ; 
 	 	 	 } 
 	 	 	 i f   ( m e m b e r . c n   & &   m e m b e r . c n . l e n g t h   >   0 )   { 
 	 	 	 	 v a r   m e m b e r C o n t a c t   =   m e m b e r . c n [ 0 ] ; 
 	 	 	 	 m e m b e r C o n t a c t . r e f   =   m e m b e r C o n t a c t . r e f   | |   ( i s G a l   & &   m e m b e r . v a l u e ) ;   / / w e   s o m e t i m e s   d o n ' t   g e t   " r e f "   b u t   t h e   " v a l u e "   f o r   G A L   i s   t h e   r e f . 
 	 	 	 	 v a r   l o a d M e m b e r   =   Z m C o n t a c t . c r e a t e F r o m D o m ( m e m b e r C o n t a c t ,   { l i s t :   t h i s . l i s t ,   i s G a l :   i s G a l } ) ;   / / p a s s   G A L   s o   f i l e A S   g e t s   s e t   c o r r e c t l y 
 	 	 	 	 l o a d M e m b e r . i s D L   =   i s G a l   & &   l o a d M e m b e r . a t t r [ Z m C o n t a c t . F _ t y p e ]   = =   " g r o u p " ; 
 	 	 	 	 a p p C t x t . c a c h e S e t ( m e m b e r . v a l u e ,   l o a d M e m b e r ) ; 
 	 	 	 } 
 	 	 	 
 	 	 } 
 	 	 t h i s . _ l o a d F r o m D o m ( c o n t a c t ) ;   / / l o a d   g r o u p 
 	 } 
 	 t h i s . i s L o a d e d   =   t r u e ; 
 	 i f   ( c a l l b a c k )   { 
 	 	 c a l l b a c k . r u n ( c o n t a c t ,   t h i s ) ; 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . c l e a r   = 
 f u n c t i o n ( )   { 
 	 / /   b u g   f i x   # 4 1 6 6 6   -   o v e r r i d e   b a s e   c l a s s   m e t h o d   a n d   d o   n o t h i n g 
 } ; 
 
 / * * 
   *   C h e c k s   i f   t h e   c o n t a c t   a t t r i b u t e s   a r e   e m p t y . 
   *   
   *   @ r e t u r n 	 { B o o l e a n } 	 < c o d e > t r u e < / c o d e >   i f   e m p t y 
   * / 
 Z m C o n t a c t . p r o t o t y p e . i s E m p t y   = 
 f u n c t i o n ( )   { 
 	 f o r   ( v a r   i   i n   t h i s . a t t r )   { 
 	 	 r e t u r n   f a l s e ; 
 	 } 
 	 r e t u r n   t r u e ; 
 } ; 
 
 / * * 
   *   C h e c k s   i f   t h e   c o n t a c t   i s   s h a r e d . 
   *   
   *   @ r e t u r n 	 { B o o l e a n } 	 < c o d e > t r u e < / c o d e >   i f   s h a r e d 
   * / 
 Z m C o n t a c t . p r o t o t y p e . i s S h a r e d   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   t h i s . a d d r b o o k   & &   t h i s . a d d r b o o k . l i n k ; 
 } ; 
 
 / * * 
   *   C h e c k s   i f   t h e   c o n t a c t   i s   r e a d - o n l y . 
   *   
   *   @ r e t u r n 	 { B o o l e a n } 	 < c o d e > t r u e < / c o d e >   i f   r e a d - o n l y 
   * / 
 Z m C o n t a c t . p r o t o t y p e . i s R e a d O n l y   = 
 f u n c t i o n ( )   { 
 	 i f   ( t h i s . i s G a l )   {   r e t u r n   t r u e ;   } 
 
 	 r e t u r n   t h i s . i s S h a r e d ( ) 
 	 	 ?   t h i s . a d d r b o o k   & &   t h i s . a d d r b o o k . i s R e a d O n l y ( ) 
 	 	 :   f a l s e ; 
 } ; 
 
 / * * 
   *   C h e c k s   i f   t h e   c o n t a c t   i s   l o c k e d .   T h i s   i s   d i f f e r e n t   f o r   D L s   t h a n   r e a d - o n l y . 
   * 
   *   @ r e t u r n 	 { B o o l e a n } 	 < c o d e > t r u e < / c o d e >   i f   r e a d - o n l y 
   * / 
 Z m C o n t a c t . p r o t o t y p e . i s L o c k e d   = 
 f u n c t i o n ( )   { 
 	 i f   ( ! t h i s . i s D i s t r i b u t i o n L i s t ( ) )   { 
 	 	 r e t u r n   t h i s . i s R e a d O n l y ( ) ; 
 	 } 
 	 i f   ( ! t h i s . d l I n f o )   { 
 	 	 r e t u r n   f a l s e ;   / / r a r e   c a s e   a f t e r   e d i t i n g   b y   a n   o w n e r   i f   t h e   f i l e A s C h a n g e d ,   t h e   n e w   d l   I n f o   s t i l l   n o t   r e a d ,   a n d   t h e   l a y o u t   r e - d o n e .   S o   d o n ' t   s h o w   t h e   l o c k . 
 	 } 
 	 v a r   d l I n f o   =   t h i s . d l I n f o ; 
 	 i f   ( d l I n f o . i s O w n e r )   { 
 	 	 r e t u r n   f a l s e ; 
 	 } 
 	 i f   ( d l I n f o . i s M e m b e r )   { 
         	 r e t u r n   d l I n f o . u n s u b s c r i p t i o n P o l i c y   = =   Z m C o n t a c t S p l i t V i e w . S U B S C R I P T I O N _ P O L I C Y _ R E J E C T ; 
 	 } 
 	 r e t u r n   d l I n f o . s u b s c r i p t i o n P o l i c y   = =   Z m C o n t a c t S p l i t V i e w . S U B S C R I P T I O N _ P O L I C Y _ R E J E C T ; 
 } ; 
 
 / * * 
   *   C h e c k s   i f   t h e   c o n t a c t   i s   a   g r o u p . 
   *   
   *   @ r e t u r n 	 { B o o l e a n } 	 < c o d e > t r u e < / c o d e >   i f   a   g r o u p 
   * / 
 Z m C o n t a c t . p r o t o t y p e . i s G r o u p   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   t h i s . g e t A t t r ( Z m C o n t a c t . F _ t y p e )   = =   " g r o u p "   | |   t h i s . t y p e   = =   Z m I t e m . G R O U P ; 
 } ; 
 
 / * * 
   *   C h e c k s   i f   t h e   c o n t a c t   i s   a   D L . 
   * 
   *   @ r e t u r n 	 { B o o l e a n } 	 < c o d e > t r u e < / c o d e >   i f   a   g r o u p 
   * / 
 Z m C o n t a c t . p r o t o t y p e . i s D i s t r i b u t i o n L i s t   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   t h i s . i s G a l   & &   t h i s . i s G r o u p ( ) ; 
 } ; 
 
 
 / /   p a r s e s   " g r o u p s "   a t t r   i n t o   A j x E m a i l A d d r e s s   o b j e c t s   s t o r e d   i n   3   v e c t o r s   ( a l l ,   g o o d ,   a n d   b a d ) 
 / * * 
   *   G e t s   t h e   g r o u p   m e m b e r s . 
   * 
   *   @ r e t u r n 	 { A j x V e c t o r } 	 	 t h e   g r o u p   m e m b e r s   o r   < c o d e > n u l l < / c o d e >   i f   n o t   g r o u p 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t G r o u p M e m b e r s   = 
 f u n c t i o n ( )   { 
 	 v a r   a l l M e m b e r s   =   t h i s . g e t A l l G r o u p M e m b e r s ( ) ; 
 	 v a r   a d d r s   =   [ ] ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   a l l M e m b e r s . l e n g t h ;   i + + )   { 
 	 	 a d d r s . p u s h ( a l l M e m b e r s [ i ] . t o S t r i n g ( ) ) ; 
 	 } 
 	 r e t u r n   A j x E m a i l A d d r e s s . p a r s e E m a i l S t r i n g ( a d d r s . j o i n ( " ,   " ) ) ; 
 } ; 	 
 
 / * * 
   *   p a r s e s   " g r o u p s "   a t t r   i n t o   a n   A j x E m a i l A d d r e s s   w i t h   a   f e w   e x t r a   a t t r i b u t e s   ( s e e   Z m C o n t a c t s H e l p e r . _ w r a p I n l i n e C o n t a c t ) 
   *   
   *   @ r e t u r n 	 { A j x V e c t o r } 	 	 t h e   g r o u p   m e m b e r s   o r   < c o d e > n u l l < / c o d e >   i f   n o t   g r o u p 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t A l l G r o u p M e m b e r s   = 
 f u n c t i o n ( )   { 
 
 	 i f   ( t h i s . i s D i s t r i b u t i o n L i s t ( ) )   { 
 	 	 r e t u r n   t h i s . d l M e m b e r s ; 
 	 } 
 
 	 v a r   a d d r s   =   [ ] ; 
 
 	 v a r   g r o u p M e m b e r s   =   t h i s . a t t r [ Z m C o n t a c t . F _ g r o u p s ] ; 
 	 i f   ( ! g r o u p M e m b e r s ) { 
 	 	 r e t u r n   A j x E m a i l A d d r e s s . p a r s e E m a i l S t r i n g ( t h i s . a t t r [ Z m C o n t a c t . F _ e m a i l ] ) ;     / / I   d o u b t   t h i s   i s   n e e d e d   o r   w o r k s   c o r r e c t l y ,   b u t   I   k e e p   t h i s   l o g i c   f r o m   b e f o r e .   I f   w e   d o n ' t   h a v e   t h e   g r o u p   m e m b e r s ,   h o w   c a n   w e   r e t u r n   t h e   g r o u p   e m a i l   i n s t e a d ? 
 	 } 
 	 f o r   ( v a r   i   =   0 ;   i   <   g r o u p M e m b e r s . l e n g t h ;   i + + )   { 
 	 	 v a r   m e m b e r   =   g r o u p M e m b e r s [ i ] ; 
 	 	 v a r   t y p e   =   m e m b e r . t y p e ; 
 	 	 v a r   v a l u e   =   m e m b e r . v a l u e ; 
 	 	 i f   ( t y p e   = =   Z m C o n t a c t . G R O U P _ I N L I N E _ R E F )   { 
 	 	 	 a d d r s . p u s h ( Z m C o n t a c t s H e l p e r . _ w r a p I n l i n e C o n t a c t ( v a l u e ) ) ; 
 	 	 } 
 	 	 e l s e   { 
 	 	 	 v a r   c o n t a c t   =   Z m C o n t a c t . g e t C o n t a c t F r o m C a c h e ( v a l u e ) ; 	   / / T O D O :   h a n d l e   c o n t a c t s   n o t   c a c h e d ? 
 	 	 	 i f   ( ! c o n t a c t )   { 
 	 	 	 	 D B G . p r i n t l n ( A j x D e b u g . D B G 1 ,   " D i s r e g a r d i n g   u n c a c h e d   c o n t a c t :   "   +   v a l u e ) ; 
 	 	 	 	 c o n t i n u e ; 
 	 	 	 } 
 	 	 	 v a r   a j x E m a i l A d d r e s s   =   Z m C o n t a c t s H e l p e r . _ w r a p C o n t a c t ( c o n t a c t ) ; 
 	 	 	 i f   ( a j x E m a i l A d d r e s s   & &   t y p e   = = =   Z m C o n t a c t . G R O U P _ C O N T A C T _ R E F )   { 
 	 	 	 	 a j x E m a i l A d d r e s s . g r o u p R e f V a l u e   =   v a l u e ;   / / d o n ' t   n o r m a l i z e   v a l u e 
 	 	 	 } 
 	 	 	 i f   ( a j x E m a i l A d d r e s s )   { 
 	 	 	 	 a d d r s . p u s h ( a j x E m a i l A d d r e s s ) ; 
 	 	 	 } 
 	 	 } 
 	 } 
 	 r e t u r n   a d d r s ; 
 } ; 
 
 
 Z m C o n t a c t . p r o t o t y p e . g a t h e r E x t r a D l S t u f f   = 
 f u n c t i o n ( c a l l b a c k )   { 
 	 i f   ( t h i s . d l I n f o   & &   ! t h i s . d l I n f o . i s M i n i m a l )   { 
 	 	 / / a l r e a d y   t h e r e ,   s k i p   t o   n e x t   s t e p ,   l o a d i n g   D L   M e m b e r s 
 	 	 t h i s . l o a d D l M e m b e r s ( c a l l b a c k ) ; 
 	 	 r e t u r n ; 
 	 } 
 	 v a r   c a l l b a c k F r o m G e t t i n g I n f o   =   t h i s . _ h a n d l e G e t D l I n f o R e s p o n s e . b i n d ( t h i s ,   c a l l b a c k ) ; 
 	 t h i s . l o a d D l I n f o ( c a l l b a c k F r o m G e t t i n g I n f o ) ; 
 } ; 
 
 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e G e t D l I n f o R e s p o n s e   = 
 f u n c t i o n ( c a l l b a c k ,   r e s u l t )   { 
 	 v a r   r e s p o n s e   =   r e s u l t . _ d a t a . G e t D i s t r i b u t i o n L i s t R e s p o n s e ; 
 	 v a r   d l   =   r e s p o n s e . d l [ 0 ] ; 
 	 v a r   a t t r s   =   d l . _ a t t r s ; 
 	 v a r   i s M e m b e r   =   d l . i s M e m b e r ; 
 	 v a r   i s O w n e r   =   d l . i s O w n e r ; 
 	 v a r   m a i l P o l i c y S p e c i f i c M a i l e r s   =   [ ] ; 
 	 t h i s . d l I n f o   =   { 	 i s M e m b e r :   i s M e m b e r , 
 	 	 	 	 	 	 i s O w n e r :   i s O w n e r , 
 	 	 	 	 	 	 s u b s c r i p t i o n P o l i c y :   a t t r s . z i m b r a D i s t r i b u t i o n L i s t S u b s c r i p t i o n P o l i c y , 
 	 	 	 	 	 	 u n s u b s c r i p t i o n P o l i c y :   a t t r s . z i m b r a D i s t r i b u t i o n L i s t U n s u b s c r i p t i o n P o l i c y , 
 	 	 	 	 	 	 d e s c r i p t i o n :   a t t r s . d e s c r i p t i o n   | |   " " , 
 	 	 	 	 	 	 d i s p l a y N a m e :   a t t r s . d i s p l a y N a m e   | |   " " , 
 	 	 	 	 	 	 n o t e s :   a t t r s . z i m b r a N o t e s   | |   " " , 
 	 	 	 	 	 	 h i d e I n G a l :   a t t r s . z i m b r a H i d e I n G a l   = =   " T R U E " , 
 	 	 	 	 	 	 m a i l P o l i c y :   i s O w n e r   & &   t h i s . _ g e t M a i l P o l i c y ( d l ,   m a i l P o l i c y S p e c i f i c M a i l e r s ) , 
 	 	 	 	 	 	 o w n e r s :   i s O w n e r   & &   t h i s . _ g e t O w n e r s ( d l ) } ; 
 	 t h i s . d l I n f o . m a i l P o l i c y S p e c i f i c M a i l e r s   =   m a i l P o l i c y S p e c i f i c M a i l e r s ; 
 
 	 t h i s . l o a d D l M e m b e r s ( c a l l b a c k ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . l o a d D l M e m b e r s   = 
 f u n c t i o n ( c a l l b a c k )   { 
 	 i f   ( ( ! a p p C t x t . g e t ( " E X P A N D _ D L _ E N A B L E D " )   | |   t h i s . d l I n f o . h i d e I n G a l )   & &   ! t h i s . d l I n f o . i s O w n e r )   { 
 	 	 / /   c a n ' t   g e t   m e m b e r s   i f   d l   h a s   z i m b r a H i d e I n G a l   t r u e ,   a n d   n o t   o w n e r 
 	 	 / / a l s o ,   i f   z i m b r a F e a t u r e D i s t r i b u t i o n L i s t E x p a n d M e m b e r s E n a b l e d   i s   f a l s e   -   a l s o   d o   n o t   s h o w   t h e   m e m b e r s   ( a g a i n   u n l e s s   i t ' s   t h e   o w n e r ) 
 	 	 t h i s . d l M e m b e r s   =   [ ] ; 
 	 	 i f   ( c a l l b a c k )   { 
 	 	 	 c a l l b a c k ( ) ; 
 	 	 } 
 	 	 r e t u r n ; 
 	 } 
 	 i f   ( t h i s . d l M e m b e r s )   { 
 	 	 / / a l r e a d y   t h e r e   -   j u s t   c a l l b a c k 
 	 	 i f   ( c a l l b a c k )   { 
 	 	 	 c a l l b a c k ( ) ; 
 	 	 } 
 	 	 r e t u r n ; 
 	 } 
 	 v a r   r e s p C a l l b a c k   =   t h i s . _ h a n d l e G e t D l M e m b e r s R e s p o n s e . b i n d ( t h i s ,   c a l l b a c k ) ; 
 	 t h i s . g e t A l l D L M e m b e r s ( r e s p C a l l b a c k ) ; 
 } ; 
 
 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e G e t D l M e m b e r s R e s p o n s e   = 
 f u n c t i o n ( c a l l b a c k ,   r e s u l t )   { 
 	 v a r   l i s t   =   r e s u l t . l i s t ; 
 	 i f   ( ! l i s t )   { 
 	 	 t h i s . d l M e m b e r s   =   [ ] ; 
 	 	 c a l l b a c k ( ) ; 
 	 	 r e t u r n ; 
 	 } 
 	 v a r   m e m b e r s   =   [ ] ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   l i s t . l e n g t h ;   i + + )   { 
 	 	 m e m b e r s . p u s h ( { t y p e :   Z m C o n t a c t . G R O U P _ I N L I N E _ R E F , 
 	 	 	 	 	 	 v a l u e :   l i s t [ i ] , 
 	 	 	 	 	 	 a d d r e s s :   l i s t [ i ] } ) ; 
 	 } 
 
 	 t h i s . d l M e m b e r s   =   m e m b e r s ; 
 	 c a l l b a c k ( ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t O w n e r s   = 
 f u n c t i o n ( d l )   { 
 	 v a r   o w n e r s   =   d l . o w n e r s [ 0 ] . o w n e r ; 
 	 v a r   o w n e r s A r r a y   =   [ ] ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   o w n e r s . l e n g t h ;   i + + )   { 
 	 	 v a r   o w n e r   =   o w n e r s [ i ] . n a m e ; 
 	 	 o w n e r s A r r a y . p u s h ( o w n e r ) ;   / / j u s t   t h e   e m a i l   a d d r e s s ,   I   t h i n k   a n d   h o p e . 
 	 } 
 	 r e t u r n   o w n e r s A r r a y ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t M a i l P o l i c y   = 
 f u n c t i o n ( d l ,   s p e c i f i c M a i l e r s )   { 
 	 v a r   m a i l P o l i c y ; 
 
 	 v a r   r i g h t s   =   d l . r i g h t s [ 0 ] . r i g h t ; 
 	 v a r   r i g h t   =   r i g h t s [ 0 ] ; 
 	 v a r   g r a n t e e s   =   r i g h t . g r a n t e e ; 
 	 i f   ( ! g r a n t e e s )   { 
 	 	 r e t u r n   Z m G r o u p V i e w . M A I L _ P O L I C Y _ A N Y O N E ; 
 	 } 
 	 f o r   ( v a r   i   =   0 ;   i   <   g r a n t e e s . l e n g t h ;   i + + )   { 
 	 	 v a r   g r a n t e e   =   g r a n t e e s [ i ] ; 
 
 	 	 m a i l P o l i c y   =   Z m G r o u p V i e w . G R A N T E E _ T Y P E _ T O _ M A I L _ P O L I C Y _ M A P [ g r a n t e e . t y p e ] ; 
 
 	 	 i f   ( m a i l P o l i c y   = =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ S P E C I F I C )   { 
 	 	 	 s p e c i f i c M a i l e r s . p u s h ( g r a n t e e . n a m e ) ; 
 	 	 } 
 	 	 e l s e   i f   ( m a i l P o l i c y   = =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ A N Y O N E )   { 
 	 	 	 b r e a k ; 
 	 	 } 
 	 	 e l s e   i f   ( m a i l P o l i c y   = =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ I N T E R N A L )   { 
 	 	 	 b r e a k ; 
 	 	 } 
 	 	 e l s e   i f   ( m a i l P o l i c y   = =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ M E M B E R S )   { 
 	 	 	 i f   ( g r a n t e e . n a m e   = =   t h i s . g e t E m a i l ( ) )   { 
 	 	 	 	 / / t h i s   m e a n s   o n l y   m e m b e r s   o f   t h i s   D L   c a n   s e n d . 
 	 	 	 	 b r e a k ; 
 	 	 	 } 
 	 	 	 e l s e   { 
 	 	 	 	 / / m u s t   b e   a n o t h e r   D L ,   a n d   w e   d o   a l l o w   i t ,   s o   t r e a t   i t   a s   r e g u l a r   u s e r . 
 	 	 	 	 s p e c i f i c M a i l e r s . p u s h ( g r a n t e e . n a m e ) ; 
 	 	 	 	 m a i l P o l i c y   =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ S P E C I F I C ; 
 	 	 	 } 
 	 	 } 
 	 } 
 	 m a i l P o l i c y   =   m a i l P o l i c y   | |   Z m G r o u p V i e w . M A I L _ P O L I C Y _ A N Y O N E ; 
 
 	 r e t u r n   m a i l P o l i c y ; 
 } ; 
 
 
 Z m C o n t a c t . p r o t o t y p e . l o a d D l I n f o   = 
 f u n c t i o n ( c a l l b a c k )   { 
 	 v a r   s o a p D o c   =   A j x S o a p D o c . c r e a t e ( " G e t D i s t r i b u t i o n L i s t R e q u e s t " ,   " u r n : z i m b r a A c c o u n t " ,   n u l l ) ; 
 	 s o a p D o c . s e t M e t h o d A t t r i b u t e ( " n e e d O w n e r s " ,   " 1 " ) ; 
 	 s o a p D o c . s e t M e t h o d A t t r i b u t e ( " n e e d R i g h t s " ,   " s e n d T o D i s t L i s t " ) ; 
 	 v a r   e l B y   =   s o a p D o c . s e t ( " d l " ,   t h i s . g e t E m a i l ( ) ) ; 
 	 e l B y . s e t A t t r i b u t e ( " b y " ,   " n a m e " ) ; 
 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { s o a p D o c :   s o a p D o c ,   a s y n c M o d e :   t r u e ,   c a l l b a c k :   c a l l b a c k } ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . t o g g l e S u b s c r i p t i o n   = 
 f u n c t i o n ( c a l l b a c k )   { 
 	 v a r   s o a p D o c   =   A j x S o a p D o c . c r e a t e ( " S u b s c r i b e D i s t r i b u t i o n L i s t R e q u e s t " ,   " u r n : z i m b r a A c c o u n t " ,   n u l l ) ; 
 	 s o a p D o c . s e t M e t h o d A t t r i b u t e ( " o p " ,   t h i s . d l I n f o . i s M e m b e r   ?   " u n s u b s c r i b e "   :   " s u b s c r i b e " ) ; 
 	 v a r   e l B y   =   s o a p D o c . s e t ( " d l " ,   t h i s . g e t E m a i l ( ) ) ; 
 	 e l B y . s e t A t t r i b u t e ( " b y " ,   " n a m e " ) ; 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { s o a p D o c :   s o a p D o c ,   a s y n c M o d e :   t r u e ,   c a l l b a c k :   c a l l b a c k } ) ; 
 } ; 
 
 
 
 / * * 
   *     R e t u r n s   t h e   c o n t a c t   i d .     I f   i n c l u d e U s e r Z i d   i s   t r u e   i t   w i l l   r e t u r n   t h e   f o r m a t   z i d : i d 
   *   @ p a r a m   i n c l u d e U s e r Z i d   { b o o l e a n }   t r u e   t o   i n c l u d e   t h e   z i d   p r e f i x   f o r   t h e   c o n t a c t   i d 
   *   @ r e t u r n   { S t r i n g }   c o n t a c t   i d   s t r i n g 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t I d   =   
 f u n c t i o n ( i n c l u d e U s e r Z i d )   { 
 
 	 i f   ( i n c l u d e U s e r Z i d )   { 
 	 	 r e t u r n   t h i s . i s S h a r e d ( )   ?   t h i s . i d   :   a p p C t x t . a c c o u n t L i s t . m a i n A c c o u n t . i d   +   " : "   +   t h i s . i d ;   
 	 } 
 	 
 	 r e t u r n   t h i s . i d ; 
 } ; 
 / * * 
   *   G e t s   t h e   i c o n . 
   *   @ p a r a m   	 { Z m A d d r B o o k }   a d d r B o o k 	 a d d r e s s   b o o k   o f   c o n t a c t   
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   i c o n 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t I c o n   = 
 f u n c t i o n ( a d d r B o o k )   { 
 	 i f   ( t h i s . i s D i s t r i b u t i o n L i s t ( ) )   	 	 	 	 	 	 {   r e t u r n   " D i s t r i b u t i o n L i s t " ;   } 
 	 i f   ( t h i s . i s G a l ) 	 	 	 	 	 	 	 	 	 	 {   r e t u r n   " G A L C o n t a c t " ;   } 
 	 i f   ( t h i s . i s S h a r e d ( )   | |   ( a d d r B o o k   & &   a d d r B o o k . l i n k ) ) 	 {   r e t u r n   " S h a r e d C o n t a c t " ;   } 
 	 i f   ( t h i s . i s G r o u p ( ) ) 	 	 	 	 	 	 	 	 	 {   r e t u r n   " G r o u p " ;   } 
 	 r e t u r n   " C o n t a c t " ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . g e t I c o n L a r g e   = 
 f u n c t i o n ( )   { 
 	 i f   ( t h i s . i s D i s t r i b u t i o n L i s t ( ) )   { 
 	 	 r e t u r n   " G r o u p _ 4 8 " ; 
 	 } 
 	 / / t o d o   -   g e t   a   b i g   v e r s i o n   o f   I m g G a l C o n t a c t . p n g 
 / / 	 i f   ( t h i s . i s G a l )   { 
 / / 	 } 
 	 r e t u r n   " P e r s o n _ 4 8 " ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   f o l d e r   i d . 
   *   
   *   @ r e t u r n 	 { S t r i n g } 	 	 t h e   f o l d e r   i d 	 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t F o l d e r I d   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   t h i s . i s S h a r e d ( ) 
 	 	 ?   t h i s . f o l d e r I d . s p l i t ( " : " ) [ 0 ] 
 	 	 :   t h i s . f o l d e r I d ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   a t t r i b u t e . 
   *   
   *   @ p a r a m 	 { S t r i n g } 	 n a m e 	 	 t h e   a t t r i b u t e   n a m e 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   v a l u e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t A t t r   = 
 f u n c t i o n ( n a m e )   { 
 	 v a r   v a l   =   t h i s . a t t r [ n a m e ] ; 
 	 r e t u r n   v a l   ?   ( ( v a l   i n s t a n c e o f   A r r a y )   ?   v a l [ 0 ]   :   v a l )   :   " " ; 
 } ; 
 
 / * * 
   *   S e t s   t h e   a t t r i b u t e . 
   *   
   *   @ p a r a m 	 { S t r i n g } 	 n a m e 	 	 t h e   a t t r i b u t e   n a m e 
   *   @ p a r a m 	 { S t r i n g } 	 v a l u e 	 	 t h e   a t t r i b u t e   v a l u e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . s e t A t t r   = 
 f u n c t i o n ( n a m e ,   v a l u e )   { 
 	 t h i s . a t t r [ n a m e ]   =   v a l u e ; 
 } ; 
 
 / * * 
   *   S e t s   t h e   p a r t i c i p a n t   s t a t u s . 
   * 
   *   @ p a r a m 	 { S t r i n g } 	 v a l u e   t h e   p a r t i c i p a n t   s t a t u s   v a l u e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . s e t P a r t i c i p a n t S t a t u s   = 
 f u n c t i o n ( p t s t )   { 
 	 t h i s . p a r t i c i p a n t S t a t u s   =   p t s t ; 
 } ; 
 
 / * * 
   *   g e t s   t h e   p a r t i c i p a n t   s t a t u s . 
   * 
   *   @ r e t u r n 	 { S t r i n g }         t h e   v a l u e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t P a r t i c i p a n t S t a t u s   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   t h i s . p a r t i c i p a n t S t a t u s ; 
 } ; 
 
 / * * 
   *   S e t s   t h e   p a r t i c i p a n t   r o l e . 
   * 
   *   @ p a r a m 	 { S t r i n g } 	 v a l u e   t h e   p a r t i c i p a n t   r o l e   v a l u e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . s e t P a r t i c i p a n t R o l e   = 
 f u n c t i o n ( r o l e )   { 
 	 t h i s . p a r t i c i p a n t R o l e   =   r o l e ; 
 } ; 
 
 / * * 
   *   g e t s   t h e   p a r t i c i p a n t   r o l e . 
   * 
   *   @ r e t u r n 	 { S t r i n g }         t h e   v a l u e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t P a r t i c i p a n t R o l e   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   t h i s . p a r t i c i p a n t R o l e ; 
 } ; 
 
 / * * 
   *   R e m o v e s   t h e   a t t r i b u t e . 
   *   
   *   @ p a r a m 	 { S t r i n g } 	 n a m e 	 	 t h e   a t t r i b u t e   n a m e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . r e m o v e A t t r   = 
 f u n c t i o n ( n a m e )   { 
 	 d e l e t e   t h i s . a t t r [ n a m e ] ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   c o n t a c t   a t t r i b u t e s . 
   * 
   *   @ p a r a m   { S t r i n g } 	 [ p r e f i x ]   i f   s p e c i f i e d ,   o n l y   t h e   t h e   a t t r i b u t e s   t h a t   m a t c h   t h e   g i v e n   p r e f i x   w i l l   b e   r e t u r n e d 
   *   @ r e t u r n 	 { H a s h } 	 a   h a s h   o f   a t t r i b u t e / v a l u e   p a i r s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t A t t r s   =   f u n c t i o n ( p r e f i x )   { 
 	 v a r   a t t r s   =   t h i s . a t t r ; 
 	 i f   ( p r e f i x )   { 
 	 	 a t t r s   =   { } ; 
 	 	 f o r   ( v a r   a n a m e   i n   t h i s . a t t r )   { 
 	 	 	 v a r   n a m e P r e f i x   =   Z m C o n t a c t . g e t P r e f i x ( a n a m e ) ; 
 	 	 	 i f   ( n a m e P r e f i x   = = =   p r e f i x )   { 
 	 	 	 	 a t t r s [ a n a m e ]   =   t h i s . a t t r [ a n a m e ] ; 
 	 	 	 } 
 	 	 } 
 	 } 
 	 r e t u r n   a t t r s ; 
 } ; 
 
 / * * 
   *   G e t s   a   n o r m a l i z e d   s e t   o f   a t t r i b u t e s   w h e r e   t h e   a t t r i b u t e 
   *   n a m e s   h a v e   b e e n   r e - n u m b e r e d   a s   n e e d e d .   F o r   e x a m p l e ,   i f   t h e 
   *   a t t r i b u t e s   c o n t a i n s   a   " f o o 2 "   b u t   n o   " f o o " ,   t h e n   t h e   " f o o 2 " 
   *   a t t r i b u t e   w i l l   b e   r e n a m e d   t o   " f o o "   i n   t h e   r e t u r n e d   o b j e c t . 
   *   < p > 
   *   < s t r o n g > N o t e : < / s t r o n g > 
   *   T h i s   m e t h o d   i s   e x p e n s i v e   s o   s h o u l d   b e   c a l l e d   o n c e   a n d 
   *   c a c h e d   t e m p o r a r i l y   a s   n e e d e d   i n s t e a d   o f   b e i n g   c a l l e d 
   *   f o r   e a c h   n o r m a l i z e d   a t t r i b u t e   t h a t   i s   n e e d e d . 
   *   
   *   @ p a r a m   { S t r i n g } 	 [ p r e f i x ] 	 	 i f   s p e c i f i e d ,   o n l y   t h e 
   *                                                 t h e   a t t r i b u t e s   t h a t   m a t c h   t h e   g i v e n 
   *                                                 p r e f i x   w i l l   b e   r e t u r n e d . 
   *   @ r e t u r n 	 { H a s h } 	 a   h a s h   o f   a t t r i b u t e / v a l u e   p a i r s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t N o r m a l i z e d A t t r s   =   f u n c t i o n ( p r e f i x )   { 
 	 r e t u r n   Z m C o n t a c t . g e t N o r m a l i z e d A t t r s ( t h i s . a t t r ,   p r e f i x ,   Z m C o n t a c t . I G N O R E _ N O R M A L I Z A T I O N ) ; 
 } ; 
 
 / * * 
 *   C r e a t e s   a   c o n t a c t   f r o m   t h e   g i v e n   s e t   o f   a t t r i b u t e s .   U s e d   t o   c r e a t e   c o n t a c t s   o n 
 *   t h e   f l y   ( r a t h e r   t h a n   b y   l o a d i n g   t h e m ) .   T h i s   m e t h o d   i s   c a l l e d   b y   a   l i s t ' s   < c o d e > c r e a t e ( ) < / c o d e > 
 *   m e t h o d . 
 *   < p > 
 *   I f   t h i s   i s   a   G A L   c o n t a c t ,   w e   a s s u m e   i t   i s   b e i n g   a d d e d   t o   t h e   c o n t a c t   l i s t . < / p > 
 * 
 *   @ p a r a m   { H a s h } 	 a t t r 	 	 	 t h e   a t t r i b u t e / v a l u e   p a i r s   f o r   t h i s   c o n t a c t 
 *   @ p a r a m   { Z m B a t c h C o m m a n d } 	 b a t c h C m d 	 t h e   b a t c h   c o m m a n d   t h a t   c o n t a i n s   t h i s   r e q u e s t 
 *   @ p a r a m   { b o o l e a n }   i s A u t o C r e a t e   t r u e   i f   t h i s   i s   a   a u t o   c r e a t e   a n d   t o a s t   m e s s a g e   s h o u l d   n o t   b e   s h o w n 
 * / 
 Z m C o n t a c t . p r o t o t y p e . c r e a t e   = 
 f u n c t i o n ( a t t r ,   b a t c h C m d ,   i s A u t o C r e a t e )   { 
 
 	 i f   ( t h i s . i s D i s t r i b u t i o n L i s t ( ) )   { 
 	 	 t h i s . _ c r e a t e D l ( a t t r ) ; 
 	 	 r e t u r n ; 
 	 } 
 
 	 v a r   j s o n O b j   =   { C r e a t e C o n t a c t R e q u e s t : { _ j s n s : " u r n : z i m b r a M a i l " } } ; 
 	 v a r   r e q u e s t   =   j s o n O b j . C r e a t e C o n t a c t R e q u e s t ; 
 	 v a r   c n   =   r e q u e s t . c n   =   { } ; 
 
 	 v a r   f o l d e r I d   =   a t t r [ Z m C o n t a c t . F _ f o l d e r I d ]   | |   Z m F o l d e r . I D _ C O N T A C T S ; 
 	 v a r   f o l d e r   =   a p p C t x t . g e t B y I d ( f o l d e r I d ) ; 
 	 i f   ( f o l d e r   & &   f o l d e r . i s R e m o t e ( ) )   { 
 	 	 f o l d e r I d   =   f o l d e r . g e t R e m o t e I d ( ) ; 
 	 } 
 	 c n . l   =   f o l d e r I d ; 
 	 c n . a   =   [ ] ; 
 	 c n . m   =   [ ] ; 
 
 	 f o r   ( v a r   n a m e   i n   a t t r )   { 
 	 	 i f   ( n a m e   = =   Z m C o n t a c t . F _ f o l d e r I d   | | 
 	 	 	 n a m e   = =   " o b j e c t C l a s s "   | | 
 	 	 	 n a m e   = =   " z i m b r a I d "   | | 
 	 	 	 n a m e   = =   " c r e a t e T i m e S t a m p "   | | 
 	 	 	 n a m e   = =   " m o d i f y T i m e S t a m p " )   {   c o n t i n u e ;   } 
 
 	 	 i f   ( n a m e   = =   Z m C o n t a c t . F _ g r o u p s )   { 
 	 	 	 t h i s . _ a d d C o n t a c t G r o u p A t t r ( c n ,   a t t r ) ; 
 	 	 } 
 	 	 e l s e   { 
 	 	 	 t h i s . _ a d d R e q u e s t A t t r ( c n ,   n a m e ,   a t t r [ n a m e ] ) ; 
 	 	 } 
 	 } 
 
 	 t h i s . _ a d d R e q u e s t A t t r ( c n ,   Z m C o n t a c t . X _ f u l l N a m e ,   Z m C o n t a c t . c o m p u t e F i l e A s ( a t t r ) ) ; 
 
 	 v a r   r e s p C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e R e s p o n s e C r e a t e ,   [ a t t r ,   b a t c h C m d   ! =   n u l l ,   i s A u t o C r e a t e ] ) ; 
 
 	 i f   ( b a t c h C m d )   { 
 	 	 b a t c h C m d . a d d R e q u e s t P a r a m s ( j s o n O b j ,   r e s p C a l l b a c k ) ; 
 	 }   e l s e   { 
 	 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { j s o n O b j : j s o n O b j ,   a s y n c M o d e : t r u e ,   c a l l b a c k : r e s p C a l l b a c k } ) ; 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e R e s p o n s e C r e a t e   = 
 f u n c t i o n ( a t t r ,   i s B a t c h M o d e ,   i s A u t o C r e a t e ,   r e s u l t )   { 
 	 / /   d o n t   b o t h e r   p r o c e s s i n g   c r e a t e s   w h e n   i n   b a t c h   m o d e   ( j u s t   l e t   c r e a t e 
 	 / /   n o t i f i c a t i o n s   h a n d l e   t h e m ) 
 	 i f   ( i s B a t c h M o d e )   {   r e t u r n ;   } 
 
 	 v a r   r e s p   =   r e s u l t . g e t R e s p o n s e ( ) . C r e a t e C o n t a c t R e s p o n s e ; 
 	 c n   =   r e s p   ?   r e s p . c n [ 0 ]   :   n u l l ; 
 	 v a r   i d   =   c n   ?   c n . i d   :   n u l l ; 
 	 i f   ( i d )   { 
 	 	 t h i s . _ f i l e A s   =   n u l l ; 
 	 	 t h i s . _ f u l l N a m e   =   n u l l ; 
 	 	 t h i s . i d   =   i d ; 
 	 	 t h i s . m o d i f i e d   =   c n . m d ; 
 	 	 t h i s . f o l d e r I d   =   c n . l   | |   Z m O r g a n i z e r . I D _ A D D R B O O K ; 
 	 	 f o r   ( v a r   a   i n   a t t r )   { 
 	 	 	 i f   ( ! ( a t t r [ a ]   = =   u n d e f i n e d   | |   a t t r [ a ]   = =   ' ' ) ) 
 	 	 	 	 t h i s . s e t A t t r ( a ,   a t t r [ a ] ) ; 
 	 	 } 
 	 	 v a r   g r o u p M e m b e r s   =   c n   ?   c n . m   :   n u l l ; 
 	 	 i f   ( g r o u p M e m b e r s )   { 
 	 	 	 t h i s . a t t r [ Z m C o n t a c t . F _ g r o u p s ]   =   g r o u p M e m b e r s ; 
 	 	 	 c n . _ a t t r s [ Z m C o n t a c t . F _ g r o u p s ]   =   g r o u p M e m b e r s ; 
 	 	 } 
 	 	 i f   ( ! i s A u t o C r e a t e )   { 
 	 	 	 v a r   m s g   =   t h i s . i s G r o u p ( )   ?   Z m M s g . g r o u p C r e a t e d   :   Z m M s g . c o n t a c t C r e a t e d ; 
 	 	 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e t S t a t u s M s g ( m s g ) ; 
 	 	 } 
 	 	 / / u p d a t e   t h e   c a n o n i c a l   l i s t .   ( t h i s   i n c l u d e s   a d d i n g   t o   t h e   _ i d H a s h   l i k e   b e f o r e   ( b u g   4 4 1 3 2 )   c a l l i n g   u p d a t e I d H a s h .   B u t   c a l l i n g   t h a t   l e f t   t h e   l i s t   i n c o n c i s t a n t . 
 	 	 a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) . g e t C o n t a c t L i s t ( ) . a d d ( c n ) ; 
 	 }   e l s e   { 
 	 	 v a r   m s g   =   t h i s . i s G r o u p ( )   ?   Z m M s g . e r r o r C r e a t e G r o u p   :   Z m M s g . e r r o r C r e a t e C o n t a c t ; 
 	 	 v a r   d e t a i l   =   Z m M s g . e r r o r T r y A g a i n   +   " \ n "   +   Z m M s g . e r r o r C o n t a c t ; 
 	 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e t S t a t u s M s g ( m s g ,   Z m S t a t u s V i e w . L E V E L _ C R I T I C A L ,   d e t a i l ) ; 
 	 } 
 } ; 
 
 / * * 
   *   C r e a t e s   a   c o n t c t   f r o m   a   V C F   p a r t   o f   a   m e s s a g e . 
   *   
   *   @ p a r a m 	 { S t r i n g } 	 m s g I d 	 	 t h e   m e s s a g e 
   *   @ p a r a m 	 { S t r i n g } 	 v c a r d P a r t I d 	 t h e   v c a r d   p a r t   i d 
   * / 
 Z m C o n t a c t . p r o t o t y p e . c r e a t e F r o m V C a r d   = 
 f u n c t i o n ( m s g I d ,   v c a r d P a r t I d )   { 
 	 v a r   j s o n O b j   =   { C r e a t e C o n t a c t R e q u e s t : { _ j s n s : " u r n : z i m b r a M a i l " } } ; 
 	 v a r   c n   =   j s o n O b j . C r e a t e C o n t a c t R e q u e s t . c n   =   { l : Z m F o l d e r . I D _ C O N T A C T S } ; 
 	 c n . v c a r d   =   { m i d : m s g I d ,   p a r t : v c a r d P a r t I d } ; 
 
 	 v a r   p a r a m s   =   { 
 	 	 j s o n O b j :   j s o n O b j , 
 	 	 a s y n c M o d e :   t r u e , 
 	 	 c a l l b a c k :   ( n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e R e s p o n s e C r e a t e V C a r d ) ) , 
 	 	 e r r o r C a l l b a c k :   ( n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e E r r o r C r e a t e V C a r d ) ) 
 	 } ; 
 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( p a r a m s ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e R e s p o n s e C r e a t e V C a r d   = 
 f u n c t i o n ( r e s u l t )   { 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e t S t a t u s M s g ( Z m M s g . c o n t a c t C r e a t e d ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e E r r o r C r e a t e V C a r d   = 
 f u n c t i o n ( e x )   { 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e t S t a t u s M s g ( Z m M s g . e r r o r C r e a t e C o n t a c t ,   Z m S t a t u s V i e w . L E V E L _ C R I T I C A L ) ; 
 } ; 
 
 / * * 
   *   U p d a t e s   c o n t a c t   a t t r i b u t e s . 
   * 
   *   @ p a r a m   { H a s h } 	 a t t r 	 	 a   s e t   o f   a t t r i b u t e s   a n d   n e w   v a l u e s 
   *   @ p a r a m   { A j x C a l l b a c k } 	 c a l l b a c k 	 t h e   c a l l b a c k 
   *   @ p a r a m   { b o o l e a n }   i s A u t o S a v e     t r u e   i f   i t   i s   a   a u t o   s a v e   a n d   t o a s t   s h o u l d   n o t   b e   d i s p l a y e d . 
   * / 
 Z m C o n t a c t . p r o t o t y p e . m o d i f y   = 
 f u n c t i o n ( a t t r ,   c a l l b a c k ,   i s A u t o S a v e ,   b a t c h C m d )   { 
 	 i f   ( t h i s . i s D i s t r i b u t i o n L i s t ( ) )   { 
 	 	 t h i s . _ m o d i f y D l ( a t t r ) ; 
 	 	 r e t u r n ; 
 	 } 
 	 i f   ( t h i s . l i s t . i s G a l )   {   r e t u r n ;   } 
 
 	 / /   c h a n g e   f o r c e   t o   0   a n d   p u t   u p   d i a l o g   i f   w e   g e t   a   M O D I F Y _ C O N F L I C T   f a u l t ? 
 	 v a r   j s o n O b j   =   { M o d i f y C o n t a c t R e q u e s t : { _ j s n s : " u r n : z i m b r a M a i l " ,   r e p l a c e : " 0 " ,   f o r c e : " 1 " } } ; 
 	 v a r   c n   =   j s o n O b j . M o d i f y C o n t a c t R e q u e s t . c n   =   { i d : t h i s . i d } ; 
 	 c n . a   =   [ ] ; 
 	 c n . m   =   [ ] ; 
 	 v a r   c o n t i n u e R e q u e s t   =   f a l s e ; 
 	 
 	 f o r   ( v a r   n a m e   i n   a t t r )   { 
 	 	 i f   ( n a m e   = =   Z m C o n t a c t . F _ f o l d e r I d )   {   c o n t i n u e ;   } 
 	 	 i f   ( n a m e   = =   Z m C o n t a c t . F _ g r o u p s )   { 
 	 	 	 t h i s . _ a d d C o n t a c t G r o u p A t t r ( c n ,   a t t r ) ; 	 
 	 	 } 
 	 	 e l s e   { 
 	 	 	 t h i s . _ a d d R e q u e s t A t t r ( c n ,   n a m e ,   ( a t t r [ n a m e ]   & &   a t t r [ n a m e ] . v a l u e )   | |   a t t r [ n a m e ] ) ; 
 	 	 } 
 	 	 c o n t i n u e R e q u e s t   =   t r u e ; 
 	 } 
 
         / /   b u g :   4 5 0 2 6 
         i f   ( Z m C o n t a c t . F _ f i r s t N a m e   i n   a t t r   | |   Z m C o n t a c t . F _ l a s t N a m e   i n   a t t r   | |   Z m C o n t a c t . F _ c o m p a n y   i n   a t t r   | |   Z m C o n t a c t . X _ f i l e A s   i n   a t t r )   { 
                 v a r   c o n t a c t   =   { } ; 
                 v a r   f i e l d s   =   [ Z m C o n t a c t . F _ f i r s t N a m e ,   Z m C o n t a c t . F _ l a s t N a m e ,   Z m C o n t a c t . F _ c o m p a n y ,   Z m C o n t a c t . X _ f i l e A s ] ; 
                 f o r   ( v a r   i   =   0 ;   i   <   f i e l d s . l e n g t h ;   i + + )   { 
                         v a r   f i e l d   =   f i e l d s [ i ] ; 
                         v a r   v a l u e   =   a t t r [ f i e l d ] ; 
                         c o n t a c t [ f i e l d ]   =   v a l u e   ! =   n u l l   ?   v a l u e   :   t h i s . g e t A t t r ( f i e l d ) ; 
                 } 
                 v a r   f u l l N a m e   =   Z m C o n t a c t . c o m p u t e F i l e A s ( c o n t a c t ) ;   
                 t h i s . _ a d d R e q u e s t A t t r ( c n ,   Z m C o n t a c t . X _ f u l l N a m e ,   f u l l N a m e ) ; 
         } 
 
 	 i f   ( c o n t i n u e R e q u e s t )   { 
 	 	 i f   ( b a t c h C m d )   { 
 	 	 	 b a t c h C m d . a d d R e q u e s t P a r a m s ( j s o n O b j ,   n u l l ,   n u l l ) ;   / / n o   n e e d   f o r   r e s p o n s e   c a l l b a c k   f o r   c u r r e n t   u s e - c a s e   ( b a t c h   m o d i f y i n g   z i m l e t   i m a g e ) 
 	 	 } 
 	 	 e l s e   { 
 	 	 	 v a r   r e s p C a l l b a c k   =   t h i s . _ h a n d l e R e s p o n s e M o d i f y . b i n d ( t h i s ,   a t t r ,   c a l l b a c k ,   i s A u t o S a v e ) ; 
 	 	 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { j s o n O b j :   j s o n O b j ,   a s y n c M o d e :   t r u e ,   c a l l b a c k :   r e s p C a l l b a c k } ) ; 
 	 	 } 
 
 	 }   e l s e   { 
 	 	 i f   ( a t t r [ Z m C o n t a c t . F _ f o l d e r I d ] )   { 
 	 	 	 t h i s . _ s e t F o l d e r ( a t t r [ Z m C o n t a c t . F _ f o l d e r I d ] ) ; 
 	 	 } 
 	 } 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ c r e a t e D l   = 
 f u n c t i o n ( a t t r )   { 
 
 	 t h i s . a t t r   =   a t t r ;   / / t h i s   i s   m a i n l y   i m p o r t a n t   f o r   t h e   e m a i l .   a t t r   i s   n o t   s e t   b e f o r e   t h i s . 
 
 	 v a r   c r e a t e D l R e q   =   t h i s . _ g e t C r e a t e D l R e q ( a t t r ) ; 
 
 	 v a r   r e q s   =   [ ] ; 
 
 	 t h i s . _ a d d M e m b e r M o d s R e q s ( r e q s ,   a t t r ) ; 
 
 	 t h i s . _ a d d M a i l P o l i c y A n d O w n e r s R e q s ( r e q s ,   a t t r ) ; 
 
 	 v a r   j s o n O b j   =   { 
 	 	 B a t c h R e q u e s t :   { 
 	 	 	 _ j s n s :   " u r n : z i m b r a " , 
 	 	 	 C r e a t e D i s t r i b u t i o n L i s t R e q u e s t :   c r e a t e D l R e q , 
 	 	 	 D i s t r i b u t i o n L i s t A c t i o n R e q u e s t :   r e q s 
 	 	 } 
 	 } ; 
 	 v a r   r e s p C a l l b a c k   =   t h i s . _ c r e a t e D l R e s p o n s e H a n d l e r . b i n d ( t h i s ) ; 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { j s o n O b j :   j s o n O b j ,   a s y n c M o d e :   t r u e ,   c a l l b a c k :   r e s p C a l l b a c k } ) ; 
 	 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ a d d M a i l P o l i c y A n d O w n e r s R e q s   = 
 f u n c t i o n ( r e q s ,   a t t r )   { 
 
 	 v a r   m a i l P o l i c y   =   a t t r [ Z m C o n t a c t . F _ d l M a i l P o l i c y ] ; 
 	 i f   ( m a i l P o l i c y )   { 
 	 	 r e q s . p u s h ( t h i s . _ g e t S e t M a i l P o l i c y R e q ( m a i l P o l i c y ,   a t t r [ Z m C o n t a c t . F _ d l M a i l P o l i c y S p e c i f i c M a i l e r s ] ) ) ; 
 	 } 
 
 	 v a r   l i s t O w n e r s   =   a t t r [ Z m C o n t a c t . F _ d l L i s t O w n e r s ] ; 
 	 i f   ( l i s t O w n e r s )   { 
 	 	 r e q s . p u s h ( t h i s . _ g e t S e t O w n e r s R e q ( l i s t O w n e r s ) ) ; 
 	 } 
 
 
 } ; 
 
 
 
 Z m C o n t a c t . p r o t o t y p e . _ a d d M e m b e r M o d s R e q s   = 
 f u n c t i o n ( r e q s ,   a t t r )   { 
 	 v a r   m e m b e r M o d i f i c a t i o n s   =   a t t r [ Z m C o n t a c t . F _ g r o u p s ] ; 
 	 v a r   a d d s   =   [ ] ; 
 	 v a r   r e m o v e s   =   [ ] ; 
 	 i f   ( m e m b e r M o d i f i c a t i o n s )   { 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   m e m b e r M o d i f i c a t i o n s . l e n g t h ;   i + + )   { 
 	 	 	 v a r   m o d   =   m e m b e r M o d i f i c a t i o n s [ i ] ; 
 	 	 	 v a r   c o l   =   ( m o d . o p   = =   " + "   ?   a d d s   :   r e m o v e s ) ; 
 	 	 	 c o l . p u s h ( m o d ) ; 
 	 	 } 
 	 } 
 
 	 i f   ( a d d s . l e n g t h   >   0 )   { 
 	 	 r e q s . p u s h ( t h i s . _ g e t A d d O r R e m o v e R e q ( a d d s ,   t r u e ) ) ; 
 	 } 
 	 i f   ( r e m o v e s . l e n g t h   >   0 )   { 
 	 	 r e q s . p u s h ( t h i s . _ g e t A d d O r R e m o v e R e q ( r e m o v e s ,   f a l s e ) ) ; 
 	 } 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ m o d i f y D l   = 
 f u n c t i o n ( a t t r )   { 
 	 v a r   r e q s   =   [ ] ; 
 
 	 v a r   n e w E m a i l   =   a t t r [ Z m C o n t a c t . F _ e m a i l ] ; 
 
 	 v a r   e m a i l C h a n g e d   =   f a l s e ; 
 	 i f   ( n e w E m a i l   ! = =   u n d e f i n e d )   { 
 	 	 e m a i l C h a n g e d   =   t r u e ; 
 	 	 r e q s . p u s h ( t h i s . _ g e t R e n a m e D l R e q ( n e w E m a i l ) ) ; 
 	 	 t h i s . s e t A t t r ( Z m C o n t a c t . F _ e m a i l ,   n e w E m a i l ) ; 
 	 } 
 
 	 v a r   m o d D l R e q   =   t h i s . _ g e t M o d i f y D l A t t r i b u t e s R e q ( a t t r ) ; 
 	 i f   ( m o d D l R e q )   { 
 	 	 r e q s . p u s h ( m o d D l R e q ) ; 
 	 } 
 
 	 v a r   d i s p l a y N a m e   =   a t t r [ Z m C o n t a c t . F _ d l D i s p l a y N a m e ] ; 
 	 i f   ( d i s p l a y N a m e   ! = =   u n d e f i n e d )   { 
 	 	 t h i s . s e t A t t r ( Z m C o n t a c t . F _ d l D i s p l a y N a m e ,   d i s p l a y N a m e ) ; 
 	 } 
 
 	 v a r   o l d F i l e A s   =   t h i s . g e t F i l e A s ( ) ; 
 	 t h i s . _ r e s e t C a c h e d F i e l d s ( ) ; 
 	 v a r   f i l e A s C h a n g e d   =   o l d F i l e A s   ! =   t h i s . g e t F i l e A s ( ) ; 
 
 	 t h i s . _ a d d M e m b e r M o d s R e q s ( r e q s ,   a t t r ) ; 
 
 	 t h i s . _ a d d M a i l P o l i c y A n d O w n e r s R e q s ( r e q s ,   a t t r ) ; 
 
 	 i f   ( r e q s . l e n g t h   = =   0 )   { 
 	 	 t h i s . _ m o d i f y D l R e s p o n s e H a n d l e r ( f a l s e ,   n u l l ) ;   / / p r e t e n d   i t   w a s   s a v e d 
 	 	 r e t u r n ; 
 	 } 
 	 v a r   j s o n O b j   =   { 
 	 	 B a t c h R e q u e s t :   { 
 	 	 	 _ j s n s :   " u r n : z i m b r a " , 
 	 	 	 D i s t r i b u t i o n L i s t A c t i o n R e q u e s t :   r e q s 
 	 	 } 
 	 } ; 
 	 v a r   r e s p C a l l b a c k   =   t h i s . _ m o d i f y D l R e s p o n s e H a n d l e r . b i n d ( t h i s ,   f i l e A s C h a n g e d   | |   e m a i l C h a n g e d ) ;   / / t h e r e ' s   s o m e   i s s u e   w i t h   f i l e A s C h a n g e d   s o   a d d i n g   t h e   e m a i l C h a n g e d   t o   b e   o n   s a f e   s i d e 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { j s o n O b j :   j s o n O b j ,   a s y n c M o d e :   t r u e ,   c a l l b a c k :   r e s p C a l l b a c k } ) ; 
 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t A d d O r R e m o v e R e q   = 
 f u n c t i o n ( m e m b e r s ,   a d d )   { 
 	 v a r   r e q   =   { 
 	 	 _ j s n s :   " u r n : z i m b r a A c c o u n t " , 
 	 	 d l :   { b y :   " n a m e " , 
 	 	 	   _ c o n t e n t :   t h i s . g e t E m a i l ( ) 
 	 	 } , 
 	 	 a c t i o n :   { 
 	 	 	 o p :   a d d   ?   " a d d M e m b e r s "   :   " r e m o v e M e m b e r s " , 
 	 	 	 d l m :   [ ] 
 	 	 } 
 	 } ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   m e m b e r s . l e n g t h ;   i + + )   { 
 	 	 v a r   m e m b e r   =   m e m b e r s [ i ] ; 
 	 	 r e q . a c t i o n . d l m . p u s h ( { _ c o n t e n t :   m e m b e r . e m a i l } ) ; 
 	 } 
 	 r e t u r n   r e q ; 
 
 } ; 
 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t R e n a m e D l R e q   = 
 f u n c t i o n ( n a m e )   { 
 	 r e t u r n   { 
 	 	 _ j s n s :   " u r n : z i m b r a A c c o u n t " , 
 	 	 d l :   { b y :   " n a m e " , 
 	 	 	   _ c o n t e n t :   t h i s . g e t E m a i l ( ) 
 	 	 } , 
 	 	 a c t i o n :   { 
 	 	 	 o p :   " r e n a m e " , 
 	 	 	 n e w N a m e :   { _ c o n t e n t :   n a m e } 
 	 	 } 
 	 } ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t S e t O w n e r s R e q   = 
 f u n c t i o n ( o w n e r s )   { 
 	 v a r   o w n e r s P a r t   =   [ ] ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   o w n e r s . l e n g t h ;   i + + )   { 
 	 	 o w n e r s P a r t . p u s h ( { 
 	 	 	 t y p e :   Z m G r o u p V i e w . G R A N T E E _ T Y P E _ U S E R , 
 	 	 	 b y :   " n a m e " , 
 	 	 	 _ c o n t e n t :   o w n e r s [ i ] 
 	 	 } ) ; 
 	 } 
 	 r e t u r n   { 
 	 	 _ j s n s :   " u r n : z i m b r a A c c o u n t " , 
 	 	 d l :   { b y :   " n a m e " , 
 	 	 	   _ c o n t e n t :   t h i s . g e t E m a i l ( ) 
 	 	 } , 
 	 	 a c t i o n :   { 
 	 	 	 o p :   " s e t O w n e r s " , 
 	 	 	 o w n e r :   o w n e r s P a r t 
 	 	 } 
 	 } ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t S e t M a i l P o l i c y R e q   = 
 f u n c t i o n ( m a i l P o l i c y ,   s p e c i f i c M a i l e r s )   { 
 	 v a r   g r a n t e e s   =   [ ] ; 
 	 i f   ( m a i l P o l i c y   = =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ S P E C I F I C )   { 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   s p e c i f i c M a i l e r s . l e n g t h ;   i + + )   { 
 	 	 	 g r a n t e e s . p u s h ( { 
 	 	 	 	 t y p e :   Z m G r o u p V i e w . G R A N T E E _ T Y P E _ E M A I L , 
 	 	 	 	 b y :   " n a m e " , 
 	 	 	 	 _ c o n t e n t :   s p e c i f i c M a i l e r s [ i ] 
 	 	 	 } ) ; 
 	 	 } 
 	 } 
 	 e l s e   i f   ( m a i l P o l i c y   = =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ A N Y O N E )   { 
 	 	 g r a n t e e s . p u s h ( { 
 	 	 	 t y p e :   Z m G r o u p V i e w . G R A N T E E _ T Y P E _ P U B L I C 
 	 	 } ) ; 
 	 } 
 	 e l s e   i f   ( m a i l P o l i c y   = =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ I N T E R N A L )   { 
 	 	 g r a n t e e s . p u s h ( { 
 	 	 	 t y p e :   Z m G r o u p V i e w . G R A N T E E _ T Y P E _ A L L 
 	 	 } ) ; 
 	 } 
 	 e l s e   i f   ( m a i l P o l i c y   = =   Z m G r o u p V i e w . M A I L _ P O L I C Y _ M E M B E R S )   { 
 	 	 g r a n t e e s . p u s h ( { 
 	 	 	 t y p e :   Z m G r o u p V i e w . G R A N T E E _ T Y P E _ G R O U P , 
 	 	 	 b y :   " n a m e " , 
 	 	 	 _ c o n t e n t :   t h i s . g e t E m a i l ( ) 
 	 	 } ) ; 
 	 } 
 	 e l s e   { 
 	 	 t h r o w   " i n v a l i d   m a i l P o l i c y   v a l u e   "   +   m a i l P o l i c y ; 
 	 } 
 
 	 r e t u r n   { 
 	 	 _ j s n s :   " u r n : z i m b r a A c c o u n t " , 
 	 	 d l :   { b y :   " n a m e " , 
 	 	 	   _ c o n t e n t :   t h i s . g e t E m a i l ( ) 
 	 	 } , 
 	 	 a c t i o n :   { 
 	 	 	 o p :   " s e t R i g h t s " , 
 	 	 	 r i g h t :   { 
 	 	 	 	 r i g h t :   " s e n d T o D i s t L i s t " , 
 	 	 	 	 g r a n t e e :   g r a n t e e s 
 	 	 	 } 
 	 	 } 
 	 } ; 
 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ a d d D l A t t r i b u t e   = 
 f u n c t i o n ( a t t r s ,   m o d s ,   n a m e ,   s o a p A t t r N a m e )   { 
 	 v a r   a t t r   =   m o d s [ n a m e ] ; 
 	 i f   ( a t t r   = = =   u n d e f i n e d )   { 
 	 	 r e t u r n ; 
 	 } 
 	 a t t r s . p u s h ( { n :   s o a p A t t r N a m e ,   _ c o n t e n t :   a t t r } ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t D l A t t r i b u t e s   = 
 f u n c t i o n ( m o d s )   { 
 	 v a r   a t t r s   =   [ ] ; 
 	 t h i s . _ a d d D l A t t r i b u t e ( a t t r s ,   m o d s ,   Z m C o n t a c t . F _ d l D i s p l a y N a m e ,   " d i s p l a y N a m e " ) ; 
 	 t h i s . _ a d d D l A t t r i b u t e ( a t t r s ,   m o d s ,   Z m C o n t a c t . F _ d l D e s c ,   " d e s c r i p t i o n " ) ; 
 	 t h i s . _ a d d D l A t t r i b u t e ( a t t r s ,   m o d s ,   Z m C o n t a c t . F _ d l N o t e s ,   " z i m b r a N o t e s " ) ; 
 	 t h i s . _ a d d D l A t t r i b u t e ( a t t r s ,   m o d s ,   Z m C o n t a c t . F _ d l H i d e I n G a l ,   " z i m b r a H i d e I n G a l " ) ; 
 	 t h i s . _ a d d D l A t t r i b u t e ( a t t r s ,   m o d s ,   Z m C o n t a c t . F _ d l S u b s c r i p t i o n P o l i c y ,   " z i m b r a D i s t r i b u t i o n L i s t S u b s c r i p t i o n P o l i c y " ) ; 
 	 t h i s . _ a d d D l A t t r i b u t e ( a t t r s ,   m o d s ,   Z m C o n t a c t . F _ d l U n s u b s c r i p t i o n P o l i c y ,   " z i m b r a D i s t r i b u t i o n L i s t U n s u b s c r i p t i o n P o l i c y " ) ; 
 
 	 r e t u r n   a t t r s ; 
 } ; 
 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t C r e a t e D l R e q   = 
 f u n c t i o n ( a t t r )   { 
 	 r e t u r n   { 
 	 	 _ j s n s :   " u r n : z i m b r a A c c o u n t " , 
 	 	 n a m e :   a t t r [ Z m C o n t a c t . F _ e m a i l ] , 
 	 	 a :   t h i s . _ g e t D l A t t r i b u t e s ( a t t r ) , 
 	 	 d y n a m i c :   f a l s e 
 	 } ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t M o d i f y D l A t t r i b u t e s R e q   = 
 f u n c t i o n ( a t t r )   { 
 	 v a r   m o d A t t r s   =   t h i s . _ g e t D l A t t r i b u t e s ( a t t r ) ; 
 	 i f   ( m o d A t t r s . l e n g t h   = =   0 )   { 
 	 	 r e t u r n   n u l l ; 
 	 } 
 	 r e t u r n   { 
 	 	 _ j s n s :   " u r n : z i m b r a A c c o u n t " , 
 	 	 d l :   { b y :   " n a m e " , 
 	 	 	   _ c o n t e n t :   t h i s . g e t E m a i l ( ) 
 	 	 } , 
 	 	 a c t i o n :   { 
 	 	 	 o p :   " m o d i f y " , 
 	 	 	 a :   m o d A t t r s 
 	 	 } 
 	 } ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ m o d i f y D l R e s p o n s e H a n d l e r   = 
 f u n c t i o n ( f i l e A s C h a n g e d ,   r e s u l t )   { 
 	 i f   ( t h i s . _ h a n d l e E r r o r D l ( r e s u l t ) )   { 
 	 	 r e t u r n ; 
 	 } 
 	 a p p C t x t . s e t S t a t u s M s g ( Z m M s g . d l S a v e d ) ; 
 
 	 / / f o r   D L s   w e   r e l o a d   f r o m   t h e   s e r v e r   s i n c e   t h e   s e r v e r   d o e s   n o t   s e n d   n o t i f i c a t i o n s . 
 	 t h i s . c l e a r D l I n f o ( ) ; 
 
 	 v a r   d e t a i l s   =   { 
 	 	 f i l e A s C h a n g e d :   f i l e A s C h a n g e d 
 	 } ; 
 
 	 t h i s . _ p o p V i e w ( f i l e A s C h a n g e d ) ; 
 
 	 t h i s . _ n o t i f y ( Z m E v e n t . E _ M O D I F Y ,   d e t a i l s ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ c r e a t e D l R e s p o n s e H a n d l e r   = 
 f u n c t i o n ( r e s u l t )   { 
 	 i f   ( t h i s . _ h a n d l e E r r o r D l ( r e s u l t ,   t r u e ) )   { 
 	 	 t h i s . a t t r   =   { } ;   / / s i n c e   a b o v e   i n   _ c r e a t e D l ,   w e   s e t   i t   t o   n e w   v a l u e s   p r e m a t u r e l y .   w h i c h   w o u l d   a f f e c t   n e x t   g a t h e r i n g   o f   m o d i f i e d   a t t r i b u t e s . 
 	 	 r e t u r n ; 
 	 } 
 	 a p p C t x t . s e t S t a t u s M s g ( Z m M s g . d i s t r i b u t i o n L i s t C r e a t e d ) ; 
 
 	 t h i s . _ p o p V i e w ( t r u e ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ p o p V i e w   = 
 f u n c t i o n ( u p d a t e D l L i s t )   { 
 	 v a r   c o n t r o l l e r   =   A j x D i s p a t c h e r . r u n ( " G e t C o n t a c t C o n t r o l l e r " ) ; 
 	 c o n t r o l l e r . p o p V i e w ( t r u e ) ; 
 	 i f   ( ! u p d a t e D l L i s t )   { 
 	 	 r e t u r n ; 
 	 } 
 	 v a r   c l c   =   A j x D i s p a t c h e r . r u n ( " G e t C o n t a c t L i s t C o n t r o l l e r " ) ; 
 	 i f   ( c l c . g e t F o l d e r I d ( )   ! =   Z m F o l d e r . I D _ D L S )   { 
 	 	 r e t u r n ; 
 	 } 
 	 Z m A d d r B o o k T r e e C o n t r o l l e r . d l F o l d e r C l i c k e d ( ) ;   / / T h i s   i s   i m p o r t a n t   i n   c a s e   o f   n e w   D L   c r e a t e d   O R   a   r e n a m e d   D L ,   s o   i t   w o u l d   r e f l e c t   i n   t h e   l i s t . 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e E r r o r D l   = 
 f u n c t i o n ( r e s u l t ,   c r e a t i o n )   { 
 	 i f   ( ! r e s u l t )   { 
 	 	 r e t u r n   f a l s e ; 
 	 } 
 	 v a r   b a t c h R e s p   =   r e s u l t . g e t R e s p o n s e ( ) . B a t c h R e s p o n s e ; 
 	 v a r   f a u l t s   =   b a t c h R e s p . F a u l t ; 
 	 i f   ( ! f a u l t s )   { 
 	 	 r e t u r n   f a l s e ; 
 	 } 
 	 v a r   e x   =   Z m C s f e C o m m a n d . f a u l t T o E x ( f a u l t s [ 0 ] ) ; 
 	 v a r   c o n t r o l l e r   =   A j x D i s p a t c h e r . r u n ( " G e t C o n t a c t C o n t r o l l e r " ) ; 
 	 c o n t r o l l e r . p o p u p E r r o r D i a l o g ( c r e a t i o n   ?   Z m M s g . d l C r e a t e F a i l e d   :   Z m M s g . d l M o d i f y F a i l e d ,   e x ) ; 
 	 r e t u r n   t r u e ; 
 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . c l e a r D l I n f o   = 
 f u n c t i o n   ( )   { 
 	 t h i s . d l M e m b e r s   =   n u l l ; 
 	 t h i s . d l I n f o   =   n u l l ; 
 	 v a r   a p p   =   a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) ; 
 	 a p p . c a c h e D L ( t h i s . g e t E m a i l ( ) ,   n u l l ) ;   / / c l e a r   t h e   c a c h e   f o r   t h i s   D L . 
 	 a p p C t x t . c a c h e R e m o v e ( t h i s . g e t I d ( ) ) ;   / / a l s o   s o m e   o t h e r   c a c h e . 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e R e s p o n s e M o d i f y   = 
 f u n c t i o n ( a t t r ,   c a l l b a c k ,   i s A u t o S a v e ,   r e s u l t )   { 
 	 v a r   r e s p   =   r e s u l t . g e t R e s p o n s e ( ) . M o d i f y C o n t a c t R e s p o n s e ; 
 	 v a r   c n   =   r e s p   ?   r e s p . c n [ 0 ]   :   n u l l ; 
 	 v a r   i d   =   c n   ?   c n . i d   :   n u l l ; 
 	 v a r   g r o u p M e m b e r s   =   c n   ?   c n . m   :   n u l l ; 
 	 i f   ( g r o u p M e m b e r s )   { 
 	 	 t h i s . a t t r [ Z m C o n t a c t . F _ g r o u p s ]   =   g r o u p M e m b e r s ; 
 	 	 c n . _ a t t r s [ Z m C o n t a c t . F _ g r o u p s ]   =   g r o u p M e m b e r s ; 	 
 	 } 
 
 	 i f   ( i d   & &   i d   = =   t h i s . i d )   { 
 	 	 i f   ( ! i s A u t o S a v e )   { 
 	 	 	 a p p C t x t . s e t S t a t u s M s g ( t h i s . i s G r o u p ( )   ?   Z m M s g . g r o u p S a v e d   :   Z m M s g . c o n t a c t S a v e d ) ; 
 	 	 } 
 	 	 / /   w a s   t h i s   c o n t a c t   m o v e d   t o   a n o t h e r   f o l d e r ? 
 	 	 i f   ( a t t r [ Z m C o n t a c t . F _ f o l d e r I d ]   & &   t h i s . f o l d e r I d   ! =   a t t r [ Z m C o n t a c t . F _ f o l d e r I d ] )   { 
 	 	 	 t h i s . _ s e t F o l d e r ( a t t r [ Z m C o n t a c t . F _ f o l d e r I d ] ) ; 
 	 	 } 
 	 	 a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) . u p d a t e I d H a s h ( c n ,   f a l s e ) ; 
 	 }   e l s e   { 
                 v a r   d e t a i l   =   Z m M s g . e r r o r T r y A g a i n   +   " \ n "   +   Z m M s g . e r r o r C o n t a c t ; 
                 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e t S t a t u s M s g ( Z m M s g . e r r o r M o d i f y C o n t a c t ,   Z m S t a t u s V i e w . L E V E L _ C R I T I C A L ,   d e t a i l ) ; 
 	 } 
 	 / /   N O T E :   w e   n o   l o n g e r   p r o c e s s   c a l l b a c k s   h e r e   s i n c e   n o t i f i c a t i o n   h a n d l i n g 
 	 / /               t a k e s   c a r e   o f   e v e r y t h i n g 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e R e s p o n s e M o v e   = 
 f u n c t i o n ( n e w F o l d e r I d ,   r e s p )   { 
 	 v a r   n e w F o l d e r   =   n e w F o l d e r I d   & &   a p p C t x t . g e t B y I d ( n e w F o l d e r I d ) ; 
 	 v a r   c o u n t   =   1 ; 
 	 i f   ( n e w F o l d e r )   { 
 	 	 a p p C t x t . s e t S t a t u s M s g ( Z m L i s t . g e t A c t i o n S u m m a r y ( { 
 	 	 	 a c t i o n T e x t K e y :     ' a c t i o n M o v e ' , 
 	 	 	 n u m I t e m s :               c o u n t , 
 	 	 	 t y p e :                       Z m I t e m . C O N T A C T , 
 	 	 	 a c t i o n A r g :             n e w F o l d e r . n a m e 
 	 	 } ) ) ; 
 	 } 
 
 	 t h i s . _ n o t i f y ( Z m E v e n t . E _ M O D I F Y ,   r e s p ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ s e t F o l d e r   = 
 f u n c t i o n ( n e w F o l d e r I d )   { 
 	 v a r   f o l d e r   =   a p p C t x t . g e t B y I d ( t h i s . f o l d e r I d ) ; 
 	 v a r   f I d   =   f o l d e r   ?   f o l d e r . n I d   :   n u l l ; 
 	 i f   ( f I d   = =   n e w F o l d e r I d )   {   r e t u r n ;   } 
 
 	 / /   m o v i n g   o u t   o f   a   s h a r e   o r   i n t o   o n e   i s   h a n d l e d   d i f f e r e n t l y   ( c r e a t e   t h e n   h a r d   d e l e t e ) 
 	 v a r   n e w F o l d e r   =   a p p C t x t . g e t B y I d ( n e w F o l d e r I d ) ; 
 	 i f   ( t h i s . i s S h a r e d ( )   | |   ( n e w F o l d e r   & &   n e w F o l d e r . l i n k ) )   { 
 	 	 i f   ( t h i s . l i s t )   { 
 	 	 	 t h i s . l i s t . m o v e I t e m s ( { i t e m s : [ t h i s ] ,   f o l d e r : n e w F o l d e r } ) ; 
 	 	 } 
 	 }   e l s e   { 
 	 	 v a r   j s o n O b j   =   { C o n t a c t A c t i o n R e q u e s t : { _ j s n s : " u r n : z i m b r a M a i l " } } ; 
 	 	 j s o n O b j . C o n t a c t A c t i o n R e q u e s t . a c t i o n   =   { i d : t h i s . i d ,   o p : " m o v e " ,   l : n e w F o l d e r I d } ; 
 	 	 v a r   r e s p C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e R e s p o n s e M o v e ,   [ n e w F o l d e r I d ] ) ; 
 	 	 v a r   a c c o u n t N a m e   =   a p p C t x t . m u l t i A c c o u n t s   & &   a p p C t x t . a c c o u n t L i s t . m a i n A c c o u n t . n a m e ; 
 	 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { j s o n O b j : j s o n O b j ,   a s y n c M o d e : t r u e ,   c a l l b a c k : r e s p C a l l b a c k ,   a c c o u n t N a m e : a c c o u n t N a m e } ) ; 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . n o t i f y M o d i f y   = 
 f u n c t i o n ( o b j ,   b a t c h M o d e )   { 
 
 	 v a r   r e s u l t   =   Z m I t e m . p r o t o t y p e . n o t i f y M o d i f y . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
 
 	 v a r   c o n t e x t   =   w i n d o w . p a r e n t A p p C t x t   | |   w i n d o w . a p p C t x t ; 
 	 c o n t e x t . c l e a r A u t o c o m p l e t e C a c h e ( Z m A u t o c o m p l e t e . A C _ T Y P E _ C O N T A C T ) ; 
 
 	 i f   ( r e s u l t )   { 
 	 	 r e t u r n   r e s u l t ; 
 	 } 
 
 	 / /   c a c h e   o l d   f i l e A s / f u l l N a m e   b e f o r e   r e s e t t i n g   t h e m 
 	 v a r   o l d F i l e A s   =   t h i s . g e t F i l e A s ( ) ; 
 	 v a r   o l d F u l l N a m e   =   t h i s . g e t F u l l N a m e ( ) ; 
 	 t h i s . _ r e s e t C a c h e d F i e l d s ( ) ; 
 
 	 v a r   o l d A t t r C a c h e   =   { } ; 
 	 i f   ( o b j . _ a t t r s )   { 
 	 	 / /   r e m o v e   a t t r s   t h a t   w e r e   n o t   r e t u r n e d   b a c k   f r o m   t h e   s e r v e r 
 	 	 v a r   o l d A t t r s   =   t h i s . g e t A t t r s ( ) ; 
 	 	 f o r   ( v a r   a   i n   o l d A t t r s )   { 
 	 	 	 o l d A t t r C a c h e [ a ]   =   o l d A t t r s [ a ] ; 
 	 	 	 i f   ( o b j . _ a t t r s [ a ]   = =   n u l l ) 
 	 	 	 	 t h i s . r e m o v e A t t r ( a ) ; 
 	 	 } 
 
 	 	 / /   s e t   a t t r s   r e t u r n e d   b y   s e r v e r 
 	 	 f o r   ( v a r   a   i n   o b j . _ a t t r s )   { 
 	 	 	 t h i s . s e t A t t r ( a ,   o b j . _ a t t r s [ a ] ) ; 
 	 	 } 
 	 	 i f   ( o b j . m )   { 
 	 	 	 t h i s . s e t A t t r ( Z m C o n t a c t . F _ g r o u p s ,   o b j . m ) ; 
 	 	 } 
 	 } 
 
 	 v a r   d e t a i l s   =   { 
 	 	 a t t r :   o b j . _ a t t r s , 
 	 	 o l d A t t r :   o l d A t t r C a c h e , 
 	 	 f u l l N a m e C h a n g e d :   ( t h i s . g e t F u l l N a m e ( )   ! =   o l d F u l l N a m e ) , 
 	 	 f i l e A s C h a n g e d :   ( t h i s . g e t F i l e A s ( )   ! =   o l d F i l e A s ) , 
 	 	 c o n t a c t :   t h i s 
 	 } ; 
 
 	 / /   u p d a t e   t h i s   c o n t a c t ' s   l i s t   p e r   o l d / n e w   a t t r s 
 	 f o r   ( v a r   l i s t I d   i n   t h i s . _ l i s t )   { 
 	 	 v a r   l i s t   =   l i s t I d   & &   a p p C t x t . g e t B y I d ( l i s t I d ) ; 
 	 	 i f   ( ! l i s t )   {   c o n t i n u e ;   } 
 	 	 l i s t . m o d i f y L o c a l ( o b j ,   d e t a i l s ) ; 
 	 } 
 
 	 t h i s . _ n o t i f y ( Z m E v e n t . E _ M O D I F Y ,   o b j ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . n o t i f y D e l e t e   = 
 f u n c t i o n ( )   { 
 	 Z m I t e m . p r o t o t y p e . n o t i f y D e l e t e . c a l l ( t h i s ) ; 
 	 v a r   c o n t e x t   =   w i n d o w . p a r e n t A p p C t x t   | |   w i n d o w . a p p C t x t ; 
 	 c o n t e x t . c l e a r A u t o c o m p l e t e C a c h e ( Z m A u t o c o m p l e t e . A C _ T Y P E _ C O N T A C T ) ; 
 } ; 
 
 / * * 
   *   I n i t i a l i z e s   t h i s   c o n t a c t   u s i n g   a n   e m a i l   a d d r e s s . 
   * 
   *   @ p a r a m   { A j x E m a i l A d d r e s s | S t r i n g } 	 e m a i l 	 	 a n   e m a i l   a d d r e s s   o r   a n   e m a i l   s t r i n g 
   *   @ p a r a m   { B o o l e a n } 	 s t r i c t N a m e 	 i f   < c o d e > t r u e < / c o d e > ,   d o   n o t   t r y   t o   s e t   n a m e   f r o m   u s e r   p o r t i o n   o f   a d d r e s s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . i n i t F r o m E m a i l   = 
 f u n c t i o n ( e m a i l ,   s t r i c t N a m e )   { 
 	 i f   ( e m a i l   i n s t a n c e o f   A j x E m a i l A d d r e s s )   { 
 	 	 t h i s . s e t A t t r ( Z m C o n t a c t . F _ e m a i l ,   e m a i l . g e t A d d r e s s ( ) ) ; 
 	 	 t h i s . _ i n i t F u l l N a m e ( e m a i l ,   s t r i c t N a m e ) ; 
 	 }   e l s e   { 
 	 	 t h i s . s e t A t t r ( Z m C o n t a c t . F _ e m a i l ,   e m a i l ) ; 
 	 } 
 } ; 
 
 / * * 
   *   I n i t i a l i z e s   t h i s   c o n t a c t   u s i n g   a   p h o n e   n u m b e r . 
   * 
   *   @ p a r a m   { S t r i n g } 	 p h o n e 	 	 t h e   p h o n e   s t r i n g 
   *   @ p a r a m   { S t r i n g } 	 f i e l d 	 	 t h e   f i e l d   o r   c o m p a n y   p h o n e   i f   < c o d e > n u l l < / c o d e > 
   * / 
 Z m C o n t a c t . p r o t o t y p e . i n i t F r o m P h o n e   = 
 f u n c t i o n ( p h o n e ,   f i e l d )   { 
 	 t h i s . s e t A t t r ( f i e l d   | |   Z m C o n t a c t . F _ c o m p a n y P h o n e ,   p h o n e ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   e m a i l   a d d r e s s . 
   *   
   *   @ p a r a m   { b o o l e a n } 	 	 a s O b j 	 i f   t r u e ,   r e t u r n   a n   A j x E m a i l A d d r e s s 
   *   
   *   @ r e t u r n 	 t h e   e m a i l   a d d r e s s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t E m a i l   = 
 f u n c t i o n ( a s O b j )   { 
 
 	 v a r   e m a i l   =   ( t h i s . g e t A t t r ( Z m C o n t a c t . F _ e m a i l )   | | 
 	 	 	 	   t h i s . g e t A t t r ( Z m C o n t a c t . F _ w o r k E m a i l 1 )   | | 
 	 	 	 	   t h i s . g e t A t t r ( Z m C o n t a c t . F _ e m a i l 2 )   | | 
 	 	 	 	   t h i s . g e t A t t r ( Z m C o n t a c t . F _ w o r k E m a i l 2 )   | | 
 	 	 	 	   t h i s . g e t A t t r ( Z m C o n t a c t . F _ e m a i l 3 )   | | 
 	 	 	 	   t h i s . g e t A t t r ( Z m C o n t a c t . F _ w o r k E m a i l 3 ) ) ; 
 	 
 	 i f   ( a s O b j )   { 
 	 	 e m a i l   =   A j x E m a i l A d d r e s s . p a r s e ( e m a i l ) ; 
                 i f ( e m a i l ) { 
 	 	         e m a i l . i s G r o u p   =   t h i s . i s G r o u p ( ) ; 
 	 	         e m a i l . c a n E x p a n d   =   t h i s . c a n E x p a n d ; 
                 } 
 	 } 
 	 
 	 r e t u r n   e m a i l ; 
 } ; 
 
 / * * 
   *   R e t u r n s   u s e r ' s   p h o n e   n u m b e r 
   *   @ r e t u r n   { S t r i n g }   p h o n e   n u m b e r 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t P h o n e   =   
 f u n c t i o n ( )   { 
 	 v a r   p h o n e   =   ( t h i s . g e t A t t r ( Z m C o n t a c t . F _ m o b i l e P h o n e )   | | 
 	 	 	 	 t h i s . g e t A t t r ( Z m C o n t a c t . F _ w o r k P h o n e )   | |   
 	 	 	 	 t h i s . g e t A t t r ( Z m C o n t a c t . F _ h o m e P h o n e )   | | 
 	 	 	 	 t h i s . g e t A t t r ( Z m C o n t a c t . F _ o t h e r P h o n e ) ) ; 
 	 r e t u r n   p h o n e ; 
 } ; 
 
         
 / * * 
   *   G e t s   t h e   l o o k u p   e m a i l   a d d r e s s ,   w h e n   a n   c o n t a c t   o b j e c t   i s   l o c a t e d   u s i n g   e m a i l   a d d r e s s   w e   s t o r e 
   *   t h e   r e f e r r e d   e m a i l   a d d r e s s   i n   t h i s   v a r i a b l e   f o r   e a s y   l o o k u p 
   * 
   *   @ p a r a m   { b o o l e a n } 	 	 a s O b j 	 i f   t r u e ,   r e t u r n   a n   A j x E m a i l A d d r e s s 
   * 
   *   @ r e t u r n 	 t h e   l o o k u p   a d d r e s s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t L o o k u p E m a i l   = 
 f u n c t i o n ( a s O b j )   { 
         v a r   e m a i l   =   t h i s . _ l o o k u p E m a i l ; 
 
         i f   ( a s O b j   & &   e m a i l )   { 
                 e m a i l   =   A j x E m a i l A d d r e s s . p a r s e ( e m a i l ) ; 
                 e m a i l . i s G r o u p   =   t h i s . i s G r o u p ( ) ; 
                 e m a i l . c a n E x p a n d   =   t h i s . c a n E x p a n d ; 
         } 
 
 	 r e t u r n     e m a i l ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   e m a i l s . 
   *   
   *   @ r e t u r n 	 { A r r a y } 	   a n   a r r a y   o f   a l l   v a l i d   e m a i l s   f o r   t h i s   c o n t a c t 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t E m a i l s   = 
 f u n c t i o n ( )   { 
 	 v a r   e m a i l s   =   [ ] ; 
 	 v a r   a t t r s   =   t h i s . g e t A t t r s ( ) ; 
 	 f o r   ( v a r   i n d e x   =   0 ;   i n d e x   <   Z m C o n t a c t . E M A I L _ F I E L D S . l e n g t h ;   i n d e x + + )   { 
 	 	 v a r   f i e l d   =   Z m C o n t a c t . E M A I L _ F I E L D S [ i n d e x ] ; 
 	 	 f o r   ( v a r   i   =   1 ;   t r u e ;   i + + )   { 
 	 	 	 v a r   a n a m e   =   Z m C o n t a c t . g e t A t t r i b u t e N a m e ( f i e l d ,   i ) ; 
 	 	 	 i f   ( ! a t t r s [ a n a m e ] )   b r e a k ; 
 	 	 	 e m a i l s . p u s h ( a t t r s [ a n a m e ] ) ; 
 	 	 } 
 	 } 
 	 r e t u r n   e m a i l s ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   f u l l   n a m e . 
   *   
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   f u l l   n a m e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t F u l l N a m e   = 
 f u n c t i o n ( h t m l )   { 
         v a r   f u l l N a m e H t m l   =   n u l l ; 
 	 i f   ( ! t h i s . _ f u l l N a m e   | |   h t m l )   { 
 	 	 v a r   f u l l N a m e   =   t h i s . g e t A t t r ( Z m C o n t a c t . X _ f u l l N a m e ) ;   / /   p r e s e n t   i f   G A L   c o n t a c t 
 	 	 i f   ( f u l l N a m e )   { 
 	 	 	 t h i s . _ f u l l N a m e   =   ( f u l l N a m e   i n s t a n c e o f   A r r a y )   ?   f u l l N a m e [ 0 ]   :   f u l l N a m e ; 
 	 	 } 
                 e l s e   { 
                         t h i s . _ f u l l N a m e   =   t h i s . g e t F u l l N a m e F o r D i s p l a y ( f a l s e ) ; 
                 } 
 
                 i f   ( h t m l )   { 
                         f u l l N a m e H t m l   =   t h i s . g e t F u l l N a m e F o r D i s p l a y ( h t m l ) ; 
                 } 
 	 } 
 
 	 / /   a s   a   l a s t   r e s o r t ,   s e t   i t   t o   f i l e A s 
 	 i f   ( ! t h i s . _ f u l l N a m e )   { 
 	 	 t h i s . _ f u l l N a m e   =   t h i s . g e t F i l e A s ( ) ; 
 	 } 
 
 	 r e t u r n   f u l l N a m e H t m l   | |   t h i s . _ f u l l N a m e ; 
 } ; 
 
 / * 
 *   G e t s   t h e   f u l l n a m e   f o r   d i s p l a y   - -   i n c l u d e s   ( i f   a p p l i c a b l e ) :   p r e f i x ,   f i r s t ,   m i d d l e ,   m a i d e n ,   l a s t ,   s u f f i x 
 * 
 *   @ p a r a m   { b o o l e a n }     i f   p h o n e t i c   f i e l d s   s h o u l d   b e   u s e d 
 *   @ r e t u r n   { S t r i n g }     t h e   f u l l n a m e   f o r   d i s p l a y 
 * / 
 Z m C o n t a c t . p r o t o t y p e . g e t F u l l N a m e F o r D i s p l a y   = 
 f u n c t i o n ( h t m l ) { 
 	 i f   ( t h i s . i s D i s t r i b u t i o n L i s t ( ) )   { 
 	 	 / / I ' m   n o t   s u r e   w h e r e   t h a t   f u l l N a m e   i s   s e t   s o m e t i m e   t o   t h e   d i s p l a y   n a m e .   T h i s   i s   s o   c o m p l i c a t e d 
 	 	 / /   I ' m   t r y i n g   t o   s e t   a t t r [ Z m C o n t a c t . F _ d l D i s p l a y N a m e ]   t o   t h e   d i s p l a y   n a m e   b u t   i n   s o e m   c a s e s   i t ' s   n o t . 
 	 	 r e t u r n   t h i s . g e t A t t r ( Z m C o n t a c t . F _ d l D i s p l a y N a m e )   | |   t h i s . g e t A t t r ( " f u l l N a m e " ) ; 
 	 } 
         v a r   p r e f i x   =   t h i s . g e t A t t r ( Z m C o n t a c t . F _ n a m e P r e f i x ) ; 
         v a r   f i r s t   =   t h i s . g e t A t t r ( Z m C o n t a c t . F _ f i r s t N a m e ) ; 
         v a r   m i d d l e   =   t h i s . g e t A t t r ( Z m C o n t a c t . F _ m i d d l e N a m e ) ; 
         v a r   m a i d e n   =   t h i s . g e t A t t r ( Z m C o n t a c t . F _ m a i d e n N a m e ) ; 
         v a r   l a s t   =   t h i s . g e t A t t r ( Z m C o n t a c t . F _ l a s t N a m e ) ; 
         v a r   s u f f i x   =   t h i s . g e t A t t r ( Z m C o n t a c t . F _ n a m e S u f f i x ) ; 
         v a r   p a t t e r n   =   Z m M s g . f u l l n a m e ; 
         i f   ( s u f f i x )   { 
                 p a t t e r n   =   m a i d e n   ?   Z m M s g . f u l l n a m e M a i d e n S u f f i x   :   Z m M s g . f u l l n a m e S u f f i x ; 
         } 
         e l s e   i f   ( m a i d e n )   { 
                 p a t t e r n   =   Z m M s g . f u l l n a m e M a i d e n ; 
         } 
         i f   ( a p p C t x t . g e t ( Z m S e t t i n g . L O C A L E _ N A M E )   = = =   " j a " )   { 
                 v a r   f i l e A s I d   =   t h i s . g e t A t t r ( Z m C o n t a c t . F _ f i l e A s ) ; 
                 i f   ( ! A j x U t i l . i s E m p t y ( f i l e A s I d )   & &   f i l e A s I d   ! = =   " 1 "   & &   f i l e A s I d   ! = =   " 4 "   & &   f i l e A s I d   ! = =   " 6 " )   { 
                         / *   W h e n   J a p a n e s e   l o c a l e   i s   s e l e c t e d ,   i n   t h e   m o s t   e v e r y   c a s e ,   t h e   n a m e   s h o u l d   b e 
                           *   d i s p l a y e d   a s   " L a s t   F i r s t "   w h i c h   i s   s e t   b y   t h e   d e f a u l t   p a t t e r n   ( Z m M s g _ j a . f u l l n a m e ) . 
                           *   B u t   i f   t h e   c o n t a c t   e n t r y ' s   f i l e A s   f i e l d   e x p l i c i t l y   s p e c i f i e s   t h e   d i s p l a y 
                           *   f o r m a t   a s   " F i r s t   L a s t " ,   w e   s h o u l d   o v e r r i d e   t h e   p a t t e r n   t o   l a y   i t   o u t   s o . 
                           *   F o r   o t h e r   l o c a l e s ,   i t   i s   n o t   n e c e s s a r y   t o   o v e r r i d e   t h e   p a t t e r n :   T h e   d e f a u l t   p a t t e r n   i s 
                           *   a l r e a d y   s e t   a s   " F i r s t   L a s t " ,   a n d   e v e n   t h e   F i l e A s   s p e c i f i e s   a s   " L a s t ,   F i r s t " ,   t h e   d i s p l a y 
                           *   n a m e   i s   a l w a y s   e x p e c t e d   t o   b e   d i s p l a y e d   a s   " F i r s t   L a s t " . 
                           * / 
                         p a t t e r n   =   " { 0 }   { 1 }   { 2 }   { 4 } " ; 
                 } 
         } 
         v a r   f o r m a t t e r   =   n e w   A j x M e s s a g e F o r m a t ( p a t t e r n ) ; 
         v a r   a r g s   =   [ p r e f i x , f i r s t , m i d d l e , m a i d e n , l a s t , s u f f i x ] ; 
         i f   ( ! h t m l ) { 
                 r e t u r n   A j x S t r i n g U t i l . t r i m ( f o r m a t t e r . f o r m a t ( a r g s ) ,   t r u e ) ; 
         } 
 
         r e t u r n   t h i s . _ g e t F u l l N a m e H t m l ( f o r m a t t e r ,   a r g s ) ; 
 } ; 
 
 / * * 
   *   @ p a r a m   f o r m a t t e r 
   *   @ p a r a m   p a r t s   { A r r a y }   N a m e   p a r t s :   [ p r e f i x , f i r s t , m i d d l e , m a i d e n , l a s t , s u f f i x ] 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ g e t F u l l N a m e H t m l   =   f u n c t i o n ( f o r m a t t e r ,   p a r t s )   { 
         v a r   a   =   [ ] ; 
         v a r   s e g m e n t s   =   f o r m a t t e r . g e t S e g m e n t s ( ) ; 
         f o r   ( v a r   i   =   0 ;   i   <   s e g m e n t s . l e n g t h ;   i + + )   { 
                 v a r   s e g m e n t   =   s e g m e n t s [ i ] ; 
                 i f   ( s e g m e n t   i n s t a n c e o f   A j x F o r m a t . T e x t S e g m e n t )   { 
                         a . p u s h ( s e g m e n t . f o r m a t ( ) ) ; 
                         c o n t i n u e ; 
                 } 
                 / /   N O T E :   A s s u m e   t h a t   i t ' s   a   A j x M e s s a g e F o r m a t . M e s s a g e S e g m e n t 
                 / /   N O T E :   i f   n o t   a   A j x F o r m a t . T e x t S e g m e n t . 
                 v a r   i n d e x   =   s e g m e n t . g e t I n d e x ( ) ; 
                 v a r   b a s e   =   p a r t s [ i n d e x ] ; 
                 v a r   t e x t   =   Z m C o n t a c t . _ _ R U B Y _ F I E L D S [ i n d e x ]   & &   t h i s . g e t A t t r ( Z m C o n t a c t . _ _ R U B Y _ F I E L D S [ i n d e x ] ) ; 
                 a . p u s h ( A j x S t r i n g U t i l . h t m l R u b y E n c o d e ( b a s e ,   t e x t ) ) ; 
         } 
         r e t u r n   a . j o i n ( " " ) ; 
 } ; 
 Z m C o n t a c t . _ _ R U B Y _ F I E L D S   =   [ 
         n u l l ,   Z m C o n t a c t . F _ p h o n e t i c F i r s t N a m e ,   n u l l ,   n u l l , 
         Z m C o n t a c t . F _ p h o n e t i c L a s t N a m e ,   n u l l 
 ] ; 
 
 / * * 
   *   G e t s   t h e   t o o l   t i p   f o r   t h i s   c o n t a c t . 
   *   
   *   @ p a r a m 	 { S t r i n g } 	 e m a i l 	 	 t h e   e m a i l   a d d r e s s 
   *   @ p a r a m 	 { B o o l e a n } 	 i s G a l 	 	 ( n o t   u s e d ) 
   *   @ p a r a m 	 { S t r i n g } 	 h i n t 	 	 t h e   h i n t   t e x t 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   t o o l   t i p   i n   H T M L 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t T o o l T i p   = 
 f u n c t i o n ( e m a i l ,   i s G a l ,   h i n t )   { 
 	 / /   X X X :   w e   d o n t   c a c h e   t o o l t i p   i n f o   a n y m o r e   s i n c e   i t s   t o o   d y n a m i c   : / 
 	 / /   i . e .   I M   s t a t u s   c a n   c h a n g e   a n y t i m e   s o   a l w a y s   r e b u i l d   t o o l t i p   a n d   b u g   1 3 8 3 4 
 	 v a r   s u b s   =   { 
 	 	 c o n t a c t :   t h i s , 
 	 	 e n t r y T i t l e :   t h i s . g e t F i l e A s ( ) , 
 	 	 h i n t :   h i n t 
 	 } ; 
 
 	 r e t u r n   ( A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # T o o l t i p " ,   s u b s ) ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   f i l i n g   s t r i n g   f o r   t h i s   c o n t a c t ,   c o m p u t i n g   i t   i f   n e c e s s a r y . 
   *   
   *   @ p a r a m 	 { B o o l e a n } 	 l o w e r 	 	 < c o d e > t r u e < / c o d e >   t o   u s e   l o w e r   c a s e 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   f i l e   a s   s t r i n g 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t F i l e A s   = 
 f u n c t i o n ( l o w e r )   { 
 	 / /   u p d a t e / n u l l   i f   m o d i f i e d 
 	 i f   ( ! t h i s . _ f i l e A s )   { 
 	 	 t h i s . _ f i l e A s   =   Z m C o n t a c t . c o m p u t e F i l e A s ( t h i s ) ; 
 	 	 t h i s . _ f i l e A s L C   =   t h i s . _ f i l e A s   ?   t h i s . _ f i l e A s . t o L o w e r C a s e ( )   :   n u l l ; 
 	 } 
 	 / /   i f   f o r   s o m e   r e a s o n   f i l e A s L C   i s   n o t   s e t   e v e n   t h o u g h   f i l e A s   i s ,   r e s e t   i t 
 	 i f   ( l o w e r   & &   ! t h i s . _ f i l e A s L C )   { 
 	 	 t h i s . _ f i l e A s L C   =   t h i s . _ f i l e A s . t o L o w e r C a s e ( ) ; 
 	 } 
 	 r e t u r n   l o w e r   ?   t h i s . _ f i l e A s L C   :   t h i s . _ f i l e A s ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   f i l i n g   s t r i n g   f o r   t h i s   c o n t a c t ,   f r o m   t h e   e m a i l   a d d r e s s   ( u s e d   i n   c a s e   n o   n a m e   e x i s t s ) . 
   *   t o d o   -   m a y b e   r e t u r n   t h i s   f r o m   g e t F i l e A s ,   b u t   t h e r e   a r e   a   l o t   o f   c a l l e r s   t o   g e t F i l e A s ,   a n d   n o t   s u r e 
   *   o f   t h e   i m p l i c a t i o n s   o n   a l l   t h e   u s e - c a s e s . 
   * 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   f i l e   a s   s t r i n g 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t F i l e A s N o N a m e   =   f u n c t i o n ( )   { 
 	 r e t u r n   [ Z m M s g . n o N a m e ,   t h i s . g e t E m a i l ( ) ] . j o i n ( "   " ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   h e a d e r . 
   *   
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   h e a d e r 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t H e a d e r   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   t h i s . i d   ?   t h i s . g e t F i l e A s ( )   :   Z m M s g . n e w C o n t a c t ; 
 } ; 
 
 Z m C o n t a c t . N O _ M A X _ I M A G E _ W I D T H   =   Z m C o n t a c t . N O _ M A X _ I M A G E _ H E I G H T   =   -   1 ; 
 
 / * * 
   *   G e t   t h e   i m a g e   U R L . 
   * 
   *   P l e a s e   n o t e   t h a t   m a x W i d t h   a n d   m a x H e i g h t   a r e   h i n t s ,   a s   t h e y   h a v e   n o 
   *   e f f e c t   o n   Z i m l e t - s u p p l i e d   i m a g e s . 
   * 
   *   m a x W i d t h   { i n t }   m a x   p i x e l   w i d t h   ( o p t i o n a l   -   d e f a u l t   4 8 ,   o r   p a s s   Z m C o n t a c t . N O _ M A X _ I M A G E _ W I D T H   i f   f u l l   s i z e   i m a g e   i s   r e q u i r e d ) 
   *   m a x H e i g h t   { i n t }   m a x   p i x e l   h e i g h t   ( o p t i o n a l   -   d e f a u l t   t o   m a x W i d t h ,   o r   p a s s   Z m C o n t a c t . N O _ M A X _ I M A G E _ H E I G H T   i f   f u l l   s i z e   i m a g e   i s   r e q u i r e d ) 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   i m a g e   U R L 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t I m a g e U r l   = 
 f u n c t i o n ( m a x W i d t h ,   m a x H e i g h t )   { 
     	 v a r   i m a g e   =   t h i s . g e t A t t r ( Z m C o n t a c t . F _ i m a g e ) ; 
 	 v a r   i m a g e P a r t     =   i m a g e   & &   i m a g e . p a r t   | |   t h i s . g e t A t t r ( Z m C o n t a c t . F _ i m a g e p a r t ) ;   / / s e e   b u g   7 3 1 4 6 
 
 	 i f   ( ! i m a g e P a r t )   { 
 	 	 r e t u r n   t h i s . g e t A t t r ( Z m C o n t a c t . F _ z i m l e t I m a g e ) ;     / / r e t u r n   z i m l e t   p o p u l a t e d   i m a g e   o n l y   i f   u s e r - u p l o a d e d   i m a g e   i s   n o t   t h e r e . 
 	 } 
     	 v a r   m s g F e t c h U r l   =   a p p C t x t . g e t ( Z m S e t t i n g . C S F E _ M S G _ F E T C H E R _ U R I ) ; 
 	 v a r   m a x W i d t h S t y l e   =   " " ; 
 	 i f   ( m a x W i d t h   ! = =   Z m C o n t a c t . N O _ M A X _ I M A G E _ W I D T H )   { 
 	 	 m a x W i d t h   =   m a x W i d t h   | |   4 8 ; 
 	 	 m a x W i d t h S t y l e   =   [ " & m a x _ w i d t h = " ,   m a x W i d t h ] . j o i n ( " " ) ; 
 	 } 
 	 v a r   m a x H e i g h t S t y l e   =   " " ; 
 	 i f   ( m a x H e i g h t   ! = =   Z m C o n t a c t . N O _ M A X _ I M A G E _ H E I G H T )   { 
 	 	 m a x H e i g h t   =   m a x H e i g h t   | | 
 	 	 	 ( m a x W i d t h   ! = =   Z m C o n t a c t . N O _ M A X _ I M A G E _ W I D T H   ?   m a x W i d t h   :   4 8 ) ; 
 	 	 m a x H e i g h t S t y l e   =   [ " & m a x _ h e i g h t = " ,   m a x H e i g h t ] . j o i n ( " " ) ; 
 	 } 
     	 r e t u r n     [ m s g F e t c h U r l ,   " & i d = " ,   t h i s . i d ,   " & p a r t = " ,   i m a g e P a r t ,   m a x W i d t h S t y l e ,   m a x H e i g h t S t y l e ,   " & t = " ,   ( n e w   D a t e ( ) ) . g e t T i m e ( ) ] . j o i n ( " " ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . a d d M o d i f y Z i m l e t I m a g e T o B a t c h   = 
 f u n c t i o n ( b a t c h C m d ,   i m a g e )   { 
 	 v a r   a t t r   =   { } ; 
 	 i f   ( t h i s . g e t A t t r ( Z m C o n t a c t . F _ z i m l e t I m a g e )   = = =   i m a g e )   { 
 	 	 r e t u r n ;   / / n o   n e e d   t o   u p d a t e   i f   s a m e 
 	 } 
 	 a t t r [ Z m C o n t a c t . F _ z i m l e t I m a g e ]   =   i m a g e ; 
 	 b a t c h C m d . a d d ( t h i s . m o d i f y . b i n d ( t h i s ,   a t t r ,   n u l l ,   t r u e ) ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   c o m p a n y   f i e l d .   C o m p a n y   f i e l d   h a s   a   g e t t e r   b / c   f i l e A s   m a y   b e   t h e   C o m p a n y   n a m e   s o 
   *   c o m p a n y   f i e l d   s h o u l d   r e t u r n   " l a s t ,   f i r s t "   n a m e   i n s t e a d   * o r *   p r e p e n d   t h e   t i t l e 
   *   i f   f i l e A s   i s   n o t   C o m p a n y   ( a s s u m i n g   i t   e x i s t s ) . 
   *   
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   c o m p a n y 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t C o m p a n y F i e l d   = 
 f u n c t i o n ( )   { 
 
 	 v a r   a t t r s   =   t h i s . g e t A t t r s ( ) ; 
 	 i f   ( a t t r s   = =   n u l l )   r e t u r n   n u l l ; 
 
 	 v a r   f a   =   p a r s e I n t ( a t t r s . f i l e A s ) ; 
 	 v a r   v a l   =   [ ] ; 
 	 v a r   i d x   =   0 ; 
 
 	 i f   ( f a   = =   Z m C o n t a c t . F A _ L A S T _ C _ F I R S T   | |   f a   = =   Z m C o n t a c t . F A _ F I R S T _ L A S T )   { 
 	 	 / /   r e t u r n   t h e   t i t l e ,   c o m p a n y   n a m e 
 	 	 i f   ( a t t r s . j o b T i t l e )   { 
 	 	 	 v a l [ i d x + + ]   =   a t t r s . j o b T i t l e ; 
 	 	 	 i f   ( a t t r s . c o m p a n y ) 
 	 	 	 	 v a l [ i d x + + ]   =   " ,   " ; 
 	 	 } 
 	 	 i f   ( a t t r s . c o m p a n y ) 
 	 	 	 v a l [ i d x + + ]   =   a t t r s . c o m p a n y ; 
 
 	 }   e l s e   i f   ( f a   = =   Z m C o n t a c t . F A _ C O M P A N Y )   { 
 	 	 / /   r e t u r n   t h e   f i r s t / l a s t   n a m e 
 	 	 i f   ( a t t r s . l a s t N a m e )   { 
 	 	 	 v a l [ i d x + + ]   =   a t t r s . l a s t N a m e ; 
 	 	 	 i f   ( a t t r s . f i r s t N a m e ) 
 	 	 	 	 v a l [ i d x + + ]   =   " ,   " ; 
 	 	 } 
 
 	 	 i f   ( a t t r s . f i r s t N a m e ) 
 	 	 	 v a l [ i d x + + ]   =   a t t r s . f i r s t N a m e ; 
 
 	 	 i f   ( a t t r s . j o b T i t l e ) 
 	 	 	 v a l [ i d x + + ]   =   "   ( "   +   a t t r s . j o b T i t l e   +   " ) " ; 
 
 	 }   e l s e   { 
 	 	 / /   j u s t   r e t u r n   t h e   t i t l e 
 	 	 i f   ( a t t r s . j o b T i t l e )   { 
 	 	 	 v a l [ i d x + + ]   =   a t t r s . j o b T i t l e ; 
 	 	 	 / /   a n d / o r   c o m p a n y   n a m e   i f   a p p l i c a b l e 
 	 	 	 i f   ( a t t r s . c o m p a n y   & &   ( a t t r s . f i l e A s   = =   n u l l   | |   f a   = =   Z m C o n t a c t . F A _ L A S T _ C _ F I R S T   | |   f a   = =   Z m C o n t a c t . F A _ F I R S T _ L A S T ) ) 
 	 	 	 	 v a l [ i d x + + ]   =   " ,   " ; 
 	 	 } 
 	 	 i f   ( a t t r s . c o m p a n y   & &   ( a t t r s . f i l e A s   = =   n u l l   | |   f a   = =   Z m C o n t a c t . F A _ L A S T _ C _ F I R S T   | |   f a   = =   Z m C o n t a c t . F A _ F I R S T _ L A S T ) ) 
 	 	 	   v a l [ i d x + + ]   =   a t t r s . c o m p a n y ; 
 	 } 
 	 i f   ( v a l . l e n g t h   = =   0 )   r e t u r n   n u l l ; 
 	 r e t u r n   v a l . j o i n ( " " ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   w o r k   a d d r e s s . 
   *   
   *   @ p a r a m 	 { O b j e c t } 	 i n s t a n c e 	 	 ( n o t   u s e d ) 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   w o r k   a d d r e s s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t W o r k A d d r F i e l d   = 
 f u n c t i o n ( i n s t a n c e )   { 
 	 v a r   a t t r s   =   t h i s . g e t A t t r s ( ) ; 
 	 r e t u r n   t h i s . _ g e t A d d r e s s F i e l d ( a t t r s . w o r k S t r e e t ,   a t t r s . w o r k C i t y ,   a t t r s . w o r k S t a t e ,   a t t r s . w o r k P o s t a l C o d e ,   a t t r s . w o r k C o u n t r y ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   h o m e   a d d r e s s . 
   *   
   *   @ p a r a m 	 { O b j e c t } 	 i n s t a n c e 	 	 ( n o t   u s e d ) 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   h o m e   a d d r e s s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t H o m e A d d r F i e l d   = 
 f u n c t i o n ( i n s t a n c e )   { 
 	 v a r   a t t r s   =   t h i s . g e t A t t r s ( ) ; 
 	 r e t u r n   t h i s . _ g e t A d d r e s s F i e l d ( a t t r s . h o m e S t r e e t ,   a t t r s . h o m e C i t y ,   a t t r s . h o m e S t a t e ,   a t t r s . h o m e P o s t a l C o d e ,   a t t r s . h o m e C o u n t r y ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   o t h e r   a d d r e s s . 
   *   
   *   @ p a r a m 	 { O b j e c t } 	 i n s t a n c e 	 	 ( n o t   u s e d ) 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   o t h e r   a d d r e s s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t O t h e r A d d r F i e l d   = 
 f u n c t i o n ( i n s t a n c e )   { 
 	 v a r   a t t r s   =   t h i s . g e t A t t r s ( ) ; 
 	 r e t u r n   t h i s . _ g e t A d d r e s s F i e l d ( a t t r s . o t h e r S t r e e t ,   a t t r s . o t h e r C i t y ,   a t t r s . o t h e r S t a t e ,   a t t r s . o t h e r P o s t a l C o d e ,   a t t r s . o t h e r C o u n t r y ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   a d d r e s s   b o o k . 
   *   
   *   @ r e t u r n 	 { Z m A d d r B o o k } 	 t h e   a d d r e s s   b o o k 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t A d d r e s s B o o k   = 
 f u n c t i o n ( )   { 
 	 i f   ( ! t h i s . a d d r b o o k )   { 
 	 	 t h i s . a d d r b o o k   =   a p p C t x t . g e t B y I d ( t h i s . f o l d e r I d ) ; 
 	 } 
 	 r e t u r n   t h i s . a d d r b o o k ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ g e t A d d r e s s F i e l d   = 
 f u n c t i o n ( s t r e e t ,   c i t y ,   s t a t e ,   z i p c o d e ,   c o u n t r y )   { 
 	 i f   ( s t r e e t   = =   n u l l   & &   c i t y   = =   n u l l   & &   s t a t e   = =   n u l l   & &   z i p c o d e   = =   n u l l   & &   c o u n t r y   = =   n u l l )   r e t u r n   n u l l ; 
 
 	 v a r   h t m l   =   [ ] ; 
 	 v a r   i d x   =   0 ; 
 
 	 i f   ( s t r e e t )   { 
 	 	 h t m l [ i d x + + ]   =   s t r e e t ; 
 	 	 i f   ( c i t y   | |   s t a t e   | |   z i p c o d e ) 
 	 	 	 h t m l [ i d x + + ]   =   " \ n " ; 
 	 } 
 
 	 i f   ( c i t y )   { 
 	 	 h t m l [ i d x + + ]   =   c i t y ; 
 	 	 i f   ( s t a t e ) 
 	 	 	 h t m l [ i d x + + ]   =   " ,   " ; 
 	 	 e l s e   i f   ( z i p c o d e ) 
 	 	 	 h t m l [ i d x + + ]   =   "   " ; 
 	 } 
 
 	 i f   ( s t a t e )   { 
 	 	 h t m l [ i d x + + ]   =   s t a t e ; 
 	 	 i f   ( z i p c o d e ) 
 	 	 	 h t m l [ i d x + + ]   =   "   " ; 
 	 } 
 
 	 i f   ( z i p c o d e ) 
 	 	 h t m l [ i d x + + ]   =   z i p c o d e ; 
 
 	 i f   ( c o u n t r y ) 
 	 	 h t m l [ i d x + + ]   =   " \ n "   +   c o u n t r y ; 
 
 	 r e t u r n   h t m l . j o i n ( " " ) ; 
 } ; 
 
 / * * 
   *   S e t s   t h e   f u l l   n a m e   b a s e d   o n   a n   e m a i l   a d d r e s s . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ i n i t F u l l N a m e   = 
 f u n c t i o n ( e m a i l ,   s t r i c t N a m e )   { 
 	 v a r   n a m e   =   e m a i l . g e t N a m e ( ) ; 
 	 n a m e   =   A j x S t r i n g U t i l . t r i m ( n a m e . r e p l a c e ( A j x E m a i l A d d r e s s . c o m m e n t P a t ,   ' ' ) ) ;   / /   s t r i p   c o m m e n t   ( t e x t   i n   p a r e n s ) 
 
 	 i f   ( n a m e   & &   n a m e . l e n g t h )   { 
 	 	 t h i s . _ s e t F u l l N a m e ( n a m e ,   [ "   " ] ) ; 
 	 }   e l s e   i f   ( ! s t r i c t N a m e )   { 
 	 	 n a m e   =   e m a i l . g e t A d d r e s s ( ) ; 
 	 	 i f   ( n a m e   & &   n a m e . l e n g t h )   { 
 	 	 	 v a r   i   =   n a m e . i n d e x O f ( " @ " ) ; 
 	 	 	 i f   ( i   = =   - 1 )   r e t u r n ; 
 	 	 	 n a m e   =   n a m e . s u b s t r ( 0 ,   i ) ; 
 	 	 	 t h i s . _ s e t F u l l N a m e ( n a m e ,   [ " . " ,   " _ " ] ) ; 
 	 	 } 
 	 } 
 } ; 
 
 / * * 
   *   T r i e s   t o   e x t r a c t   a   s e t   o f   n a m e   c o m p o n e n t s   f r o m   t h e   g i v e n   t e x t ,   w i t h   t h e 
   *   g i v e n   l i s t   o f   p o s s i b l e   d e l i m i t e r s .   T h e   f i r s t   d e l i m i t e r   c o n t a i n e d   i n   t h e 
   *   t e x t   w i l l   b e   u s e d .   I f   n o n e   a r e   f o u n d ,   t h e   f i r s t   d e l i m i t e r   i n   t h e   l i s t   i s   u s e d . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ s e t F u l l N a m e   = 
 f u n c t i o n ( t e x t ,   d e l i m s )   { 
 	 v a r   d e l i m   =   d e l i m s [ 0 ] ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   d e l i m s . l e n g t h ;   i + + )   { 
 	 	 i f   ( t e x t . i n d e x O f ( d e l i m s [ i ] )   ! =   - 1 )   { 
 	 	 	 d e l i m   =   d e l i m s [ i ] ; 
 	 	 	 b r e a k ; 
 	 	 } 
 	 } 
         v a r   p a r t s   =   t e x t . s p l i t ( d e l i m ) ; 
         v a r   f u n c   =   t h i s [ " _ _ s e t F u l l N a m e _ " + A j x E n v . D E F A U L T _ L O C A L E ]   | |   t h i s . _ _ s e t F u l l N a m e ; 
         f u n c . c a l l ( t h i s ,   p a r t s ,   t e x t ,   d e l i m s ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ _ s e t F u l l N a m e   =   f u n c t i o n ( p a r t s ,   t e x t ,   d e l i m s )   { 
         t h i s . s e t A t t r ( Z m C o n t a c t . F _ f i r s t N a m e ,   p a r t s [ 0 ] ) ; 
         i f   ( p a r t s . l e n g t h   = =   2 )   { 
                 t h i s . s e t A t t r ( Z m C o n t a c t . F _ l a s t N a m e ,   p a r t s [ 1 ] ) ; 
         }   e l s e   i f   ( p a r t s . l e n g t h   = =   3 )   { 
                 t h i s . s e t A t t r ( Z m C o n t a c t . F _ m i d d l e N a m e ,   p a r t s [ 1 ] ) ; 
                 t h i s . s e t A t t r ( Z m C o n t a c t . F _ l a s t N a m e ,   p a r t s [ 2 ] ) ; 
         } 
 } ; 
 Z m C o n t a c t . p r o t o t y p e . _ _ s e t F u l l N a m e _ j a   =   f u n c t i o n ( p a r t s ,   t e x t ,   d e l i m s )   { 
         i f   ( p a r t s . l e n g t h   >   2 )   { 
                 t h i s . _ _ s e t F u l l N a m e ( p a r t s ,   t e x t ,   d e l i m s ) ; 
                 r e t u r n ; 
         } 
         / /   T O D O :   P e r h a p s   d o   s o m e   a n a l y s i s   t o   a u t o - d e t e c t   J a p a n e s e   v s . 
         / /   T O D O :   n o n - J a p a n e s e   n a m e s .   F o r   e x a m p l e ,   i f   t h e   n a m e   t e x t   i s 
         / /   T O D O :   c o m p r i s e d   o f   k a n j i ,   t r e a t   i t   a s   " l a s t   f i r s t " ;   e l s e   i f 
         / /   T O D O :   f i r s t   p a r t   i s   a l l   u p p e r c a s e ,   t r e a t   i t   a s   " l a s t   f i r s t " ; 
         / /   T O D O :   e l s e   t r e a t   i t   a s   " f i r s t   l a s t " . 
         t h i s . s e t A t t r ( Z m C o n t a c t . F _ l a s t N a m e ,   p a r t s [ 0 ] ) ; 
         i f   ( p a r t s . l e n g t h   >   1 )   { 
                 t h i s . s e t A t t r ( Z m C o n t a c t . F _ f i r s t N a m e ,   p a r t s [ 1 ] ) ; 
         } 
 } ; 
 Z m C o n t a c t . p r o t o t y p e . _ _ s e t F u l l N a m e _ j a _ J P   =   Z m C o n t a c t . p r o t o t y p e . _ _ s e t F u l l N a m e _ j a ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ a d d R e q u e s t A t t r   = 
 f u n c t i o n ( c n ,   n a m e ,   v a l u e )   { 
 	 v a r   a   =   { n : n a m e } ; 
 	 i f   ( n a m e   = =   Z m C o n t a c t . F _ i m a g e   & &   A j x U t i l . i s S t r i n g ( v a l u e )   & &   v a l u e . l e n g t h )   { 
 	 	 / /   h a n d l e   c o n t a c t   p h o t o 
 	 	 i f   ( v a l u e . i n d e x O f ( " a i d _ " )   ! =   - 1 )   { 
 	 	 	 a . a i d   =   v a l u e . s u b s t r i n g ( 4 ) ; 
 	 	 }   e l s e   { 
 	 	 	 a . p a r t   =   v a l u e . s u b s t r i n g ( 5 ) ; 
 	 	 } 
 	 }   e l s e   { 
 	 	 a . _ c o n t e n t   =   v a l u e   | |   " " ; 
 	 } 
 
         i f   ( v a l u e   i n s t a n c e o f   A r r a y )   { 
                 i f   ( ! c n . _ a t t r s ) 
                         c n . _ a t t r s   =   { } ; 
                 c n . _ a t t r s [ n a m e ]   =   v a l u e   | |   " " ; 
         } 
         e l s e     { 
                 i f   ( ! c n . a ) 
                         c n . a   =   [ ] ; 
                 c n . a . p u s h ( a ) ; 
         } 
 } ; 
 	 
 Z m C o n t a c t . p r o t o t y p e . _ a d d C o n t a c t G r o u p A t t r   =   
 f u n c t i o n ( c n ,   g r o u p )   { 
 	 v a r   g r o u p M e m b e r s   =   g r o u p [ Z m C o n t a c t . F _ g r o u p s ] ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   g r o u p M e m b e r s . l e n g t h ;   i + + )   { 
 	 	 v a r   m e m b e r   =   g r o u p M e m b e r s [ i ] ; 
 	 	 i f   ( ! c n . m )   { 
 	 	 	 c n . m   =   [ ] ; 
 	 	 } 
 
 	 	 v a r   m   =   { t y p e :   m e m b e r . t y p e , 	 v a l u e :   m e m b e r . v a l u e } ;   / / f o r   t h e   J S O N   o b j e c t   t h i s   i s   a l l   w e   n e e d . 
 	 	 i f   ( m e m b e r . o p )   { 
 	 	 	 m . o p   =   m e m b e r . o p ;   / / t h i s   i s   o n l y   f o r   m o d i f y ,   n o t   f o r   c r e a t e . 
 	 	 } 
 	 	 c n . m . p u s h ( m ) ; 
 	 } 
 } ; 
 
 / * * 
   *   R e s e t   c o m p u t e d   f i e l d s . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ r e s e t C a c h e d F i e l d s   = 
 f u n c t i o n ( )   { 
 	 t h i s . _ f i l e A s   =   t h i s . _ f i l e A s L C   =   t h i s . _ f u l l N a m e   =   n u l l ; 
 } ; 
 
 / * * 
   *   P a r s e   c o n t a c t   n o d e . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . _ l o a d F r o m D o m   = 
 f u n c t i o n ( n o d e )   { 
 	 t h i s . i s L o a d e d   =   t r u e ; 
 	 t h i s . r e v   =   n o d e . r e v ; 
 	 t h i s . s f   =   n o d e . s f   | |   n o d e . _ a t t r s . s f ; 
 	 i f   ( ! t h i s . i s G a l )   { 
 	 	 t h i s . f o l d e r I d   =   n o d e . l ; 
 	 } 
 	 t h i s . c r e a t e d   =   n o d e . c d ; 
 	 t h i s . m o d i f i e d   =   n o d e . m d ; 
 
 	 t h i s . a t t r   =   n o d e . _ a t t r s   | |   { } ; 
 	 i f   ( n o d e . m )   { 
 	 	 t h i s . a t t r [ Z m C o n t a c t . F _ g r o u p s ]   =   n o d e . m ; 
 	 } 
 
 	 t h i s . r e f   =   n o d e . r e f   | |   t h i s . a t t r . d n ;   / / b u g   7 8 4 2 5 
 	 
 	 / /   f o r   s h a r e d   c o n t a c t s ,   w e   g e t   t h e s e   f i e l d s   o u t s i d e   o f   t h e   a t t r   p a r t 
 	 i f   ( n o d e . e m a i l ) 	 	 {   t h i s . a t t r [ Z m C o n t a c t . F _ e m a i l ]   =   n o d e . e m a i l ;   } 
 	 i f   ( n o d e . e m a i l 2 ) 	 {   t h i s . a t t r [ Z m C o n t a c t . F _ e m a i l 2 ]   =   n o d e . e m a i l 2 ;   } 
 	 i f   ( n o d e . e m a i l 3 ) 	 {   t h i s . a t t r [ Z m C o n t a c t . F _ e m a i l 3 ]   =   n o d e . e m a i l 3 ;   } 
 
 	 / /   i n   c a s e   a t t r s   a r e   c o m i n g   i n   f r o m   a n   e x t e r n a l   G A L ,   m a k e   a n   e f f o r t   t o   m a p   t h e m ,   i n c l u d i n g   m u l t i v a l u e d   o n e s 
 	 t h i s . a t t r   =   Z m C o n t a c t . m a p A t t r s ( t h i s . a t t r ) ; 
 
         / / t h e   a t t r   g r o u p s   i s   r e t u r n e d   a s   [ ]   s o   c h e c k   b o t h   n u l l   a n d   e m p t y   a r r a y   t o   s e t   t h e   t y p e 
         v a r   g r o u p s   =   t h i s . a t t r [ Z m C o n t a c t . F _ g r o u p s ] ; 
         i f ( ! g r o u p s   | |   ( g r o u p s   i n s t a n c e o f   A r r a y   & &   g r o u p s . l e n g t h   = =   0 ) )   { 
                 t h i s . t y p e   =   Z m I t e m . C O N T A C T ; 
         } 
         e l s e   { 
                 t h i s . t y p e   =   Z m I t e m . G R O U P ; 
         } 
 
 	 / /   c h e c k   i f   t h e   f o l d e r I d   i s   f o u n d   i n   o u r   a d d r e s s   b o o k   ( o t h e r w i s e ,   w e   a s s u m e 
 	 / /   t h i s   c o n t a c t   t o   b e   a   s h a r e d   c o n t a c t ) 
 	 v a r   a c   =   w i n d o w . p a r e n t A p p C t x t   | |   w i n d o w . a p p C t x t ; 
 	 t h i s . a d d r b o o k   =   a c . g e t B y I d ( t h i s . f o l d e r I d ) ; 
 
 	 t h i s . _ p a r s e T a g N a m e s ( n o d e . t n ) ; 
 
 	 / /   d o n t   p r o c e s s   f l a g s   f o r   s h a r e d   c o n t a c t s   u n t i l   w e   g e t   s e r v e r   s u p p o r t 
 	 i f   ( ! t h i s . i s S h a r e d ( ) )   { 
 	 	 t h i s . _ p a r s e F l a g s ( n o d e . f ) ; 
 	 }   e l s e   { 
 	 	 / /   s h a r e d   c o n t a c t s   a r e   n e v e r   f u l l y   l o a d e d   s i n c e   w e   n e v e r   c a c h e   t h e m 
 	 	 t h i s . i s L o a d e d   =   f a l s e ; 
 	 } 
 
 	 / /   b u g :   2 2 1 7 4 
 	 / /   W e   i g n o r e   t h e   s e r v e r ' s   c o m p u t e d   f i l e - a s   p r o p e r t y   a n d   i n s t e a d 
 	 / /   f o r m a t   i t   b a s e d   o n   t h e   u s e r ' s   l o c a l e . 
 	 t h i s . _ f i l e A s   =   Z m C o n t a c t . c o m p u t e F i l e A s ( t h i s ) ; 
 
 	 / /   I s   t h i s   a   d i s t r i b u t i o n   l i s t ? 
 	 t h i s . i s D L   =   t h i s . i s D i s t r i b u t i o n L i s t ( ) ; 
 	 i f   ( t h i s . i s D L )   { 
 	 	 t h i s . d l I n f o   =   {   / / t h i s   i s   m i n i m a l   D L   i n f o ,   a v a i l a b l e   m a i n l y   t o   a l l o w   t o   k n o w   w h e t h e r   t o   s h o w   t h e   l o c k   o r   n o t . 
 	 	 	 i s M i n i m a l :   t r u e , 
 	 	 	 i s M e m b e r :   n o d e . i s M e m b e r , 
 	 	 	 i s O w n e r :   n o d e . i s O w n e r , 
 	 	 	 s u b s c r i p t i o n P o l i c y :   t h i s . a t t r . z i m b r a D i s t r i b u t i o n L i s t S u b s c r i p t i o n P o l i c y , 
 	 	 	 u n s u b s c r i p t i o n P o l i c y :   t h i s . a t t r . z i m b r a D i s t r i b u t i o n L i s t U n s u b s c r i p t i o n P o l i c y , 
 	 	 	 d i s p l a y N a m e :   n o d e . d   | |   " " , 
 	 	 	 h i d e I n G a l :   t h i s . a t t r . z i m b r a H i d e I n G a l   = =   " T R U E " 
 	 	 } ; 
 
 	 	 t h i s . c a n E x p a n d   =   n o d e . e x p   ! = =   f a l s e ;   / / d e f a u l t   t o   t r u e ,   s i n c e   m o s t   c a s e s   t h i s   i s   i m p l i c i t l y   t r u e   i f   n o t   r e t u r n e d .   S e e   b u g   9 4 8 6 7 
 	 	 v a r   e m a i l s   =   t h i s . g e t E m a i l s ( ) ; 
 	 	 v a r   a c   =   w i n d o w . p a r e n t A p p C t x t   | |   w i n d o w . a p p C t x t ; 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   e m a i l s . l e n g t h ;   i + + )   { 
 	 	 	 a c . s e t I s E x p a n d a b l e D L ( e m a i l s [ i ] ,   t h i s . c a n E x p a n d ) ; 
 	 	 } 
 	 } 
 	 / / S / M I M E :   I f   u s e r   c e r t i f i c a t e   i s   p r e s e n t ,   i n c l u d e   i t   i n t o   c o n t a c t ' s   o b j e c t 
 	 i f   ( n o d e . c e r t i f i c a t e )   { 
 	 	 t h i s . c e r t i f i c a t e   =   n o d e . c e r t i f i c a t e ; 
 	 } 
 } ; 
 
 / * * 
   *   G e t s   d i s p l a y   t e x t   f o r   a n   a t t e n d e e .   P r e f e r s   n a m e   o v e r   e m a i l . 
   * 
   *   @ p a r a m   { c o n s t a n t } 	 t y p e 	 	 t h e   a t t e n d e e   t y p e 
   *   @ p a r a m   { B o o l e a n } 	 s h o r t F o r m 	 	 i f   < c o d e > t r u e < / c o d e > ,   r e t u r n   o n l y   n a m e   o r   e m a i l 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   a t t e n d e e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t A t t e n d e e T e x t   = 
 f u n c t i o n ( t y p e ,   s h o r t F o r m )   { 
 	 v a r   e m a i l   =   t h i s . g e t E m a i l ( t r u e ) ; 
 	 r e t u r n   ( e m a i l ? e m a i l . t o S t r i n g ( s h o r t F o r m   | |   ( t y p e   & &   t y p e   ! =   Z m C a l B a s e I t e m . P E R S O N ) ) : " " ) ; 
 } ; 
 
 / * * 
   *   G e t s   d i s p l a y   t e x t   f o r   a n   a t t e n d e e .   P r e f e r s   n a m e   o v e r   e m a i l . 
   * 
   *   @ p a r a m   { c o n s t a n t } 	 t y p e 	 	 t h e   a t t e n d e e   t y p e 
   *   @ p a r a m   { B o o l e a n } 	 s h o r t F o r m 	 	 i f   < c o d e > t r u e < / c o d e > ,   r e t u r n   o n l y   n a m e   o r   e m a i l 
   *   @ r e t u r n 	 { S t r i n g } 	 t h e   a t t e n d e e 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t A t t e n d e e K e y   = 
 f u n c t i o n ( )   { 
 	 v a r   e m a i l   =   t h i s . g e t L o o k u p E m a i l ( )   | |   t h i s . g e t E m a i l ( ) ; 
 	 v a r   n a m e   =   t h i s . g e t F u l l N a m e ( ) ; 
 	 r e t u r n   e m a i l   ?   e m a i l   :   n a m e ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   u n k n o w n   f i e l d s . 
   *   
   *   @ p a r a m 	 { f u n c t i o n } 	 [ s o r t B y N a m e F u n c ] 	 s o r t   b y   f u n c t i o n 
   *   @ r e t u r n 	 { A r r a y } 	 a n   a r r a y   o f   f i e l d   n a m e / v a l u e   p a i r s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t U n k n o w n F i e l d s   =   f u n c t i o n ( s o r t B y N a m e F u n c )   { 
 	 v a r   m a p   =   Z m C o n t a c t . _ _ F I E L D _ M A P ; 
 	 i f   ( ! m a p )   { 
 	 	 m a p   =   Z m C o n t a c t . _ _ F I E L D _ M A P   =   { } ; 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   Z m C o n t a c t . D I S P L A Y _ F I E L D S ;   i + + )   { 
 	 	 	 m a p [ Z m C o n t a c t . D I S P L A Y _ F I E L D S [ i ] ]   =   t r u e ; 
 	 	 } 
 	 } 
 	 v a r   f i e l d s   =   [ ] ; 
 	 v a r   a t t r s   =   t h i s . g e t A t t r s ( ) ; 
 	 f o r   ( v a r   a n a m e   i n   a t t r s )   { 
 	 	 v a r   f i e l d   =   Z m C o n t a c t . g e t P r e f i x ( a n a m e ) ; 
 	 	 i f   ( m a p [ a n a m e ] )   c o n t i n u e ; 
 	 	 f i e l d s . p u s h ( f i e l d ) ; 
 	 } 
 	 r e t u r n   t h i s . g e t F i e l d s ( f i e l d s ,   s o r t B y N a m e F u n c ) ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   f i e l d s . 
   *   
   *   @ p a r a m 	 { A r r a y } 	 f i e l d 	 	 t h e   f i e l d s 
   *   @ p a r a m 	 { f u n c t i o n } 	 [ s o r t B y N a m e F u n c ] 	 s o r t   b y   f u n c t i o n 
   *   @ r e t u r n 	 { A r r a y } 	 a n   a r r a y   o f   f i e l d   n a m e / v a l u e   p a i r s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t F i e l d s   = 
 f u n c t i o n ( f i e l d s ,   s o r t B y N a m e F u n c )   { 
 	 / /   T O D O :   [ Q ]   S h o u l d   s o r t   f u n c t i o n   h a n d l e   j u s t   t h e   f i e l d   n a m e s   o r   t h e   a t t r i b u t e   n a m e s ? 
 	 v a r   s e l e c t i o n ; 
 	 v a r   a t t r s   =   t h i s . g e t A t t r s ( ) ; 
 	 f o r   ( v a r   i n d e x   =   0 ;   i n d e x   <   f i e l d s . l e n g t h ;   i n d e x + + )   { 
 	 	 f o r   ( v a r   i   =   1 ;   t r u e ;   i + + )   { 
 	 	 	 v a r   a n a m e   =   Z m C o n t a c t . g e t A t t r i b u t e N a m e ( f i e l d s [ i n d e x ] ,   i ) ; 
 	 	 	 i f   ( ! a t t r s [ a n a m e ] )   b r e a k ; 
 	 	 	 i f   ( ! s e l e c t i o n )   s e l e c t i o n   =   { } ; 
 	 	 	 s e l e c t i o n [ a n a m e ]   =   a t t r s [ a n a m e ] ; 
 	 	 } 
 	 } 
 	 i f   ( s o r t B y N a m e F u n c   & &   s e l e c t i o n )   { 
 	 	 v a r   k e y s   =   A j x U t i l . k e y s ( s e l e c t i o n ) ; 
 	 	 k e y s . s o r t ( s o r t B y N a m e F u n c ) ; 
 	 	 v a r   n f i e l d s   =   { } ; 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   k e y s ;   i + + )   { 
 	 	 	 v a r   k e y   =   k e y s [ i ] ; 
 	 	 	 n f i e l d s [ k e y ]   =   f i e l d s [ k e y ] ; 
 	 	 } 
 	 	 s e l e c t i o n   =   n f i e l d s ; 
 	 } 
 	 r e t u r n   s e l e c t i o n ; 
 } ; 
 
 / * * 
   *   R e t u r n s   a   l i s t   o f   d i s t r i b u t i o n   l i s t   m e m b e r s   f o r   t h i s   c o n t a c t .   O n l y   t h e 
   *   r e q u e s t e d   r a n g e   i s   r e t u r n e d . 
   * 
   *   @ p a r a m   o f f s e t 	 { i n t } 	 	 	 o f f s e t   i n t o   l i s t   t o   s t a r t   a t 
   *   @ p a r a m   l i m i t 	 	 { i n t } 	 	 	 n u m b e r   o f   m e m b e r s   t o   f e t c h   a n d   r e t u r n 
   *   @ p a r a m   c a l l b a c k 	 { A j x C a l l b a c k } 	 c a l l b a c k   t o   r u n   w i t h   r e s u l t s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t D L M e m b e r s   = 
 f u n c t i o n ( o f f s e t ,   l i m i t ,   c a l l b a c k )   { 
 
 	 v a r   r e s u l t   =   { l i s t : [ ] ,   m o r e : f a l s e ,   i s D L : { } } ; 
 	 i f   ( ! t h i s . i s D L )   {   r e t u r n   r e s u l t ;   } 
 
 	 v a r   e m a i l   =   t h i s . g e t E m a i l ( ) ; 
 	 v a r   a p p   =   a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) ; 
 	 v a r   d l   =   a p p . g e t D L ( e m a i l ) ; 
 	 i f   ( ! d l )   { 
 	 	 d l   =   r e s u l t ; 
 	 	 d l . m o r e   =   t r u e ; 
 	 	 a p p . c a c h e D L ( e m a i l ,   d l ) ; 
 	 } 
 
 	 l i m i t   =   l i m i t   | |   Z m C o n t a c t . D L _ P A G E _ S I Z E ; 
 	 v a r   s t a r t   =   o f f s e t   | |   0 ; 
 	 v a r   e n d   =   ( o f f s e t   +   l i m i t )   -   1 ; 
 
 	 / /   s e e   i f   w e   a l r e a d y   h a v e   t h e   r e q u e s t e d   m e m b e r s ,   o r   k n o w   t h a t   w e   d o n ' t 
 	 i f   ( d l . l i s t . l e n g t h   > =   e n d   +   1   | |   ! d l . m o r e )   { 
 	 	 v a r   l i s t   =   d l . l i s t . s l i c e ( o f f s e t ,   e n d   +   1 ) ; 
 	 	 r e s u l t   =   { l i s t : l i s t ,   m o r e : d l . m o r e   | |   ( d l . l i s t . l e n g t h   >   e n d   +   1 ) ,   i s D L : d l . i s D L } ; 
 	 	 D B G . p r i n t l n ( " d l " ,   " f o u n d   c a c h e d   D L   m e m b e r s " ) ; 
 	 	 t h i s . _ h a n d l e R e s p o n s e G e t D L M e m b e r s ( s t a r t ,   l i m i t ,   c a l l b a c k ,   r e s u l t ) ; 
 	 	 r e t u r n ; 
 	 } 
 
 	 D B G . p r i n t l n ( " d l " ,   " s e r v e r   c a l l   "   +   o f f s e t   +   "   /   "   +   l i m i t ) ; 
 	 i f   ( ! d l . t o t a l   | |   ( o f f s e t   <   d l . t o t a l ) )   { 
 	 	 v a r   j s o n O b j   =   { G e t D i s t r i b u t i o n L i s t M e m b e r s R e q u e s t : { _ j s n s : " u r n : z i m b r a A c c o u n t " ,   o f f s e t : o f f s e t ,   l i m i t : l i m i t } } ; 
 	 	 v a r   r e q u e s t   =   j s o n O b j . G e t D i s t r i b u t i o n L i s t M e m b e r s R e q u e s t ; 
 	 	 r e q u e s t . d l   =   { _ c o n t e n t :   t h i s . g e t E m a i l ( ) } ; 
 	 	 v a r   r e s p C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e R e s p o n s e G e t D L M e m b e r s ,   [ o f f s e t ,   l i m i t ,   c a l l b a c k ] ) ; 
 	 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { j s o n O b j : j s o n O b j ,   a s y n c M o d e : t r u e ,   c a l l b a c k : r e s p C a l l b a c k } ) ; 
 	 }   e l s e   { 
 	 	 t h i s . _ h a n d l e R e s p o n s e G e t D L M e m b e r s ( s t a r t ,   l i m i t ,   c a l l b a c k ,   r e s u l t ) ; 
 	 } 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ h a n d l e R e s p o n s e G e t D L M e m b e r s   = 
 f u n c t i o n ( o f f s e t ,   l i m i t ,   c a l l b a c k ,   r e s u l t ,   r e s p )   { 
 
 	 i f   ( r e s p   | |   ! r e s u l t . l i s t )   { 
 	 	 v a r   l i s t   =   [ ] ; 
 	 	 r e s p   =   r e s p   | |   r e s u l t . g e t R e s p o n s e ( ) ;     / / i f   r e s p o n s e   i s   p a s s e d ,   t a k e   i t .   O t h e r w i s e   g e t   i t   f r o m   r e s u l t 
 	 	 r e s p   =   r e s p . G e t D i s t r i b u t i o n L i s t M e m b e r s R e s p o n s e ; 
 	 	 v a r   d l   =   a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) . g e t D L ( t h i s . g e t E m a i l ( ) ) ; 
 	 	 v a r   m o r e   =   d l . m o r e   =   r e s p . m o r e ; 
 	 	 v a r   i s D L   =   { } ; 
 	 	 v a r   m e m b e r s   =   r e s p . d l m ; 
 	 	 i f   ( m e m b e r s   & &   m e m b e r s . l e n g t h )   { 
 	 	 	 f o r   ( v a r   i   =   0 ,   l e n   =   m e m b e r s . l e n g t h ;   i   <   l e n ;   i + + )   { 
 	 	 	 	 v a r   m e m b e r   =   m e m b e r s [ i ] . _ c o n t e n t ; 
 	 	 	 	 l i s t . p u s h ( m e m b e r ) ; 
 	 	 	 	 d l . l i s t [ o f f s e t   +   i ]   =   m e m b e r ; 
 	 	 	 	 i f   ( m e m b e r s [ i ] . i s D L )   { 
 	 	 	 	 	 i s D L [ m e m b e r ]   =   d l . i s D L [ m e m b e r ]   =   t r u e ; 
 	 	 	 	 } 
 	 	 	 } 
 	 	 } 
 	 	 d l . t o t a l   =   r e s p . t o t a l ; 
 	 	 D B G . p r i n t l n ( " d l " ,   l i s t . j o i n ( " < b r > " ) ) ; 
 	 	 v a r   r e s u l t   =   { l i s t : l i s t ,   m o r e : m o r e ,   i s D L : i s D L } ; 
 	 } 
 	 D B G . p r i n t l n ( " d l " ,   " r e t u r n i n g   l i s t   o f   "   +   r e s u l t . l i s t . l e n g t h   +   " ,   m o r e   i s   "   +   r e s u l t . m o r e ) ; 
 	 i f   ( c a l l b a c k )   { 
 	 	 c a l l b a c k . r u n ( r e s u l t ) ; 
 	 } 
 	 e l s e   {   / / s y n c h r o n i z e d   c a s e   -   s e e   Z m C o n t a c t . p r o t o t y p e . g e t D L M e m b e r s   a b o v e 
 	 	 r e t u r n   r e s u l t ; 
 	 } 
 } ; 
 
 / * * 
   *   R e t u r n s   a   l i s t   o f   a l l   t h e   d i s t r i b u t i o n   l i s t   m e m b e r s   f o r   t h i s   c o n t a c t . 
   * 
   *   @ p a r a m   c a l l b a c k 	 { A j x C a l l b a c k } 	 c a l l b a c k   t o   r u n   w i t h   r e s u l t s 
   * / 
 Z m C o n t a c t . p r o t o t y p e . g e t A l l D L M e m b e r s   = 
 f u n c t i o n ( c a l l b a c k )   { 
 
 	 v a r   r e s u l t   =   { l i s t : [ ] ,   m o r e : f a l s e ,   i s D L : { } } ; 
 	 i f   ( ! t h i s . i s D L )   {   r e t u r n   r e s u l t ;   } 
 
 	 v a r   d l   =   a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) . g e t D L ( t h i s . g e t E m a i l ( ) ) ; 
 	 i f   ( d l   & &   ! d l . m o r e )   { 
 	 	 r e s u l t   =   { l i s t : d l . l i s t . s l i c e ( ) ,   m o r e : f a l s e ,   i s D L : d l . i s D L } ; 
 	 	 c a l l b a c k . r u n ( r e s u l t ) ; 
 	 	 r e t u r n ; 
 	 } 
 
 	 v a r   n e x t C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ g e t N e x t D L C h u n k ,   [ c a l l b a c k ] ) ; 
 	 t h i s . g e t D L M e m b e r s ( d l   ?   d l . l i s t . l e n g t h   :   0 ,   n u l l ,   n e x t C a l l b a c k ) ; 
 } ; 
 
 Z m C o n t a c t . p r o t o t y p e . _ g e t N e x t D L C h u n k   = 
 f u n c t i o n ( c a l l b a c k ,   r e s u l t )   { 
 
 	 v a r   d l   =   a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) . g e t D L ( t h i s . g e t E m a i l ( ) ) ; 
 	 i f   ( r e s u l t . m o r e )   { 
 	 	 v a r   n e x t C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ g e t N e x t D L C h u n k ,   [ c a l l b a c k ] ) ; 
 	 	 t h i s . g e t D L M e m b e r s ( d l . l i s t . l e n g t h ,   n u l l ,   n e x t C a l l b a c k ) ; 
 	 }   e l s e   { 
 	 	 r e s u l t . l i s t   =   d l . l i s t . s l i c e ( ) ; 
 	 	 c a l l b a c k . r u n ( r e s u l t ) ; 
 	 } 
 } ; 
 
 / * * 
   *   G e t s   t h e   c o n t a c t   f r o m   c a c h e   h a n d l i n g   p a r s i n g   o f   c o n t a c t I d 
   *   
   *   @ p a r a m   c o n t a c t I d   { S t r i n g }   c o n t a c t   i d 
   *   @ r e t u r n   c o n t a c t   { Z m C o n t a c t }   c o n t a c t   o r   n u l l 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t . g e t C o n t a c t F r o m C a c h e   = 
 f u n c t i o n ( c o n t a c t I d )   { 
 	 v a r   u s e r Z i d   =   a p p C t x t . a c c o u n t L i s t . m a i n A c c o u n t . i d ; 
 	 v a r   c o n t a c t   =   n u l l ; 
 	 i f   ( c o n t a c t I d   & &   c o n t a c t I d . i n d e x O f ( u s e r Z i d   +   " : " )   ! = - 1 )   { 
 	 	 / / s t r i p   o f f   t h e   u s e r s Z i d   t o   p u l l   f r o m   c a c h e 
 	 	 v a r   a r r   =   c o n t a c t I d . s p l i t ( u s e r Z i d   +   " : " ) ; 
 	 	 c o n t a c t   =   a r r   & &   a r r . l e n g t h   >   1   ?   a p p C t x t . c a c h e G e t ( a r r [ 1 ] )   :   a p p C t x t . c a c h e G e t ( c o n t a c t I d ) ; 
 	 } 
 	 e l s e   { 
 	 	 c o n t a c t   =   a p p C t x t . c a c h e G e t ( c o n t a c t I d ) ; 
 	 } 
 	 i f   ( c o n t a c t   i n s t a n c e o f   Z m C o n t a c t )   { 
 	 	 r e t u r n   c o n t a c t ; 
 	 } 
 	 r e t u r n   n u l l ; 
 } ; 
 
 / /   F o r   m a p A t t r s ( ) ,   p r e p a r e   a   h a s h   w h e r e   e a c h   k e y   i s   t h e   b a s e   n a m e   o f   a n   a t t r   ( w i t h o u t   a n   e n d i n g   n u m b e r   a n d   l o w e r c a s e d ) , 
 / /   a n d   t h e   v a l u e   i s   a   n u m e r i c a l l y   s o r t e d   l i s t   o f   a t t r   n a m e s   i n   t h e i r   o r i g i n a l   f o r m . 
 Z m C o n t a c t . A T T R _ V A R I A N T S   =   { } ; 
 Z m C o n t a c t . I G N O R E _ A T T R _ V A R I A N T   =   { } ; 
 Z m C o n t a c t . I G N O R E _ A T T R _ V A R I A N T [ Z m C o n t a c t . F _ g r o u p s ]   =   t r u e ; 
 
 Z m C o n t a c t . i n i t A t t r V a r i a n t s   =   f u n c t i o n ( a t t r C l a s s )   { 
 	 v a r   k e y s   =   O b j e c t . k e y s ( a t t r C l a s s ) , 
 	 	 l e n   =   k e y s . l e n g t h ,   k e y ,   i ,   a t t r , 
 	 	 a t t r s   =   [ ] ; 
 
 	 / /   f i r s t ,   g r a b   a l l   t h e   a t t r   n a m e s 
 	 v a r   i g n o r e V a r i a n t   =   a t t r C l a s s . I G N O R E _ A T T R _ V A R I A N T   | |   { } ; 
 	 f o r   ( i   =   0 ;   i   <   l e n ;   i + + )   { 
 	 	 k e y   =   k e y s [ i ] ; 
 	 	 i f   ( k e y . i n d e x O f ( ' F _ ' )   = = =   0 )   { 
 	 	 	 a t t r   =   a t t r C l a s s [ k e y ] ; 
 	 	 	 i f   ( ! i g n o r e V a r i a n t [ a t t r ] )   { 
 	 	 	 	 a t t r s . p u s h ( a t t r ) ; 
 	 	 	 } 
 	 	 } 
 	 } 
 
 	 / /   s o r t   n u m e r i c a l l y ,   e g   s o   t h a t   w e   g e t   [ ' e m a i l ' ,   ' e m a i l 2 ' ,   ' e m a i l 1 0 ' ]   i n   r i g h t   o r d e r 
 	 v a r   n u m R e g e x   =   / ^ ( [ a - z A - Z ] + ) ( \ d + ) $ / ; 
 	 a t t r s . s o r t ( f u n c t i o n ( a ,   b )   { 
 	 	 v a r   a M a t c h   =   a . m a t c h ( n u m R e g e x ) , 
 	 	 	 b M a t c h   =   b . m a t c h ( n u m R e g e x ) ; 
 	 	 / /   c h e c k   i f   b o t h   a r e   n u m b e r e d   a t t r s   w i t h   s a m e   b a s e 
 	 	 i f   ( a M a t c h   & &   b M a t c h   & &   a M a t c h [ 1 ]   = = =   b M a t c h [ 1 ] )   { 
 	 	 	 r e t u r n   a M a t c h [ 2 ]   -   b M a t c h [ 2 ] ; 
 	 	 } 
 	 	 e l s e   { 
 	 	 	 r e t u r n   a   >   b   ?   1   :   ( a   <   b   ?   - 1   :   0 ) ; 
 	 	 } 
 	 } ) ; 
 
 	 / /   c o n s t r u c t   h a s h   m a p p i n g   g e n e r i c   b a s e   n a m e   t o   i t s   i t e r a t e d   a t t r   n a m e s 
 	 v a r   a t t r ,   b a s e ; 
 	 f o r   ( i   =   0 ;   i   <   a t t r s . l e n g t h ;   i + + )   { 
 	 	 a t t r   =   a t t r s [ i ] ; 
 	 	 b a s e   =   a t t r . r e p l a c e ( / \ d + $ / ,   ' ' ) . t o L o w e r C a s e ( ) ; 
 	 	 i f   ( ! Z m C o n t a c t . A T T R _ V A R I A N T S [ b a s e ] )   { 
 	 	 	 Z m C o n t a c t . A T T R _ V A R I A N T S [ b a s e ]   =   [ ] ; 
 	 	 } 
 	 	 Z m C o n t a c t . A T T R _ V A R I A N T S [ b a s e ] . p u s h ( a t t r ) ; 
 	 } 
 } ; 
 Z m C o n t a c t . i n i t A t t r V a r i a n t s ( Z m C o n t a c t ) ; 
 
 / * * 
   *   T a k e s   a   h a s h   o f   a t t r s   a n d   v a l u e s   a n d   m a p s   i t   t o   o u r   a t t r   n a m e s   a s   b e s t   a s   i t   c a n .   S c a l a r   a t t r s   w i l l   m a p   i f   t h e y 
   *   h a v e   t h e   s a m e   n a m e   o r   o n l y   d i f f e r   b y   c a s e .   A   m u l t i v a l u e d   a t t r   w i l l   m a p   t o   a   s e t   o f   o u r   a t t r i b u t e s   t h a t   s h a r e   t h e 
   *   s a m e   c a s e - i n s e n s i t i v e   b a s e   n a m e .   S o m e   e x a m p l e s : 
   * 
   *             F I R S T N A M E :   " M i l d r e d "         = >             f i r s t N a m e :   " M i l d r e d " 
   *             e m a i l :   [ ' a ' ,   ' b ' ]               = >             e m a i l :   ' a ' , 
   *                                                                             e m a i l 2 :   ' b ' 
   *             W o r k E m a i l :   [ ' y ' ,   ' z ' ]       = >             w o r k E m a i l 1 :   ' y ' , 
   *                                                                             w o r k E m a i l 2 :   ' z ' 
   *             I M a d d r e s s :   [ ' f ' ,   ' g ' ]       = >             i m A d d r e s s 1 :   ' f ' , 
   *                                                                             i m A d d r e s s 2 :   ' g ' 
   * 
   *   @ p a r a m       { O b j e c t }         a t t r s               h a s h   o f   a t t r   n a m e s / v a l u e s 
   * 
   *   @ r e t u r n s   { O b j e c t }         h a s h   o f   a t t r   n a m e s / v a l u e s   u s i n g   k n o w n   a t t r   n a m e s   Z m C o n t a c t . F _ * 
   * / 
 Z m C o n t a c t . m a p A t t r s   =   f u n c t i o n ( a t t r s )   { 
 
 	 v a r   a t t r ,   v a l u e ,   b a s e A t t r s ,   n e w A t t r s   =   { } ; 
 	 f o r   ( a t t r   i n   a t t r s )   { 
 	 	 v a l u e   =   a t t r s [ a t t r ] ; 
 	 	 i f   ( v a l u e )   { 
 	 	 	 b a s e A t t r s   =   Z m C o n t a c t . A T T R _ V A R I A N T S [ a t t r . t o L o w e r C a s e ( ) ] ; 
 	 	 	 i f   ( b a s e A t t r s )   { 
 	 	 	 	 v a l u e   =   A j x U t i l . t o A r r a y ( v a l u e ) ; 
 	 	 	 	 v a r   l e n   =   M a t h . m i n ( v a l u e . l e n g t h ,   b a s e A t t r s . l e n g t h ) ,   i ; 
 	 	 	 	 f o r   ( i   =   0 ;   i   <   l e n ;   i + + )   { 
 	 	 	 	 	 n e w A t t r s [ b a s e A t t r s [ i ] ]   =   v a l u e [ i ] ; 
 	 	 	 	 } 
 	 	 	 }   e l s e   { 
 	 	 	 	 / /   A n y   o v e r l o o k e d / i g n o r e d   a t t r i b u t e s   a r e   s i m p l y   p a s s e d   a l o n g 
 	 	 	 	 n e w A t t r s [ a t t r ]   =   v a l u e ; 
 	 	 	 } 
 	 	 } 
 	 } 
 	 r e t u r n   n e w A t t r s ; 
 } ; 
 
 / /   t h e s e   n e e d   t o   b e   k e p t   i n   s y n c   w i t h   Z m C o n t a c t . F _ * 
 Z m C o n t a c t . _ A B _ F I E L D   =   { 
 	 f i r s t N a m e : 	 	 	 	 Z m M s g . A B _ F I E L D _ f i r s t N a m e , 	 	 / /   f i l e   a s   i n f o 
 	 l a s t N a m e : 	 	 	 	 Z m M s g . A B _ F I E L D _ l a s t N a m e , 
 	 m i d d l e N a m e : 	 	 	 	 Z m M s g . A B _ F I E L D _ m i d d l e N a m e , 
 	 f u l l N a m e : 	 	 	 	 Z m M s g . A B _ F I E L D _ f u l l N a m e , 
 	 j o b T i t l e : 	 	 	 	 Z m M s g . A B _ F I E L D _ j o b T i t l e , 
 	 c o m p a n y : 	 	 	 	 Z m M s g . A B _ F I E L D _ c o m p a n y , 
 	 d e p a r t m e n t : 	 	 	 	 Z m M s g . A B _ F I E L D _ d e p a r t m e n t , 
 	 e m a i l : 	 	 	 	 	 Z m M s g . A B _ F I E L D _ e m a i l , 	 	 	 / /   e m a i l   a d d r e s s e s 
 	 e m a i l 2 : 	 	 	 	 	 Z m M s g . A B _ F I E L D _ e m a i l 2 , 
 	 e m a i l 3 : 	 	 	 	 	 Z m M s g . A B _ F I E L D _ e m a i l 3 , 
 	 i m A d d r e s s 1 : 	 	 	 	 Z m M s g . A B _ F I E L D _ i m A d d r e s s 1 , 	 	 / /   I M   a d d r e s s e s 
 	 i m A d d r e s s 2 : 	 	 	 	 Z m M s g . A B _ F I E L D _ i m A d d r e s s 2 , 
 	 i m A d d r e s s 3 : 	 	 	 	 Z m M s g . A B _ F I E L D _ i m A d d r e s s 3 , 
 	 i m a g e :   	 	 	 	 	 Z m M s g . A B _ F I E L D _ i m a g e , 	 	 	 / /   c o n t a c t   p h o t o 
 	 a t t a c h m e n t : 	 	 	 	 Z m M s g . A B _ F I E L D _ a t t a c h m e n t , 
 	 w o r k S t r e e t : 	 	 	 	 Z m M s g . A B _ F I E L D _ s t r e e t , 	 	 	 / /   w o r k   a d d r e s s   i n f o 
 	 w o r k C i t y : 	 	 	 	 Z m M s g . A B _ F I E L D _ c i t y , 
 	 w o r k S t a t e : 	 	 	 	 Z m M s g . A B _ F I E L D _ s t a t e , 
 	 w o r k P o s t a l C o d e : 	 	 	 Z m M s g . A B _ F I E L D _ p o s t a l C o d e , 
 	 w o r k C o u n t r y : 	 	 	 Z m M s g . A B _ F I E L D _ c o u n t r y , 
 	 w o r k U R L : 	 	 	 	 Z m M s g . A B _ F I E L D _ U R L , 
 	 w o r k P h o n e : 	 	 	 	 Z m M s g . A B _ F I E L D _ w o r k P h o n e , 
 	 w o r k P h o n e 2 : 	 	 	 	 Z m M s g . A B _ F I E L D _ w o r k P h o n e 2 , 
 	 w o r k F a x : 	 	 	 	 Z m M s g . A B _ F I E L D _ w o r k F a x , 
 	 a s s i s t a n t P h o n e : 	 	 	 Z m M s g . A B _ F I E L D _ a s s i s t a n t P h o n e , 
 	 c o m p a n y P h o n e : 	 	 	 Z m M s g . A B _ F I E L D _ c o m p a n y P h o n e , 
 	 c a l l b a c k P h o n e : 	 	 	 Z m M s g . A B _ F I E L D _ c a l l b a c k P h o n e , 
 	 h o m e S t r e e t : 	 	 	 	 Z m M s g . A B _ F I E L D _ s t r e e t , 	 	 	 / /   h o m e   a d d r e s s   i n f o 
 	 h o m e C i t y : 	 	 	 	 Z m M s g . A B _ F I E L D _ c i t y , 
 	 h o m e S t a t e : 	 	 	 	 Z m M s g . A B _ F I E L D _ s t a t e , 
 	 h o m e P o s t a l C o d e : 	 	 	 Z m M s g . A B _ F I E L D _ p o s t a l C o d e , 
 	 h o m e C o u n t r y : 	 	 	 Z m M s g . A B _ F I E L D _ c o u n t r y , 
 	 h o m e U R L : 	 	 	 	 Z m M s g . A B _ F I E L D _ U R L , 
 	 h o m e P h o n e : 	 	 	 	 Z m M s g . A B _ F I E L D _ h o m e P h o n e , 
 	 h o m e P h o n e 2 : 	 	 	 	 Z m M s g . A B _ F I E L D _ h o m e P h o n e 2 , 
 	 h o m e F a x : 	 	 	 	 Z m M s g . A B _ F I E L D _ h o m e F a x , 
 	 m o b i l e P h o n e : 	 	 	 Z m M s g . A B _ F I E L D _ m o b i l e P h o n e , 
 	 p a g e r : 	 	 	 	 	 Z m M s g . A B _ F I E L D _ p a g e r , 
 	 c a r P h o n e : 	 	 	 	 Z m M s g . A B _ F I E L D _ c a r P h o n e , 
 	 o t h e r S t r e e t : 	 	 	 Z m M s g . A B _ F I E L D _ s t r e e t , 	 	 	 / /   o t h e r   i n f o 
 	 o t h e r C i t y : 	 	 	 	 Z m M s g . A B _ F I E L D _ c i t y , 
 	 o t h e r S t a t e : 	 	 	 	 Z m M s g . A B _ F I E L D _ s t a t e , 
 	 o t h e r P o s t a l C o d e : 	 	 Z m M s g . A B _ F I E L D _ p o s t a l C o d e , 
 	 o t h e r C o u n t r y : 	 	 	 Z m M s g . A B _ F I E L D _ c o u n t r y , 
 	 o t h e r U R L : 	 	 	 	 Z m M s g . A B _ F I E L D _ U R L , 
 	 o t h e r P h o n e : 	 	 	 	 Z m M s g . A B _ F I E L D _ o t h e r P h o n e , 
 	 o t h e r F a x : 	 	 	 	 Z m M s g . A B _ F I E L D _ o t h e r F a x , 
 	 n o t e s : 	 	 	 	 	 Z m M s g . n o t e s , 	 	 	 	 	 / /   m i s c   f i e l d s 
 	 b i r t h d a y : 	 	 	 	 Z m M s g . A B _ F I E L D _ b i r t h d a y 
 } ; 
 
 Z m C o n t a c t . _ A B _ F I L E _ A S   =   { 
 	 1 : 	 	 	 	 	 	 Z m M s g . A B _ F I L E _ A S _ l a s t F i r s t , 
 	 2 : 	 	 	 	 	 	 Z m M s g . A B _ F I L E _ A S _ f i r s t L a s t , 
 	 3 : 	 	 	 	 	 	 Z m M s g . A B _ F I L E _ A S _ c o m p a n y , 
 	 4 : 	 	 	 	 	 	 Z m M s g . A B _ F I L E _ A S _ l a s t F i r s t C o m p a n y , 
 	 5 : 	 	 	 	 	 	 Z m M s g . A B _ F I L E _ A S _ f i r s t L a s t C o m p a n y , 
 	 6 : 	 	 	 	 	 	 Z m M s g . A B _ F I L E _ A S _ c o m p a n y L a s t F i r s t , 
 	 7 : 	 	 	 	 	 	 Z m M s g . A B _ F I L E _ A S _ c o m p a n y F i r s t L a s t 
 } ; 
 
 }   / /   i f   ( ! w i n d o w . Z m C o n t a c t ) 
 } 
 i f   ( A j x P a c k a g e . d e f i n e ( " z i m b r a M a i l . a b o o k . m o d e l . Z m C o n t a c t L i s t " ) )   { 
 / * 
   *   * * * * *   B E G I N   L I C E N S E   B L O C K   * * * * * 
   *   Z i m b r a   C o l l a b o r a t i o n   S u i t e   W e b   C l i e n t 
   *   C o p y r i g h t   ( C )   2 0 0 4 ,   2 0 0 5 ,   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 5 ,   2 0 1 6   S y n a c o r ,   I n c . 
   * 
   *   T h e   c o n t e n t s   o f   t h i s   f i l e   a r e   s u b j e c t   t o   t h e   C o m m o n   P u b l i c   A t t r i b u t i o n   L i c e n s e   V e r s i o n   1 . 0   ( t h e   " L i c e n s e " ) ; 
   *   y o u   m a y   n o t   u s e   t h i s   f i l e   e x c e p t   i n   c o m p l i a n c e   w i t h   t h e   L i c e n s e . 
   *   Y o u   m a y   o b t a i n   a   c o p y   o f   t h e   L i c e n s e   a t :   h t t p s : / / w w w . z i m b r a . c o m / l i c e n s e 
   *   T h e   L i c e n s e   i s   b a s e d   o n   t h e   M o z i l l a   P u b l i c   L i c e n s e   V e r s i o n   1 . 1   b u t   S e c t i o n s   1 4   a n d   1 5 
   *   h a v e   b e e n   a d d e d   t o   c o v e r   u s e   o f   s o f t w a r e   o v e r   a   c o m p u t e r   n e t w o r k   a n d   p r o v i d e   f o r   l i m i t e d   a t t r i b u t i o n 
   *   f o r   t h e   O r i g i n a l   D e v e l o p e r .   I n   a d d i t i o n ,   E x h i b i t   A   h a s   b e e n   m o d i f i e d   t o   b e   c o n s i s t e n t   w i t h   E x h i b i t   B . 
   * 
   *   S o f t w a r e   d i s t r i b u t e d   u n d e r   t h e   L i c e n s e   i s   d i s t r i b u t e d   o n   a n   " A S   I S "   b a s i s , 
   *   W I T H O U T   W A R R A N T Y   O F   A N Y   K I N D ,   e i t h e r   e x p r e s s   o r   i m p l i e d . 
   *   S e e   t h e   L i c e n s e   f o r   t h e   s p e c i f i c   l a n g u a g e   g o v e r n i n g   r i g h t s   a n d   l i m i t a t i o n s   u n d e r   t h e   L i c e n s e . 
   *   T h e   O r i g i n a l   C o d e   i s   Z i m b r a   O p e n   S o u r c e   W e b   C l i e n t . 
   *   T h e   I n i t i a l   D e v e l o p e r   o f   t h e   O r i g i n a l   C o d e   i s   Z i m b r a ,   I n c .     A l l   r i g h t s   t o   t h e   O r i g i n a l   C o d e   w e r e 
   *   t r a n s f e r r e d   b y   Z i m b r a ,   I n c .   t o   S y n a c o r ,   I n c .   o n   S e p t e m b e r   1 4 ,   2 0 1 5 . 
   * 
   *   A l l   p o r t i o n s   o f   t h e   c o d e   a r e   C o p y r i g h t   ( C )   2 0 0 4 ,   2 0 0 5 ,   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 5 ,   2 0 1 6   S y n a c o r ,   I n c .   A l l   R i g h t s   R e s e r v e d . 
   *   * * * * *   E N D   L I C E N S E   B L O C K   * * * * * 
   * / 
 
 / * * 
   *   @ o v e r v i e w 
   *   T h i s   f i l e   c o n t a i n s   t h e   c o n t a c t   l i s t   c l a s s . 
   *   
   * / 
 
 / * * 
   *   C r e a t e   a   n e w ,   e m p t y   c o n t a c t   l i s t . 
   *   @ c l a s s 
   *   T h i s   c l a s s   r e p r e s e n t s   a   l i s t   o f   c o n t a c t s .   I n   g e n e r a l ,   t h e   l i s t   i s   t h e   r e s u l t   o f   a 
   *   s e a r c h .   I t   m a y   b e   t h e   r e s u l t   o f   a   < c o d e > & l t ; G e t C o n t a c t s R e q u e s t & g t ; < / c o d e > ,   w h i c h   r e t u r n s   a l l   o f   t h e   u s e r ' s 
   *   l o c a l   c o n t a c t s .   T h a t   l i s t   i s   c o n s i d e r e d   t o   b e   c a n o n i c a l . 
   *   < p > 
   *   L o a d i n g   o f   a l l   l o c a l   c o n t a c t s   h a s   b e e n   o p t i m i z e d   b y   d e l a y i n g   t h e   c r e a t i o n   o f   { @ l i n k   Z m C o n t a c t }   o b j e c t s   u n t i l 
   *   t h e y   a r e   n e e d e d .   T h a t   h a s   a   b i g   i m p a c t   o n   I E ,   a n d   n o t   m u c h   o n   F i r e f o x .   L o a d i n g   a   s u b s e t 
   *   o f   a t t r i b u t e s   d i d   n o t   h a v e   m u c h   i m p a c t   o n   l o a d   t i m e ,   p r o b a b l y   b e c a u s e   a   l a r g e   m a j o r i t y 
   *   o f   c o n t a c t s   c o n t a i n   o n l y   t h o s e   m i n i m a l   f i e l d s . < / p > 
   * 
   *   @ a u t h o r   C o n r a d   D a m o n 
   * 
   *   @ p a r a m   { Z m S e a r c h } 	 s e a r c h 	 t h e   s e a r c h   t h a t   g e n e r a t e d   t h i s   l i s t 
   *   @ p a r a m   { B o o l e a n } 	 i s G a l 	 	 i f   < c o d e > t r u e < / c o d e > ,   t h i s   i s   a   l i s t   o f   G A L   c o n t a c t s 
   *   @ p a r a m   { c o n s t a n t } 	 t y p e 	 	 t h e   i t e m   t y p e 
   *   
   *   @ e x t e n d s 	 	 Z m L i s t 
   * / 
 Z m C o n t a c t L i s t   =   f u n c t i o n ( s e a r c h ,   i s G a l ,   t y p e )   { 
 
 	 i f   ( a r g u m e n t s . l e n g t h   = =   0 )   {   r e t u r n ;   } 
 	 t y p e   =   t y p e   | |   Z m I t e m . C O N T A C T ; 
 	 Z m L i s t . c a l l ( t h i s ,   t y p e ,   s e a r c h ) ; 
 
 	 t h i s . i s G a l   =   ( i s G a l   = = =   t r u e ) ; 
 	 t h i s . i s C a n o n i c a l   =   f a l s e ; 
 	 t h i s . i s L o a d e d   =   f a l s e ; 
 
 	 t h i s . _ a p p   =   a p p C t x t . g e t A p p ( Z m A p p . C O N T A C T S ) ; 
 	 i f   ( ! t h i s . _ a p p )   {   
 	 	 t h i s . _ e m a i l T o C o n t a c t   =   t h i s . _ p h o n e T o C o n t a c t   =   { } ; 
 	 	 r e t u r n ; 
 	 } 
 	 t h i s . _ e m a i l T o C o n t a c t   =   t h i s . _ a p p . _ b y E m a i l ; 
 	 t h i s . _ p h o n e T o C o n t a c t   =   t h i s . _ a p p . _ b y P h o n e ; 
 
 	 t h i s . _ a l w a y s U p d a t e H a s h e s   =   t r u e ;   / /   S h o u l d   w e   u p d a t e   t h e   p h o n e   &   I M   f a s t - l o o k u p   h a s h e s   e v e n   w h e n   a c c o u n t   f e a t u r e s   d o n ' t   r e q u i r e   i t ?   ( b u g   # 6 0 4 1 1 ) 
 } ; 
 
 Z m C o n t a c t L i s t . p r o t o t y p e   =   n e w   Z m L i s t ; 
 Z m C o n t a c t L i s t . p r o t o t y p e . c o n s t r u c t o r   =   Z m C o n t a c t L i s t ; 
 
 Z m C o n t a c t L i s t . p r o t o t y p e . i s Z m C o n t a c t L i s t   =   t r u e ; 
 Z m C o n t a c t L i s t . p r o t o t y p e . t o S t r i n g   =   f u n c t i o n ( )   {   r e t u r n   " Z m C o n t a c t L i s t " ;   } ; 
 
 
 
 
 / /   C o n s t a n t s 
 
 / /   S u p p o r t   f o r   l o a d i n g   u s e r ' s   l o c a l   c o n t a c t s   f r o m   a   l a r g e   s t r i n g 
 
 Z m C o n t a c t L i s t . U R L   =   " / C o n t a c t s " ; 	 / /   R E S T   U R L   f o r   l o a d i n g   u s e r ' s   l o c a l   c o n t a c t s 
 Z m C o n t a c t L i s t . U R L _ A R G S   =   {   f m t :   ' c f ' ,   t :   2 ,   a l l :   ' a l l '   } ;   / /   a r g u m e n t s   f o r   t h e   U R L   a b o v e 
 Z m C o n t a c t L i s t . C O N T A C T _ S P L I T _ C H A R 	 =   ' \ u 0 0 1 E ' ; 	 / /   c h a r   f o r   s p l i t t i n g   s t r i n g   i n t o   c o n t a c t s 
 Z m C o n t a c t L i s t . F I E L D _ S P L I T _ C H A R 	 	 =   ' \ u 0 0 1 D ' ; 	 / /   c h a r   f o r   s p l i t t i n g   c o n t a c t   i n t o   f i e l d s 
 / /   f i e l d s   t h a t   b e l o n g   t o   a   c o n t a c t   r a t h e r   t h a n   i t s   a t t r s 
 Z m C o n t a c t L i s t . I S _ C O N T A C T _ F I E L D   =   { " i d " : t r u e ,   " l " : t r u e ,   " d " : t r u e ,   " f i l e A s S t r " : t r u e ,   " r e v " : t r u e } ; 
 
 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . a d d L o a d e d C a l l b a c k   = 
 f u n c t i o n ( c a l l b a c k )   { 
 	 i f   ( t h i s . i s L o a d e d )   { 
 	 	 c a l l b a c k . r u n ( ) ; 
 	 	 r e t u r n ; 
 	 } 
 	 i f   ( ! t h i s . _ l o a d e d C a l l b a c k s )   { 
 	 	 t h i s . _ l o a d e d C a l l b a c k s   =   [ ] ; 
 	 } 
 	 t h i s . _ l o a d e d C a l l b a c k s . p u s h ( c a l l b a c k ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ f i n i s h L o a d i n g   = 
 f u n c t i o n ( )   { 
 	 D B G . t i m e P t ( " d o n e   l o a d i n g   "   +   t h i s . s i z e ( )   +   "   c o n t a c t s " ) ; 
 	 t h i s . i s L o a d e d   =   t r u e ; 
 	 i f   ( t h i s . _ l o a d e d C a l l b a c k s )   { 
 	 	 v a r   c a l l b a c k ; 
 	 	 w h i l e   ( c a l l b a c k   =   t h i s . _ l o a d e d C a l l b a c k s . s h i f t ( ) )   { 
 	 	 	 c a l l b a c k . r u n ( ) ; 
 	 	 } 
 	 } 
 } ; 
 
 / * * 
   *   R e t r i e v e s   t h e   c o n t a c t s   f r o m   t h e   b a c k   e n d ,   a n d   p a r s e s   t h e   r e s p o n s e .   T h e   l i s t   i s   t h e n   s o r t e d . 
   *   T h i s   m e t h o d   i s   u s e d   o n l y   b y   t h e   c a n o n i c a l   l i s t   o f   c o n t a c t s ,   i n   o r d e r   t o   l o a d   t h e i r   c o n t e n t . 
   *   < p > 
   *   L o a d i n g   a   m i n i m a l   s e t   o f   a t t r i b u t e s   d i d   n o t   r e s u l t   i n   a   s i g n i f i c a n t   p e r f o r m a n c e   g a i n . 
   *   < / p > 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . l o a d   = 
 f u n c t i o n ( c a l l b a c k ,   e r r o r C a l l b a c k ,   a c c o u n t N a m e )   { 
 	 / /   o n l y   t h e   c a n o n i c a l   l i s t   g e t s   l o a d e d 
 	 t h i s . i s C a n o n i c a l   =   t r u e ; 
 	 v a r   r e s p C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e R e s p o n s e L o a d ,   [ c a l l b a c k ] ) ; 
 	 D B G . t i m e P t ( " r e q u e s t i n g   c o n t a c t   l i s t " ,   t r u e ) ; 
         i f ( a p p C t x t . i s E x t e r n a l A c c o u n t ( ) )   { 
                 / / D o   n o t   m a k e   a   c a l l   i n   c a s e   o f   e x t e r n a l   u s e r 
                 / / T h e   r e s t   u r l   c o n s t r u c t e d   w o n t   e x i s t   i n   c a s e   o f   e x t e r n a l   u s e r 
                 i f   ( c a l l b a c k )   { 
 	 	         c a l l b a c k . r u n ( ) ; 
 	         } 
                 r e t u r n ; 
         } 
 	 v a r   a r g s   =   Z m C o n t a c t L i s t . U R L _ A R G S ; 
 
 	 / /   b u g   7 4 6 0 9 :   s u p p r e s s   o v e r z e a l o u s   c a c h i n g   b y   I E 
 	 i f   ( A j x E n v . i s I E )   { 
 	 	 a r g s   =   A j x U t i l . h a s h C o p y ( a r g s ) ; 
 	 	 a r g s . s i d   =   Z m C s f e C o m m a n d . g e t S e s s i o n I d ( ) ; 
 	 } 
 
 	 v a r   p a r a m s   =   { a s y n c M o d e : t r u e ,   n o B u s y O v e r l a y : t r u e ,   c a l l b a c k : r e s p C a l l b a c k ,   e r r o r C a l l b a c k : e r r o r C a l l b a c k ,   o f f l i n e C a l l b a c k : c a l l b a c k } ; 
 	 p a r a m s . r e s t U r i   =   A j x U t i l . f o r m a t U r l ( { 
 	 	 p a t h : [ " / h o m e / " ,   ( a c c o u n t N a m e   | |   a p p C t x t . g e t U s e r n a m e ( ) ) , 
 	                     Z m C o n t a c t L i s t . U R L ] . j o i n ( " " ) , 
 	         q s A r g s :   a r g s ,   q s R e s e t : t r u e 
 	 } ) ; 
 	 D B G . p r i n t l n ( A j x D e b u g . D B G 1 ,   " l o a d i n g   c o n t a c t s   f r o m   "   +   p a r a m s . r e s t U r i ) ; 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( p a r a m s ) ; 
 
 	 Z m C o n t a c t L i s t . a d d D l F o l d e r ( ) ; 
 	 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ h a n d l e R e s p o n s e L o a d   = 
 f u n c t i o n ( c a l l b a c k ,   r e s u l t )   { 
 	 D B G . t i m e P t ( " g o t   c o n t a c t   l i s t " ) ; 
 	 v a r   t e x t   =   r e s u l t . g e t R e s p o n s e ( ) ; 
         i f   ( t e x t   & &   t y p e o f   t e x t   ! = =   ' s t r i n g ' ) { 
                 t e x t   =   t e x t . _ d a t a ; 
         } 
 	 v a r   d e r e f L i s t   =   [ ] ; 
 	 i f   ( t e x t )   { 
 	 	 v a r   c o n t a c t s   =   t e x t . s p l i t ( Z m C o n t a c t L i s t . C O N T A C T _ S P L I T _ C H A R ) ; 
 	 	 v a r   d e r e f B a t c h C m d   =   n e w   Z m B a t c h C o m m a n d ( t r u e ,   n u l l ,   t r u e ) ; 
 	 	 f o r   ( v a r   i   =   0 ,   l e n   =   c o n t a c t s . l e n g t h ;   i   <   l e n ;   i + + )   { 
 	 	 	 v a r   f i e l d s   =   c o n t a c t s [ i ] . s p l i t ( Z m C o n t a c t L i s t . F I E L D _ S P L I T _ C H A R ) ; 
 	 	 	 v a r   c o n t a c t   =   { } ,   a t t r s   =   { } ; 
 	 	 	 v a r   g r o u p M e m b e r s   =   [ ] ; 
 	 	 	 v a r   f o u n d D e r e f   =   f a l s e ; 
 	 	 	 f o r   ( v a r   j   =   0 ,   l e n 1   =   f i e l d s . l e n g t h ;   j   <   l e n 1 ;   j   + =   2 )   { 
 	 	 	 	 i f   ( Z m C o n t a c t L i s t . I S _ C O N T A C T _ F I E L D [ f i e l d s [ j ] ] )   { 
 	 	 	 	 	 c o n t a c t [ f i e l d s [ j ] ]   =   f i e l d s [ j   +   1 ] ; 
 	 	 	 	 }   e l s e   { 
 	 	 	 	 	 v a r   v a l u e   =   f i e l d s [ j + 1 ] ; 
 	 	 	 	 	 s w i t c h   ( f i e l d s [ j ] )   { 
 	 	 	 	 	 	 c a s e   Z m C o n t a c t . F _ m e m b e r C : 
 	 	 	 	 	 	 	 g r o u p M e m b e r s . p u s h ( { t y p e :   Z m C o n t a c t . G R O U P _ C O N T A C T _ R E F ,   v a l u e :   v a l u e } ) ; 
 	 	 	 	 	 	 	 f o u n d D e r e f   =   t r u e ;   / / l o a d   s h a r e d   c o n t a c t s 
 	 	 	 	 	 	 	 b r e a k ; 
 	 	 	 	 	 	 c a s e   Z m C o n t a c t . F _ m e m b e r G : 
 	 	 	 	 	 	 	 g r o u p M e m b e r s . p u s h ( { t y p e :   Z m C o n t a c t . G R O U P _ G A L _ R E F ,   v a l u e :   v a l u e } ) ; 
 	 	 	 	 	 	 	 f o u n d D e r e f   =   t r u e ; 
 	 	 	 	 	 	 	 b r e a k ; 
 	 	 	 	 	 	 c a s e   Z m C o n t a c t . F _ m e m b e r I : 
 	 	 	 	 	 	 	 g r o u p M e m b e r s . p u s h ( { t y p e :   Z m C o n t a c t . G R O U P _ I N L I N E _ R E F ,   v a l u e :   v a l u e } ) ; 
 	 	 	 	 	 	 	 f o u n d D e r e f   =   t r u e ; 
 	 	 	 	 	 	 	 b r e a k ; 
 	 	 	 	 	 	 d e f a u l t : 
 	 	 	 	 	 	 	 a t t r s [ f i e l d s [ j ] ]   =   v a l u e ; 
 	 	 	 	 	 } 
 	 	 	 	 } 
 	 	 	 } 
 	 	 	 i f   ( a t t r s [ Z m C o n t a c t . F _ t y p e ]   = = =   " g r o u p " )   {   / / s e t   o n l y   f o r   g r o u p . 
 	 	 	 	 a t t r s [ Z m C o n t a c t . F _ g r o u p s ]   =   g r o u p M e m b e r s ; 
 	 	 	 } 
 	 	 	 i f   ( f o u n d D e r e f )   { 
 	 	 	 	 / / b a t c h   g r o u p   m e m b e r s   f o r   d e r e f   l o a d i n g 
 	 	 	 	 v a r   d u m m y   =   n e w   Z m C o n t a c t ( c o n t a c t [ " i d " ] ,   t h i s ) ; 
 	 	 	 	 d e r e f B a t c h C m d . a d d ( n e w   A j x C a l l b a c k ( d u m m y ,   d u m m y . l o a d ,   [ n u l l ,   n u l l ,   d e r e f B a t c h C m d ,   t r u e ] ) ) ; 
 	 	 	 } 
 	 	 	 c o n t a c t . _ a t t r s   =   a t t r s ; 
 	 	 	 t h i s . _ a d d C o n t a c t ( c o n t a c t ) ; 
 	 	 } 
 	 	 d e r e f B a t c h C m d . r u n ( ) ; 
 	 } 
 
 	 t h i s . _ f i n i s h L o a d i n g ( ) ; 
 
 	 i f   ( c a l l b a c k )   { 
 	 	 c a l l b a c k . r u n ( ) ; 
 	 } 
 } ; 
 
 / * * 
   *   @ s t a t i c 
   * / 
 Z m C o n t a c t L i s t . a d d D l F o l d e r   = 
 f u n c t i o n ( )   { 
 
 	 i f   ( ! a p p C t x t . g e t ( Z m S e t t i n g . D L S _ F O L D E R _ E N A B L E D ) )   { 
 	 	 r e t u r n ; 
 	 } 
 
 	 v a r   d l s F o l d e r   =   a p p C t x t . g e t B y I d ( Z m O r g a n i z e r . I D _ D L S ) ; 
 
 	 v a r   r o o t   =   a p p C t x t . g e t B y I d ( Z m O r g a n i z e r . I D _ R O O T ) ; 
 	 i f   ( ! r o o t )   {   r e t u r n ;   } 
 
 	 i f   ( d l s F o l d e r   & &   r o o t . g e t B y I d ( Z m O r g a n i z e r . I D _ D L S ) )   { 
 	 	 / / s o m e h o w   ( a f t e r   a   r e f r e s h   b l o c k ,   c a n   b e   r e p r o d   u s i n g   $ s e t : r e f r e s h .   Z m C l i e n t C m d H a n d l e r . p r o t o t y p e . e x e c u t e _ r e f r e s h )   t h e   D L s   f o l d e r   o b j e c t   i s   r e m o v e d   f r o m   u n d e r   t h e   r o o t   ( b u t   s t i l l   c a c h e d   i n   a p p C t x t ) .   S o   m a k i n g   s u r e   i t ' s   t h e r e . 
 	 	 r e t u r n ; 
 	 } 
 
 	 i f   ( ! d l s F o l d e r )   { 
 	 	 v a r   p a r a m s   =   { 
 	 	 	 i d :   Z m O r g a n i z e r . I D _ D L S , 
 	 	 	 n a m e :   Z m M s g . d i s t r i b u t i o n L i s t s , 
 	 	 	 p a r e n t :   r o o t , 
 	 	 	 t r e e :   r o o t . t r e e , 
 	 	 	 t y p e :   Z m O r g a n i z e r . A D D R B O O K , 
 	 	 	 n u m T o t a l :   n u l l ,   / / w e   d o n ' t   k n o w   h o w   m a n y 
 	 	 	 n o T o o l t i p :   t r u e   / / s o   d o n ' t   s h o w   t o o l t i p 
 	 	 } ; 
 
 	 	 d l s F o l d e r   =   n e w   Z m A d d r B o o k ( p a r a m s ) ; 
 	 	 r o o t . c h i l d r e n . a d d ( d l s F o l d e r ) ; 
 	 	 d l s F o l d e r . _ i s D L   =   t r u e ; 
 	 } 
 	 e l s e   { 
 	 	 / / t h e   d l s   f o l d e r   o b j e c t   e x i s t s   b u t   n o   l o n g e r   a s   a   c h i l d   o f   t h e   r o o t . 
 	 	 d l s F o l d e r . p a r e n t   =   r o o t ; 
 	 	 r o o t . c h i l d r e n . a d d ( d l s F o l d e r ) ;   / / a n y   b e t t e r   w a y   t o   d o   t h i s ? 
 	 } 
 
 } ; 
 
 Z m C o n t a c t L i s t . p r o t o t y p e . a d d   =   
 f u n c t i o n ( i t e m ,   i n d e x )   { 
 	 i f   ( ! i t e m . i d   | |   ! t h i s . _ i d H a s h [ i t e m . i d ] )   { 
 	 	 t h i s . _ v e c t o r . a d d ( i t e m ,   i n d e x ) ; 
 	 	 i f   ( i t e m . i d )   { 
 	 	 	 t h i s . _ i d H a s h [ i t e m . i d ]   =   i t e m ; 
 	 	 } 
 	 	 t h i s . _ u p d a t e H a s h e s ( i t e m ,   t r u e ) ; 
 	 } 
 } ; 
 
 Z m C o n t a c t L i s t . p r o t o t y p e . c a c h e   =   
 f u n c t i o n ( o f f s e t ,   n e w L i s t )   { 
 	 v a r   g e t I d   =   f u n c t i o n ( ) { 
 	 	 r e t u r n   t h i s . i d ; 
 	 } 
 	 v a r   e x i s t s   =   f u n c t i o n ( o b j )   { 
 	 	 r e t u r n   t h i s . _ v e c t o r . c o n t a i n s L i k e ( o b j ,   g e t I d ) ; 
 	 } 
 	 v a r   u n i q u e   =   n e w L i s t . s u b ( e x i s t s ,   t h i s ) ; 
 
 	 t h i s . g e t V e c t o r ( ) . m e r g e ( o f f s e t ,   u n i q u e ) ; 
 	 / /   r e p a r e n t   e a c h   i t e m   w i t h i n   n e w   l i s t ,   a n d   a d d   i t   t o   I D   h a s h 
 	 v a r   l i s t   =   u n i q u e . g e t A r r a y ( ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   l i s t . l e n g t h ;   i + + )   { 
 	 	 v a r   i t e m   =   l i s t [ i ] ; 
 	 	 i t e m . l i s t   =   t h i s ; 
 	 	 i f   ( i t e m . i d )   { 
 	 	 	 t h i s . _ i d H a s h [ i t e m . i d ]   =   i t e m ; 
 	 	 } 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ a d d C o n t a c t   = 
 f u n c t i o n ( c o n t a c t )   { 
 
 	 / /   n o t e   t h a t   w e   d o n ' t   c r e a t e   a   Z m C o n t a c t   h e r e   ( o p t i m i z a t i o n ) 
 	 c o n t a c t . l i s t   =   t h i s ; 
 	 t h i s . _ u p d a t e H a s h e s ( c o n t a c t ,   t r u e ) ; 
 	 v a r   f n   =   [ ] ,   f l   =   [ ] ; 
 	 i f   ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ f i r s t N a m e ] ) 	 {   f n . p u s h ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ f i r s t N a m e ] ) ;   } 
 	 i f   ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ m i d d l e N a m e ] ) 	 {   f n . p u s h ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ m i d d l e N a m e ] ) ;   } 
 	 i f   ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ l a s t N a m e ] ) 	 {   f n . p u s h ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ l a s t N a m e ] ) ;   } 
 	 i f   ( f n . l e n g t h )   { 
 	 	 c o n t a c t . _ a t t r s [ Z m C o n t a c t . X _ f u l l N a m e ]   =   f n . j o i n ( "   " ) ; 
 	 } 
 	 i f   ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ f i r s t N a m e ] ) 	 {   f l . p u s h ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ f i r s t N a m e ] ) ;   } 
 	 i f   ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ l a s t N a m e ] ) 	 {   f l . p u s h ( c o n t a c t . _ a t t r s [ Z m C o n t a c t . F _ l a s t N a m e ] ) ;   } 
 	 c o n t a c t . _ a t t r s [ Z m C o n t a c t . X _ f i r s t L a s t ]   =   f l . j o i n ( "   " ) ; 
 
 	 t h i s . a d d ( c o n t a c t ) ; 
 } ; 
 
 / * * 
   *   C o n v e r t s   a n   a n o n y m o u s   c o n t a c t   o b j e c t   ( c o n t a i n e d   b y   t h e   J S   r e t u r n e d   b y   l o a d   r e q u e s t ) 
   *   i n t o   a   Z m C o n t a c t ,   a n d   u p d a t e s   t h e   c o n t a i n i n g   l i s t   i f   i t   i s   t h e   c a n o n i c a l   o n e . 
   * 
   *   @ p a r a m   { O b j e c t } 	 c o n t a c t 	 	 a   c o n t a c t 
   *   @ p a r a m   { i n t } 	 i d x 	 	 t h e   i n d e x   o f   c o n t a c t   i n   c a n o n i c a l   l i s t 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ r e a l i z e C o n t a c t   = 
 f u n c t i o n ( c o n t a c t ,   i d x )   { 
 
 	 i f   ( c o n t a c t   i n s t a n c e o f   Z m C o n t a c t )   {   r e t u r n   c o n t a c t ;   } 
 	 i f   ( c o n t a c t   & &   c o n t a c t . t y p e   = =   Z m I t e m . C O N T A C T )   {   r e t u r n   c o n t a c t ;   } 	 / /   i n s t a n c e o f   o f t e n   f a i l s   i n   n e w   w i n d o w 
 
 	 v a r   a r g s   =   { l i s t : t h i s } ; 
 	 v a r   o b j   =   e v a l ( Z m L i s t . I T E M _ C L A S S [ t h i s . t y p e ] ) ; 
 	 v a r   r e a l C o n t a c t   =   o b j   & &   o b j . c r e a t e F r o m D o m ( c o n t a c t ,   a r g s ) ; 
 
 	 i f   ( t h i s . i s C a n o n i c a l )   { 
 	 	 v a r   a   =   t h i s . g e t A r r a y ( ) ; 
 	 	 i d x   =   i d x   | |   t h i s . g e t I n d e x B y I d ( c o n t a c t . i d ) ; 
 	 	 a [ i d x ]   =   r e a l C o n t a c t ; 
 	 	 t h i s . _ u p d a t e H a s h e s ( r e a l C o n t a c t ,   t r u e ) ; 
 	 	 t h i s . _ i d H a s h [ c o n t a c t . i d ]   =   r e a l C o n t a c t ; 
 	 } 
 
 	 r e t u r n   r e a l C o n t a c t ; 
 } ; 
 
 / * * 
   *   F i n d s   t h e   a r r a y   i n d e x   f o r   t h e   c o n t a c t   w i t h   t h e   g i v e n   I D . 
   * 
   *   @ p a r a m   { i n t } 	 i d 	 	 t h e   c o n t a c t   I D 
   *   @ r e t u r n 	 { i n t } 	 t h e   i n d e x 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . g e t I n d e x B y I d   = 
 f u n c t i o n ( i d )   { 
 	 v a r   a   =   t h i s . g e t A r r a y ( ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   a . l e n g t h ;   i + + )   { 
 	 	 i f   ( a [ i ] . i d   = =   i d )   { 
 	 	 	 r e t u r n   i ; 
 	 	 } 
 	 } 
 	 r e t u r n   n u l l ; 
 } ; 
 
 / * * 
   *   O v e r r i d e   i n   o r d e r   t o   m a k e   s u r e   t h e   c o n t a c t s   h a v e   b e e n   r e a l i z e d .   W e   d o n ' t 
   *   c a l l   r e a l i z e C o n t a c t ( )   s i n c e   t h i s   i s   n o t   t h e   c a n o n i c a l   l i s t . 
   * 
   *   @ p a r a m   { i n t } 	 o f f s e t 	 	 t h e   s t a r t i n g   i n d e x 
   *   @ p a r a m   { i n t } 	 l i m i t 	 	 t h e   s i z e   o f   s u b l i s t 
   *   @ r e t u r n 	 { A j x V e c t o r } 	 a   v e c t o r   o f   { @ l i n k   Z m C o n t a c t }   o b j e c t s 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . g e t S u b L i s t   = 
 f u n c t i o n ( o f f s e t ,   l i m i t ,   f o l d e r I d )   { 
 	 i f   ( f o l d e r I d   & &   t h i s . i s C a n o n i c a l )   { 
 	 	 / /   o n l y   c o l l e c t   t h o s e   c o n t a c t s   t h a t   b e l o n g   t o   t h e   g i v e n   f o l d e r I d   i f   p r o v i d e d 
 	 	 v a r   n e w l i s t   =   [ ] ; 
 	 	 v a r   s u b l i s t   =   t h i s . g e t A r r a y ( ) ; 
 	 	 v a r   o f f s e t C o u n t   =   0 ; 
 	 	 t h i s . s e t H a s M o r e ( f a l s e ) ; 
 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   s u b l i s t . l e n g t h ;   i + + )   { 
 	 	 	 s u b l i s t [ i ]   =   t h i s . _ r e a l i z e C o n t a c t ( s u b l i s t [ i ] ,   i ) ; 
 	 	 	 v a r   f o l d e r   =   a p p C t x t . g e t B y I d ( s u b l i s t [ i ] . f o l d e r I d ) ; 
 	 	 	 i f   ( f o l d e r   & &   f o l d e r . n I d   = =   Z m O r g a n i z e r . n o r m a l i z e I d ( f o l d e r I d ) )   { 
 	 	 	 	 i f   ( o f f s e t C o u n t   > =   o f f s e t )   { 
 	 	 	 	 	 i f   ( n e w l i s t . l e n g t h   = =   l i m i t )   { 
 	 	 	 	 	 	 t h i s . s e t H a s M o r e ( t r u e ) ; 
 	 	 	 	 	 	 b r e a k ; 
 	 	 	 	 	 } 
 	 	 	 	 	 n e w l i s t . p u s h ( s u b l i s t [ i ] ) ; 
 	 	 	 	 } 
 	 	 	 	 o f f s e t C o u n t + + ; 
 	 	 	 } 
 	 	 } 
 
 	 	 r e t u r n   A j x V e c t o r . f r o m A r r a y ( n e w l i s t ) ; 
 	 }   e l s e   { 
 	 	 v a r   v e c   =   Z m L i s t . p r o t o t y p e . g e t S u b L i s t . c a l l ( t h i s ,   o f f s e t ,   l i m i t ) ; 
 	 	 i f   ( v e c )   { 
 	 	 	 v a r   a   =   v e c . g e t A r r a y ( ) ; 
 	 	 	 f o r   ( v a r   i   =   0 ;   i   <   a . l e n g t h ;   i + + )   { 
 	 	 	 	 a [ i ]   =   t h i s . _ r e a l i z e C o n t a c t ( a [ i ] ,   o f f s e t   +   i ) ; 
 	 	 	 } 
 	 	 } 
 
 	 	 r e t u r n   v e c ; 
 	 } 
 } ; 
 
 / * * 
   *   O v e r r i d e   i n   o r d e r   t o   m a k e   s u r e   t h e   c o n t a c t   h a s   b e e n   r e a l i z e d .   C a n o n i c a l   l i s t   o n l y . 
   * 
   *   @ p a r a m   { i n t } 	 i d 	 	 t h e   c o n t a c t   I D 
   *   @ r e t u r n 	 { Z m C o n t a c t } 	 t h e   c o n t a c t   o r   < c o d e > n u l l < / c o d e >   i f   n o t   f o u n d 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . g e t B y I d   = 
 f u n c t i o n ( i d )   { 
 	 i f   ( ! i d   | |   ! t h i s . i s C a n o n i c a l )   r e t u r n   n u l l ; 
 
 	 v a r   c o n t a c t   =   t h i s . _ i d H a s h [ i d ] ; 
 	 r e t u r n   c o n t a c t   ?   t h i s . _ r e a l i z e C o n t a c t ( c o n t a c t )   :   n u l l ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   c o n t a c t   w i t h   t h e   g i v e n   a d d r e s s ,   i f   a n y   ( c a n o n i c a l   l i s t   o n l y ) . 
   * 
   *   @ p a r a m   { S t r i n g } 	 a d d r e s s 	 a n   e m a i l   a d d r e s s 
   *   @ r e t u r n 	 { Z m C o n t a c t } 	 t h e   c o n t a c t   o r   < c o d e > n u l l < / c o d e >   i f   n o t   f o u n d 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . g e t C o n t a c t B y E m a i l   = 
 f u n c t i o n ( a d d r e s s )   { 
 	 i f   ( ! a d d r e s s   | |   ! t h i s . i s C a n o n i c a l )   r e t u r n   n u l l ; 
 
 	 v a r   c o n t a c t   =   t h i s . _ e m a i l T o C o n t a c t [ a d d r e s s . t o L o w e r C a s e ( ) ] ; 
 	 i f   ( c o n t a c t )   { 
 	 	 c o n t a c t   =   t h i s . _ r e a l i z e C o n t a c t ( c o n t a c t ) ; 
 	 	 c o n t a c t . _ l o o k u p E m a i l   =   a d d r e s s ; 	 / /   s o   c a l l e r   k n o w s   w h i c h   a d d r e s s   m a t c h e d 
 	 	 r e t u r n   c o n t a c t ; 
 	 }   e l s e   { 
 	 	 r e t u r n   n u l l ; 
 	 } 
 } ; 
 
 / * * 
   *   G e t s   i n f o r m a t i o n   a b o u t   t h e   c o n t a c t   w i t h   t h e   g i v e n   p h o n e   n u m b e r ,   i f   a n y   ( c a n o n i c a l   l i s t   o n l y ) . 
   * 
   *   @ p a r a m   { S t r i n g } 	 p h o n e 	 t h e   p h o n e   n u m b e r 
   *   @ r e t u r n 	 { H a s h } 	 a n   o b j e c t   w i t h   < c o d e > c o n t a c t < / c o d e >   =   t h e   c o n t a c t   &   < c o d e > f i e l d < / c o d e >   =   t h e   f i e l d   w i t h   t h e   m a t c h i n g   p h o n e   n u m b e r 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . g e t C o n t a c t B y P h o n e   = 
 f u n c t i o n ( p h o n e )   { 
 	 i f   ( ! p h o n e   | |   ! t h i s . i s C a n o n i c a l )   r e t u r n   n u l l ; 
 
 	 v a r   d i g i t s   =   t h i s . _ g e t P h o n e D i g i t s ( p h o n e ) ; 
 	 v a r   d a t a   =   t h i s . _ p h o n e T o C o n t a c t [ d i g i t s ] ; 
 	 i f   ( d a t a )   { 
 	 	 d a t a . c o n t a c t   =   t h i s . _ r e a l i z e C o n t a c t ( d a t a . c o n t a c t ) ; 
 	 	 r e t u r n   d a t a ; 
 	 }   e l s e   { 
 	 	 r e t u r n   n u l l ; 
 	 } 
 } ; 
 
 / * * 
   *   M o v e s   a   l i s t   o f   i t e m s   t o   t h e   g i v e n   f o l d e r . 
   *   < p > 
   *   T h i s   m e t h o d   c a l l s   t h e   b a s e   c l a s s   f o r   n o r m a l   " m o v e s "   U N L E S S   w e ' r e   d e a l i n g   w / 
   *   s h a r e d   i t e m s   ( o r   f o l d e r )   i n   w h i c h   c a s e   w e   m u s t   s e n d   a   C R E A T E   r e q u e s t   f o r   t h e 
   *   g i v e n   f o l d e r   t o   t h e   s e r v e r   f o l l o w e d   b y   a   h a r d   d e l e t e   o f   t h e   s h a r e d   c o n t a c t . 
   *   < / p > 
   * 
   *   @ p a r a m   { H a s h } 	 p a r a m s 	 	 a   h a s h   o f   p a r a m e t e r s 
   *   @ p a r a m 	 { A r r a y }               p a r a m s . i t e m s 	 	 	 a   l i s t   o f   i t e m s   t o   m o v e 
   *   @ p a r a m 	 { Z m F o l d e r } 	 p a r a m s . f o l d e r 	 	 t h e   d e s t i n a t i o n   f o l d e r 
   *   @ p a r a m 	 { H a s h } 	               p a r a m s . a t t r s 	 	 t h e   a d d i t i o n a l   a t t r s   f o r   S O A P   c o m m a n d 
   *   @ p a r a m 	 { B o o l e a n } 	 p a r a m s . o u t O f T r a s h 	 i f   < c o d e > t r u e < / c o d e > ,   w e   a r e   m o v i n g   c o n t a c t s   o u t   o f   t r a s h 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . m o v e I t e m s   = 
 f u n c t i o n ( p a r a m s )   { 
 
 	 p a r a m s   =   D w t . g e t P a r a m s ( a r g u m e n t s ,   [ " i t e m s " ,   " f o l d e r " ,   " a t t r s " ,   " o u t O f T r a s h " ] ) ; 
 	 p a r a m s . i t e m s   =   A j x U t i l . t o A r r a y ( p a r a m s . i t e m s ) ; 
 
 	 v a r   m o v e B a t c h C m d   =   n e w   Z m B a t c h C o m m a n d ( t r u e ,   n u l l ,   t r u e ) ; 
 	 v a r   l o a d B a t c h C m d   =   n e w   Z m B a t c h C o m m a n d ( t r u e ,   n u l l ,   t r u e ) ; 
 	 v a r   s o f t M o v e   =   [ ] ; 
 
 	 / /   i f   t h e   f o l d e r   w e ' r e   m o v i n g   c o n t a c t s   t o   i s   a   s h a r e d   f o l d e r ,   t h e n   d o n t   b o t h e r 
 	 / /   c h e c k i n g   w h e t h e r   e a c h   i t e m   i s   s h a r e d   o r   n o t 
 	 i f   ( p a r a m s . i t e m s [ 0 ]   & &   p a r a m s . i t e m s [ 0 ]   i n s t a n c e o f   Z m I t e m )   { 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   p a r a m s . i t e m s . l e n g t h ;   i + + )   { 
 	 	 	 v a r   c o n t a c t   =   p a r a m s . i t e m s [ i ] ; 
 
 	 	 	 i f   ( c o n t a c t . i s R e a d O n l y ( ) )   {   c o n t i n u e ;   } 
 
 	 	 	 s o f t M o v e . p u s h ( c o n t a c t ) ; 
 	 	 } 
 	 }   e l s e   { 
 	 	 s o f t M o v e   =   p a r a m s . i t e m s ; 
 	 } 
 
 	 / /   f o r   " s o f t "   m o v e s ,   h a n d l e   m o v i n g   o u t   o f   T r a s h   d i f f e r e n t l y 
 	 i f   ( s o f t M o v e . l e n g t h   >   0 )   { 
 	 	 v a r   p a r a m s 1   =   A j x U t i l . h a s h C o p y ( p a r a m s ) ; 
 	 	 p a r a m s 1 . a t t r s   =   p a r a m s . a t t r s   | |   { } ; 
 	 	 v a r   t o F o l d e r   =   p a r a m s . f o l d e r ; 
 	 	 p a r a m s 1 . a t t r s . l   =   t o F o l d e r . i s R e m o t e ( )   ?   t o F o l d e r . g e t R e m o t e I d ( )   :   t o F o l d e r . i d ; 
 	 	 p a r a m s 1 . a c t i o n   =   " m o v e " ; 
                 p a r a m s 1 . a c c o u n t N a m e   =   a p p C t x t . m u l t i A c c o u n t s   & &   a p p C t x t . a c c o u n t L i s t . m a i n A c c o u n t . n a m e ; 
                 i f   ( p a r a m s 1 . f o l d e r . i d   = =   Z m F o l d e r . I D _ T R A S H )   { 
                         p a r a m s 1 . a c t i o n T e x t K e y   =   ' a c t i o n T r a s h ' ; 
                         / /   b u g :   4 7 3 8 9   a v o i d   m o v i n g   t o   l o c a l   a c c o u n t ' s   T r a s h   f o l d e r . 
                         p a r a m s 1 . a c c o u n t N a m e   =   a p p C t x t . m u l t i A c c o u n t s   & &   p a r a m s . i t e m s [ 0 ] . g e t A c c o u n t ( ) . n a m e ; 
                 }   e l s e   { 
                         p a r a m s 1 . a c t i o n T e x t K e y   =   ' a c t i o n M o v e ' ; 
                         p a r a m s 1 . a c t i o n A r g   =   t o F o l d e r . g e t N a m e ( f a l s e ,   f a l s e ,   t r u e ) ; 
                 } 
 	 	 p a r a m s 1 . c a l l b a c k   =   p a r a m s . o u t O f T r a s h   & &   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e R e s p o n s e M o v e I t e m s ,   p a r a m s ) ; 
 
 	 	 t h i s . _ i t e m A c t i o n ( p a r a m s 1 ) ; 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ h a n d l e R e s p o n s e M o v e B a t c h C m d   = 
 f u n c t i o n ( r e s u l t )   { 
 	 v a r   r e s p   =   r e s u l t . g e t R e s p o n s e ( ) . B a t c h R e s p o n s e . C o n t a c t A c t i o n R e s p o n s e ; 
 	 / /   X X X :   b / c   t h e   s e r v e r   d o e s   n o t   r e t u r n   n o t i f i c a t i o n s   f o r   a c t i o n s   d o n e   o n 
 	 / /             s h a r e s ,   w e   m a n u a l l y   n o t i f y   -   T E M P   U N T I L   W E   G E T   B E T T E R   S E R V E R   S U P P O R T 
 	 v a r   i d s   =   r e s p [ 0 ] . a c t i o n . i d . s p l i t ( " , " ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   i d s . l e n g t h ;   i + + )   { 
 	 	 v a r   c o n t a c t   =   a p p C t x t . c a c h e G e t ( i d s [ i ] ) ; 
 	 	 i f   ( c o n t a c t   & &   c o n t a c t . i s S h a r e d ( ) )   { 
 	 	 	 c o n t a c t . n o t i f y D e l e t e ( ) ; 
 	 	 	 a p p C t x t . c a c h e R e m o v e ( i d s [ i ] ) ; 
 	 	 } 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ h a n d l e R e s p o n s e L o a d M o v e   = 
 f u n c t i o n ( m o v e B a t c h C m d ,   p a r a m s )   { 
 	 v a r   d e l e t e C m d   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ i t e m A c t i o n ,   [ p a r a m s ] ) ; 
 	 m o v e B a t c h C m d . a d d ( d e l e t e C m d ) ; 
 
 	 v a r   r e s p C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e R e s p o n s e M o v e B a t c h C m d ) ; 
 	 m o v e B a t c h C m d . r u n ( r e s p C a l l b a c k ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ h a n d l e R e s p o n s e B a t c h L o a d   = 
 f u n c t i o n ( b a t c h C m d ,   f o l d e r ,   r e s u l t ,   c o n t a c t )   { 
 	 b a t c h C m d . a d d ( t h i s . _ g e t C o p y C m d ( c o n t a c t ,   f o l d e r ) ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ g e t C o p y C m d   = 
 f u n c t i o n ( c o n t a c t ,   f o l d e r )   { 
 	 v a r   t e m p   =   n e w   Z m C o n t a c t ( n u l l ,   t h i s ) ; 
 	 f o r   ( v a r   j   i n   c o n t a c t . a t t r )   { 
 	 	 t e m p . a t t r [ j ]   =   c o n t a c t . a t t r [ j ] ; 
 	 } 
 	 t e m p . a t t r [ Z m C o n t a c t . F _ f o l d e r I d ]   =   f o l d e r . i d ; 
 
 	 r e t u r n   n e w   A j x C a l l b a c k ( t e m p ,   t e m p . c r e a t e ,   [ t e m p . a t t r ] ) ; 
 } ; 
 
 / * * 
   *   D e l e t e s   c o n t a c t s   a f t e r   c h e c k i n g   t h a t   t h i s   i s   n o t   a   G A L   l i s t . 
   * 
   *   @ p a r a m   { H a s h } 	 p a r a m s 	 	 a   h a s h   o f   p a r a m e t e r s 
   *   @ p a r a m 	 { A r r a y } 	               p a r a m s . i t e m s 	 	 	 t h e   l i s t   o f   i t e m s   t o   d e l e t e 
   *   @ p a r a m 	 { B o o l e a n } 	 p a r a m s . h a r d D e l e t e 	 i f   < c o d e > t r u e < / c o d e > ,   f o r c e   p h y s i c a l   r e m o v a l   o f   i t e m s 
   *   @ p a r a m 	 { O b j e c t } 	 p a r a m s . a t t r s 	 	 	 t h e   a d d i t i o n a l   a t t r s   f o r   S O A P   c o m m a n d 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . d e l e t e I t e m s   = 
 f u n c t i o n ( p a r a m s )   { 
 	 i f   ( t h i s . i s G a l )   { 
 	 	 i f   ( Z m C o n t a c t L i s t . d e l e t e G a l I t e m s A l l o w e d ( p a r a m s . i t e m s ) )   { 
 	 	 	 t h i s . _ d e l e t e D l s ( p a r a m s . i t e m s ) ; 
 	 	 	 r e t u r n ; 
 	 	 } 
 	 	 D B G . p r i n t l n ( A j x D e b u g . D B G 1 ,   " C a n n o t   d e l e t e   G A L   c o n t a c t s   t h a t   a r e   n o t   D L s " ) ; 
 	 	 r e t u r n ; 
 	 } 
 	 Z m L i s t . p r o t o t y p e . d e l e t e I t e m s . c a l l ( t h i s ,   p a r a m s ) ; 
 } ; 
 
 Z m C o n t a c t L i s t . d e l e t e G a l I t e m s A l l o w e d   = 
 f u n c t i o n ( i t e m s )   { 
 	 v a r   d e l e t e D o m a i n s A l l o w e d   =   a p p C t x t . c r e a t e D i s t L i s t A l l o w e d D o m a i n s M a p ; 
 	 i f   ( i t e m s . l e n g t h   = =   0 )   { 
 	 	 r e t u r n   f a l s e ;   / / n e e d   a   s p e c i a l   c a s e   s i n c e   w e   d o n ' t   w a n t   t o   e n a b l e   t h e   " d e l e t e "   b u t t o n   f o r   0   i t e m s . 
 	 } 
 	 f o r   ( v a r   i   =   0 ;   i   <   i t e m s . l e n g t h ;   i + + )   { 
 	 	 v a r   c o n t a c t   =   i t e m s [ i ] ; 
 	 	 v a r   e m a i l   =   c o n t a c t . g e t E m a i l ( ) ; 
 	 	 v a r   d o m a i n   =   e m a i l . s p l i t ( " @ " ) [ 1 ] ; 
 	 	 v a r   i s D L   =   c o n t a c t   & &   c o n t a c t . i s D i s t r i b u t i o n L i s t ( ) ; 
 	 	 / / s e e   b u g   7 1 3 6 8   a n d   a l s o   b u g   7 9 6 7 2   -   t h e   ! c o n t a c t . d l I n f o   i s   i n   c a s e   s o m e h o w   d l I n f o   i s   m i s s i n g   -   s o   u n f o r t u n a t e l y   i f   t h a t   h a p p e n s   ( c a n ' t   r e p r o )   -   l e t ' s   n o t   a l l o w   t o   d e l e t e   s i n c e   w e   d o   n o t   k n o w   i f   i t ' s   a n   o w n e r 
 	 	 i f   ( ! i s D L   | |   ! d e l e t e D o m a i n s A l l o w e d [ d o m a i n ]   | |   ! c o n t a c t . d l I n f o   | |   ! c o n t a c t . d l I n f o . i s O w n e r )   { 
 	 	 	 r e t u r n   f a l s e ; 
 	 	 } 
 	 } 
 	 r e t u r n   t r u e ; 
 } ; 
 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ d e l e t e D l s   = 
 f u n c t i o n ( i t e m s ,   c o n f i r m D e l e t e )   { 
 
 	 i f   ( ! c o n f i r m D e l e t e )   { 
 	 	 v a r   c a l l b a c k   =   t h i s . _ d e l e t e D l s . b i n d ( t h i s ,   i t e m s ,   t r u e ) ; 
 	 	 t h i s . _ p o p u p D e l e t e W a r n i n g D i a l o g ( c a l l b a c k ,   f a l s e ,   i t e m s . l e n g t h ) ; 
 	 	 r e t u r n ; 
 	 } 
 
 	 v a r   r e q s   =   [ ] ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   i t e m s . l e n g t h ;   i + + )   { 
 	 	 v a r   c o n t a c t   =   i t e m s [ i ] ; 
 	 	 v a r   e m a i l   =   c o n t a c t . g e t E m a i l ( ) ; 
 	 	 r e q s . p u s h ( { 
 	 	 	 	 _ j s n s :   " u r n : z i m b r a A c c o u n t " , 
 	 	 	 	 d l :   { b y :   " n a m e " , 
 	 	 	 	 	   _ c o n t e n t :   c o n t a c t . g e t E m a i l ( ) 
 	 	 	 	 } , 
 	 	 	 	 a c t i o n :   { 
 	 	 	 	 	 o p :   " d e l e t e " 
 	 	 	 	 } 
 	 	 	 } ) ; 
 	 } 
 	 v a r   j s o n O b j   =   { 
 	 	 B a t c h R e q u e s t :   { 
 	 	 	 _ j s n s :   " u r n : z i m b r a " , 
 	 	 	 D i s t r i b u t i o n L i s t A c t i o n R e q u e s t :   r e q s 
 	 	 } 
 	 } ; 
 	 v a r   r e s p C a l l b a c k   =   t h i s . _ d e l e t e D l s R e s p o n s e H a n d l e r . b i n d ( t h i s ,   i t e m s ) ; 
 	 a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { j s o n O b j :   j s o n O b j ,   a s y n c M o d e :   t r u e ,   c a l l b a c k :   r e s p C a l l b a c k } ) ; 
 
 } ; 
 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ d e l e t e D l s R e s p o n s e H a n d l e r   = 
 f u n c t i o n ( i t e m s )   { 
 	 i f   ( a p p C t x t . g e t C u r r e n t V i e w ( ) . i s Z m G r o u p V i e w )   { 
 	 	 / / t h i s   i s   t h e   c a s e   w e   w e r e   e d i t i n g   t h e   D L   ( d i f f e r e n t   t h a n   v i e w i n g   i t   i n   t h e   D L   l i s t ,   i n   w h i c h   c a s e   i t ' s   t h e   c o n t a c t L i s t C o n t r o l l e r ) . 
 	 	 / / s o   w e   n o w   n e e d   t o   p o p   u p   t h e   v i e w . 
 	 	 t h i s . c o n t r o l l e r . p o p V i e w ( ) ; 
 	 } 
 
 	 a p p C t x t . s e t S t a t u s M s g ( i t e m s . l e n g t h   = =   1   ?   Z m M s g . d l D e l e t e d   :   Z m M s g . d l s D e l e t e d ) ; 
 
 	 f o r   ( v a r   i   =   0 ;   i   <   i t e m s . l e n g t h ;   i + + )   { 
 	 	 v a r   i t e m   =   i t e m s [ i ] ; 
 	 	 i t e m . c l e a r D l I n f o ( ) ; 
 	 	 i t e m . _ n o t i f y ( Z m E v e n t . E _ D E L E T E ) ; 
 	 } 
 } ; 
 
 
 
 / * * 
   *   S e t s   t h e   i s   G A L   f l a g . 
   *   
   *   @ p a r a m 	 { B o o l e a n } 	 i s G a l 	 	 < c o d e > t r u e < / c o d e >   i f   c o n t a c t   l i s t   i s   G A L 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . s e t I s G a l   = 
 f u n c t i o n ( i s G a l )   { 
 	 t h i s . i s G a l   =   i s G a l ; 
 } ; 
 
 Z m C o n t a c t L i s t . p r o t o t y p e . n o t i f y C r e a t e   = 
 f u n c t i o n ( n o d e )   { 
 	 v a r   o b j   =   e v a l ( Z m L i s t . I T E M _ C L A S S [ t h i s . t y p e ] ) ; 
 	 i f   ( o b j )   { 
 	 	 v a r   i t e m   =   o b j . c r e a t e F r o m D o m ( n o d e ,   { l i s t : t h i s } ) ; 
 	 	 v a r   i n d e x   =   t h i s . _ s o r t I n d e x ( i t e m ) ; 
 	 	 / /   o n l y   a d d   i f   i t   s o r t s   i n t o   t h i s   l i s t 
 	 	 v a r   l i s t S i z e   =   t h i s . s i z e ( ) ; 
 	 	 v a r   v i s i b l e   =   f a l s e ; 
 	 	 i f   ( i n d e x   <   l i s t S i z e   | |   l i s t S i z e   = =   0   | |   ( i n d e x = = l i s t S i z e   & &   ! t h i s . _ h a s M o r e ) )   { 
 	 	 	 t h i s . a d d ( i t e m ,   i n d e x ) ; 
 	 	 	 t h i s . c r e a t e L o c a l ( i t e m ) ; 
 	 	 	 v i s i b l e   =   t r u e ; 
 	 	 } 
 	 	 t h i s . _ n o t i f y ( Z m E v e n t . E _ C R E A T E ,   { i t e m s :   [ i t e m ] ,   s o r t I n d e x :   i n d e x ,   v i s i b l e :   v i s i b l e } ) ; 
 	 } 
 } ; 
 
 / * * 
   *   M o v e s   t h e   i t e m s . 
   *   
   *   @ p a r a m 	 { A r r a y } 	 i t e m s 	 	 a n   a r r a y   o f   { @ l i n k   Z m C o n t a c t }   o b j e c t s 
   *   @ p a r a m 	 { S t r i n g } 	 f o l d e r I d 	 t h e   f o l d e r   i d 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . m o v e L o c a l   = 
 f u n c t i o n ( i t e m s ,   f o l d e r I d )   { 
 	 / /   d o n ' t   r e m o v e   a n y   c o n t a c t s   f r o m   t h e   c a n o n i c a l   l i s t 
 	 i f   ( ! t h i s . i s C a n o n i c a l ) 
 	 	 Z m L i s t . p r o t o t y p e . m o v e L o c a l . c a l l ( t h i s ,   i t e m s ,   f o l d e r I d ) ; 
 	 i f   ( f o l d e r I d   = =   Z m F o l d e r . I D _ T R A S H )   { 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   i t e m s . l e n g t h ;   i + + )   { 
 	 	 	 t h i s . _ u p d a t e H a s h e s ( i t e m s [ i ] ,   f a l s e ) ; 
 	 	 } 
 	 } 
 } ; 
 
 / * * 
   *   D e l e t e s   t h e   i t e m s . 
   *   
   *   @ p a r a m 	 { A r r a y } 	 i t e m s 	 	 a n   a r r a y   o f   { @ l i n k   Z m C o n t a c t }   o b j e c t s 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . d e l e t e L o c a l   = 
 f u n c t i o n ( i t e m s )   { 
 	 Z m L i s t . p r o t o t y p e . d e l e t e L o c a l . c a l l ( t h i s ,   i t e m s ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   i t e m s . l e n g t h ;   i + + )   { 
 	 	 t h i s . _ u p d a t e H a s h e s ( i t e m s [ i ] ,   f a l s e ) ; 
 	 } 
 } ; 
 
 / * * 
   *   H a n d l e   m o d i f i e d   c o n t a c t . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . m o d i f y L o c a l   = 
 f u n c t i o n ( i t e m ,   d e t a i l s )   { 
 	 i f   ( d e t a i l s )   { 
 	 	 / /   n o t i f y   i t e m ' s   l i s t 
 	 	 t h i s . _ e v t . i t e m s   =   d e t a i l s . i t e m s   =   [ i t e m ] ; 
 	 	 t h i s . _ e v t . i t e m   =   d e t a i l s . c o n t a c t ;   / / s o m e h o w   t h i s   w a s   s e t   t o   s o m e t h i n g   o b s o l e t e .   W h a t   a   m e s s .   A l s o   n o t e   t h a t   i t e m   i s   O b j e c t   w h i l e   d e t a i l s . c o n t a c t   i s   Z m C o n t a c t 
 	 	 t h i s . _ n o t i f y ( Z m E v e n t . E _ M O D I F Y ,   d e t a i l s ) ; 
 	 } 
 
 	 v a r   c o n t a c t   =   d e t a i l s . c o n t a c t ; 
 	 i f   ( t h i s . i s C a n o n i c a l   | |   c o n t a c t . a t t r [ Z m C o n t a c t . F _ e m a i l ]   ! =   d e t a i l s . o l d A t t r [ Z m C o n t a c t . F _ e m a i l ] )   { 
 	 	 / /   R e m o v e   t r a c e s   o f   o l d   c o n t a c t   -   N O T E :   w e   p a s s   i n   n u l l   f o r   t h e   I D   o n 
 	 	 / /   P U R P O S E   t o   a v o i d   o v e r w r i t i n g   t h e   e x i s t i n g   c a c h e d   c o n t a c t 
 	 	 v a r   o l d C o n t a c t   =   n e w   Z m C o n t a c t ( n u l l ,   t h i s ) ; 
 	 	 o l d C o n t a c t . i d   =   d e t a i l s . c o n t a c t . i d ; 
 	 	 o l d C o n t a c t . a t t r   =   d e t a i l s . o l d A t t r ; 
 	 	 t h i s . _ u p d a t e H a s h e s ( o l d C o n t a c t ,   f a l s e ) ; 
 
 	 	 / /   a d d   n e w   c o n t a c t   t o   h a s h e s 
 	 	 t h i s . _ u p d a t e H a s h e s ( c o n t a c t ,   t r u e ) ; 
 	 } 
 
 	 / /   p l a c e   i n   c o r r e c t   p o s i t i o n   i n   l i s t 
 	 i f   ( d e t a i l s . f i l e A s C h a n g e d )   { 
 	 	 t h i s . r e m o v e ( c o n t a c t ) ; 
 	 	 v a r   i n d e x   =   t h i s . _ s o r t I n d e x ( c o n t a c t ) ; 
 	 	 v a r   l i s t S i z e   =   t h i s . s i z e ( ) ; 
 	 	 i f   ( i n d e x   <   l i s t S i z e   | |   l i s t S i z e   = =   0   | |   ( i n d e x   = =   l i s t S i z e   & &   ! t h i s . _ h a s M o r e ) )   { 
 	 	 	 t h i s . a d d ( c o n t a c t ,   i n d e x ) ; 
 	 	 } 
 	 } 
 
 	 / /   r e s e t   a d d r b o o k   p r o p e r t y 
 	 i f   ( c o n t a c t . a d d r b o o k   & &   ( c o n t a c t . a d d r b o o k . i d   ! =   c o n t a c t . f o l d e r I d ) )   { 
 	 	 c o n t a c t . a d d r b o o k   =   a p p C t x t . g e t B y I d ( c o n t a c t . f o l d e r I d ) ; 
 	 } 
 } ; 
 
 / * * 
   *   C r e a t e s   t h e   i t e m   l o c a l . 
   *   
   *   @ p a r a m 	 { Z m C o n t a c t } 	 i t e m 	 	 t h e   i t e m 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . c r e a t e L o c a l   = 
 f u n c t i o n ( i t e m )   { 
 	 t h i s . _ u p d a t e H a s h e s ( i t e m ,   t r u e ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ u p d a t e H a s h e s   = 
 f u n c t i o n ( c o n t a c t ,   d o A d d )   { 
 
 	 t h i s . _ a p p . u p d a t e C a c h e ( c o n t a c t ,   d o A d d ) ; 
 
 	 / /   U p d a t e   e m a i l   h a s h . 
 	 f o r   ( v a r   i n d e x   =   0 ;   i n d e x   <   Z m C o n t a c t . E M A I L _ F I E L D S . l e n g t h ;   i n d e x + + )   { 
 	 	 v a r   f i e l d   =   Z m C o n t a c t . E M A I L _ F I E L D S [ i n d e x ] ; 
 	 	 f o r   ( v a r   i   =   1 ;   t r u e ;   i + + )   { 
 	 	 	 v a r   a n a m e   =   Z m C o n t a c t . g e t A t t r i b u t e N a m e ( f i e l d ,   i ) ; 
 	 	 	 v a r   a v a l u e   =   Z m C o n t a c t . g e t A t t r ( c o n t a c t ,   a n a m e ) ; 
 	 	 	 i f   ( ! a v a l u e )   b r e a k ; 
 	 	 	 i f   ( d o A d d )   { 
 	 	 	 	 t h i s . _ e m a i l T o C o n t a c t [ a v a l u e . t o L o w e r C a s e ( ) ]   =   c o n t a c t ; 
 	 	 	 }   e l s e   { 
 	 	 	 	 d e l e t e   t h i s . _ e m a i l T o C o n t a c t [ a v a l u e . t o L o w e r C a s e ( ) ] ; 
 	 	 	 } 
 	 	 } 
 	 } 
 
 	 / /   U p d a t e   p h o n e   h a s h . 
 	 i f   ( a p p C t x t . g e t ( Z m S e t t i n g . V O I C E _ E N A B L E D )   | |   t h i s . _ a l w a y s U p d a t e H a s h e s )   { 
 	 	 f o r   ( v a r   i n d e x   =   0 ;   i n d e x   <   Z m C o n t a c t . P H O N E _ F I E L D S . l e n g t h ;   i n d e x + + )   { 
 	 	 	 v a r   f i e l d   =   Z m C o n t a c t . P H O N E _ F I E L D S [ i n d e x ] ; 
 	 	 	 f o r   ( v a r   i   =   1 ;   t r u e ;   i + + )   { 
 	 	 	 	 v a r   a n a m e   =   Z m C o n t a c t . g e t A t t r i b u t e N a m e ( f i e l d ,   i ) ; 
 	 	 	 	 v a r   a v a l u e   =   Z m C o n t a c t . g e t A t t r ( c o n t a c t ,   a n a m e ) ; 
 	 	 	 	 i f   ( ! a v a l u e )   b r e a k ; 
 	 	 	 	 v a r   d i g i t s   =   t h i s . _ g e t P h o n e D i g i t s ( a v a l u e ) ; 
 	 	 	 	 i f   ( d i g i t s )   { 
 	 	 	 	 	 i f   ( d o A d d )   { 
 	 	 	 	 	 	 t h i s . _ p h o n e T o C o n t a c t [ a v a l u e ]   =   { c o n t a c t :   c o n t a c t ,   f i e l d :   a n a m e } ; 
 	 	 	 	 	 }   e l s e   { 
 	 	 	 	 	 	 d e l e t e   t h i s . _ p h o n e T o C o n t a c t [ a v a l u e ] ; 
 	 	 	 	 	 } 
 	 	 	 	 } 
 	 	 	 } 
 	 	 } 
 	 } 
 } ; 
 
 / * * 
   *   S t r i p s   a l l   n o n - d i g i t   c h a r a c t e r s   f r o m   a   p h o n e   n u m b e r . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ g e t P h o n e D i g i t s   = 
 f u n c t i o n ( p h o n e )   { 
 	 r e t u r n   p h o n e . r e p l a c e ( / [ ^ \ d ] / g ,   ' ' ) ; 
 } ; 
 
 / * * 
   *   R e t u r n s   t h e   p o s i t i o n   a t   w h i c h   t h e   g i v e n   c o n t a c t   s h o u l d   b e   i n s e r t e d   i n   t h i s   l i s t . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ s o r t I n d e x   = 
 f u n c t i o n ( c o n t a c t )   { 
 	 v a r   a   =   t h i s . _ v e c t o r . g e t A r r a y ( ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   a . l e n g t h ;   i + + )   { 
 	 	 i f   ( Z m C o n t a c t . c o m p a r e B y F i l e A s ( a [ i ] ,   c o n t a c t )   >   0 )   { 
 	 	 	 r e t u r n   i ; 
 	 	 } 
 	 } 
 	 r e t u r n   a . l e n g t h ; 
 } ; 
 
 / * * 
   *   G e t s   t h e   l i s t   I D   h a s h 
   *   @ r e t u r n   i d H a s h   { O j b e c t }   l i s t   I D   h a s h 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . g e t I d H a s h   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   t h i s . _ i d H a s h ; 
 } 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t L i s t . p r o t o t y p e . _ h a n d l e R e s p o n s e M o d i f y I t e m   = 
 f u n c t i o n ( i t e m ,   r e s u l t )   { 
 	 / /   N O T E :   w e   o v e r l o a d   a n d   d o   n o t h i n g   b / c   b a s e   c l a s s   d o e s   m o r e   t h a n   w e   w a n t 
 	 / /               ( s i n c e   e v e r y t h i n g   i s   h a n d l e d   b y   n o t i f i c a t i o n s ) 
 } ; 
 } 
 i f   ( A j x P a c k a g e . d e f i n e ( " z i m b r a M a i l . a b o o k . v i e w . Z m C o n t a c t s H e l p e r " ) )   { 
 / * 
   *   * * * * *   B E G I N   L I C E N S E   B L O C K   * * * * * 
   *   Z i m b r a   C o l l a b o r a t i o n   S u i t e   W e b   C l i e n t 
   *   C o p y r i g h t   ( C )   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 6   S y n a c o r ,   I n c . 
   * 
   *   T h e   c o n t e n t s   o f   t h i s   f i l e   a r e   s u b j e c t   t o   t h e   C o m m o n   P u b l i c   A t t r i b u t i o n   L i c e n s e   V e r s i o n   1 . 0   ( t h e   " L i c e n s e " ) ; 
   *   y o u   m a y   n o t   u s e   t h i s   f i l e   e x c e p t   i n   c o m p l i a n c e   w i t h   t h e   L i c e n s e . 
   *   Y o u   m a y   o b t a i n   a   c o p y   o f   t h e   L i c e n s e   a t :   h t t p s : / / w w w . z i m b r a . c o m / l i c e n s e 
   *   T h e   L i c e n s e   i s   b a s e d   o n   t h e   M o z i l l a   P u b l i c   L i c e n s e   V e r s i o n   1 . 1   b u t   S e c t i o n s   1 4   a n d   1 5 
   *   h a v e   b e e n   a d d e d   t o   c o v e r   u s e   o f   s o f t w a r e   o v e r   a   c o m p u t e r   n e t w o r k   a n d   p r o v i d e   f o r   l i m i t e d   a t t r i b u t i o n 
   *   f o r   t h e   O r i g i n a l   D e v e l o p e r .   I n   a d d i t i o n ,   E x h i b i t   A   h a s   b e e n   m o d i f i e d   t o   b e   c o n s i s t e n t   w i t h   E x h i b i t   B . 
   * 
   *   S o f t w a r e   d i s t r i b u t e d   u n d e r   t h e   L i c e n s e   i s   d i s t r i b u t e d   o n   a n   " A S   I S "   b a s i s , 
   *   W I T H O U T   W A R R A N T Y   O F   A N Y   K I N D ,   e i t h e r   e x p r e s s   o r   i m p l i e d . 
   *   S e e   t h e   L i c e n s e   f o r   t h e   s p e c i f i c   l a n g u a g e   g o v e r n i n g   r i g h t s   a n d   l i m i t a t i o n s   u n d e r   t h e   L i c e n s e . 
   *   T h e   O r i g i n a l   C o d e   i s   Z i m b r a   O p e n   S o u r c e   W e b   C l i e n t . 
   *   T h e   I n i t i a l   D e v e l o p e r   o f   t h e   O r i g i n a l   C o d e   i s   Z i m b r a ,   I n c .     A l l   r i g h t s   t o   t h e   O r i g i n a l   C o d e   w e r e 
   *   t r a n s f e r r e d   b y   Z i m b r a ,   I n c .   t o   S y n a c o r ,   I n c .   o n   S e p t e m b e r   1 4 ,   2 0 1 5 . 
   * 
   *   A l l   p o r t i o n s   o f   t h e   c o d e   a r e   C o p y r i g h t   ( C )   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 6   S y n a c o r ,   I n c .   A l l   R i g h t s   R e s e r v e d . 
   *   * * * * *   E N D   L I C E N S E   B L O C K   * * * * * 
   * / 
 
 / * * 
   *   @ o v e r v i e w 
   *   T h i s   f i l e   c o n t a i n s   a   c o n t a c t   h e l p e r   c l a s s . 
   *   
   * / 
 
 / * * 
   *   D e f a u l t   c o n s t r u c t o r   f o r   h e l p e r   c l a s s . 
   *   @ c l a s s 
   *   M i s c e l l a n e o u s   c o n t a c t s - r e l a t e d   u t i l i t y   f u n c t i o n s .   S o   f a r ,   m o s t l y   t h i n g s   t h a t 
   *   { @ l i n k   Z m C o n t a c t P i c k e r }   a n d   { @ l i n k   Z m G r o u p V i e w }   b o t h   n e e d   t o   p e r f o r m   a   c o n t a c t s   s e a r c h   a n d 
   *   d i s p l a y   r e s u l t s   i n   a   l i s t   v i e w . 
   * 
   *   @ a u t h o r   C o n r a d   D a m o n 
   * / 
 Z m C o n t a c t s H e l p e r   =   f u n c t i o n ( )   { } ; 
 
 / * * 
   *   P e r f o r m s   a   c o n t a c t   s e a r c h   ( i n   e i t h e r   p e r s o n a l   c o n t a c t s   o r   i n   t h e   G A L )   a n d   p o p u l a t e s 
   *   t h e   s o u r c e   l i s t   v i e w   w i t h   t h e   r e s u l t s . 
   * 
   *   @ p a r a m 	 { H a s h } 	 p a r a m s 	 	 a   h a s h   o f   p a r a m e t e r s 
   *   @ p a r a m   { O b j e c t } 	 p a r a m s . o b j 	 	 	 t h e   o b j e c t   t h a t   i s   d o i n g   t h e   s e a r c h 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . q u e r y 	 	 	 t h e   q u e r y   s t r i n g   t o   s e a r c h   o n 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . q u e r y H i n t 	 	 t h e   q u e r y   h i n t   ( i . e .   s e a r c h i n g   s h a r e d   f o l d e r s ) 
   *   @ p a r a m   { B o o l e a n } 	 p a r a m s . a s c e n d i n g 	 	 i f   < c o d e > t r u e < / c o d e > ,   s o r t   i n   a s c e n d i n g   o r d e r 
   *   @ p a r a m   { i n t } 	 p a r a m s . l a s t I d 	 	 t h e   I D   o f   l a s t   i t e m   d i s p l a y e d   ( f o r   p a g i n a t i o n ) 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . l a s t S o r t V a l 	 t h e   v a l u e   o f   s o r t   f i e l d   f o r   a b o v e   i t e m 
   *   @ p a r a m   { A j x C a l l b a c k } 	 p a r a m s . r e s p C a l l b a c k 	 t h e   c a l l b a c k   t o   c a l l   o n c e   r e s p o n s e   c o m e s   b a c k   f r o m   s e r v e r 
   *   @ p a r a m   { A j x C a l l b a c k } 	 p a r a m s . e r r o r C a l l b a c k 	 t h e   c a l l b a c k   t o   c a l l   i f   e r r o r   r e t u r n e d   f r o m   s e r v e r 
   *   @ p a r a m   { S t r i n g } 	 p a r a m s . a c c o u n t N a m e 	 t h e   a c c o u n t   t o   m a k e   s e a r c h   r e q u e s t   o n   b e h a l f   o f 
   *   @ p a r a m   { A r r a y }       p a r a m s . c o n d s 	 t h e   c o n d s   t o   r e s t r i c t   t h e   s e a r c h   b y   ( a r r a y   o f   { a t t r : " " ,   o p : " " ,   v a l u e : " " }   h a s h e s ) 
   * / 
 Z m C o n t a c t s H e l p e r . s e a r c h   = 
 f u n c t i o n ( p a r a m s )   { 
 	 v a r   o   =   p a r a m s . o b j ; 
 	 i f   ( o . _ s e a r c h B u t t o n )   { 
 	 	 o . _ s e a r c h B u t t o n . s e t E n a b l e d ( f a l s e ) ; 
 	 } 
 
 	 p a r a m s . s o r t B y   =   p a r a m s . a s c e n d i n g   ?   Z m S e a r c h . N A M E _ A S C   :   Z m S e a r c h . N A M E _ D E S C ; 
 	 p a r a m s . t y p e s   =   A j x V e c t o r . f r o m A r r a y ( [ Z m I t e m . C O N T A C T ] ) ; 
 	 p a r a m s . o f f s e t   =   p a r a m s . o f f s e t   | |   0 ; 
 	 p a r a m s . l i m i t   =   Z m C o n t a c t s A p p . S E A R C H F O R _ M A X ; 
 	 p a r a m s . c o n t a c t S o u r c e   =   o . _ c o n t a c t S o u r c e ; 
 	 p a r a m s . f i e l d   =   " c o n t a c t " ; 
 
 	 v a r   s e a r c h   =   n e w   Z m S e a r c h ( p a r a m s ) ; 
 	 s e a r c h . e x e c u t e ( { c a l l b a c k : p a r a m s . r e s p C a l l b a c k ,   e r r o r C a l l b a c k : p a r a m s . e r r o r C a l l b a c k } ) ; 
 } ; 
 
 / * * 
   *   T a k e   t h e   c o n t a c t s   a n d   c r e a t e   a   l i s t   o f   t h e i r   e m a i l   a d d r e s s e s   ( a   c o n t a c t   m a y   h a v e   m o r e   t h a n   o n e ) 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t s H e l p e r . _ p r o c e s s S e a r c h R e s p o n s e   =   
 f u n c t i o n ( r e s p ,   i n c l u d e C o n t a c t s W i t h N o E m a i l )   { 
 	 v a r   v e c   =   r e s p . g e t R e s u l t s ( Z m I t e m . C O N T A C T ) ; 
 
 	 / /   T a k e   t h e   c o n t a c t s   a n d   c r e a t e   a   l i s t   o f   t h e i r   e m a i l   a d d r e s s e s   ( a   c o n t a c t   m a y   h a v e   m o r e   t h a n   o n e ) 
 	 v a r   l i s t   =   [ ] ; 
 	 v a r   a   =   v e c . g e t A r r a y ( ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   a . l e n g t h ;   i + + )   { 
 	 	 v a r   c o n t a c t   =   a [ i ] ; 
 	 	 i f   ( c o n t a c t . i s G r o u p ( )   & &   ! c o n t a c t . i s D L )   { 
 	 	 	 v a r   m e m b e r s   =   c o n t a c t . g e t G r o u p M e m b e r s ( ) . g o o d . t o S t r i n g ( A j x E m a i l A d d r e s s . S E P A R A T O R ) ; 
 	 	 	 Z m C o n t a c t s H e l p e r . _ a d d C o n t a c t T o L i s t ( l i s t ,   c o n t a c t ,   m e m b e r s ,   t r u e ) ; 
 	 	 }   e l s e   { 
 	 	 	 v a r   e m a i l s   =   c o n t a c t . i s G a l   ?   [ c o n t a c t . g e t E m a i l ( ) ]   :   c o n t a c t . g e t E m a i l s ( ) ; 
 	 	 	 f o r   ( v a r   j   =   0 ;   j   <   e m a i l s . l e n g t h ;   j + + )   { 
 	 	 	 	 Z m C o n t a c t s H e l p e r . _ a d d C o n t a c t T o L i s t ( l i s t ,   c o n t a c t ,   e m a i l s [ j ] ) ; 
 	 	 	 } 
 	 	 	 i f   ( i n c l u d e C o n t a c t s W i t h N o E m a i l   & &   e m a i l s . l e n g t h   = =   0 )   { 
 	 	 	 	 Z m C o n t a c t s H e l p e r . _ a d d C o n t a c t T o L i s t ( l i s t ,   c o n t a c t ,   n u l l ) ; 
 	 	 	 } 
 	 	 } 
 	 } 
 	 
 	 r e t u r n   l i s t ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t s H e l p e r . _ a d d C o n t a c t T o L i s t   =   
 f u n c t i o n ( l i s t ,   c o n t a c t ,   a d d r ,   i s G r o u p )   { 
 
 	 v a r   e m a i l   =   Z m C o n t a c t s H e l p e r . _ w r a p C o n t a c t ( c o n t a c t ,   a d d r ,   i s G r o u p ) ;     
 	 l i s t . p u s h ( e m a i l ) ; 
 } ; 
 
 / * * 
   *   w r a p p s   t h e   c o n t a c t   i n s i d e   a   A j x E m a i l A d d r e s s   o b j e c t ,   a n d   a d d s   a   c o u p l e   e x t r a   f i e l d s   t o   t h e   A j x E m a i l A d d r e s s   i n s t a n c e   ( v a l u e ,   c o n t a c t ,   i c o n   [ w h i c h   I ' m   n o t   s u r e   i s   u s e d ] ) 
   * 
   *   @ p a r a m   c o n t a c t 
   *   @ p a r a m   a d d r   { S t r i n g }   o p t i o n a l . 
   *   @ p a r a m   i s G r o u p 
   * / 
 Z m C o n t a c t s H e l p e r . _ w r a p C o n t a c t   = 
 f u n c t i o n ( c o n t a c t ,   a d d r ,   i s G r o u p )   { 
 
 	 a d d r   =   a d d r   | |   c o n t a c t . g e t E m a i l ( ) ; 
 	 v a r   f i l e A s   =   c o n t a c t . g e t F i l e A s ( ) ; 
 	 v a r   n a m e   =   ( f i l e A s   ! =   a d d r )   ?   f i l e A s   :   " " ;     / / t o d o   ? ? ?   t h i s   i s   w e i r d . 
 	 v a r 	 t y p e   =   c o n t a c t . i s G a l   ?   Z m C o n t a c t . G R O U P _ G A L _ R E F   :   Z m C o n t a c t . G R O U P _ C O N T A C T _ R E F ; 
 	 v a r 	 v a l u e   =   c o n t a c t . i s G a l   ?   ( c o n t a c t . r e f   | |   c o n t a c t . i d )   :   c o n t a c t . i d ;     / / d e f a u l t i n g   t o   c o n t a c t . i d   i n   t h e   g a l   c a s e   s i n c e   f r o m   G e t C o n t a c t s R e s p o n s e   t h e   r e f   i s   n o t   r e t u r n e d   a n d   w e   c a n   e n d   u p   w i t h   i t   c a c h e d   w i t h o u t   t h e   r e f .   P r o b a b l y   n e e d   t o   f i x   t h a t . 
 	 v a r   d i s p l a y N a m e   =   c o n t a c t . g e t F u l l N a m e F o r D i s p l a y ( ) ; 
 
 	 v a r   e m a i l   =   n e w   A j x E m a i l A d d r e s s ( a d d r ,   t y p e ,   n a m e ,   d i s p l a y N a m e ,   i s G r o u p ) ; 
 
 	 e m a i l . v a l u e   =   v a l u e ; 
 	 e m a i l . i d   =   D w t . g e t N e x t I d ( ) ; 
 	 e m a i l . _ _ c o n t a c t   =   c o n t a c t ; 
 	 e m a i l . i c o n   =   c o n t a c t . g e t I c o n ( ) ; 
 	 i f   ( c o n t a c t . i s D L )   { 
 	 	 e m a i l . i s G r o u p   =   t r u e ; 
 	 	 e m a i l . c a n E x p a n d   =   c o n t a c t . c a n E x p a n d ; 
 	 	 v a r   a c   =   w i n d o w . p a r e n t A p p C t x t   | |   w i n d o w . a p p C t x t ; 
 	 	 a c . s e t I s E x p a n d a b l e D L ( a d d r ,   e m a i l . c a n E x p a n d ) ; 
 	 } 
 	 r e t u r n   e m a i l ; 
 } ; 
 
 / * * 
   *   w r a p p s   t h e   i n l i n e   a d d r e s s   ( t h e r e ' s   n o   r e a l   Z m C o n t a c t   o b j e c t )   i n s i d e   A j x E m a i l A d d r e s s   a n d   a d d s   t h e   v a l u e   a t t r i b u t e   t o   i t . 
   *   t h i s   i s   s o   w e   t r e a t   r e a l   c o n t a c t s   a n d   i n l i n e   c o n t a c t s   c o n s i s t e n t l y   t h r o u g h o u t   t h e   r e s t   o f   t h e   c o d e . 
   * 
   *   @ p a r a m   v a l u e     { S t r i n g }   -   t h e   i n l i n e   e m a i l   a d d r e s s   a n d / o r   n a m e   ( e . g .   " j o h n   d o e   < j o h n @ d o e . c o m > "   o r   " j o h n @ d o e . c o m " ) 
   * / 
 Z m C o n t a c t s H e l p e r . _ w r a p I n l i n e C o n t a c t   = 
 f u n c t i o n ( v a l u e )   { 
 	 v a r   e m a i l   =   A j x E m a i l A d d r e s s . p a r s e ( v a l u e ) ;   / / f r o m   l e g a c y   d a t a   a t   l e a s t   ( n o t   s u r e   a b o u t   n e w ) ,   t h e   f o r m a t   m i g h t   b e   s o m e t h i n g   l i k e   " I n i g o   M o n t o y a   < i n i g o @ t h e p r i n c e s s b r i d e . c o m > "   s o   w e   h a v e   t o   p a r s e . 
 	 i f   ( ! e m a i l )   { 
 	 	 / / t h i s   c a n   h a p p e n   w h e n   c r e a t i n g   i n l i n e   i n   c o n t a c t   g r o u p   e d i t ,   a n d   t h e   u s e r   d i d   n o t   s u p l y   e m a i l   a d d r e s s   i n   t h e   i n l i n e   v a l u e 
 	 	 e m a i l   =   n e w   A j x E m a i l A d d r e s s ( v a l u e ,   n u l l ,   v a l u e ) ; 
 	 } 
 	 e m a i l . t y p e   =   Z m C o n t a c t . G R O U P _ I N L I N E _ R E F ; 
 	 e m a i l . v a l u e   =   v a l u e ; 
 	 e m a i l . i d   =   D w t . g e t N e x t I d ( ) ; 
 	 r e t u r n   e m a i l ; 
 } ; 
 
 
 / * * 
   *   T h e   i t e m s   a r e   A j x E m a i l A d d r e s s   o b j e c t s 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t s H e l p e r . _ g e t E m a i l F i e l d   = 
 f u n c t i o n ( h t m l ,   i d x ,   i t e m ,   f i e l d ,   c o l I d x )   { 
 	 i f   ( f i e l d   = =   Z m I t e m . F _ T Y P E )   { 
 	 	 h t m l [ i d x + + ]   =   A j x I m g . g e t I m a g e H t m l ( i t e m . i c o n ) ; 
 	 }   e l s e   i f   ( f i e l d   = =   Z m I t e m . F _ N A M E )   { 
 	 	 h t m l [ i d x + + ]   =   ' < s p a n   s t y l e = " w h i t e - s p a c e : n o w r a p " > ' ; 
 	 	 h t m l [ i d x + + ]   =   A j x S t r i n g U t i l . h t m l E n c o d e ( i t e m . n a m e   | |   Z m M s g . n o N a m e ) ; 
 	 	 h t m l [ i d x + + ]   =   " < / s p a n > " ; 
 	 }   e l s e   i f   ( f i e l d   = =   Z m I t e m . F _ E M A I L )   { 
 	 	 h t m l [ i d x + + ]   =   A j x S t r i n g U t i l . h t m l E n c o d e ( i t e m . a d d r e s s ) ; 
 	 }   e l s e   i f   ( f i e l d   = =   Z m I t e m . F _ D E P A R T M E N T )   { 
 	 	 i f   ( i t e m . _ _ c o n t a c t )   { 
 	 	 	 h t m l [ i d x + + ]   =   A j x S t r i n g U t i l . h t m l E n c o d e ( Z m C o n t a c t . g e t A t t r ( i t e m . _ _ c o n t a c t ,   Z m C o n t a c t . F _ d e p a r t m e n t ) ) ; 
 	 	 } 
 	 } 
 	 r e t u r n   i d x ; 
 } ; 
 } 
 i f   ( A j x P a c k a g e . d e f i n e ( " z i m b r a M a i l . a b o o k . v i e w . Z m C o n t a c t P i c k e r " ) )   { 
 / * 
   *   * * * * *   B E G I N   L I C E N S E   B L O C K   * * * * * 
   *   Z i m b r a   C o l l a b o r a t i o n   S u i t e   W e b   C l i e n t 
   *   C o p y r i g h t   ( C )   2 0 0 4 ,   2 0 0 5 ,   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 5 ,   2 0 1 6   S y n a c o r ,   I n c . 
   * 
   *   T h e   c o n t e n t s   o f   t h i s   f i l e   a r e   s u b j e c t   t o   t h e   C o m m o n   P u b l i c   A t t r i b u t i o n   L i c e n s e   V e r s i o n   1 . 0   ( t h e   " L i c e n s e " ) ; 
   *   y o u   m a y   n o t   u s e   t h i s   f i l e   e x c e p t   i n   c o m p l i a n c e   w i t h   t h e   L i c e n s e . 
   *   Y o u   m a y   o b t a i n   a   c o p y   o f   t h e   L i c e n s e   a t :   h t t p s : / / w w w . z i m b r a . c o m / l i c e n s e 
   *   T h e   L i c e n s e   i s   b a s e d   o n   t h e   M o z i l l a   P u b l i c   L i c e n s e   V e r s i o n   1 . 1   b u t   S e c t i o n s   1 4   a n d   1 5 
   *   h a v e   b e e n   a d d e d   t o   c o v e r   u s e   o f   s o f t w a r e   o v e r   a   c o m p u t e r   n e t w o r k   a n d   p r o v i d e   f o r   l i m i t e d   a t t r i b u t i o n 
   *   f o r   t h e   O r i g i n a l   D e v e l o p e r .   I n   a d d i t i o n ,   E x h i b i t   A   h a s   b e e n   m o d i f i e d   t o   b e   c o n s i s t e n t   w i t h   E x h i b i t   B . 
   * 
   *   S o f t w a r e   d i s t r i b u t e d   u n d e r   t h e   L i c e n s e   i s   d i s t r i b u t e d   o n   a n   " A S   I S "   b a s i s , 
   *   W I T H O U T   W A R R A N T Y   O F   A N Y   K I N D ,   e i t h e r   e x p r e s s   o r   i m p l i e d . 
   *   S e e   t h e   L i c e n s e   f o r   t h e   s p e c i f i c   l a n g u a g e   g o v e r n i n g   r i g h t s   a n d   l i m i t a t i o n s   u n d e r   t h e   L i c e n s e . 
   *   T h e   O r i g i n a l   C o d e   i s   Z i m b r a   O p e n   S o u r c e   W e b   C l i e n t . 
   *   T h e   I n i t i a l   D e v e l o p e r   o f   t h e   O r i g i n a l   C o d e   i s   Z i m b r a ,   I n c .     A l l   r i g h t s   t o   t h e   O r i g i n a l   C o d e   w e r e 
   *   t r a n s f e r r e d   b y   Z i m b r a ,   I n c .   t o   S y n a c o r ,   I n c .   o n   S e p t e m b e r   1 4 ,   2 0 1 5 . 
   * 
   *   A l l   p o r t i o n s   o f   t h e   c o d e   a r e   C o p y r i g h t   ( C )   2 0 0 4 ,   2 0 0 5 ,   2 0 0 6 ,   2 0 0 7 ,   2 0 0 8 ,   2 0 0 9 ,   2 0 1 0 ,   2 0 1 1 ,   2 0 1 2 ,   2 0 1 3 ,   2 0 1 4 ,   2 0 1 5 ,   2 0 1 6   S y n a c o r ,   I n c .   A l l   R i g h t s   R e s e r v e d . 
   *   * * * * *   E N D   L I C E N S E   B L O C K   * * * * * 
   * / 
 
 / * * 
   *   @ o v e r v i e w 
   *   T h i s   f i l e   c o n t a i n s   t h e   c o n t a c t   p i c k e r   c l a s s e s . 
   *   
   * / 
 
 / * * 
   *   C r e a t e s   a   d i a l o g   t h a t   l e t s   t h e   u s e r   s e l e c t   a d d r e s s e s   f r o m   a   c o n t a c t   l i s t . 
   *   @ c o n s t r u c t o r 
   *   @ c l a s s 
   *   T h i s   c l a s s   c r e a t e s   a n d   m a n a g e s   a   d i a l o g   t h a t   l e t s   t h e   u s e r   s e l e c t   a d d r e s s e s 
   *   f r o m   a   c o n t a c t   l i s t .   T w o   l i s t s   a r e   m a i n t a i n e d ,   o n e   w i t h   c o n t a c t s   t o   s e l e c t 
   *   f r o m ,   a n d   o n e   t h a t   c o n t a i n s   t h e   s e l e c t e d   a d d r e s s e s .   B e t w e e n   t h e m   a r e   b u t t o n s 
   *   t o   s h u f f l e   a d d r e s s e s   b a c k   a n d   f o r t h   b e t w e e n   t h e   t w o   l i s t s . 
   * 
   *   @ a u t h o r   C o n r a d   D a m o n 
   *   
   *   @ p a r a m   { A r r a y } 	 b u t t o n I n f o 	 	 t h e   t r a n s f e r   b u t t o n   I D s   a n d   l a b e l s 
   *   
   *   @ e x t e n d s 	 	 D w t D i a l o g 
   * / 
 Z m C o n t a c t P i c k e r   =   f u n c t i o n ( b u t t o n I n f o )   { 
 
 	 D w t D i a l o g . c a l l ( t h i s ,   { p a r e n t : a p p C t x t . g e t S h e l l ( ) ,   t i t l e : Z m M s g . s e l e c t A d d r e s s e s ,   i d :   " Z m C o n t a c t P i c k e r " } ) ; 
 
 	 t h i s . _ b u t t o n I n f o   =   b u t t o n I n f o ; 
 	 t h i s . _ i n i t i a l i z e d   =   f a l s e ; 
 	 t h i s . _ e m a i l L i s t O f f s e t   =   0 ;   / / c l i e n t   s i d e   p a g i n a t i n g   o v e r   e m a i l   l i s t .   O f f s e t   o f   c u r r e n t   p a g e   o f   e m a i l   a d d r e s s e s .   Q u i t e   d i f f e r e n t   t h a n   _ l a s t S e r v e r O f f s e t   i f   c o n t a c t s   h a v e   0   o r   m o r e   t h a n   1   e m a i l   a d d r e s s e s . 
 	 t h i s . _ s e r v e r C o n t a c t O f f s e t   =   0 ;   / / s e r v e r   s i d e   p a g i n a t i n g   o v e r   c o n t a c t   l i s t .   O f f s e t   o f   l a s t   c o n t a c t   b l o c k   w e   g o t   f r o m   t h e   s e r v e r   ( e a c h   c o n t a c t   c o u l d   h a v e   0 ,   1 ,   o r   m o r e   e m a i l s   s o   w e   h a v e   t o   k e e p   t r a c k   o f   t h i s   s e p a r a t e   f r o m   t h e   v i e w   o f f s e t . 
 	 t h i s . _ a s c e n d i n g   =   t r u e ;   / / a s e n d i n g   o r   d e s c e n d i n g   s e a r c h .   K e e p   i t   s t o r e d   f o r   p a g i n a t i o n   t o   d o   t h e   r i g h t   s o r t . 
 	 t h i s . _ e m a i l L i s t   =   n e w   A j x V e c t o r ( ) ; 
 	 t h i s . _ d e t a i l e d S e a r c h   =   a p p C t x t . g e t ( Z m S e t t i n g . D E T A I L E D _ C O N T A C T _ S E A R C H _ E N A B L E D ) ; 
 	 t h i s . _ i g n o r e S e t D r a g B o u n d r i e s   =   t r u e ; 
 
 	 t h i s . s e t S i z e ( D w t . D E F A U L T ,   t h i s . _ g e t D i a l o g H e i g h t ( ) ) ; 
 
 	 t h i s . _ s e a r c h E r r o r C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e E r r o r S e a r c h ) ; 
 } ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e   =   n e w   D w t D i a l o g ; 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . c o n s t r u c t o r   =   Z m C o n t a c t P i c k e r ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . i s Z m C o n t a c t P i c k e r   =   t r u e ; 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . t o S t r i n g   =   f u n c t i o n ( )   {   r e t u r n   " Z m C o n t a c t P i c k e r " ;   } ; 
 
 / /   C o n s t s 
 
 Z m C o n t a c t P i c k e r . D I A L O G _ H E I G H T   =   4 6 0 ; 
 
 Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C   =   " s e a r c h " ; 
 Z m C o n t a c t P i c k e r . S E A R C H _ N A M E   =   " n a m e " ; 
 Z m C o n t a c t P i c k e r . S E A R C H _ E M A I L   =   " e m a i l " ; 
 Z m C o n t a c t P i c k e r . S E A R C H _ D E P T   =   " d e p t " ; 
 Z m C o n t a c t P i c k e r . S E A R C H _ P H O N E T I C   =   " p h o n e t i c " ; 
 
 Z m C o n t a c t P i c k e r . S H O W _ O N _ G A L   =   [ Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C ,   Z m C o n t a c t P i c k e r . S E A R C H _ N A M E ,   Z m C o n t a c t P i c k e r . S E A R C H _ E M A I L ,   Z m C o n t a c t P i c k e r . S E A R C H _ D E P T ] ; 
 Z m C o n t a c t P i c k e r . S H O W _ O N _ N O N G A L   =   [ Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C ,   Z m C o n t a c t P i c k e r . S E A R C H _ N A M E ,   Z m C o n t a c t P i c k e r . S E A R C H _ P H O N E T I C ,   Z m C o n t a c t P i c k e r . S E A R C H _ E M A I L ] ; 
 Z m C o n t a c t P i c k e r . A L L   =   [   Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C ,   Z m C o n t a c t P i c k e r . S E A R C H _ N A M E ,   Z m C o n t a c t P i c k e r . S E A R C H _ P H O N E T I C ,   Z m C o n t a c t P i c k e r . S E A R C H _ E M A I L ,   Z m C o n t a c t P i c k e r . S E A R C H _ D E P T   ] ; 
 
 / /   P u b l i c   m e t h o d s 
 
 
 / * * 
 *   D i s p l a y s   t h e   c o n t a c t   p i c k e r   d i a l o g .   T h e   s o u r c e   l i s t   i s   p o p u l a t e d   w i t h 
 *   c o n t a c t s ,   a n d   t h e   t a r g e t   l i s t   i s   p o p u l a t e d   w i t h   a n y   a d d r e s s e s   t h a t   a r e 
 *   p a s s e d   i n .   T h e   a d d r e s s   b u t t o n   t h a t   w a s   u s e d   t o   p o p u p   t h e   d i a l o g   i s   s e t 
 *   a s   t h e   a c t i v e   b u t t o n . 
 * 
 *   @ p a r a m   { S t r i n g } 	 b u t t o n I d 	 t h e   b u t t o n   I D   o f   t h e   b u t t o n   t h a t   c a l l e d   u s 
 *   @ p a r a m   { H a s h } 	 a d d r s 	 	 a   h a s h   o f   3   v e c t o r s   ( o n e   f o r   e a c h   t y p e   o f   a d d r e s s ) 
 *   @ p a r a m   { S t r i n g } 	 s t r 	 	 i n i t i a l   s e a r c h   s t r i n g 
 * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . p o p u p   = 
 f u n c t i o n ( b u t t o n I d ,   a d d r s ,   s t r ,   a c c o u n t )   { 
 
 	 i f   ( ! t h i s . _ i n i t i a l i z e d )   { 
 	 	 t h i s . _ i n i t i a l i z e ( a c c o u n t ) ; 
 	 	 t h i s . _ i n i t i a l i z e d   =   t r u e ; 
 	 } 
 	 e l s e   i f   ( a p p C t x t . m u l t i A c c o u n t s   & &   t h i s . _ a c c o u n t   ! =   a c c o u n t )   { 
 	 	 t h i s . _ a c c o u n t   =   a c c o u n t ; 
 	 	 t h i s . _ r e s e t S e l e c t D i v ( ) ; 
 	 } 
 	 t h i s . _ e m a i l L i s t O f f s e t   =   0 ; 
 
 	 v a r   s e a r c h F o r   =   t h i s . _ s e a r c h I n S e l e c t   ?   t h i s . _ s e a r c h I n S e l e c t . g e t V a l u e ( )   :   Z m C o n t a c t s A p p . S E A R C H F O R _ C O N T A C T S ; 
 
 	 / /   r e s e t   c o l u m n   s o r t i n g   p r e f e r e n c e 
 	 t h i s . _ c h o o s e r . s o u r c e L i s t V i e w . s e t S o r t B y A s c ( Z m I t e m . F _ N A M E ,   t r u e ) ; 
 
 	 / /   r e s e t   b u t t o n   s t a t e s 
 	 t h i s . _ c h o o s e r . r e s e t ( ) ; 
 	 i f   ( b u t t o n I d )   { 
 	 	 t h i s . _ c h o o s e r . _ s e t A c t i v e B u t t o n ( b u t t o n I d ) ; 
 	 } 
 
 	 / /   p o p u l a t e   t a r g e t   l i s t   i f   a d d r s   w e r e   p a s s e d   i n 
 	 i f   ( a d d r s )   { 
 	 	 f o r   ( v a r   i d   i n   a d d r s )   { 
 	 	 	 t h i s . _ c h o o s e r . a d d I t e m s ( a d d r s [ i d ] ,   D w t C h o o s e r L i s t V i e w . T A R G E T ,   t r u e ,   i d ) ; 
 	 	 } 
 	 } 
 
 	 f o r   ( v a r   f i e l d I d   i n   t h i s . _ s e a r c h F i e l d )   { 
 	 	 v a r   f i e l d   =   t h i s . _ s e a r c h F i e l d [ f i e l d I d ] ; 
 	 	 f i e l d . d i s a b l e d   =   f a l s e ; 
 	 	 f i e l d . v a l u e   =   ( A j x U t i l . i s O b j e c t ( s t r )   ?   s t r [ f i e l d I d ]   :   s t r )   | |   " " ; 
 	 } 
 
 	 / /   r e s e t   p a g i n g   b u t t o n s 
 	 t h i s . _ p r e v B u t t o n . s e t E n a b l e d ( f a l s e ) ; 
 	 t h i s . _ n e x t B u t t o n . s e t E n a b l e d ( f a l s e ) ; 
 
 	 t h i s . s e a r c h ( n u l l ,   t r u e ,   t r u e ) ; 
 
         D w t D i a l o g . p r o t o t y p e . p o p u p . c a l l ( t h i s ) ; 
 
 	 t h i s . _ r e s i z e C h o o s e r ( ) ; 
 
         i f   ( ( t h i s . g e t L o c a t i o n ( ) . x   <   0   | |     t h i s . g e t L o c a t i o n ( ) . y   <   0 )   ) { 
                                 / /   p a r e n t   w i n d o w   s i z e   i s   s m a l l e r   t h a n   D i a l o g   s i z e 
                                 t h i s . s e t L o c a t i o n ( 0 , 3 0 ) ; 
                                 v a r   s i z e   =   D w t . g e t W i n d o w S i z e ( ) ; 
                                 v a r   c u r r e n t S i z e   =   t h i s . g e t S i z e ( ) ; 
                                 v a r   d r a g E l e m e n t   =   d o c u m e n t . g e t E l e m e n t B y I d ( t h i s . _ d r a g H a n d l e I d ) ; 
                                 D w t D r a g g a b l e . s e t D r a g B o u n d a r i e s ( d r a g E l e m e n t ,   1 0 0   -   c u r r e n t S i z e . x ,   s i z e . x   -   1 0 0 ,   0 ,   s i z e . y   -   1 0 0 ) ; 
         } 
 
 	 v a r   f o c u s F i e l d   =   t h i s . _ s e a r c h F i e l d [ Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C ]   | |   t h i s . _ s e a r c h F i e l d [ Z m C o n t a c t P i c k e r . S E A R C H _ N A M E ] ; 
 	 a p p C t x t . g e t K e y b o a r d M g r ( ) . g r a b F o c u s ( f o c u s F i e l d ) ; 
 
 } ; 
 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ r e s e t R e s u l t s   = 
 f u n c t i o n ( )   { 
 	 t h i s . _ e m a i l L i s t . r e m o v e A l l ( ) ; 
 	 t h i s . _ s e r v e r C o n t a c t O f f s e t   =   0 ; 
 	 t h i s . _ e m a i l L i s t O f f s e t   =   0 ; 
 } ; 
 
 / * * 
   *   C l o s e s   t h e   d i a l o g . 
   *   
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . p o p d o w n   = 
 f u n c t i o n ( )   { 
 	 / /   d i s a b l e   s e a r c h   f i e l d   ( h a c k   t o   f i x   b l e e d i n g   c u r s o r ) 
 
 	 f o r   ( v a r   f i e l d I d   i n   t h i s . _ s e a r c h F i e l d )   { 
 	 	 t h i s . _ s e a r c h F i e l d [ f i e l d I d ] . d i s a b l e d   =   t r u e ; 
 	 } 
 
 	 t h i s . _ c o n t a c t S o u r c e   =   n u l l ; 
 	 t h i s . _ r e s e t R e s u l t s ( ) ; 
 
 	 D w t D i a l o g . p r o t o t y p e . p o p d o w n . c a l l ( t h i s ) ; 
 } ; 
 
 / * * 
   *   P e r f o r m s   a   s e a r c h . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . s e a r c h   = 
 f u n c t i o n ( c o l I t e m ,   a s c e n d i n g ,   f i r s t T i m e ,   l a s t I d ,   l a s t S o r t V a l ,   o f f s e t )   { 
 	 i f   ( o f f s e t   = =   u n d e f i n e d )   { 
 	 	 / / t h i s   c o u l d   b e   a   c a l l   f r o m   D w t C h o o s e r L i s t V i e w . p r o t o t y p e . _ s o r t C o l u m n ,   w h i c h   m e a n s   w e   h a v e   t o   r e s e t   t h e   r e s u l t   a n d   b o t h   s e r v e r   a n d   c l i e n t   p a g i n a t i o n . 
 	 	 / / I n   a n y   c a s e   t h e   r e s u l t s   s h o u l d   b e   r e s e t   o r   a r e   a l r e a d y   r e s e t   s o   d o e s n ' t   h u r t   t o   r e s e t . 
 	 	 t h i s . _ r e s e t R e s u l t s ( ) ; 
 	 } 
 
 	 i f   ( a s c e n d i n g   = = =   n u l l   | |   a s c e n d i n g   = = =   u n d e f i n e d )   { 
 	 	 a s c e n d i n g   =   t h i s . _ a s c e n d i n g ; 
 	 } 
 	 e l s e   { 
 	 	 t h i s . _ a s c e n d i n g   =   a s c e n d i n g ; 
 	 } 
 	 
 	 v a r   q u e r y ; 
 	 v a r   q u e r y H i n t   =   [ ] ; 
 	 v a r   e m a i l Q u e r y T e r m   =   " " ; 
 	 v a r   p h o n e t i c Q u e r y T e r m s   =   [ ] ; 
 	 v a r   n a m e Q u e r y T e r m s   =   [ ] ; 
 	 v a r   c o n d s   =   [ ] ; 
 	 i f   ( t h i s . _ d e t a i l e d S e a r c h )   { 
 	 	 v a r   n a m e Q u e r y   =   t h i s . g e t S e a r c h F i e l d V a l u e ( Z m C o n t a c t P i c k e r . S E A R C H _ N A M E ) ; 
 	 	 v a r   e m a i l Q u e r y   =   t h i s . g e t S e a r c h F i e l d V a l u e ( Z m C o n t a c t P i c k e r . S E A R C H _ E M A I L ) ; 
 	 	 v a r   d e p t Q u e r y   =   t h i s . g e t S e a r c h F i e l d V a l u e ( Z m C o n t a c t P i c k e r . S E A R C H _ D E P T ) ; 
 	 	 v a r   p h o n e t i c Q u e r y   =   t h i s . g e t S e a r c h F i e l d V a l u e ( Z m C o n t a c t P i c k e r . S E A R C H _ P H O N E T I C ) ; 
 	 	 v a r   i s G a l   =   t h i s . _ s e a r c h I n S e l e c t   & &   ( t h i s . _ s e a r c h I n S e l e c t . g e t V a l u e ( )   = =   Z m C o n t a c t s A p p . S E A R C H F O R _ G A L ) ; 
 	 	 i f   ( n a m e Q u e r y   & &   ! i s G a l )   { 
 	 	 	 v a r   n a m e Q u e r y P i e c e s   =   n a m e Q u e r y . s p l i t ( / \ s + / ) ; 
 	 	 	 f o r   ( v a r   i   =   0 ;   i   <   n a m e Q u e r y P i e c e s . l e n g t h ;   i + + )   { 
 	 	 	 	 v a r   n a m e Q u e r y P i e c e   =   n a m e Q u e r y P i e c e s [ i ] ; 
 	 	 	 	 n a m e Q u e r y T e r m s . p u s h ( " # " + Z m C o n t a c t . F _ f i r s t N a m e   +   " : "   +   n a m e Q u e r y P i e c e ) ; 
 	 	 	 	 n a m e Q u e r y T e r m s . p u s h ( " # " + Z m C o n t a c t . F _ l a s t N a m e   +   " : "   +   n a m e Q u e r y P i e c e ) ; 
 	 	 	 	 n a m e Q u e r y T e r m s . p u s h ( " # " + Z m C o n t a c t . F _ m i d d l e N a m e   +   " : "   +   n a m e Q u e r y P i e c e ) ; 
 	 	 	 	 n a m e Q u e r y T e r m s . p u s h ( " # " + Z m C o n t a c t . F _ n i c k n a m e   +   " : "   +   n a m e Q u e r y P i e c e ) ; 
 	 	 	 } 
 	 	 	 q u e r y   =   " ( "   +   n a m e Q u e r y T e r m s . j o i n ( "   O R   " )   +   " ) " ; 
 	 	 }   e l s e   { 
 	 	 	 i f   ( n a m e Q u e r y   & &   i s G a l )   { 
 	 	 	 	 c o n d s . p u s h ( [ { a t t r : Z m C o n t a c t . F _ f i r s t N a m e ,   o p : " h a s " ,   v a l u e :   n a m e Q u e r y } , 
 	 	 	 	                         { a t t r : Z m C o n t a c t . F _ l a s t N a m e ,     o p : " h a s " ,   v a l u e :   n a m e Q u e r y } , 
 	 	 	 	                         { a t t r : Z m C o n t a c t . F _ m i d d l e N a m e ,   o p : " h a s " ,   v a l u e :   n a m e Q u e r y } , 
 	 	 	 	                         { a t t r : Z m C o n t a c t . F _ n i c k n a m e ,     o p : " h a s " ,   v a l u e :   n a m e Q u e r y } , 
 	 	 	 	                         { a t t r : Z m C o n t a c t . F _ p h o n e t i c F i r s t N a m e ,   o p : " h a s " ,   v a l u e :   n a m e Q u e r y } , 
 	 	 	 	                         { a t t r : Z m C o n t a c t . F _ p h o n e t i c L a s t N a m e ,     o p : " h a s " ,   v a l u e :   n a m e Q u e r y } ] ) ; 
 	 	 	 } 
 	 	 	 q u e r y   =   " " ; 
 	 	 } 
 	 	 i f   ( e m a i l Q u e r y )   { 
 	 	 	 i f   ( i s G a l )   { 
 	 	 	 	 c o n d s . p u s h ( [ { a t t r : Z m C o n t a c t . F _ e m a i l ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 2 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 3 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 4 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 5 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 6 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 7 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 8 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 9 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 1 0 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 1 1 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 1 2 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 1 3 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 1 4 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 1 5 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } , 
 	 	 	 	 { a t t r : Z m C o n t a c t . F _ e m a i l 1 6 ,   o p : " h a s " ,   v a l u e :   e m a i l Q u e r y } 
 	 	 	 	 ] ) ; 
 	 	 	 }   e l s e   { 
 	 	 	 	 e m a i l Q u e r y T e r m   =   " t o : " + e m a i l Q u e r y + " * " ; 
 	 	 	 } 
 	 	 } 
 	 	 i f   ( d e p t Q u e r y   & &   i s G a l )   { 
 	 	 	 c o n d s . p u s h ( { a t t r : Z m C o n t a c t . F _ d e p a r t m e n t ,   o p : " h a s " ,   v a l u e :   d e p t Q u e r y } ) ; 
 	 	 } 
 	 	 i f   ( p h o n e t i c Q u e r y   & &   ! i s G a l )   { 
 	 	 	 v a r   p h o n e t i c Q u e r y P i e c e s   =   p h o n e t i c Q u e r y . s p l i t ( / \ s + / ) ; 
 	 	 	 f o r   ( v a r   i = 0 ;   i < p h o n e t i c Q u e r y P i e c e s . l e n g t h ;   i + + )   { 
 	 	 	 	 p h o n e t i c Q u e r y T e r m s . p u s h ( " # " + Z m C o n t a c t . F _ p h o n e t i c F i r s t N a m e   +   " : "   +   p h o n e t i c Q u e r y P i e c e s [ i ] ) ; 
 	 	 	 	 p h o n e t i c Q u e r y T e r m s . p u s h ( " # " + Z m C o n t a c t . F _ p h o n e t i c L a s t N a m e   +   " : "   +   p h o n e t i c Q u e r y P i e c e s [ i ] ) ; 
 	 	 	 } 
 	 	 } 
 	 }   e l s e   { 
 	 	 q u e r y   =   t h i s . g e t S e a r c h F i e l d V a l u e ( Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C ) ; 
 	 } 
 	 
 
 	 i f   ( t h i s . _ s e a r c h I n S e l e c t )   { 
 	 	 v a r   s e a r c h F o r   =   t h i s . _ s e a r c h I n S e l e c t . g e t V a l u e ( ) ; 
 	 	 t h i s . _ c o n t a c t S o u r c e   =   ( s e a r c h F o r   = =   Z m C o n t a c t s A p p . S E A R C H F O R _ C O N T A C T S   | |   s e a r c h F o r   = =   Z m C o n t a c t s A p p . S E A R C H F O R _ P A S ) 
 	 	 	 ?   Z m I t e m . C O N T A C T 
 	 	 	 :   Z m I d . S E A R C H _ G A L ; 
 
 	 	 i f   ( s e a r c h F o r   = =   Z m C o n t a c t s A p p . S E A R C H F O R _ P A S )   { 
 	 	 	 q u e r y H i n t . p u s h ( Z m S e a r c h C o n t r o l l e r . g e n e r a t e Q u e r y F o r S h a r e s ( Z m I d . I T E M _ C O N T A C T )   | |   " i s : l o c a l " ) ; 
 	 	 }   e l s e   i f   ( s e a r c h F o r   = =   Z m C o n t a c t s A p p . S E A R C H F O R _ C O N T A C T S )   { 
 	 	 	 q u e r y H i n t . p u s h ( " i s : l o c a l " ) ; 
 	 	 }   e l s e   i f   ( s e a r c h F o r   = =   Z m C o n t a c t s A p p . S E A R C H F O R _ G A L )   { 
                         a s c e n d i n g   =   t r u e ; 
                 } 
 	 }   e l s e   { 
 	 	 t h i s . _ c o n t a c t S o u r c e   =   a p p C t x t . g e t ( Z m S e t t i n g . C O N T A C T S _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) 
 	 	 	 ?   Z m I t e m . C O N T A C T 
 	 	 	 :   Z m I d . S E A R C H _ G A L ; 
 
 	 	 i f   ( t h i s . _ c o n t a c t S o u r c e   = =   Z m I t e m . C O N T A C T )   { 
 	 	 	 q u e r y H i n t . p u s h ( " i s : l o c a l " ) ; 
 	 	 } 
 	 } 
 
 	 i f   ( t h i s . _ c o n t a c t S o u r c e   = =   Z m I t e m . C O N T A C T   & &   q u e r y   ! =   " "   & &   ! q u e r y . s t a r t s W i t h   ( " ( " ) )   { 
 	 	 q u e r y   =   q u e r y . r e p l a c e ( / \ " / g ,   ' \ \ " ' ) ; 
 	 	 q u e r y   =   " \ " "   +   q u e r y   +   " \ " " ; 
 	 } 
 	 i f   ( p h o n e t i c Q u e r y T e r m s . l e n g t h )   { 
 	 	 q u e r y   =   q u e r y   +   "   ( "   +   p h o n e t i c Q u e r y T e r m s . j o i n ( "   O R   " )   +   " ) " ; 
 	 } 
 	 i f   ( e m a i l Q u e r y T e r m . l e n g t h )   { 
 	 	 q u e r y   =   q u e r y   +   "   "   +   e m a i l Q u e r y T e r m ;     / /   M U S T   m a t c h   e m a i l   t e r m ,   h e n c e   A N D   r a t h e r   t h a n   O R 
 	 } 
 
 	 i f   ( t h i s . _ s e a r c h I c o n )   {   / / d o e s   n o t   e x i s t   i n   Z m G r o u p V i e w   c a s e 
 	 	 t h i s . _ s e a r c h I c o n . c l a s s N a m e   =   " D w t W a i t 1 6 I c o n " ; 
 	 } 
 
 	 / /   X X X :   l i n e   b e l o w   d o e s n ' t   h a v e   i n t e n d e d   e f f e c t   ( t u r n   o f f   c o l u m n   s o r t i n g   f o r   G A L   s e a r c h ) 
 	 i f   ( t h i s . _ c h o o s e r )   {   / / _ c h o o s e r   n o t   d e f i n e d   i n   Z m G r o u p V i e w   b u t   w e   a l s o   d o   n o t   s u p p o r t   s o r t i n g   t h e r e   a n y w a y 
 	 	 t h i s . _ c h o o s e r . s o u r c e L i s t V i e w . s o r t i n g E n a b l e d   =   ( t h i s . _ c o n t a c t S o u r c e   = =   Z m I t e m . C O N T A C T ) ; 
 	 } 
 
 	 v a r   p a r a m s   =   { 
 	 	 o b j : 	 	 	 t h i s , 
 	 	 a s c e n d i n g : 	 	 a s c e n d i n g , 
 	 	 q u e r y : 	 	 	 q u e r y , 
 	 	 q u e r y H i n t : 	 	 q u e r y H i n t . j o i n ( "   " ) , 
 	 	 c o n d s : 	 	 	 c o n d s , 
 	 	 o f f s e t : 	 	 	 o f f s e t   | |   0 , 
 	 	 l a s t I d : 	 	 	 l a s t I d , 
 	 	 l a s t S o r t V a l : 	 l a s t S o r t V a l , 
 	 	 r e s p C a l l b a c k : 	 ( n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ h a n d l e R e s p o n s e S e a r c h ,   [ f i r s t T i m e ] ) ) , 
 	 	 e r r o r C a l l b a c k : 	 t h i s . _ s e a r c h E r r o r C a l l b a c k , 
 	 	 a c c o u n t N a m e : 	 ( t h i s . _ a c c o u n t   & &   t h i s . _ a c c o u n t . n a m e ) , 
 	 	 e x p a n d D L : 	 	 t r u e 
 	 } ; 
 	 Z m C o n t a c t s H e l p e r . s e a r c h ( p a r a m s ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ c o n t e n t H t m l   = 
 f u n c t i o n ( a c c o u n t )   { 
 	 v a r   s h o w S e l e c t ; 
 	 i f   ( a p p C t x t . m u l t i A c c o u n t s )   { 
 	 	 v a r   l i s t   =   a p p C t x t . a c c o u n t L i s t . v i s i b l e A c c o u n t s ; 
 	 	 f o r   ( v a r   i   =   0 ;   i   <   l i s t . l e n g t h ;   i + + )   { 
 	 	 	 v a r   a c c o u n t   =   l i s t [ i ] ; 
 	 	 	 i f   ( a p p C t x t . g e t ( Z m S e t t i n g . C O N T A C T S _ E N A B L E D ,   n u l l ,   a c c o u n t )   & & 
 	 	 	 	 ( a p p C t x t . g e t ( Z m S e t t i n g . G A L _ E N A B L E D ,   n u l l ,   a c c o u n t )   | | 
 	 	 	 	   a p p C t x t . g e t ( Z m S e t t i n g . S H A R I N G _ E N A B L E D ,   n u l l ,   a c c o u n t ) ) ) 
 	 	 	 { 
 	 	 	 	 s h o w S e l e c t   =   t r u e ; 
 	 	 	 	 b r e a k ; 
 	 	 	 } 
 	 	 } 
 	 }   e l s e   { 
 	 	 s h o w S e l e c t   =   ( a p p C t x t . g e t ( Z m S e t t i n g . C O N T A C T S _ E N A B L E D )   & & 
 	 	 	 	 	     ( a p p C t x t . g e t ( Z m S e t t i n g . G A L _ E N A B L E D )   | | 
 	 	 	 	 	       a p p C t x t . g e t ( Z m S e t t i n g . S H A R I N G _ E N A B L E D ) ) ) ; 
 	 } 
 
 	 v a r   s u b s   =   { 
 	 	 i d :   t h i s . _ h t m l E l I d , 
 	 	 s h o w S e l e c t :   s h o w S e l e c t , 
 	 	 d e t a i l e d :   t h i s . _ d e t a i l e d S e a r c h 
 	 } ; 
 
 	 r e t u r n   ( A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # Z m C o n t a c t P i c k e r " ,   s u b s ) ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ r e s e t S e l e c t D i v   = 
 f u n c t i o n ( )   { 
         t h i s . _ s e a r c h I n S e l e c t . c l e a r O p t i o n s ( ) ; 
 
         i f   ( a p p C t x t . m u l t i A c c o u n t s )   { 
                 v a r   a c c t s   =   a p p C t x t . a c c o u n t L i s t . v i s i b l e A c c o u n t s ; 
                 v a r   o r g   =   Z m O r g a n i z e r . I T E M _ O R G A N I Z E R ; 
                 o r g   =   Z m O r g a n i z e r . I T E M _ O R G A N I Z E R [ Z m I t e m . C O N T A C T ] ; 
 
                 f o r   ( v a r   i   =   0 ;   i   <   a c c t s . l e n g t h ;   i + + )   { 
                         t h i s . _ s e a r c h I n S e l e c t . a d d O p t i o n ( a c c t s [ i ] . d i s p l a y N a m e ,   f a l s e ,   a c c t s [ i ] . i d ) ; 
                         v a r   f o l d e r T r e e   =   a p p C t x t . g e t F o l d e r T r e e ( a c c t s [ i ] ) ; 
                         v a r   d a t a   =   [ ] ; 
                         d a t a   =   d a t a . c o n c a t ( f o l d e r T r e e . g e t B y T y p e ( o r g ) ) ; 
                         f o r   ( v a r   j   =   0 ;   j   <   d a t a . l e n g t h ;   j + + )   { 
                                 v a r   a d d r s b k   =   d a t a [ j ] ; 
                                 i f ( a d d r s b k . n o S u c h F o l d e r )   {   c o n t i n u e ;   } 
                                 t h i s . _ s e a r c h I n S e l e c t . a d d O p t i o n ( a d d r s b k . g e t N a m e ( ) ,   f a l s e ,   a d d r s b k . i d ,   " I m g C o n t a c t " ) ; 
                         } 
                         i f ( a c c t s [ i ] . i s Z i m b r a A c c o u n t   & &   ! a c c t s [ i ] . i s M a i n )   { 
                                 i f   ( a p p C t x t . g e t ( Z m S e t t i n g . C O N T A C T S _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) )   { 
                                         i f   ( a p p C t x t . g e t ( Z m S e t t i n g . S H A R I N G _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) ) 
                                                 t h i s . _ s e a r c h I n S e l e c t . a d d O p t i o n ( Z m M s g . s e a r c h P e r s o n a l S h a r e d C o n t a c t s ,   f a l s e ,   Z m C o n t a c t s A p p . S E A R C H F O R _ P A S ,   " I m g C o n t a c t " ) ; 
                                 } 
 
                                 i f   ( a p p C t x t . g e t ( Z m S e t t i n g . G A L _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) )   { 
                                         t h i s . _ s e a r c h I n S e l e c t . a d d O p t i o n ( Z m M s g . G A L ,   t r u e ,   Z m C o n t a c t s A p p . S E A R C H F O R _ G A L ,   " I m g C o n t a c t " ) ; 
                                 } 
 
                                 i f   ( ! a p p C t x t . g e t ( Z m S e t t i n g . I N I T I A L L Y _ S E A R C H _ G A L ,   n u l l ,   t h i s . _ a c c o u n t )   | | 
                                                 ! a p p C t x t . g e t ( Z m S e t t i n g . G A L _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) ) 
                                 { 
                                         t h i s . _ s e a r c h I n S e l e c t . s e t S e l e c t e d V a l u e ( Z m C o n t a c t s A p p . S E A R C H F O R _ C O N T A C T S ) ; 
                                 } 
                         } 
                 } 
 
                 f o r   ( v a r   k   =   0 ;   k   <   a c c t s . l e n g t h ;   k + + )   { 
                         t h i s . _ s e a r c h I n S e l e c t . e n a b l e O p t i o n ( a c c t s [ k ] . i d ,   f a l s e ) ; 
                 } 
         }   e l s e   { 
 
                 i f   ( a p p C t x t . g e t ( Z m S e t t i n g . C O N T A C T S _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) )   { 
                         t h i s . _ s e a r c h I n S e l e c t . a d d O p t i o n ( Z m M s g . c o n t a c t s ,   f a l s e ,   Z m C o n t a c t s A p p . S E A R C H F O R _ C O N T A C T S ) ; 
 
                         i f   ( a p p C t x t . g e t ( Z m S e t t i n g . S H A R I N G _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) ) 
                                 t h i s . _ s e a r c h I n S e l e c t . a d d O p t i o n ( Z m M s g . s e a r c h P e r s o n a l S h a r e d C o n t a c t s ,   f a l s e ,   Z m C o n t a c t s A p p . S E A R C H F O R _ P A S ) ; 
                 } 
 
                 i f   ( a p p C t x t . g e t ( Z m S e t t i n g . G A L _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) )   { 
                         t h i s . _ s e a r c h I n S e l e c t . a d d O p t i o n ( Z m M s g . G A L ,   t r u e ,   Z m C o n t a c t s A p p . S E A R C H F O R _ G A L ) ; 
                 } 
 
                 i f   ( ! a p p C t x t . g e t ( Z m S e t t i n g . I N I T I A L L Y _ S E A R C H _ G A L ,   n u l l ,   t h i s . _ a c c o u n t )   | | 
                                 ! a p p C t x t . g e t ( Z m S e t t i n g . G A L _ E N A B L E D ,   n u l l ,   t h i s . _ a c c o u n t ) ) 
                 { 
                         t h i s . _ s e a r c h I n S e l e c t . s e t S e l e c t e d V a l u e ( Z m C o n t a c t s A p p . S E A R C H F O R _ C O N T A C T S ) ; 
                 } 
 
         } 
 } ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . g e t S e a r c h F i e l d V a l u e   = 
 f u n c t i o n ( f i e l d I d )   { 
 	 i f   ( ! f i e l d I d   & &   ! t h i s . _ d e t a i l e d S e a r c h )   { 
 	 	 f i e l d I d   =   Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C ; 
 	 } 
 	 v a r   f i e l d   =   t h i s . _ s e a r c h F i e l d [ f i e l d I d ] ; 
 	 r e t u r n   f i e l d   & &   A j x S t r i n g U t i l . t r i m ( f i e l d . v a l u e )   | |   " " ; 
 } ; 
 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ g e t D i a l o g H e i g h t   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   Z m C o n t a c t P i c k e r . D I A L O G _ H E I G H T   -   ( a p p C t x t . i s C h i l d W i n d o w   ?   1 0 0   :   0 ) ; 
 } ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ g e t S e c t i o n H e i g h t   = 
 f u n c t i o n ( i d S u f f i x )   { 
 	 r e t u r n   D w t . g e t S i z e ( d o c u m e n t . g e t E l e m e n t B y I d ( t h i s . _ h t m l E l I d   +   i d S u f f i x ) ) . y ; 
 
 } ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ r e s i z e C h o o s e r   = 
 f u n c t i o n ( )   { 
 
 	 v a r   c h o o s e r H e i g h t   =   t h i s . _ g e t D i a l o g H e i g h t ( ) 
 	 	 	 -   t h i s . _ g e t S e c t i o n H e i g h t ( " _ h a n d l e " )     / / t h e   h e a d e r 
 	 	 	 -   t h i s . _ g e t S e c t i o n H e i g h t ( " _ s e a r c h T a b l e " ) 
 	 	 	 -   t h i s . _ g e t S e c t i o n H e i g h t ( " _ p a g i n g " ) 
 	 	 	 -   t h i s . _ g e t S e c t i o n H e i g h t ( " _ b u t t o n s S e p " ) 
 	 	 	 -   t h i s . _ g e t S e c t i o n H e i g h t ( " _ b u t t o n s " ) 
 	 	 	 -   3 0 ;   / / s t i l l   n e e d   s o m e   m a g i c   t o   a c c o u n t   f o r   s o m e   m a r g i n s   e t c . 
 
 	 t h i s . _ c h o o s e r . r e s i z e ( t h i s . g e t S i z e ( ) . x   -   2 5 ,   c h o o s e r H e i g h t ) ; 
 } ; 
 
 / * * 
   *   c a l l e d   o n l y   w h e n   Z m C o n t a c t P i c k e r   i s   f i r s t   c r e a t e d .   S e t s   u p   i n i t i a l   l a y o u t . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ i n i t i a l i z e   = 
 f u n c t i o n ( a c c o u n t )   { 
 
 	 / /   c r e a t e   s t a t i c   c o n t e n t   a n d   a p p e n d   t o   d i a l o g   p a r e n t 
 	 t h i s . s e t C o n t e n t ( t h i s . _ c o n t e n t H t m l ( a c c o u n t ) ) ; 
 
 	 t h i s . _ s e a r c h I c o n   =   d o c u m e n t . g e t E l e m e n t B y I d ( t h i s . _ h t m l E l I d   +   " _ s e a r c h I c o n " ) ; 
 
 	 / /   a d d   s e a r c h   b u t t o n 
 	 t h i s . _ s e a r c h B u t t o n   =   n e w   D w t B u t t o n ( { p a r e n t : t h i s ,   p a r e n t E l e m e n t : ( t h i s . _ h t m l E l I d + " _ s e a r c h B u t t o n " ) } ) ; 
 	 t h i s . _ s e a r c h B u t t o n . s e t T e x t ( Z m M s g . s e a r c h ) ; 
 	 t h i s . _ s e a r c h B u t t o n . a d d S e l e c t i o n L i s t e n e r ( n e w   A j x L i s t e n e r ( t h i s ,   t h i s . _ s e a r c h B u t t o n L i s t e n e r ) ) ; 
 
 	 / /   a d d   s e l e c t   m e n u 
 	 v a r   s e l e c t C e l l I d   =   t h i s . _ h t m l E l I d   +   " _ l i s t S e l e c t " ; 
 	 v a r   s e l e c t C e l l   =   d o c u m e n t . g e t E l e m e n t B y I d ( s e l e c t C e l l I d ) ; 
 	 i f   ( s e l e c t C e l l )   { 
 	 	 t h i s . _ s e a r c h I n S e l e c t   =   n e w   D w t S e l e c t ( { 
 	 	 	 p a r e n t :                   t h i s , 
 	 	 	 p a r e n t E l e m e n t :     s e l e c t C e l l I d , 
 	 	 	 i d :                           D w t . g e t N e x t I d ( " Z m C o n t a c t P i c k e r S e l e c t _ " ) , 
 	 	 	 l e g e n d I d :               t h i s . _ h t m l E l I d   +   ' _ l i s t S e l e c t L b l ' 
 	 	 } ) ; 
 	 	 t h i s . _ r e s e t S e l e c t D i v ( ) ; 
 	 	 t h i s . _ s e a r c h I n S e l e c t . a d d C h a n g e L i s t e n e r ( n e w   A j x L i s t e n e r ( t h i s ,   t h i s . _ s e a r c h T y p e L i s t e n e r ) ) ; 
 	 }   e l s e   { 
 	 	 t h i s . s e t S i z e ( " 6 0 0 " ) ; 
 	 } 
 
 	 / /   a d d   c h o o s e r 
 	 t h i s . _ c h o o s e r   =   n e w   Z m C o n t a c t C h o o s e r ( { p a r e n t : t h i s ,   b u t t o n I n f o : t h i s . _ b u t t o n I n f o } ) ; 
 	 t h i s . _ c h o o s e r . r e p a r e n t H t m l E l e m e n t ( t h i s . _ h t m l E l I d   +   " _ c h o o s e r " ) ; 
 
 	 / /   a d d   p a g i n g   b u t t o n s 
 	 v a r   p a g e L i s t e n e r   =   n e w   A j x L i s t e n e r ( t h i s ,   t h i s . _ p a g e L i s t e n e r ) ; 
 	 t h i s . _ p r e v B u t t o n   =   n e w   D w t B u t t o n ( { p a r e n t : t h i s ,   p a r e n t E l e m e n t : ( t h i s . _ h t m l E l I d + " _ p a g e L e f t " ) } ) ; 
 	 t h i s . _ p r e v B u t t o n . s e t T e x t ( Z m M s g . p r e v i o u s ) ; 
 	 t h i s . _ p r e v B u t t o n . s e t I m a g e ( " L e f t A r r o w " ) ; 
 	 t h i s . _ p r e v B u t t o n . a d d S e l e c t i o n L i s t e n e r ( p a g e L i s t e n e r ) ; 
 
 	 t h i s . _ n e x t B u t t o n   =   n e w   D w t B u t t o n ( { p a r e n t : t h i s ,   s t y l e : D w t L a b e l . I M A G E _ R I G H T ,   p a r e n t E l e m e n t : ( t h i s . _ h t m l E l I d + " _ p a g e R i g h t " ) } ) ; 
 	 t h i s . _ n e x t B u t t o n . s e t T e x t ( Z m M s g . n e x t ) ; 
 	 t h i s . _ n e x t B u t t o n . s e t I m a g e ( " R i g h t A r r o w " ) ; 
 	 t h i s . _ n e x t B u t t o n . a d d S e l e c t i o n L i s t e n e r ( p a g e L i s t e n e r ) ; 
 
 	 v a r   p a g e C o n t a i n e r   =   d o c u m e n t . g e t E l e m e n t B y I d ( t h i s . _ h t m l E l I d   +   " _ p a g i n g " ) ; 
 	 i f   ( p a g e C o n t a i n e r )   { 
 	 	 D w t . s e t S i z e ( p a g e C o n t a i n e r ,   t h i s . _ c h o o s e r . s o u r c e L i s t V i e w . g e t S i z e ( ) . x ) ; 
 	 } 
 
 	 / /   i n i t   l i s t e n e r s 
 	 t h i s . s e t B u t t o n L i s t e n e r ( D w t D i a l o g . O K _ B U T T O N ,   n e w   A j x L i s t e n e r ( t h i s ,   t h i s . _ o k B u t t o n L i s t e n e r ) ) ; 
 	 t h i s . s e t B u t t o n L i s t e n e r ( D w t D i a l o g . C A N C E L _ B U T T O N ,   n e w   A j x L i s t e n e r ( t h i s ,   t h i s . _ c a n c e l B u t t o n L i s t e n e r ) ) ; 
 
 	 v a r   f i e l d M a p   =   { } ; 
 	 v a r   r o w M a p   =   { } ; 
 	 t h i s . m a p F i e l d s ( f i e l d M a p ,   r o w M a p ) ; 
 
 	 t h i s . _ s e a r c h F i e l d   =   { } ; 
 	 f o r   ( v a r   f i e l d I d   i n   f i e l d M a p )   { 
 	 	 v a r   f i e l d   =   D w t . b y I d ( f i e l d M a p [ f i e l d I d ] ) ; 
 	 	 i f   ( f i e l d )   { 
 	 	 	 t h i s . _ s e a r c h F i e l d [ f i e l d I d ]   =   f i e l d ; 
 	 	 	 D w t . s e t H a n d l e r ( f i e l d ,   D w t E v e n t . O N K E Y U P ,   Z m C o n t a c t P i c k e r . _ k e y P r e s s H d l r ) ; 
 	 	 } 
 	 } 
 
 	 t h i s . _ s e a r c h R o w   =   { } ; 
 	 f o r   ( v a r   r o w I d   i n   r o w M a p )   { 
 	 	 v a r   r o w   =   D w t . b y I d ( r o w M a p [ r o w I d ] ) ; 
 	 	 i f   ( r o w )   { 
 	 	 	 t h i s . _ s e a r c h R o w [ r o w I d ]   =   r o w ; 
 	 	 } 
 	 } 
 	 t h i s . _ u p d a t e S e a r c h R o w s ( t h i s . _ s e a r c h I n S e l e c t   & &   t h i s . _ s e a r c h I n S e l e c t . g e t V a l u e ( )   | |   Z m C o n t a c t s A p p . S E A R C H F O R _ C O N T A C T S ) ; 
 	 t h i s . _ k e y P r e s s C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . _ s e a r c h B u t t o n L i s t e n e r ) ; 
         t h i s . s h a r e d C o n t a c t G r o u p s   =   [ ] ; 
 
 	 / / a d d   t a b g r o u p s   f o r   k e y b o a r d   n a v i g a t i o n 
 	 t h i s . _ t a b G r o u p   =   n e w   D w t T a b G r o u p ( t h i s . t o S t r i n g ( ) ) ; 
 	 t h i s . _ t a b G r o u p . r e m o v e A l l M e m b e r s ( ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   Z m C o n t a c t P i c k e r . A L L . l e n g t h ;   i + + )   { 
 	 	 f i e l d   =   D w t . b y I d ( f i e l d M a p [ Z m C o n t a c t P i c k e r . A L L [ i ] ] ) ; 
 	 	 i f   ( D w t . g e t V i s i b l e ( f i e l d ) )   { 
 	 	 	 t h i s . _ t a b G r o u p . a d d M e m b e r ( f i e l d ) ; 
 	 	 } 
 	 } 
 	 t h i s . _ t a b G r o u p . a d d M e m b e r ( t h i s . _ s e a r c h B u t t o n ) ; 
 	 t h i s . _ t a b G r o u p . a d d M e m b e r ( t h i s . _ s e a r c h I n S e l e c t ) ; 
 	 t h i s . _ t a b G r o u p . a d d M e m b e r ( t h i s . _ c h o o s e r . g e t T a b G r o u p M e m b e r ( ) ) ; 
 	 t h i s . _ t a b G r o u p . a d d M e m b e r ( t h i s . _ p r e v B u t t o n ) ; 
 	 t h i s . _ t a b G r o u p . a d d M e m b e r ( t h i s . _ n e x t B u t t o n ) ; 
 	 f o r   ( v a r   i   =   0 ;   i   <   t h i s . _ b u t t o n L i s t . l e n g t h ;   i + + )   { 
 	 	 t h i s . _ t a b G r o u p . a d d M e m b e r ( t h i s . _ b u t t o n [ t h i s . _ b u t t o n L i s t [ i ] ] ) ; 
 	 } 
 } ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . m a p F i e l d s   = 
 f u n c t i o n ( f i e l d M a p ,   r o w M a p )   { 
 	 i f   ( t h i s . _ d e t a i l e d S e a r c h )   { 
 	 	 f i e l d M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ N A M E ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h N a m e F i e l d " ; 
 	 	 f i e l d M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ E M A I L ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h E m a i l F i e l d " ; 
 	 	 f i e l d M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ D E P T ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h D e p a r t m e n t F i e l d " ; 
 	 	 f i e l d M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ P H O N E T I C ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h P h o n e t i c F i e l d " ; 
 	 	 r o w M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ N A M E ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h N a m e R o w " ; 
 	 	 r o w M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ P H O N E T I C ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h P h o n e t i c R o w " ; 
 	 	 r o w M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ E M A I L ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h E m a i l R o w " ; 
 	 	 r o w M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ D E P T ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h D e p a r t m e n t R o w " ; 
 	 } 
 	 e l s e   { 
 	 	 f i e l d M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h F i e l d " ; 
 	 	 r o w M a p [ Z m C o n t a c t P i c k e r . S E A R C H _ B A S I C ]   =   t h i s . _ h t m l E l I d   +   " _ s e a r c h R o w " ; 
 	 } 
 } ; 	 	 
 
 / /   L i s t e n e r s 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ s e a r c h B u t t o n L i s t e n e r   = 
 f u n c t i o n ( e v )   { 
 	 t h i s . _ r e s e t R e s u l t s ( ) ; 
 	 t h i s . s e a r c h ( ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ h a n d l e R e s p o n s e S e a r c h   = 
 f u n c t i o n ( f i r s t T i m e ,   r e s u l t )   { 
 	 v a r   r e s p   =   r e s u l t . g e t R e s p o n s e ( ) ; 
 	 v a r   s e r v e r H a s M o r e   =   r e s p . g e t A t t r i b u t e ( " m o r e " ) ; 
 	 v a r   s e r v e r P a g i n a t i o n S u p p o r t e d   =   r e s p . g e t A t t r i b u t e ( " p a g i n a t i o n S u p p o r t e d " )   ! = =   f a l s e ;   / / i f   i t ' s   n o t   s p e c i f i e d   ( s u c h   a s   t h e   c a s e   o f   S e a r c h R e s p o n s e ,   i . e .   n o t   G a l )   i t   I S   s u p p o r t e d . 
 	 t h i s . _ s e r v e r H a s M o r e A n d P a g i n a t i o n S u p p o r t e d   =   s e r v e r H a s M o r e   & &   s e r v e r P a g i n a t i o n S u p p o r t e d ; 
 	 v a r   o f f s e t   =   r e s p . g e t A t t r i b u t e ( " o f f s e t " ) ; 
 	 t h i s . _ s e r v e r C o n t a c t O f f s e t   =   o f f s e t   | |   0 ; 
 	 v a r   i n f o   =   r e s p . g e t A t t r i b u t e ( " i n f o " ) ; 
 	 v a r   e x p a n d e d   =   i n f o   & &   i n f o [ 0 ] . w i l d c a r d [ 0 ] . e x p a n d e d   = =   " 0 " ; 
 
 	 / / t h e   c h e c k   f o r   f i r s t T i m e   i s   s o   w h e n   t h e   p i c k e r   i s   p o p p e d   u p   w e   p r o b a b l y   d o n ' t   w a n t   t o   o v e r w h e l m   t h e m   w i t h   a   w a r n i n g   m e s s a g e .   S o   o n l y   s h o w   i t   i f   t h e   u s e r   p l a y s   w i t h   t h e   p i c k e r ,   u s i n g   t h e   d r o p - d o w n   o r   t h e   s e a r c h   b o x . 
 	 i f   ( ! f i r s t T i m e   & &   ! s e r v e r P a g i n a t i o n S u p p o r t e d   & &   ( s e r v e r H a s M o r e   | |   e x p a n d e d ) )   {   / / n o   i d e a   w h a t   t h e   e x p a n d e d   c a s e   i s 
 	 	 v a r   d   =   a p p C t x t . g e t M s g D i a l o g ( ) ; 
 	 	 d . s e t M e s s a g e ( Z m M s g . e r r o r S e a r c h N o t E x p a n d e d ) ; 
 	 	 d . p o p u p ( ) ; 
 	 	 i f   ( e x p a n d e d )   {   r e t u r n ;   } 
 	 } 
 
 	 / /   t h i s   m e t h o d   w i l l   e x p a n d   t h e   l i s t   d e p e n d i n g   o n   t h e   n u m b e r   o f   e m a i l 
 	 / /   a d d r e s s e s   p e r   c o n t a c t . 
 	 v a r   e m a i l A r r a y   =   Z m C o n t a c t s H e l p e r . _ p r o c e s s S e a r c h R e s p o n s e ( r e s p ,   t h i s . _ i n c l u d e C o n t a c t s W i t h N o E m a i l ) ;   / / t h i s . _ i n c l u d e C o n t a c t s W i t h N o E m a i l   -   t r u e   i n   t h e   Z m G r o u p V i e w   c a s e   
 	 v a r   e m a i l L i s t   =   A j x V e c t o r . f r o m A r r a y ( e m a i l A r r a y ) ; 
 
 	 i f   ( s e r v e r P a g i n a t i o n S u p p o r t e d )   { 
 	 	 t h i s . _ e m a i l L i s t . a d d L i s t ( e m a i l A r r a y ) ;   / / t h i s   i n t e r n a l l y   c a l l s   c o n c a t .   w e   d o   n o t   n e e d   " m e r g e "   h e r e   b e c a u s e   w e   u s e   t h e   _ s e r v e r C o n t a c t O f f s e t   a s   a   m a r k e r   o f   w h e r e   t o   s e a r c h   n e x t ,   n e v e r   s e a r c h i n g   a   b l o c k   w e   a l r e a d y   d i d . 
 	 } 
 	 e l s e   { 
 	 	 t h i s . _ e m a i l L i s t   =   e m a i l L i s t ; 
 	 } 
         v a r   l i s t   =   t h i s . g e t S u b L i s t ( ) ; 
         i f   ( t h i s . t o S t r i n g ( )   = = =   " Z m C o n t a c t P i c k e r " )   { 
                 l i s t   =   t h i s . l o a d S h a r e d G r o u p C o n t a c t s ( l i s t )   | |   l i s t ; 
         } 
 	 t h i s . _ s h o w R e s u l t s ( l i s t ) ; 
 
 } ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ s h o w R e s u l t s   = 
 f u n c t i o n ( a L i s t )   { 
         v a r   l i s t   =   a L i s t   | |   t h i s . g e t S u b L i s t ( ) ; 
 	 / /   s p e c i a l   c a s e   1   -   s e a r c h   f o r w a r d   a n o t h e r   s e r v e r   b l o c k ,   t o   f i l l   u p   a   p a g e .   C o u l d   s e a r c h   s e v e r a l   t i m e s . 
 	 i f   ( l i s t . s i z e ( )   <   Z m C o n t a c t s A p p . S E A R C H F O R _ M A X   & &   t h i s . _ s e r v e r H a s M o r e A n d P a g i n a t i o n S u p p o r t e d )   { 
 	 	 t h i s . s e a r c h ( n u l l ,   n u l l ,   n u l l ,   n u l l ,   n u l l ,   t h i s . _ s e r v e r C o n t a c t O f f s e t   +   Z m C o n t a c t s A p p . S E A R C H F O R _ M A X ) ;   / / s e a r c h   a n o t h e r   p a g e 
 	 	 r e t u r n ; 
 	 } 
 
 	 i f   ( t h i s . _ s e a r c h I c o n )   {   / / d o e s   n o t   e x i s t   i n   Z m G r o u p V i e w   c a s e 
 	 	 t h i s . _ s e a r c h I c o n . c l a s s N a m e   =   " " ; 
 	 } 
 	 t h i s . _ s e a r c h B u t t o n . s e t E n a b l e d ( t r u e ) ; 
 
 	 / /   s p e c i a l   c a s e   2   -   n o   r e s u l t s ,   a n d   n o   m o r e   t o   s e a r c h   ( t h a t   w a s   c o v e r e d   i n   s p e c i a l   c a s e   1 )   -   s o   d i s p l a y   t h e   " n o   r e s u l t s "   t e x t . 
 	 i f   ( l i s t . s i z e ( )   = =   0   & &   t h i s . _ e m a i l L i s t O f f s e t   = =   0 )   { 
 	 	 t h i s . _ s e t R e s u l t s I n V i e w ( l i s t ) ;   / / e m p t y   t h e   l i s t 
 	 	 t h i s . _ n e x t B u t t o n . s e t E n a b l e d ( f a l s e ) ; 
 	 	 t h i s . _ p r e v B u t t o n . s e t E n a b l e d ( f a l s e ) ; 
 	 	 t h i s . _ s e t N o R e s u l t s H t m l ( ) ; 
 	 	 r e t u r n ; 
 	 } 
 
 	 / /   s p e c i a l   c a s e   3   -   I f   t h e   A B   e n d s   w i t h   a   l o n g   l i s t   o f   c o n t a c t s   w / o   a d d r e s s e s , 
 	 / /   w e   m a y   g e t   a n   e m p t y   l i s t .     I f   t h a t ' s   t h e   c a s e ,   r o l l   b a c k   t h e   o f f s e t 
 	 / /   n o t   1 0 0 %   s u r e   t h i s   c a s e   c o u l d   s t i l l   h a p p e n   a f t e r   a l l   m y   c h a n g e s   b u t   i t   w a s   t h e r e   i n   t h e   c o d e ,   s o   I   k e e p   i t   j u s t   i n   c a s e . 
 	 i f   ( l i s t . s i z e ( )   = =   0 )   { 
 	 	 t h i s . _ e m a i l L i s t O f f s e t   - =   Z m C o n t a c t s A p p . S E A R C H F O R _ M A X ; 
 	 	 t h i s . _ e m a i l L i s t O f f s e t     =   M a t h . m a x ( 0 ,   t h i s . _ e m a i l L i s t O f f s e t ) ; 
 	 } 
 
 	 v a r   m o r e   =   t h i s . _ s e r v e r H a s M o r e A n d P a g i n a t i o n S u p p o r t e d     / / w e   c a n   g e t   m o r e   f r o m   t h e   s e r v e r 
 	 	 	 	 | |   ( t h i s . _ e m a i l L i s t O f f s e t   +   Z m C o n t a c t s A p p . S E A R C H F O R _ M A X )   <   t h i s . _ e m a i l L i s t . s i z e ( ) ;   / / o r   w e   h a v e   m o r e   o n   t h e   c l i e n t   w e   d i d n ' t   y e t   s h o w 
 	 t h i s . _ p r e v B u t t o n . s e t E n a b l e d ( t h i s . _ e m a i l L i s t O f f s e t   >   0 ) ; 
 	 t h i s . _ n e x t B u t t o n . s e t E n a b l e d ( m o r e ) ; 
 
 	 t h i s . _ r e s e t S e a r c h C o l H e a d e r s ( ) ;   / /   b u g   # 2 2 6 9   -   e n a b l e / d i s a b l e   s o r t   c o l u m n   p e r   t y p e   o f   s e a r c h 
 	 t h i s . _ s e t R e s u l t s I n V i e w ( l i s t ) ; 
 } ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . l o a d S h a r e d G r o u p C o n t a c t s   = 
         f u n c t i o n ( a L i s t )   { 
 
         v a r   l i s t L e n , 
                 l i s t A r r a y , 
                 c o n t a c t , 
                 i t e m , 
                 i , 
                 j , 
                 k , 
                 s h a r e d C o n t a c t G r o u p A r r a y , 
                 l e n 1 , 
                 j s o n O b j , 
                 b a t c h R e q u e s t , 
                 r e q u e s t , 
                 r e s p o n s e ; 
 
                 l i s t A r r a y   =   a L i s t . g e t A r r a y ( ) ; 
                 l i s t L e n   =   a L i s t . s i z e ( ) ; 
                 s h a r e d C o n t a c t G r o u p A r r a y   =   [ ] ; 
 
         f o r   ( i   =   0   ;   i   <   l i s t L e n ;   i + + )   { 
                 i t e m   =   l i s t A r r a y [ i ] ; 
                 c o n t a c t   =   i t e m . _ _ c o n t a c t ; 
                 i f   ( c o n t a c t . i s G r o u p ( )   & &   c o n t a c t . i s S h a r e d ( ) )   { 
                         i f   ( t h i s . s h a r e d C o n t a c t G r o u p s . i n d e x O f ( i t e m . v a l u e )   ! = =   - 1 )   { 
                                 r e t u r n ; 
                         } 
                         t h i s . s h a r e d C o n t a c t G r o u p s . p u s h ( i t e m . v a l u e ) ; 
                         s h a r e d C o n t a c t G r o u p A r r a y . p u s h ( i t e m . v a l u e ) ; 
                 } 
         } 
 
         l e n 1   =   s h a r e d C o n t a c t G r o u p A r r a y . l e n g t h ; 
         j s o n O b j   =   { B a t c h R e q u e s t : { G e t C o n t a c t s R e q u e s t : [ ] , _ j s n s : " u r n : z i m b r a " ,   o n e r r o r : ' c o n t i n u e ' } } ; 
         b a t c h R e q u e s t   =   j s o n O b j . B a t c h R e q u e s t ; 
         r e q u e s t   =   b a t c h R e q u e s t . G e t C o n t a c t s R e q u e s t ; 
 
         f o r   ( j   =   0 , k   = 0 ;   j   <   l e n 1 ;   j + + )   { 
                 r e q u e s t . p u s h ( {   c n :   { i d :   s h a r e d C o n t a c t G r o u p A r r a y [ j ] } ,   _ j s n s :   ' u r n : z i m b r a M a i l ' ,   d e r e f G r o u p M e m b e r :   ' 1 ' ,   r e t u r n C e r t I n f o :   ' 1 ' ,   r e q u e s t I d :   k + +   } ) ;   / / S e e   Z C S - 9 9 9   a n d   Z C S - 9 9 1   f o r   r e t u r n C e r t I n f o   p a r a m 
         } 
                 v a r   r e s p C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s ,   t h i s . h a n d l e S h a r e d C o n t a c t R e s p o n s e , [ a L i s t ] ) ; 
               r e s p o n s e   =     a p p C t x t . g e t A p p C o n t r o l l e r ( ) . s e n d R e q u e s t ( { 
                         j s o n O b j : j s o n O b j , 
                         a s y n c M o d e : t r u e , 
                         c a l l b a c k : r e s p C a l l b a c k 
                 } ) ; 
       } ; 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . h a n d l e S h a r e d C o n t a c t R e s p o n s e   = 
         f u n c t i o n ( a L i s t , r e s p o n s e )   { 
 
           v a r   c o n t a c t R e s p o n s e , 
                   c o n t a c t R e s p o n s e L e n g t h , 
                   l i s t A r r a y , 
                   l i s t A r r a y L e n g t h , 
                   s h a r e d G r o u p M e m b e r s , 
                   i , 
                   j , 
                   k , 
                   r e s p , 
                   c o n t a c t , 
                   m e m b e r , 
                   i s G a l , 
                   m e m b e r C o n t a c t , 
                   l o a d M e m b e r , 
                   l i s t A r r E l e m e n t , 
                   s h a r e d G r o u p M e m b e r s ; 
 
                 i f   ( r e s p o n s e   & &   r e s p o n s e . g e t R e s p o n s e ( )   & &   r e s p o n s e . g e t R e s p o n s e ( ) . B a t c h R e s p o n s e )   { 
                         c o n t a c t R e s p o n s e   =   r e s p o n s e . g e t R e s p o n s e ( ) . B a t c h R e s p o n s e . G e t C o n t a c t s R e s p o n s e ; 
                 } 
                 i f   ( ! c o n t a c t R e s p o n s e )   { 
                         r e t u r n ; 
                 } 
                 c o n t a c t R e s p o n s e L e n g t h   =   c o n t a c t R e s p o n s e . l e n g t h ; 
                 l i s t A r r a y   =   a L i s t . g e t A r r a y ( ) ; 
                 l i s t A r r a y L e n g t h   =   a L i s t . s i z e ( ) ; 
 
                 f o r   ( k =   0 ;   k   <   l i s t A r r a y L e n g t h ;   k + + )   { 
                         s h a r e d G r o u p M e m b e r s   =   [ ] ; 
                         f o r   ( j   =   0 ;   j   <   c o n t a c t R e s p o n s e L e n g t h ;   j + + )   { 
                                 r e s p   =   c o n t a c t R e s p o n s e [ j ] ; 
                                 c o n t a c t   =   r e s p . c n [ 0 ] ; 
 
                                 i f   ( c o n t a c t . m )   { 
                                         f o r   ( i   =   0 ;   i   <   c o n t a c t . m . l e n g t h ;   i + + )   { 
                                                 m e m b e r   =   c o n t a c t . m [ i ] ; 
                                                 i s G a l   =   f a l s e ; 
                                                 i f   ( m e m b e r . t y p e   = =   Z m C o n t a c t . G R O U P _ G A L _ R E F )   { 
                                                         i s G a l   =   t r u e ; 
                                                 } 
                                                 i f   ( m e m b e r . c n   & &   m e m b e r . c n . l e n g t h   >   0 )   { 
                                                         m e m b e r C o n t a c t   =   m e m b e r . c n [ 0 ] ; 
                                                         m e m b e r C o n t a c t . r e f   =   m e m b e r C o n t a c t . r e f   | |   ( i s G a l   & &   m e m b e r . v a l u e ) ; 
                                                         l o a d M e m b e r   =   Z m C o n t a c t . c r e a t e F r o m D o m ( m e m b e r C o n t a c t ,   { l i s t :   t h i s . l i s t ,   i s G a l :   i s G a l } ) ; 
                                                         l o a d M e m b e r . i s D L   =   i s G a l   & &   l o a d M e m b e r . a t t r [ Z m C o n t a c t . F _ t y p e ]   = = =   " g r o u p " ; 
                                                         a p p C t x t . c a c h e S e t ( m e m b e r . v a l u e ,   l o a d M e m b e r ) ; 
                                                         l i s t A r r E l e m e n t   =   l i s t A r r a y [ k ] ; 
                                                         i f   ( l i s t A r r E l e m e n t . v a l u e   = = =   c o n t a c t . i d )   { 
                                                                 s h a r e d G r o u p M e m b e r s . p u s h (   ' " ' + l o a d M e m b e r . g e t F u l l N a m e ( ) + ' " '   + '   < '   +   l o a d M e m b e r . g e t E m a i l s ( )   + ' > ; '   ) ;   / /   U p d a t i n g   t h e   o r i g i n a l   l i s t   w i t h   s h a r e d   m e m b e r s   o f   s h a r e d   c o n t a c t   g r o u p   t h a t   c o m e s   i n   ' c o n t a c t R e s p o n s e ' . 
                                                                 a L i s t . _ a r r a y [ k ] . a d d r e s s   =   s h a r e d G r o u p M e m b e r s . j o i n ( " " ) ; 
                                                         } 
                                                 } 
                                         } 
                                         Z m C o n t a c t . p r o t o t y p e . _ l o a d F r o m D o m ( c o n t a c t ) ; 
                                 } 
                         } 
                 } 
                 t h i s . _ s h o w R e s u l t s ( a L i s t ) ;   / /   A s   a s y n c   =   t r u e ,   w h e n   t h e   r e s p o n s e   h a s   c o m e ,   a g a i n   w e   r e n d e r / u p d a t e   t h e     l i s t   w i t h     c o n t a c t R e s p o n s e   s h a r e d   c o n t a c t   m e m b e r s , 
         } ; 
 
 
 / * * 
   *   e x t r a c t e d   t h i s   s o   i t   c a n   b e   u s e d   i n   Z m G r o u p V i e w   w h e r e   t h i s   i s   d i f f e r e n t . 
   *   @ p a r a m   l i s t 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ s e t R e s u l t s I n V i e w   = 
 f u n c t i o n ( l i s t )   { 
 	 t h i s . _ c h o o s e r . s e t I t e m s ( l i s t ) ; 
 } ; 
 
 / * * 
   *   e x t r a c t e d   t h i s   s o   i t   c a n   b e   u s e d   i n   Z m G r o u p V i e w   w h e r e   t h i s   i s   d i f f e r e n t . 
   *   @ p a r a m   l i s t 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ s e t N o R e s u l t s H t m l   = 
 f u n c t i o n ( l i s t )   { 
 	 t h i s . _ c h o o s e r . s o u r c e L i s t V i e w . _ s e t N o R e s u l t s H t m l ( ) ; 
 } ; 
 
 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ u p d a t e S e a r c h R o w s   = 
 f u n c t i o n ( s e a r c h F o r )   { 
 	 v a r   f i e l d I d s   =   ( s e a r c h F o r   = =   Z m C o n t a c t s A p p . S E A R C H F O R _ G A L )   ?   Z m C o n t a c t P i c k e r . S H O W _ O N _ G A L   :   Z m C o n t a c t P i c k e r . S H O W _ O N _ N O N G A L ; 
 	 f o r   ( v a r   f i e l d I d   i n   t h i s . _ s e a r c h R o w )   { 
 	 	 D w t . s e t V i s i b l e ( t h i s . _ s e a r c h R o w [ f i e l d I d ] ,   A j x U t i l . i n d e x O f ( f i e l d I d s ,   f i e l d I d ) ! = - 1 ) ; 
 	 } 
 	 f o r   ( v a r   f i e l d I d   i n   t h i s . _ s e a r c h F i e l d )   { 
 	 	 v a r   f i e l d   =   t h i s . _ s e a r c h F i e l d [ f i e l d I d ] ; 
 	 	 i f   ( t h i s . _ t a b G r o u p . c o n t a i n s ( f i e l d ) ) 
 	 	 	 t h i s . _ t a b G r o u p . r e m o v e M e m b e r ( f i e l d ) ; 
 	 } 
 	 f o r   ( v a r   i = 0 ;   i < f i e l d I d s . l e n g t h ;   i + + )   { 
 	 	 t h i s . _ t a b G r o u p . a d d M e m b e r ( t h i s . _ s e a r c h F i e l d [ f i e l d I d s [ i ] ] ) ; 
 	 } 
 
 	 t h i s . _ r e s i z e C h o o s e r ( ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ h a n d l e E r r o r S e a r c h   = 
 f u n c t i o n ( )   { 
 	 t h i s . _ s e a r c h B u t t o n . s e t E n a b l e d ( t r u e ) ; 
 	 r e t u r n   f a l s e ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ p a g e L i s t e n e r   = 
 f u n c t i o n ( e v )   { 
 	 i f   ( e v . i t e m   = =   t h i s . _ p r e v B u t t o n )   { 
 	 	 t h i s . _ e m a i l L i s t O f f s e t   - =   Z m C o n t a c t s A p p . S E A R C H F O R _ M A X ; 
 	 	 t h i s . _ e m a i l L i s t O f f s e t     =   M a t h . m a x ( 0 ,   t h i s . _ e m a i l L i s t O f f s e t ) ; 
 	 } 
 	 e l s e   { 
 	 	 t h i s . _ e m a i l L i s t O f f s e t   + =   Z m C o n t a c t s A p p . S E A R C H F O R _ M A X ; 
 	 } 
 	 t h i s . _ s h o w R e s u l t s ( ) ; 
 } ; 
 
 / * * 
   *   G e t s   a   s u b - l i s t   o f   c o n t a c t s . 
   *   
   *   @ r e t u r n 	 { A j x V e c t o r } 	 	 a   v e c t o r   o f   { Z m C o n t a c t }   o b j e c t s 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . g e t S u b L i s t   = 
 f u n c t i o n ( )   { 
 	 v a r   s i z e   =   t h i s . _ e m a i l L i s t . s i z e ( ) ; 
 
 	 v a r   e n d   =   t h i s . _ e m a i l L i s t O f f s e t   +   Z m C o n t a c t s A p p . S E A R C H F O R _ M A X ; 
 
 	 i f   ( e n d   >   s i z e )   { 
 	 	 e n d   =   s i z e ; 
 	 } 
 
 	 v a r   a   =   ( t h i s . _ e m a i l L i s t O f f s e t   <   e n d )   ?   t h i s . _ e m a i l L i s t . g e t A r r a y ( ) . s l i c e ( t h i s . _ e m a i l L i s t O f f s e t ,   e n d )   :   [ ] ; 
 	 r e t u r n   A j x V e c t o r . f r o m A r r a y ( a ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ s e a r c h T y p e L i s t e n e r   = 
 f u n c t i o n ( e v )   { 
 	 v a r   o l d V a l u e   =   e v . _ a r g s . o l d V a l u e ; 
 	 v a r   n e w V a l u e   =   e v . _ a r g s . n e w V a l u e ; 
 
 	 i f   ( o l d V a l u e   ! =   n e w V a l u e )   { 
 	 	 t h i s . _ u p d a t e S e a r c h R o w s ( n e w V a l u e ) ; 
 	 	 t h i s . _ s e a r c h B u t t o n L i s t e n e r ( ) ; 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ r e s e t S e a r c h C o l H e a d e r s   = 
 f u n c t i o n   ( )   { 
         v a r   s l v   =   t h i s . _ c h o o s e r . s o u r c e L i s t V i e w ; 
         v a r   t l v   =   t h i s . _ c h o o s e r . t a r g e t L i s t V i e w ; 
         s l v . h e a d e r C o l C r e a t e d   =   f a l s e ; 
         t l v . h e a d e r C o l C r e a t e d   =   f a l s e ; 
         v a r   i s G a l   =   t h i s . _ s e a r c h I n S e l e c t   & &   ( t h i s . _ s e a r c h I n S e l e c t . g e t V a l u e ( )   = =   Z m C o n t a c t s A p p . S E A R C H F O R _ G A L ) ; 
 
         / /   f i n d   t h e   p a r t i c i p a n t   c o l u m n 
         v a r   p a r t   =   0 ; 
         f o r   ( v a r   i   =   0 ;   i   <   s l v . _ h e a d e r L i s t . l e n g t h ;   i + + )   { 
                 v a r   f i e l d   =   s l v . _ h e a d e r L i s t [ i ] . _ f i e l d ; 
                 i f   ( f i e l d   = =   Z m I t e m . F _ N A M E )   { 
                         p a r t   =   i ; 
                 } 
                 i f   ( f i e l d   = =   Z m I t e m . F _ D E P A R T M E N T )   { 
                         s l v . _ h e a d e r L i s t [ i ] . _ v i s i b l e   =   i s G a l   & &   t h i s . _ d e t a i l e d S e a r c h ; 
                 } 
         } 
 
         v a r   s o r t a b l e   =   i s G a l   ?   n u l l   :   Z m I t e m . F _ N A M E ; 
         s l v . _ h e a d e r L i s t [ p a r t ] . _ s o r t a b l e   =   s o r t a b l e ; 
         s l v . c r e a t e H e a d e r H t m l ( s o r t a b l e ) ; 
 
         f o r   ( i   =   0 ;   i   <   t l v . _ h e a d e r L i s t . l e n g t h ;   i + + )   { 
                 i f   ( t l v . _ h e a d e r L i s t [ i ] . _ f i e l d   = =   Z m I t e m . F _ D E P A R T M E N T )   { 
                         t l v . _ h e a d e r L i s t [ i ] . _ v i s i b l e   =   i s G a l   & &   t h i s . _ d e t a i l e d S e a r c h ; 
                 } 
         } 
         t l v . c r e a t e H e a d e r H t m l ( ) ; 
 } ; 
 
 / * * 
   *   D o n e   c h o o s i n g   a d d r e s s e s ,   a d d   t h e m   t o   t h e   c o m p o s e   f o r m . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ o k B u t t o n L i s t e n e r   = 
 f u n c t i o n ( e v )   { 
 	 v a r   d a t a   =   t h i s . _ c h o o s e r . g e t I t e m s ( ) ; 
 	 D w t D i a l o g . p r o t o t y p e . _ b u t t o n L i s t e n e r . c a l l ( t h i s ,   e v ,   [ d a t a ] ) ; 
 } ; 
 
 / * * 
   *   C a l l   c u s t o m   p o p d o w n   m e t h o d . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . p r o t o t y p e . _ c a n c e l B u t t o n L i s t e n e r   = 
 f u n c t i o n ( e v )   { 
 	 D w t D i a l o g . p r o t o t y p e . _ b u t t o n L i s t e n e r . c a l l ( t h i s ,   e v ) ; 
 	 t h i s . p o p d o w n ( ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t P i c k e r . _ k e y P r e s s H d l r   = 
 f u n c t i o n ( e v )   { 
 	 v a r   s t b   =   D w t C o n t r o l . g e t T a r g e t C o n t r o l ( e v ) ; 
 	 v a r   c h a r C o d e   =   D w t K e y E v e n t . g e t C h a r C o d e ( e v ) ; 
 	 i f   ( s t b . _ k e y P r e s s C a l l b a c k   & &   ( c h a r C o d e   = =   1 3   | |   c h a r C o d e   = =   3 ) )   { 
 	 	 s t b . _ k e y P r e s s C a l l b a c k . r u n ( ) ; 
 	 	 r e t u r n   f a l s e ; 
 	 } 
 	 r e t u r n   t r u e ; 
 } ; 
 
 
 / * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * / 
 
 / * * 
   *   C r e a t e s   a   c o n t a c t   c h o o s e r . 
   *   @ c l a s s 
   *   T h i s   c l a s s   c r e a t e s   a   s p e c i a l i z e d   c h o o s e r   f o r   t h e   c o n t a c t   p i c k e r . 
   * 
   *   @ p a r a m   { D w t C o m p o s i t e } 	 p a r e n t 	 	 	 t h e   c o n t a c t   p i c k e r 
   *   @ p a r a m   { A r r a y } 	 	 b u t t o n I n f o 	 	 t r a n s f e r   b u t t o n   I D s   a n d   l a b e l s 
   *   
   *   @ e x t e n d s 	 	 D w t C h o o s e r 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r   =   f u n c t i o n ( p a r a m s )   { 
 	 D w t C h o o s e r . c a l l ( t h i s ,   p a r a m s ) ; 
 } ; 
 
 Z m C o n t a c t C h o o s e r . p r o t o t y p e   =   n e w   D w t C h o o s e r ; 
 Z m C o n t a c t C h o o s e r . p r o t o t y p e . c o n s t r u c t o r   =   Z m C o n t a c t C h o o s e r ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r . p r o t o t y p e . _ c r e a t e S o u r c e L i s t V i e w   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   n e w   Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w ( t h i s ) ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r . p r o t o t y p e . _ c r e a t e T a r g e t L i s t V i e w   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   n e w   Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w ( t h i s ,   ( t h i s . _ b u t t o n I n f o . l e n g t h   >   1 ) ) ; 
 } ; 
 
 / * * 
   *   T h e   i t e m   i s   a   A j x E m a i l A d d r e s s .   I t s   a d d r e s s   i s   u s e d   f o r   c o m p a r i s o n . 
   * 
   *   @ p a r a m   { A j x E m a i l A d d r e s s } 	 i t e m 	 a n   e m a i l   a d d r e s s 
   *   @ p a r a m   { A j x V e c t o r } 	 l i s t 	 l i s t   t o   c h e c k   i n 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r . p r o t o t y p e . _ i s D u p l i c a t e   = 
 f u n c t i o n ( i t e m ,   l i s t )   { 
 	 r e t u r n   l i s t . c o n t a i n s L i k e ( i t e m ,   i t e m . g e t A d d r e s s ) ; 
 } ; 
 
 / * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * / 
 
 / * * 
   *   C r e a t e s   a   s o u r c e   l i s t   v i e w . 
   *   @ c l a s s 
   *   T h i s   c l a s s   c r e a t e s   a   s p e c i a l i z e d   s o u r c e   l i s t   v i e w   f o r   t h e   c o n t a c t   c h o o s e r . 
   *   
   *   @ p a r a m   { D w t C o m p o s i t e } 	 p a r e n t 	 	 	 t h e   c o n t a c t   p i c k e r 
   *   
   *   @ e x t e n d s 	 	 D w t C h o o s e r L i s t V i e w 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w   =   f u n c t i o n ( p a r e n t )   { 
 	 D w t C h o o s e r L i s t V i e w . c a l l ( t h i s ,   { p a r e n t : p a r e n t ,   t y p e : D w t C h o o s e r L i s t V i e w . S O U R C E } ) ; 
 	 t h i s . s e t S c r o l l S t y l e ( D w t . C L I P ) ; 
 } ; 
 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e   =   n e w   D w t C h o o s e r L i s t V i e w ; 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . c o n s t r u c t o r   =   Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w ; 
 
 / * * 
   *   R e t u r n s   a   s t r i n g   r e p r e s e n t a t i o n   o f   t h e   o b j e c t . 
   *   
   *   @ r e t u r n 	 	 { S t r i n g } 	 	 a   s t r i n g   r e p r e s e n t a t i o n   o f   t h e   o b j e c t 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . t o S t r i n g   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   " Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w " ; 
 } ; 
 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . g e t T o o l T i p C o n t e n t   = 
 f u n c t i o n ( e v )   { 
 	 
 	 i f   ( t h i s . _ h o v e r e d I t e m )   { 
 	 	 v a r   t t P a r a m s   =   { 
 	 	 	 a d d r e s s : 	 	 t h i s . _ h o v e r e d I t e m . a d d r e s s , 
 	 	 	 c o n t a c t : 	 	 t h i s . _ h o v e r e d I t e m . _ _ c o n t a c t , 
 	 	 	 e v : 	 	 	 	 e v , 
 	 	 	 n o R i g h t C l i c k : 	 t r u e 
 	 	 } ; 
 	 	 v a r   t t C a l l b a c k   =   n e w   A j x C a l l b a c k ( t h i s , 
 	 	 	 f u n c t i o n ( c a l l b a c k )   { 
 	 	 	 	 a p p C t x t . g e t T o o l T i p M g r ( ) . g e t T o o l T i p ( Z m T o o l T i p M g r . P E R S O N ,   t t P a r a m s ,   c a l l b a c k ) ; 
 	 	 	 } ) ; 
 	 	 r e t u r n   { c a l l b a c k : t t C a l l b a c k } ; 
 	 } 
 	 e l s e   { 
 	 	 r e t u r n   " " ; 
 	 } 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . _ g e t H e a d e r L i s t   = 
 f u n c t i o n ( )   { 
 	 v a r   h e a d e r L i s t   =   [ ] ; 
 	 h e a d e r L i s t . p u s h ( n e w   D w t L i s t H e a d e r I t e m ( { f i e l d : Z m I t e m . F _ T Y P E ,   i c o n : " F o l d e r " ,   w i d t h : Z m M s g . C O L U M N _ W I D T H _ F O L D E R _ C N } ) ) ; 
 	 h e a d e r L i s t . p u s h ( n e w   D w t L i s t H e a d e r I t e m ( { f i e l d : Z m I t e m . F _ N A M E ,   t e x t : Z m M s g . _ n a m e ,   w i d t h : Z m M s g . C O L U M N _ W I D T H _ N A M E _ C N ,   r e s i z e a b l e :   t r u e } ) ) ; 
 	 h e a d e r L i s t . p u s h ( n e w   D w t L i s t H e a d e r I t e m ( { f i e l d : Z m I t e m . F _ D E P A R T M E N T ,   t e x t : Z m M s g . d e p a r t m e n t ,   w i d t h : Z m M s g . C O L U M N _ W I D T H _ D E P A R T M E N T _ C N ,   r e s i z e a b l e :   t r u e } ) ) ; 
 	 h e a d e r L i s t . p u s h ( n e w   D w t L i s t H e a d e r I t e m ( { f i e l d : Z m I t e m . F _ E M A I L ,   t e x t : Z m M s g . e m a i l ,   r e s i z e a b l e :   t r u e } ) ) ; 
 
 
 	 r e t u r n   h e a d e r L i s t ; 
 } ; 
 
   
 / /   O v e r r i d e   o f   D w t L i s t V i e w . p r o t o t y p e . _ r e s e t C o l W i d t h   t o   s e t   w i d t h ;   w i t h o u t   o v e r r r i d i n g   c a u s e s   v e r t i c a l   s c r o l l b a r s   t o   d i s a p p e r 
 / /   o n   h e a d e r   r e s i z e 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . _ r e s e t C o l W i d t h   = 
 f u n c t i o n ( )   { 
 
 	 i f   ( ! t h i s . h e a d e r C o l C r e a t e d )   {   r e t u r n ;   } 
 
 	 v a r   l a s t C o l I d x   =   t h i s . _ g e t L a s t C o l u m n I n d e x ( ) ; 
         i f   ( l a s t C o l I d x )   { 
                 v a r   l a s t C o l   =   t h i s . _ h e a d e r L i s t [ l a s t C o l I d x ] ; 
                 v a r   l a s t C e l l   =   d o c u m e n t . g e t E l e m e n t B y I d ( l a s t C o l . _ i d ) ; 
 	 	 i f   ( l a s t C e l l )   { 
 	 	 	 v a r   d i v   =   l a s t C e l l . f i r s t C h i l d ; 
 	 	 	 l a s t C e l l . s t y l e . w i d t h   =   d i v . s t y l e . w i d t h   =   ( l a s t C o l . _ w i d t h   | |   " " ) ;   
 	 	 } 
         } 
 } ; 
 
 / * * 
   *   o v e r r i d e   f o r   s c r o l l b a r s   i n   I E 
   *   @ p a r a m   h e a d e r I d x 
   * / 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . _ c a l c R e l a t i v e W i d t h   = 
 f u n c t i o n ( h e a d e r I d x )   { 
 	 v a r   c o l u m n   =   t h i s . _ h e a d e r L i s t [ h e a d e r I d x ] ; 
 	 i f   ( ! c o l u m n . _ w i d t h   | |   ( c o l u m n . _ w i d t h   & &   c o l u m n . _ w i d t h   = =   " a u t o " ) )   { 
 	 	 v a r   c e l l   =   d o c u m e n t . g e t E l e m e n t B y I d ( c o l u m n . _ i d ) ; 
 	 	 / /   U G H :   c l i e n t W i d t h   i s   5 p x   m o r e   t h a n   H T M L - w i d t h   ( 2 0 p x   f o r   I E   t o   d e a l   w i t h   s c r o l l b a r s ) 
 	 	 r e t u r n   ( c e l l )   ?   ( c e l l . c l i e n t W i d t h   -   ( A j x E n v . i s I E   ?   D w t . S C R O L L B A R _ W I D T H   :   5 ) )   :   n u l l ; 
 	 } 
 	 r e t u r n   c o l u m n . _ w i d t h ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . _ m o u s e O v e r A c t i o n   = 
 f u n c t i o n ( e v ,   d i v )   { 
 	 D w t C h o o s e r L i s t V i e w . p r o t o t y p e . _ m o u s e O v e r A c t i o n . c a l l ( t h i s ,   e v ,   d i v ) ; 
 	 v a r   i d   =   e v . t a r g e t . i d   | |   d i v . i d ; 
 	 v a r   i t e m   =   t h i s . g e t I t e m F r o m E l e m e n t ( d i v ) ; 
 	 t h i s . _ h o v e r e d I t e m   =   ( i d   & &   i t e m )   ?   i t e m   :   n u l l ; 
 	 r e t u r n   t r u e ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . _ g e t C e l l C o n t e n t s   = 
 f u n c t i o n ( h t m l ,   i d x ,   i t e m ,   f i e l d ,   c o l I d x ,   p a r a m s )   { 
 	 i f   ( f i e l d   = =   Z m I t e m . F _ E M A I L   & &   A j x E n v . i s I E )   { 
 	 	 v a r   m a x W i d t h   =   A j x S t r i n g U t i l . g e t W i d t h ( i t e m . a d d r e s s ) ; 
 	 	 h t m l [ i d x + + ]   =   " < d i v   s t y l e = ' f l o a t ;   l e f t ;   o v e r f l o w :   v i s i b l e ;   w i d t h :   "   +   m a x W i d t h   +   " ; ' > " ; 
 	 	 i d x   =   Z m C o n t a c t s H e l p e r . _ g e t E m a i l F i e l d ( h t m l ,   i d x ,   i t e m ,   f i e l d ,   c o l I d x ,   p a r a m s ) ; 
 	 	 h t m l [ i d x + + ]   =   " < / d i v > " ; 	 	 
 	 } 
 	 e l s e   { 
 	 	 i d x   =   Z m C o n t a c t s H e l p e r . _ g e t E m a i l F i e l d ( h t m l ,   i d x ,   i t e m ,   f i e l d ,   c o l I d x ,   p a r a m s ) ; 
 	 } 
 	 r e t u r n   i d x ; 
 } ; 
 
 / * * 
   *   R e t u r n s   a   s t r i n g   o f   a n y   e x t r a   a t t r i b u t e s   t o   b e   u s e d   f o r   t h e   T D . 
   * 
   *   @ p a r a m   i t e m 	 	 [ o b j e c t ] 	 i t e m   t o   r e n d e r 
   *   @ p a r a m   f i e l d 	 	 [ c o n s t a n t ] 	 c o l u m n   i d e n t i f i e r 
   *   @ p a r a m   p a r a m s 	 [ h a s h ] * 	 	 h a s h   o f   o p t i o n a l   p a r a m s 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . _ g e t C e l l A t t r T e x t   = 
 f u n c t i o n ( i t e m ,   f i e l d ,   p a r a m s )   { 
 	 i f   ( f i e l d   = =   Z m I t e m . F _ E M A I L )   { 
 	 	 r e t u r n   " s t y l e = ' p o s i t i o n :   r e l a t i v e ;   o v e r f l o w :   v i s i b l e ; ' " ; 
 	 } 
 } ; 
 
 / * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * / 
 
 / * * 
   *   C r e a t e s   t h e   t a r g e t   l i s t   v i e w . 
   *   @ c l a s s 
   *   T h i s   c l a s s   c r e a t e s   a   s p e c i a l i z e d   t a r g e t   l i s t   v i e w   f o r   t h e   c o n t a c t   c h o o s e r . 
   *   
   *   @ p a r a m   { D w t C o m p o s i t e } 	 p a r e n t 	 	 	 t h e   c o n t a c t   p i c k e r 
   *   @ p a r a m   { c o n s t a n t } 	 	 s h o w T y p e 	 	 t h e   s h o w   t y p e 
   *   @ e x t e n d s 	 	 D w t C h o o s e r L i s t V i e w 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w   =   f u n c t i o n ( p a r e n t ,   s h o w T y p e )   { 
 	 t h i s . _ s h o w T y p e   =   s h o w T y p e ;   / /   c a l l   b e f o r e   b a s e   c l a s s   s i n c e   b a s e   c a l l s   g e t H e a d e r L i s t 
 
 	 D w t C h o o s e r L i s t V i e w . c a l l ( t h i s ,   { p a r e n t : p a r e n t ,   t y p e : D w t C h o o s e r L i s t V i e w . T A R G E T } ) ; 
 
 	 t h i s . s e t S c r o l l S t y l e ( D w t . C L I P ) ; 
 } ; 
 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e   =   n e w   D w t C h o o s e r L i s t V i e w ; 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e . c o n s t r u c t o r   =   Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w ; 
 
 / * * 
   *   R e t u r n s   a   s t r i n g   r e p r e s e n t a t i o n   o f   t h e   o b j e c t . 
   *   
   *   @ r e t u r n 	 	 { S t r i n g } 	 	 a   s t r i n g   r e p r e s e n t a t i o n   o f   t h e   o b j e c t 
   * / 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e . t o S t r i n g   = 
 f u n c t i o n ( )   { 
 	 r e t u r n   " Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w " ; 
 } ; 
 
 / * * 
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e . _ g e t H e a d e r L i s t   = 
 f u n c t i o n ( )   { 
 	 v a r   h e a d e r L i s t   =   [ ] ; 
 	 v a r   v i e w   =   t h i s . _ v i e w ; 
 	 i f   ( t h i s . _ s h o w T y p e )   { 
 	 	 h e a d e r L i s t . p u s h ( n e w   D w t L i s t H e a d e r I t e m ( { f i e l d : Z m I t e m . F _ T Y P E ,   i c o n : " C o n t a c t s P i c k e r " ,   w i d t h : Z m M s g . C O L U M N _ W I D T H _ T Y P E _ C N } ) ) ; 
 	 } 
 	 h e a d e r L i s t . p u s h ( n e w   D w t L i s t H e a d e r I t e m ( { f i e l d : Z m I t e m . F _ N A M E ,   t e x t : Z m M s g . _ n a m e ,   w i d t h : Z m M s g . C O L U M N _ W I D T H _ N A M E _ C N ,   r e s i z e a b l e :   t r u e } ) ) ; 
         h e a d e r L i s t . p u s h ( n e w   D w t L i s t H e a d e r I t e m ( { f i e l d : Z m I t e m . F _ D E P A R T M E N T ,   t e x t : Z m M s g . d e p a r t m e n t ,   w i d t h : Z m M s g . C O L U M N _ W I D T H _ D E P A R T M E N T _ C N ,   r e s i z e a b l e :   t r u e } ) ) ; 
         h e a d e r L i s t . p u s h ( n e w   D w t L i s t H e a d e r I t e m ( { f i e l d : Z m I t e m . F _ E M A I L ,   t e x t : Z m M s g . e m a i l ,   r e s i z e a b l e :   t r u e } ) ) ; 
 
 	 r e t u r n   h e a d e r L i s t ; 
 } ; 
 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e . _ m o u s e O v e r A c t i o n   = 
 Z m C o n t a c t C h o o s e r S o u r c e L i s t V i e w . p r o t o t y p e . _ m o u s e O v e r A c t i o n ; 
 
 / * * 
   *   T h e   i t e m s   a r e   A j x E m a i l A d d r e s s   o b j e c t s . 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e . _ g e t C e l l C o n t e n t s   = 
 f u n c t i o n ( h t m l ,   i d x ,   i t e m ,   f i e l d ,   c o l I d x ,   p a r a m s )   { 
 	 i f   ( f i e l d   = =   Z m I t e m . F _ T Y P E )   { 
 	 	 i t e m . s e t T y p e ( i t e m . _ b u t t o n I d ) ; 
 	 	 h t m l [ i d x + + ]   =   Z m M s g [ i t e m . g e t T y p e A s S t r i n g ( ) ] ; 
 	 	 h t m l [ i d x + + ]   =   " : " ; 
 	 } 
 	 e l s e   i f   ( f i e l d   = =   Z m I t e m . F _ E M A I L   & &   A j x E n v . i s I E )   { 
 	 	 v a r   m a x W i d t h   =   A j x S t r i n g U t i l . g e t W i d t h ( i t e m . a d d r e s s )   +   1 0 ; 
 	 	 h t m l [ i d x + + ]   =   " < d i v   s t y l e = ' f l o a t ;   l e f t ;     w i d t h :   "   +   m a x W i d t h   +   " ; ' > " ; 
 	 	 i d x   =   Z m C o n t a c t s H e l p e r . _ g e t E m a i l F i e l d ( h t m l ,   i d x ,   i t e m ,   f i e l d ,   c o l I d x ,   p a r a m s ) ; 
 	 	 h t m l [ i d x + + ]   =   " < / d i v > " ; 
 	 } 
 	 e l s e   { 
 	 	 i d x   =   Z m C o n t a c t s H e l p e r . _ g e t E m a i l F i e l d ( h t m l ,   i d x ,   i t e m ,   f i e l d ,   c o l I d x ) ; 
 	 } 
 	 r e t u r n   i d x ; 
 } ; 
 
 
 / /   O v e r r i d e   o f   D w t L i s t V i e w . p r o t o t y p e . _ r e s e t C o l W i d t h   t o   s e t   w i d t h ;   w i t h o u t   o v e r r r i d i n g   c a u s e s   v e r t i c a l   s c r o l l b a r s   t o   d i s a p p e r 
 / /   o n   h e a d e r   r e s i z e 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e . _ r e s e t C o l W i d t h   = 
 f u n c t i o n ( )   { 
 
 	 i f   ( ! t h i s . h e a d e r C o l C r e a t e d )   {   r e t u r n ;   } 
 
 	 v a r   l a s t C o l I d x   =   t h i s . _ g e t L a s t C o l u m n I n d e x ( ) ; 
 
 	 
         i f   ( l a s t C o l I d x )   { 
                 v a r   l a s t C o l   =   t h i s . _ h e a d e r L i s t [ l a s t C o l I d x ] ; 
                 v a r   l a s t C e l l   =   d o c u m e n t . g e t E l e m e n t B y I d ( l a s t C o l . _ i d ) ; 
 	 	 i f   ( l a s t C e l l )   { 
 	 	 	 v a r   d i v   =   l a s t C e l l . f i r s t C h i l d ; 
 	 	 	 l a s t C e l l . s t y l e . w i d t h   =   d i v . s t y l e . w i d t h   =   ( l a s t C o l . _ w i d t h   | |   " " ) ; 
 	 	 } 
         } 
 } ; 
 
 / * * 
   *   o v e r r i d e   f o r   s c r o l l b a r s   i n   I E 
   *   @ p a r a m   h e a d e r I d x 
   * / 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e . _ c a l c R e l a t i v e W i d t h   = 
 f u n c t i o n ( h e a d e r I d x )   { 
 	 v a r   c o l u m n   =   t h i s . _ h e a d e r L i s t [ h e a d e r I d x ] ; 
 	 i f   ( ! c o l u m n . _ w i d t h   | |   ( c o l u m n . _ w i d t h   & &   c o l u m n . _ w i d t h   = =   " a u t o " ) )   { 
 	 	 v a r   c e l l   =   d o c u m e n t . g e t E l e m e n t B y I d ( c o l u m n . _ i d ) ; 
 	 	 / /   U G H :   c l i e n t W i d t h   i s   5 p x   m o r e   t h a n   H T M L - w i d t h   ( 2 0 p x   f o r   I E   t o   d e a l   w i t h   s c r o l l b a r s ) 
 	 	 r e t u r n   ( c e l l )   ?   ( c e l l . c l i e n t W i d t h   -   ( A j x E n v . i s I E   ?   D w t . S C R O L L B A R _ W I D T H   :   5 ) )   :   n u l l ; 
 	 } 
 	 r e t u r n   c o l u m n . _ w i d t h ; 
 } ; 
 
 / * * 
   *   R e t u r n s   a   s t r i n g   o f   a n y   e x t r a   a t t r i b u t e s   t o   b e   u s e d   f o r   t h e   T D . 
   * 
   *   @ p a r a m   i t e m 	 	 [ o b j e c t ] 	 i t e m   t o   r e n d e r 
   *   @ p a r a m   f i e l d 	 	 [ c o n s t a n t ] 	 c o l u m n   i d e n t i f i e r 
   *   @ p a r a m   p a r a m s 	 [ h a s h ] * 	 	 h a s h   o f   o p t i o n a l   p a r a m s 
   *   
   *   @ p r i v a t e 
   * / 
 Z m C o n t a c t C h o o s e r T a r g e t L i s t V i e w . p r o t o t y p e . _ g e t C e l l A t t r T e x t   = 
 f u n c t i o n ( i t e m ,   f i e l d ,   p a r a m s )   { 
 	 i f   ( f i e l d   = =   Z m I t e m . F _ E M A I L )   { 
 	 	 r e t u r n   " s t y l e = ' p o s i t i o n :   r e l a t i v e ;   o v e r f l o w :   v i s i b l e ; ' " ; 
 	 } 
 } ; 
 } 
 } 
 i f   ( A j x P a c k a g e . d e f i n e ( " a b o o k . C o n t a c t s " ) )   { 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ D E B U G ' > < / d i v > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   v a l i g n = ' t o p '   w i d t h = ' 1 0 0 % ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " # Z m E d i t C o n t a c t V i e w _ h e a d e r " ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " # Z m E d i t C o n t a c t V i e w _ b o d y " ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w " 
 } ,   f a l s e ) ; 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s " ,   A j x T e m p l a t e . g e t T e m p l a t e ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w " ) ,   A j x T e m p l a t e . g e t P a r a m s ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w " ) ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w _ h e a d e r " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t r   v a l i g n = ' t o p '   c l a s s = ' c o n t a c t H e a d e r R o w ' > < t d   c l a s s = ' c o n t a c t H e a d e r C e l l '   a l i g n = ' c e n t e r ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ I M A G E '   t a b i n d e x = ' 1 0 0 ' > < / d i v > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ R E M O V E _ I M A G E _ r o w '   s t y l e = ' p a d d i n g - l e f t : 7 p x ; f o n t - s i z e : . 8 e m ; w h i t e - s p a c e : n o w r a p ; ' > < a   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ V I E W _ I M A G E '   h r e f = ' # v i e w '   t a b i n d e x = ' 1 0 1 ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . v i e w ; 
 	 b u f f e r [ _ i + + ]   =   " < / a > \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t \ t | \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t \ t < a   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ R E M O V E _ I M A G E '   h r e f = ' # r e m o v e '   t a b i n d e x = ' 1 0 2 ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . r e m o v e ; 
 	 b u f f e r [ _ i + + ]   =   " < / a > < / d i v > < / t d > < t d   c l a s s = ' c o n t a c t H e a d e r C e l l '   v a l i g n = ' b o t t o m ' > < d i v   s t y l e = ' p a d d i n g : . 1 2 5 e m ; ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ F U L L N A M E ' > < / d i v > < / d i v > " ; 
 	   i f   ( a p p C t x t . g e t ( Z m S e t t i n g . T A G G I N G _ E N A B L E D ) )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ T A G '   c l a s s = ' c o n t a c t H e a d e r C e l l R o w ' > < / d i v > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " # Z m E d i t C o n t a c t V i e w _ h e a d e r N a m e " ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " # Z m E d i t C o n t a c t V i e w _ h e a d e r J o b I n f o " ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' c o n t a c t H e a d e r C e l l ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < t d   s t y l e = ' t e x t - a l i g n : r i g h t ; w h i t e - s p a c e : n o w r a p ; ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . f i l e A s L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ F I L E _ A S '   t a b i n d e x = ' 4 0 0 ' > < / d i v > < / t d > < / t r > < t r > < t d   s t y l e = ' t e x t - a l i g n : r i g h t ; w h i t e - s p a c e : n o w r a p ; ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . l o c a t i o n L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ F O L D E R '   t a b i n d e x = ' 4 0 1 ' > < / d i v > < / t d > < / t r > " ; 
 	   i f   ( a p p C t x t . m u l t i A c c o u n t s )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r > < t d   s t y l e = ' t e x t - a l i g n : r i g h t ; ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . a c c o u n t L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ A C C O U N T '   t a b i n d e x = ' 4 0 2 ' > < / d i v > < / t d > < / t r > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > < / t d > < / t r > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w _ h e a d e r " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w _ h e a d e r N a m e " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ N A M E _ r o w '   c l a s s = ' c o n t a c t H e a d e r C e l l R o w ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > " ; 
 	   i f   ( a p p C t x t . g e t ( Z m S e t t i n g . P H O N E T I C _ C O N T A C T _ F I E L D S ) )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ r o w ' > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ P R E F I X '   c l a s s = ' i n l i n e I n p u t ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ F I R S T _ r o w '   c l a s s = ' i n l i n e I n p u t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ F I R S T '   t a b i n d e x = ' 1 9 0 ' > < / d i v > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ M I D D L E '   c l a s s = ' i n l i n e I n p u t ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ M A I D E N '   c l a s s = ' i n l i n e I n p u t ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ L A S T _ r o w '   c l a s s = ' i n l i n e I n p u t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ L A S T '   t a b i n d e x = ' 1 9 1 ' > < / d i v > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ S U F F I X '   c l a s s = ' i n l i n e I n p u t ' > < / t d > < / t r > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < t r > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P R E F I X _ r o w '   c l a s s = ' i n l i n e I n p u t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P R E F I X '   t a b i n d e x = ' 2 0 0 ' > < / d i v > < / t d > < t d   c l a s s = ' i n l i n e I n p u t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ F I R S T '   t a b i n d e x = ' 2 0 1 ' > < / d i v > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ M I D D L E _ r o w '   c l a s s = ' i n l i n e I n p u t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ M I D D L E '   t a b i n d e x = ' 2 0 2 ' > < / d i v > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ M A I D E N _ r o w '   c l a s s = ' i n l i n e I n p u t ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > < t r > < t d   c l a s s = ' i n l i n e I n p u t W r a p p e r ' > ( < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ M A I D E N '   t a b i n d e x = ' 2 0 3 ' > < / d i v > < / t d > < t d   c l a s s = ' i n l i n e I n p u t W r a p p e r ' > ) < / t d > < / t r > < / t a b l e > < / t d > < t d   c l a s s = ' i n l i n e I n p u t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ L A S T '   t a b i n d e x = ' 2 0 4 ' > < / d i v > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ S U F F I X _ r o w '   c l a s s = ' i n l i n e I n p u t ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > < t r > < t d   c l a s s = ' i n l i n e I n p u t W r a p p e r ' > , < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ S U F F I X '   t a b i n d e x = ' 2 0 5 ' > < / d i v > < / t d > < / t r > < / t a b l e > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ D E T A I L S '   t a b i n d e x = ' 2 0 6 ' > < / d i v > < / t d > < / t r > < / t a b l e > < / d i v > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ N I C K N A M E _ r o w '   c l a s s = ' c o n t a c t H e a d e r C e l l R o w ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > < t r > < t d   c l a s s = ' i n l i n e I n p u t W r a p p e r ' > & l d q u o ; < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ N I C K N A M E '   t a b i n d e x = ' 2 5 0 ' > < / d i v > < / t d > < t d   c l a s s = ' i n l i n e I n p u t W r a p p e r ' > & r d q u o ; < / t d > < / t r > < / t a b l e > < / d i v > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w _ h e a d e r N a m e " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w _ h e a d e r J o b I n f o " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ J O B _ r o w '   c l a s s = ' c o n t a c t H e a d e r C e l l R o w ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > < t r > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ T I T L E _ r o w '   c l a s s = ' i n l i n e I n p u t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ T I T L E '   t a b i n d e x = ' 3 0 1 ' > < / d i v > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ T I T L E _ D E P A R T M E N T _ S E P '   c l a s s = ' i n l i n e I n p u t W r a p p e r ' > & n d a s h ; < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ D E P A R T M E N T _ r o w '   c l a s s = ' i n l i n e I n p u t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ D E P A R T M E N T '   t a b i n d e x = ' 3 0 2 ' > < / d i v > < / t d > < / t r > < / t a b l e > < / d i v > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ C O M P A N Y _ r o w '   c l a s s = ' c o n t a c t H e a d e r C e l l R o w ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > " ; 
 	   i f   ( a p p C t x t . g e t ( Z m S e t t i n g . P H O N E T I C _ C O N T A C T _ F I E L D S ) )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ C O M P A N Y _ r o w ' > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E T I C _ C O M P A N Y '   t a b i n d e x = ' 3 0 4 ' > < / d i v > < / t d > < / t r > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < t r > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ C O M P A N Y '   t a b i n d e x = ' 3 0 5 ' > < / d i v > < / t d > < / t r > < / t a b l e > < / d i v > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w _ h e a d e r J o b I n f o " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w _ b o d y " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t r > < t d   c l a s s = r o w L a b e l > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . e m a i l L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = r o w V a l u e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ E M A I L '   t a b i n d e x = ' 5 0 0 ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = r o w L a b e l > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . p h o n e L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = r o w V a l u e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ P H O N E '   t a b i n d e x = ' 6 0 0 ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = r o w L a b e l > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . i m L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = r o w V a l u e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ I M '   t a b i n d e x = ' 7 0 0 ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = r o w L a b e l > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . a d d r e s s L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = r o w V a l u e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ A D D R E S S '   t a b i n d e x = ' 8 0 0 ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = r o w L a b e l > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . u r l L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = r o w V a l u e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ U R L '   t a b i n d e x = ' 9 0 0 ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = r o w L a b e l > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . o t h e r L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = r o w V a l u e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ O T H E R '   t a b i n d e x = ' 1 0 0 0 ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = r o w L a b e l > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . n o t e s L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = r o w V a l u e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ N O T E S '   t a b i n d e x = ' 1 1 0 0 ' > < / d i v > < / t d > < / t r > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w _ b o d y " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w R o w s " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > < t b o d y   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ r o w s '   t a b i n d e x = ' 1 0 0 ' > < / t b o d y > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w R o w s " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w D e t a i l s B u t t o n " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < s p a n   c l a s s = ' S c r e e n R e a d e r O n l y ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . c h o o s e F i e l d s   ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > < s p a n   a r i a - h i d d e n = ' t r u e '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ t i t l e '   c l a s s = ' Z B u t t o n B o r d e r   Z W i d g e t T i t l e ' > < / s p a n > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w D e t a i l s B u t t o n " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w I n p u t S e l e c t " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' i n p u t T a b l e ' > < t r > < t d   c l a s s = ' i n p u t E l e m e n t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ i n p u t '   t a b i n d e x = ' 1 0 0 ' > < / d i v > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e l e c t '   t a b i n d e x = ' 2 0 0 ' > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w I n p u t S e l e c t " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w I n p u t D o u b l e S e l e c t " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' i n p u t T a b l e ' > < t r > < t d   c l a s s = ' i n p u t E l e m e n t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ i n p u t '   t a b i n d e x = ' 1 0 0 ' > < / d i v > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e l e c t '   t a b i n d e x = ' 2 0 0 ' > < / d i v > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e l e c t 2 '   t a b i n d e x = ' 3 0 0 ' > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w I n p u t D o u b l e S e l e c t " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w O t h e r " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' i n p u t T a b l e ' > < t r > < t d   c l a s s = ' i n p u t E l e m e n t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ i n p u t '   t a b i n d e x = ' 1 0 0 ' > < / d i v > < / t d > < t d   c l a s s = ' i n p u t E l e m e n t '   s t y l e = ' w i d t h : 4 7 p x ; ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ p i c k e r '   t a b i n d e x = ' 2 0 0 ' > < / d i v > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e l e c t '   t a b i n d e x = ' 3 0 0 ' > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w O t h e r " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w A d d r e s s R o w " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' i n p u t T a b l e ' > < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ r o w '   c l a s s = ' D w t F o r m R o w '   v a l i g n = ' t o p ' > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " '   t a b i n d e x = ' 1 0 0 ' > < / d i v > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ a d d '   c l a s s = ' D w t F o r m R o w A d d '   t a b i n d e x = ' 2 0 0 ' > < / d i v > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ r e m o v e '   c l a s s = ' D w t F o r m R o w R e m o v e '   t a b i n d e x = ' 3 0 0 ' > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w A d d r e s s R o w " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w A d d r e s s S e l e c t " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' i n p u t T a b l e ' > < t r   v a l i g n = ' t o p ' > < t d   c l a s s = ' i n p u t E l e m e n t ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ i n p u t '   t a b i n d e x = ' 1 0 0 '   s t y l e = \ " p a d d i n g : 1 p x   3 p x ; \ " > < / d i v > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e l e c t '   t a b i n d e x = ' 2 0 0 ' > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w A d d r e s s S e l e c t " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w A d d r e s s " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' a d d r e s s T a b l e '   w i d t h = ' 1 0 0 % ' > < t r > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ S T R E E T '   t a b i n d e x = ' 1 0 0 ' > < / d i v > < / t d > < / t r > < / t a b l e > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' a d d r e s s T a b l e '   w i d t h = ' 1 0 0 % '   s t y l e = ' m a r g i n - b o t t o m : 3 p x ; ' > < t r > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ C I T Y '   t a b i n d e x = ' 2 0 0 ' > < / d i v > < / t d > < t d > , & n b s p ; < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ S T A T E '   t a b i n d e x = ' 3 0 0 ' > < / d i v > < / t d > < t d > & n b s p ; & n b s p ; < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ Z I P '   t a b i n d e x = ' 4 0 0 ' > < / d i v > < / t d > < / t r > < / t a b l e > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' a d d r e s s T a b l e '   w i d t h = ' 1 0 0 % ' > < t r > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ C O U N T R Y '   t a b i n d e x = ' 5 0 0 ' > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m E d i t C o n t a c t V i e w A d d r e s s " , 
 	 " c l a s s " :   " D w t F o r m   Z m E d i t C o n t a c t V i e w A d d r e s s " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % '   h e i g h t = ' 1 0 0 % '   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < c o l   w i d t h = ' 2 3 0 ' > < / c o l > < t r > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ a l p h a b e t b a r ' > < / t d > < / t r > < t r   h e i g h t = ' 1 0 0 % ' > < t d   v a l i g n = ' t o p ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s p l i t v i e w '   s t y l e = ' p o s i t i o n : r e l a t i v e ; w i d t h : 1 0 0 % ; h e i g h t : 1 0 0 % ; ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l i s t v i e w '   s t y l e = ' p o s i t i o n : a b s o l u t e ; w i d t h : 2 3 0 p x ; h e i g h t : 1 0 0 % ; l e f t : 0 ; ' > < / d i v > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s a s h '   s t y l e = ' p o s i t i o n : a b s o l u t e ; w i d t h : 8 p x ; h e i g h t : 1 0 0 % ; l e f t : 2 3 0 p x ; ' > < / d i v > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ c o n t e n t C e l l '   s t y l e = ' p o s i t i o n : a b s o l u t e ; l e f t : 2 3 8 p x ; ' > < d i v   c l a s s = ' Z m C o n t a c t I n f o V i e w '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ c o n t e n t ' > < / d i v > < / d i v > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ c o n t e n t " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d e t a i l s '   c l a s s = ' c o n t a c t C o n t e n t T a b l e ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r " ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t E m a i l s ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t P h o n e s ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t I M s ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t A d d r e s s e s ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t U r l s ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t O t h e r ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t N o t e s ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t D L M e m b e r s ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ c o n t e n t " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ g r o u p " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 
 	 	 	 v a r   i m a g e U r l   =   d a t a . i m a g e U r l ; 
 	 	 	 v a r   d e f a u l t I m a g e U r l   =   d a t a . d e f a u l t I m a g e U r l ; 
 	 	 	 v a r   e m a i l   =   d a t a . e m a i l ; 
 	 	 	 v a r   t i t l e   =   d a t a . t i t l e ; 
 	 	 	 v a r   f u l l N a m e   =   d a t a . f u l l N a m e ; 
 	 	 	 v a r   p h o n e   =   d a t a . p h o n e ; 
 	 	 	 v a r   l o c a t i o n   =   d a t a . l o c a t i o n ; 
 	 	 	 v a r   i m g C l a s s N a m e   =   d a t a . i m g C l a s s N a m e   | |   " P e r s o n _ 4 8 " ; 
 	 	 	 v a r   q u i c k A d d   =   " i d = ' "   +   d a t a . q u i c k A d d I d   +   " ' " ; 
 	 	 	 v a r   i s E d i t   =   d a t a . i s E d i t ; 
 	 	 	 v a r   d e l I d   =   " i d = ' "   +   d a t a . d e l B u t t o n I d   +   " ' " ; 
 	 	 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' c o n t a c t G r o u p T a b l e ' > < t r > " ; 
 	   i f   ( i m a g e U r l )   {   
 	 b u f f e r [ _ i + + ]   =   " < t d   c l a s s = ' c o n t a c t G r o u p T a b l e I m a g e '   w i d t h = ' 4 8 ' > < i m g   s r c = ' " ; 
 	 b u f f e r [ _ i + + ]   =     i m a g e U r l   ; 
 	 b u f f e r [ _ i + + ]   =   " ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t " ; 
 	   i f   ( A j x E n v . i s I E )   {   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t h e i g h t = ' 4 8 ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t " ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t s t y l e = ' m a x - w i d t h : 4 8 p x ; m a x - h e i g h t : 4 8 p x ; ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t " ; 
 	   }   
 	   i f   ( d e f a u l t I m a g e U r l )   {   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t o n e r r o r = ' t h i s . o n e r r o r = n u l l ; t h i s . s r c = \ " " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " d e f a u l t I m a g e U r l " ] ; 
 	 b u f f e r [ _ i + + ]   =   " \ " ; ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t b o r d e r = ' 0 ' > < / t d > " ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " < t d   c l a s s = ' c o n t a c t G r o u p T a b l e I m a g e '   w i d t h = ' 4 8 ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x I m g . g e t I m a g e H t m l ( i m g C l a s s N a m e )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < t d   c l a s s = ' c o n t a c t G r o u p T a b l e C o n t e n t ' > " ; 
 	   i f   ( f u l l N a m e )   { 
 	 b u f f e r [ _ i + + ]   =   " < d i v > < s t r o n g > " ; 
 	 b u f f e r [ _ i + + ]   =   f u l l N a m e ; 
 	 b u f f e r [ _ i + + ]   =   " < / s t r o n g > < / d i v > " ; 
 	   }   
 	   i f   ( t i t l e )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v > < s p a n > " ; 
 	 b u f f e r [ _ i + + ]   =   t i t l e ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > < / d i v > " ; 
 	 } 
 	   i f   ( e m a i l )   { 
 	 b u f f e r [ _ i + + ]   =   " < d i v > " ; 
 	 b u f f e r [ _ i + + ]   =   e m a i l ; 
 	   i f   ( d a t a . i s I n l i n e )   { 
 	 b u f f e r [ _ i + + ]   =   A j x I m g . g e t I m a g e H t m l ( " P l u s " ,   " " ,   q u i c k A d d ) ; 
 	   } 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	 } 
 	   i f   ( p h o n e )   { 
 	 b u f f e r [ _ i + + ]   =   " < d i v > " ; 
 	 b u f f e r [ _ i + + ]   =   p h o n e ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	 } 
 	   i f   ( l o c a t i o n )   { 
 	 b u f f e r [ _ i + + ]   =   " < d i v > " ; 
 	 b u f f e r [ _ i + + ]   =   l o c a t i o n ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	 } 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 	   i f   ( i s E d i t )   { 
 	 b u f f e r [ _ i + + ]   =   " < t d   w i d t h = ' 3 6 '   v a l i g n = ' t o p ' > " ; 
 	 b u f f e r [ _ i + + ]   =   A j x I m g . g e t I m a g e H t m l ( " D e l e t e " ,   " " ,   d e l I d ) ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 	 } 
 	 b u f f e r [ _ i + + ]   =   " < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ g r o u p " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 
 	 	 	 v a r   c o n t a c t   =   d a t a . c o n t a c t ; 
 	 	 	 v a r   i m a g e U r l   =   c o n t a c t . g e t I m a g e U r l ( ) ; 
 	 	 	 v a r   i m a g e L a b e l   =   c o n t a c t . i s D i s t r i b u t i o n L i s t ( )   ?   Z m M s g . d i s t r i b u t i o n L i s t   :   c o n t a c t . i s G r o u p ( )   ?   Z m M s g . g r o u p   :   Z m M s g . c o n t a c t ; 
 	 	 	 v a r   d e f a u l t I m a g e U r l   =   d a t a . d e f a u l t I m a g e U r l ; 
 	 	 	 v a r   a c c o u n t N a m e   =   a p p C t x t . m u l t i A c c o u n t s   & &   c o n t a c t . a c c o u n t   & &   c o n t a c t . a c c o u n t . g e t D i s p l a y N a m e ( ) ; 
 	 	 	 v a r   t a g s I d   =   d a t a . i d   +   ' _ t a g s _ c o n t a c t ' ;   
 	 	 	 v a r   i m g C l a s s N a m e   =   c o n t a c t . i s D i s t r i b u t i o n L i s t ( )   ?   ' G r o u p _ 4 8 '   :   c o n t a c t . i s G r o u p ( )   ?   ' G r o u p P e r s o n _ 4 8 '   :   ' P e r s o n _ 4 8 ' ; 
 	 	 	 v a r   i s E d i t   =   d a t a . i s E d i t ; 
 	 	 
 	 b u f f e r [ _ i + + ]   =   " < t r   c l a s s = ' h e a d e r R o w '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ h e a d e r R o w ' > " ; 
 	   i f   ( i m a g e U r l )   {   
 	 b u f f e r [ _ i + + ]   =   " < t d   c l a s s = ' r o w L a b e l ' > < d i v   c l a s s = ' h e a d e r R o w I m a g e ' > < i m g   s r c = ' " ; 
 	 b u f f e r [ _ i + + ]   =     i m a g e U r l   ; 
 	 b u f f e r [ _ i + + ]   =   " ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t " ; 
 	   i f   ( A j x E n v . i s I E )   {   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t \ t h e i g h t = ' 4 8 ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t " ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t \ t s t y l e = ' m a x - w i d t h : 4 8 p x ; m a x - h e i g h t : 4 8 p x ; ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t " ; 
 	   }   
 	   i f   ( d e f a u l t I m a g e U r l )   {   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t \ t o n e r r o r = ' t h i s . o n e r r o r = n u l l ; t h i s . s r c = \ " " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " d e f a u l t I m a g e U r l " ] ; 
 	 b u f f e r [ _ i + + ]   =   " \ " ; ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t \ t b o r d e r = 0   a l t = ' " ; 
 	 b u f f e r [ _ i + + ]   =     i m a g e L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " ' > < / d i v > < / t d > " ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " < t d   c l a s s = ' r o w L a b e l ' > < d i v   c l a s s = ' h e a d e r R o w I m a g e ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x I m g . g e t I m a g e H t m l ( { 
 	 	 	 	 	 	 	 i m a g e N a m e :   i m g C l a s s N a m e ,   a l t T e x t :   i m a g e L a b e l 
 	 	 	 	 	 	 } )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > < / t d > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < t d   c l a s s = ' r o w V a l u e ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " # S p l i t V i e w _ h e a d e r N a m e " ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " # S p l i t V i e w _ h e a d e r J o b I n f o " ,   d a t a )   ; 
 	   i f   ( d a t a . d l I n f o   & &   d a t a . d l I n f o . d e s c r i p t i o n )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . d l I n f o . d e s c r i p t i o n )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	   }   
 	   i f   ( ! i s E d i t )   { 
 	 b u f f e r [ _ i + + ]   =   " < d i v   c l a s s = ' c o n t a c t H e a d e r T a g s '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =     t a g s I d   ; 
 	 b u f f e r [ _ i + + ]   =   " ' > < / d i v > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w T y p e '   v a l i g n = ' t o p ' > " ; 
 	   i f   ( a c c o u n t N a m e )   {   
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < t d   c l a s s = ' c o n t a c t L o c a t i o n ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . a c c o u n t L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' c o m p a n y F o l d e r ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( a c c o u n t N a m e )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > < / t a b l e > " ; 
 	   }   
 	   i f   ( ! i s E d i t )   {   
 	   i f   ( d a t a . a d d r b o o k )   {   
 	 b u f f e r [ _ i + + ]   =     A j x I m g . g e t I m a g e H t m l ( { 
 	 	 	 	 	 	 	 	 i m a g e N a m e :   d a t a . a d d r b o o k . g e t I c o n W i t h C o l o r ( ) , 
 	 	 	 	 	 	 	 	 a l t T e x t :   Z m M s g . l o c a t i o n L a b e l 
 	 	 	 	 	 	 	 } )   ; 
 	 b u f f e r [ _ i + + ]   =   " & n b s p ; " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . a d d r b o o k . g e t N a m e ( )   ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =     A j x I m g . g e t I m a g e H t m l ( ' G A L ' )   ; 
 	 b u f f e r [ _ i + + ]   =   " & n b s p ; " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . G A L   ; 
 	   }   
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l o c a t i o n L a b e l '   c l a s s = ' c o n t a c t L o c a t i o n ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . l o c a t i o n L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ L O C A T I O N _ F O L D E R ' > < / t d > < / t r > < / t a b l e > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r N a m e " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 
 	 	 	 v a r   c o n t a c t   =   d a t a . c o n t a c t ; 
 	 	 	 v a r   i s P h o n e t i c   =   a p p C t x t . g e t ( Z m S e t t i n g . P H O N E T I C _ C O N T A C T _ F I E L D S ) ; 
 	 	 	 v a r   f u l l n a m e H t m l   =   c o n t a c t . g e t F u l l N a m e F o r D i s p l a y ( i s P h o n e t i c ) ; 
 	 	 	 i f   ( ! i s P h o n e t i c )   { 
 	 	 	 	 f u l l n a m e H t m l   =   A j x S t r i n g U t i l . h t m l E n c o d e ( f u l l n a m e H t m l ) ; 
 	 	 	 } 
 	 	 	 v a r   n i c k n a m e   =   c o n t a c t . g e t A t t r ( Z m C o n t a c t . F _ n i c k n a m e ) ; 
 	 	 	 v a r   i s E d i t   =   d a t a . i s E d i t ; 
 	 	 	 i f   ( i s E d i t   & &   d a t a . c o n t a c t . i s D i s t r i b u t i o n L i s t ( ) )   { 
 	 	 	 	 f u l l n a m e H t m l   =   ' ' ; 
 	 	 	 } 
 	 	 
 	 b u f f e r [ _ i + + ]   =   " < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ c o n t a c t N a m e '   c l a s s = ' c o n t a c t H e a d e r   " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . i s I n T r a s h   ?   " T r a s h "   :   " "   ; 
 	 b u f f e r [ _ i + + ]   =   " ' > " ; 
 	 b u f f e r [ _ i + + ]   =     f u l l n a m e H t m l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	   i f   ( n i c k n a m e   & &   ! i s E d i t )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v   c l a s s = ' c o n t a c t H e a d e r ' > & l d q u o ; " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( n i c k n a m e )   ; 
 	 b u f f e r [ _ i + + ]   =   " & r d q u o ; < / d i v > " ; 
 	   }   
 	   e l s e   i f   ( i s E d i t )   { 
 	 b u f f e r [ _ i + + ]   =   " < d i v   c l a s s = ' c o n t a c t H e a d e r 2 ' > " ; 
 	 	 i f   ( d a t a . c o n t a c t . i s D i s t r i b u t i o n L i s t ( ) )   { 
 	 	 	 	 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > < t r > < t d   c l a s s = ' c o n t a c t H e a d e r 2 ' > " ; 
 	 
 	 	 	 	 	 	 i f   ( d a t a . u s e r n a m e E d i t a b l e )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ g r o u p N a m e P a r e n t ' > < / d i v > " ; 
 	 	 	 }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . u s e r n a m e ) ; 
 	 	 	 } 
 	 	 	 	 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' c o n t a c t H e a d e r 2 ' > & n b s p ; @ \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t " ; 
 	 
 	 	 	 	 	 	 i f   ( d a t a . d o m a i n E d i t a b l e )   {   
 	 b u f f e r [ _ i + + ]   =   " < i n p u t   t y p e = ' t e x t '   a u t o c o m p l e t e = ' o f f '   s i z e = ' 2 0 '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ g r o u p N a m e D o m a i n '   c l a s s = ' T e x t ' > " ; 
 	 	 	 }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . d o m a i n ) ; 
 	 	 	 }   
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > < / t a b l e > " ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ g r o u p N a m e P a r e n t ' > < / d i v > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / d i v > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ t a g s '   s t y l e = ' p a d d i n g - t o p : 5 p x ; ' > < / d i v > " ; 
 	   }   
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r N a m e " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r J o b I n f o " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 
 	 	 	 v a r   c o n t a c t   =   d a t a . c o n t a c t ; 
 	 	 	 v a r   i s P h o n e t i c   =   a p p C t x t . g e t ( Z m S e t t i n g . P H O N E T I C _ C O N T A C T _ F I E L D S ) ; 
 	 	 	 v a r   c o m p a n y   =   c o n t a c t . g e t A t t r ( Z m C o n t a c t . F _ c o m p a n y ) ; 
 	 	 	 v a r   t i t l e   =   c o n t a c t . g e t A t t r ( Z m C o n t a c t . F _ j o b T i t l e ) ; 
 	 	 	 v a r   d e p a r t m e n t   =   c o n t a c t . g e t A t t r ( Z m C o n t a c t . F _ d e p a r t m e n t ) ; 
 	 	 
 	   i f   ( t i t l e   | |   d e p a r t m e n t )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v   c l a s s = ' c o n t a c t H e a d e r 2 ' > " ; 
 	   i f   ( t i t l e )   {   
 	 b u f f e r [ _ i + + ]   =   " < s p a n > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( t i t l e )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > " ; 
 	   }   
 	   i f   ( d e p a r t m e n t )   {   
 	   i f   ( t i t l e )   {   
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t & n b s p ; & n d a s h ; & n b s p ; \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < s p a n > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( d e p a r t m e n t )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	   }   
 	   i f   ( c o m p a n y )   { 
 	 	 	 v a r   p h o n e t i c C o m p a n y   =   i s P h o n e t i c   & &   c o n t a c t . g e t A t t r ( Z m C o n t a c t . F _ p h o n e t i c C o m p a n y ) ; 
 	 	 	 v a r   c o m p a n y H t m l   =   A j x S t r i n g U t i l . h t m l R u b y E n c o d e ( c o m p a n y ,   p h o n e t i c C o m p a n y ) ; 
 	 	 	 
 	 b u f f e r [ _ i + + ]   =   " < d i v   c l a s s = ' c o n t a c t H e a d e r 2 ' > " ; 
 	 b u f f e r [ _ i + + ]   =     c o m p a n y H t m l ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	   }   
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r J o b I n f o " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ d l m e m b e r - c o l l a p s e d " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t d   " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . e x p a n d T d T e x t   ; 
 	 b u f f e r [ _ i + + ]   =   " > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . h t m l . j o i n ( " " )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = r o w L a b e l > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . c o n t a c t . c a n E x p a n d   ?   Z m M s g . m e m b e r s L a b e l   :   " "   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c o l s p a n = ' 2 '   c l a s s = ' r o w V a l u e ' > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . v a l u e   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ d l m e m b e r - c o l l a p s e d " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ d l m e m b e r - e x p a n d e d " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t d   " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . f i r s t   ?   d a t a . e x p a n d T d T e x t   :   " "     ; 
 	 b u f f e r [ _ i + + ]   =   " > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . h t m l . j o i n ( " " )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . f i r s t   ?   Z m M s g . m e m b e r s L a b e l   :   " "   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c o l s p a n = ' 2 '   c l a s s = ' r o w V a l u e ' > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . v a l u e   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ d l m e m b e r - e x p a n d e d " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ a d d r e s s _ v a l u e " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t r   v a l i g n = ' t o p ' > < t d   c l a s s = ' r o w L a b e l ' > < ! - -   o n l y   s h o w   t h e   f i r s t   l a b e l   v i s u a l l y   - - > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " '   c l a s s = ' " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . f i r s t   ?   " "   :   " S c r e e n R e a d e r O n l y "   ; 
 	 b u f f e r [ _ i + + ]   =   " ' > \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l " ] ; 
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t < / l a b e l > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " '   c l a s s = ' r o w V a l u e ' > " ; 
 	   v a r   a d d r e s s   =   d a t a . a d d r e s s ; 
 	 	 	 	 i f   ( a d d r e s s . S t r e e t )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v > " ; 
 	 b u f f e r [ _ i + + ]   =   a d d r e s s . S t r e e t ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	   } 
 	 	 	 	 i f   ( a d d r e s s . C i t y   | |   a d d r e s s . S t a t e   | |   a d d r e s s . P o s t a l C o d e )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v > < s p a n > " ; 
 	 b u f f e r [ _ i + + ]   =   a d d r e s s . C i t y ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > " ; 
 	   i f   ( a d d r e s s . C i t y   & &   a d d r e s s . S t a t e )   {   
 	 b u f f e r [ _ i + + ]   =   " ,   " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < s p a n > " ; 
 	 b u f f e r [ _ i + + ]   =   a d d r e s s . S t a t e ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > " ; 
 	   i f   ( a d d r e s s . C i t y   | |   a d d r e s s . S t a t e )   {   
 	 b u f f e r [ _ i + + ]   =   " & n b s p ; " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < s p a n > " ; 
 	 b u f f e r [ _ i + + ]   =   a d d r e s s . P o s t a l C o d e ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > < / d i v > " ; 
 	   } 
 	 	 	 	 i f   ( a d d r e s s . C o u n t r y )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v > " ; 
 	 b u f f e r [ _ i + + ]   =   a d d r e s s . C o u n t r y ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w T y p e ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " ' > \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t & n b s p ; " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . t y p e   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ a d d r e s s _ v a l u e " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w _ l i s t _ i t e m " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t r   v a l i g n = ' t o p ' > " ; 
 	   i f   ( d a t a . i s D L )   {   
 	 b u f f e r [ _ i + + ]   =   " < t d > < d i v   c l a s s = ' I m g B l a n k _ 1 6 ' > < / d i v > < / t d > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < t d   c l a s s = ' r o w L a b e l '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l a b e l ' > < ! - -   o n l y   s h o w   t h e   f i r s t   l a b e l   v i s u a l l y   - - > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l a b e l '   c l a s s = ' " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . f i r s t   ?   " "   :   " S c r e e n R e a d e r O n l y "   ; 
 	 b u f f e r [ _ i + + ]   =   " ' > \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l " ] ; 
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t < / l a b e l > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ v a l u e '   " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . t y p e   ?   " "   :   " c o l s p a n = ' 2 ' "   ; 
 	 b u f f e r [ _ i + + ]   =   "   c l a s s = ' r o w V a l u e '   a r i a - l a b e l l e d b y = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l a b e l   " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ t y p e ' > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . v a l u e   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 	   i f   ( d a t a . t y p e )   {   
 	 b u f f e r [ _ i + + ]   =   " < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ t y p e '   c l a s s = ' r o w T y p e ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " l a b e l I d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l a b e l ' > \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t & n b s p ; " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " t y p e " ] ; 
 	 b u f f e r [ _ i + + ]   =   " \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t < / l a b e l > < / t d > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t r > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w _ l i s t _ i t e m " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S p l i t V i e w G r o u p " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   c l a s s = ' c o n t a c t C o n t e n t T a b l e ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r " ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > " ; 
 	   i f   ( d a t a . d l I n f o )   {   
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' c o n t a c t H e a d e r S u b T a b l e   N o n e B g   Z P r o p e r t y S h e e t '   w i d t h = ' 1 0 0 % '   c e l l s p a c i n g = ' 6 ' > < t r > < t d > < u l   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s u b s c r i p t i o n M s g '   s t y l e = ' m a r g i n : . 5 e m   0 ; p a d d i n g - l e f t : 5 3 p x ; ' > < / u l > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s u b s c r i p t i o n B u t t o n ' > < / t d > < / t r > < / t a b l e > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < d i v   c l a s s = ' c o n t a c t G r o u p L i s t '   s t y l e = ' o v e r f l o w : a u t o ; ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m C o n t a c t S p l i t V i e w . s h o w C o n t a c t G r o u p ( d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S p l i t V i e w G r o u p " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # S i m p l e V i e w - N o R e s u l t s " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % ' > < t r > < t d   c l a s s = ' N o R e s u l t s ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x M s g . n o R e s u l t s   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # S i m p l e V i e w - N o R e s u l t s " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # G r o u p V i e w " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   c l a s s = ' Z P r o p e r t y S h e e t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r " ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # G r o u p V i e w M e m b e r s " ,   d a t a )   ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # G r o u p V i e w " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # D l V i e w " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   c l a s s = ' Z P r o p e r t y S h e e t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( ' a b o o k . C o n t a c t s # S p l i t V i e w _ h e a d e r ' ,   d a t a )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ t a b V i e w C o n t a i n e r ' > < / d i v > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # D l V i e w " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # D l P r o p e r t i e s V i e w " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	   i f   ( d a t a . c o n t a c t . i s D i s t r i b u t i o n L i s t ( ) )   {   
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % '   c l a s s = ' Z m E d i t C o n t a c t V i e w ' > < t r > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . d i s p l a y N a m e L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w V a l u e ' > < d i v   c l a s s = ' D w t I n p u t F i e l d ' > < i n p u t   t y p e = ' t e x t '   a u t o c o m p l e t e = ' o f f '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l D i s p l a y N a m e '   c l a s s = ' T e x t '   s t y l e = ' w i d t h : 4 5 e m ; ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . d e s c r i p t i o n L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w V a l u e ' > < d i v   c l a s s = ' D w t I n p u t F i e l d ' > < t e x t a r e a   r o w s = ' 4 '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l D e s c '   s t y l e = ' w i d t h : 4 5 e m ; ' > < / t e x t a r e a > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . d i r e c t o r y L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w V a l u e   r o w C h e c k G r o u p ' > < i n p u t   t y p e = ' c h e c k b o x '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l H i d e I n G a l ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l H i d e I n G a l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . h i d d e n I n G l o b a l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . m a i l L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w V a l u e   r o w R a d i o G r o u p ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' m a i l P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l M a i l P o l i c y A N Y O N E ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l M a i l P o l i c y A N Y O N E ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . m a i l A n y o n e   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > < / t d > < t d   c l a s s = ' r o w V a l u e ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' m a i l P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l M a i l P o l i c y M E M B E R S ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l M a i l P o l i c y M E M B E R S ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . m a i l O n l y M e m b e r s   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > < / t d > < t d   c l a s s = ' r o w V a l u e ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' m a i l P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l M a i l P o l i c y I N T E R N A L ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l M a i l P o l i c y I N T E R N A L ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . m a i l O n l y I n t e r n a l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > < / t d > < t d   c l a s s = ' r o w V a l u e ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' m a i l P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l M a i l P o l i c y S P E C I F I C ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l M a i l P o l i c y S P E C I F I C ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . m a i l O n l y S p e c i f i c   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > < / t d > < t d   c l a s s = ' r o w V a l u e ' > < d i v   c l a s s = ' D w t I n p u t F i e l d ' > < i n p u t   t y p e = ' t e x t '   a u t o c o m p l e t e = ' o f f '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l L i s t S p e c i f i c M a i l e r s '   c l a s s = ' T e x t '   s t y l e = ' m a r g i n - l e f t : 2 e m ; w i d t h : 4 3 e m ; ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . n e w S u b s c r i p t i o n s L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w V a l u e   r o w R a d i o G r o u p ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' s u b s c r i p t i o n P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l S u b s c r i p t i o n P o l i c y A C C E P T ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l S u b s c r i p t i o n P o l i c y A C C E P T ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . p o l i c y A c c e p t   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > < / t d > < t d   c l a s s = ' r o w V a l u e ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' s u b s c r i p t i o n P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l S u b s c r i p t i o n P o l i c y A P P R O V A L ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l S u b s c r i p t i o n P o l i c y A P P R O V A L ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . p o l i c y A p p r o v a l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > < / t d > < t d   c l a s s = ' r o w V a l u e ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' s u b s c r i p t i o n P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l S u b s c r i p t i o n P o l i c y R E J E C T ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l S u b s c r i p t i o n P o l i c y R E J E C T ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . p o l i c y R e j e c t   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . u n s u b s c r i p t i o n s R e q u e s t L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w V a l u e   r o w R a d i o G r o u p '   > < i n p u t   t y p e = ' r a d i o '   n a m e = ' u n s u b s c r i p t i o n P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l U n s u b s c r i p t i o n P o l i c y A C C E P T ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l U n s u b s c r i p t i o n P o l i c y A C C E P T ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . p o l i c y A c c e p t   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > < / t d > < t d   c l a s s = ' r o w V a l u e ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' u n s u b s c r i p t i o n P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l U n s u b s c r i p t i o n P o l i c y A P P R O V A L ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l U n s u b s c r i p t i o n P o l i c y A P P R O V A L ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . p o l i c y A p p r o v a l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > < / t d > < t d   c l a s s = ' r o w V a l u e ' > < i n p u t   t y p e = ' r a d i o '   n a m e = ' u n s u b s c r i p t i o n P o l i c y '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l U n s u b s c r i p t i o n P o l i c y R E J E C T ' > < l a b e l   f o r = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l U n s u b s c r i p t i o n P o l i c y R E J E C T ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . p o l i c y R e j e c t   ; 
 	 b u f f e r [ _ i + + ]   =   " < / l a b e l > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . l i s t O w n e r s L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w V a l u e ' > < d i v   c l a s s = ' D w t I n p u t F i e l d ' > < i n p u t   t y p e = ' t e x t '   a u t o c o m p l e t e = ' o f f '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l L i s t O w n e r s '   c l a s s = ' T e x t '   s t y l e = ' w i d t h : 4 5 e m ; ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = ' r o w L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . n o t e s L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c l a s s = ' r o w V a l u e ' > < d i v   c l a s s = ' D w t I n p u t F i e l d ' > < t e x t a r e a   r o w s = ' 4 '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ d l N o t e s '   s t y l e = ' w i d t h : 4 5 e m ; ' > < / t e x t a r e a > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 	   }   
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # D l P r o p e r t i e s V i e w " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # G r o u p V i e w M e m b e r s " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % '   h e i g h t = ' 1 0 0 % '   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < ! - -   c o n t e n t :   l e f t   p a n e   - - > < t d   w i d t h = ' 5 0 % '   v a l i g n = ' t o p ' > < d i v   c l a s s = ' g r o u p M e m b e r s '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ g r o u p M e m b e r s ' > < / d i v > < / t d > < ! - -   c o n t e n t :   r i g h t   p a n e   - - > < t d   w i d t h = ' 5 0 % '   v a l i g n = ' t o p ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % ' > < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h F i e l d s R o w ' > < t d   w i d t h = ' 5 0 ' > & n b s p ; < / t d > < t d > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > " ; 
 	   i f   ( d a t a . d e t a i l e d )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h N a m e R o w ' > < t d   a l i g n = ' r i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . n a m e L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < i n p u t   t y p e = ' t e x t '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h N a m e F i e l d ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h B u t t o n '   v a l i g n = ' t o p '   r o w s p a n = ' 3 ' > < / t d > < / t r > " ; 
 	   i f   ( a p p C t x t . g e t ( Z m S e t t i n g . P H O N E T I C _ C O N T A C T _ F I E L D S ) )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h P h o n e t i c R o w ' > < t d   a l i g n = ' r i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . p h o n e t i c N a m e L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < i n p u t   t y p e = ' t e x t '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h P h o n e t i c F i e l d ' > < / t d > < / t r > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h E m a i l R o w ' > < t d   a l i g n = ' r i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . e m a i l A d d r L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < i n p u t   t y p e = ' t e x t '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h E m a i l F i e l d ' > < / t d > < / t r > < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h D e p a r t m e n t R o w ' > < t d   a l i g n = ' r i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . d e p a r t m e n t L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < i n p u t   t y p e = ' t e x t '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h D e p a r t m e n t F i e l d ' > < / t d > < / t r > " ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h R o w ' > < t d   a l i g n = ' r i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . f i n d L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < i n p u t   t y p e = ' t e x t '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h F i e l d ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h B u t t o n ' > < / t d > < / t r > " ; 
 	   }   
 	   i f   ( d a t a . s h o w S e a r c h I n )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r > < t d   a l i g n = ' r i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . s e a r c h I n   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   c o l s p a n = ' 2 '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l i s t S e l e c t ' > < / t d > < / t r > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > < / t d > < / t r > < t r > < t d   w i d t h = ' 5 0 ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % '   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ a d d B u t t o n ' > < / t d > < / t r > < t r > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ a d d A l l B u t t o n ' > < / t d > < / t r > < / t a b l e > < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l i s t V i e w ' > < / d i v > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % '   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ n a v B u t t o n s R o w ' > < t d   w i d t h = ' 1 0 0 % ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ p r e v B u t t o n ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ n e x t B u t t o n ' > < / t d > < / t r > < / t a b l e > < / t d > < / t r > < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ m a n u a l A d d R o w ' > < t d   w i d t h = ' 5 0 ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % '   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ a d d N e w B u t t o n ' > < / t d > < / t r > < / t a b l e > < / t d > < t d > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % '   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < t d > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . e n t e r A d d r B e l o w ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > < t r > < t d > < t e x t a r e a   c l a s s = ' g r o u p M e m b e r s '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ a d d N e w F i e l d ' > < / t e x t a r e a > < / t d > < / t r > < / t a b l e > < / t d > < / t r > < / t a b l e > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # G r o u p V i e w M e m b e r s " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m A l p h a b e t B a r " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < c e n t e r > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ a l p h a b e t '   w i d t h = ' 8 0 % '   c l a s s = ' A l p h a b e t B a r T a b l e ' '   c e l l s p a c i n g = ' 0 ' > < t r > " ; 
 	   f o r   ( v a r   i   =   0 ;   i   <   d a t a . n u m L e t t e r s ;   i + + )   {   
 	 b u f f e r [ _ i + + ]   =   " < t d   _ i d x = \ " " ; 
 	 b u f f e r [ _ i + + ]   =     i   ; 
 	 b u f f e r [ _ i + + ]   =   " \ " \ t r o l e = ' b u t t o n ' \ n " ; 
 	 b u f f e r [ _ i + + ]   =   " \ t \ t \ t \ t \ t \ t c l a s s = ' D w t B u t t o n   A l p h a b e t B a r C e l l ' " ; 
 	   i f   ( d a t a . a l p h a b e t [ i ] . l e n g t h   >   1 )   {   
 	 b u f f e r [ _ i + + ]   =   "   c o l s p a n = ' " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . a l p h a b e t [ i ] . l e n g t h / 2   +   1   ; 
 	 b u f f e r [ _ i + + ]   =   " '   " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   "   > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . a l p h a b e t [ i ]   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t r > < / t a b l e > < / c e n t e r > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m A l p h a b e t B a r " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # T o o l t i p " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 2 5 0 ' > < t r > < t d   c o l s p a n = ' 2 '   v a l i g n = ' t o p ' > < d i v   s t y l e = ' b o r d e r - b o t t o m : 1 p x   s o l i d   b l a c k ; m a r g i n - b o t t o m : 2 p x ; ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % ' > < t r   v a l i g n = ' b o t t o m ' > < t d   s t y l e = ' f o n t - w e i g h t : b o l d ; ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . e n t r y T i t l e ) ;   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   a l i g n = ' r i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x I m g . g e t I m a g e H t m l ( d a t a . c o n t a c t . g e t I c o n ( ) ) ;   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > < / t a b l e > < / d i v > < / t d > < / t r > " ; 
 	   i f   ( d a t a . c o n t a c t . i s G r o u p ( ) )   { 
 	 	 	 	 v a r   m e m b e r s   =   d a t a . c o n t a c t . g e t G r o u p M e m b e r s ( ) . g o o d . g e t A r r a y ( ) ; 
 	 	 	 	 f o r   ( v a r   i   =   0 ;   i   <   m e m b e r s . l e n g t h ;   i + + )   { 
 	 	 	 
 	 b u f f e r [ _ i + + ]   =   " < t r > < t d   w i d t h = 2 0 > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x I m g . g e t I m a g e H t m l ( " M e s s a g e " )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( m e m b e r s [ i ] . t o S t r i n g ( ) )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > " ; 
 	 	 }   
 	 	 	 }   e l s e   { 
 	 	 	 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   { d a t a : d a t a ,   f i e l d : " f u l l N a m e " } )   ; 
 	   v a r   f i e l d s   =   Z m M s g . c o n t a c t T o o l t i p W o r k I n f o O r d e r . s p l i t ( " , " ) ; 
 	 	 	 	       v a r   i ; 
 	 	 	 	       f o r   ( i   =   0 ;   i   <   f i e l d s . l e n g t h ;   i + + )   { 
 	 	 	 	 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   { d a t a : d a t a ,   f i e l d : f i e l d s [ i ] } )   ; 
 	 
 	 	 	 	       } 
 	 	 	 	 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   { d a t a : d a t a ,   f i e l d : " m o b i l e P h o n e " } )   ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   { d a t a : d a t a ,   f i e l d : " w o r k P h o n e " } )   ; 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   { d a t a : d a t a ,   f i e l d : " h o m e P h o n e " } )   ; 
 	   i f   ( d a t a . c o n t a c t . i s G a l )   { 
 	 	 	 	 	 v a r   e m a i l s   =   d a t a . c o n t a c t . g e t E m a i l s ( ) ; 
 	 	 	 	 	 f o r   ( v a r   i   =   0 ;   i   <   e m a i l s . l e n g t h   & &   e m a i l s . l e n g t h   < =   3 ;   i + + )   { 
 	 	 	 	 
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   { d a t a : d a t a ,   f i e l d : " e m a i l " ,   v a l : e m a i l s [ i ] } )   ; 
 	 	 }   
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   { d a t a : d a t a ,   f i e l d : " n o t e s " ,   t r u n c a t e : 5 0 0 } )   ; 
 	 	 }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =     A j x T e m p l a t e . e x p a n d ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   { d a t a : d a t a ,   f i e l d : " e m a i l " ,   v a l : d a t a . c o n t a c t . _ l o o k u p E m a i l   | |   d a t a . e m a i l } )   ; 
 	 	 }   
 	 	 }   
 	   i f   ( d a t a . h i n t )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r > < t d   c o l s p a n = ' 2 ' > < d i v   c l a s s = ' T o o l t i p H i n t ' > < h r   c o l o r = b l a c k   s i z e = 1 > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . h i n t   ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > < / t d > < / t r > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # T o o l t i p " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # T o o l t i p N o t I n A d d r B o o k " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	   i f   ( d a t a . h i n t )   {   
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 2 5 0 ' > < t r > < t d   v a l i g n = ' t o p ' > " ; 
 	   i f   ( a p p C t x t . g e t ( Z m S e t t i n g . C O N T A C T S _ E N A B L E D ) )   {   
 	 b u f f e r [ _ i + + ]   =   " < d i v   s t y l e = ' b o r d e r - b o t t o m : 1 p x   s o l i d   b l a c k ; ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % ' > < t r   v a l i g n = ' b o t t o m ' > < t d   s t y l e = ' f o n t - w e i g h t : b o l d ; ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . n e w C o n t a c t   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   a l i g n = ' r i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x I m g . g e t I m a g e H t m l ( " N e w C o n t a c t " ) ;   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > < / t a b l e > < / d i v > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < d i v   c l a s s = ' T o o l t i p N o t I n A d d r B o o k ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . a d d r s t r )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > < h r   c o l o r = ' b l a c k '   s i z e = ' 1 ' > < d i v   c l a s s = ' T o o l t i p H i n t ' > " ; 
 	 b u f f e r [ _ i + + ]   =     d a t a . h i n t   ; 
 	 b u f f e r [ _ i + + ]   =   " < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " < s p a n   s t y l e = ' f o n t - w e i g h t : b o l d ; ' >   " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . e m a i l L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   "   < / s p a n > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . a d d r s t r )   ; 
 	   }   
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # T o o l t i p N o t I n A d d r B o o k " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	   i f   ( d a t a . v a l   = =   n u l l )   { 
 	 	 	 v a r   i s P h o n e t i c   =   a p p C t x t . g e t ( Z m S e t t i n g . P H O N E T I C _ C O N T A C T _ F I E L D S ) ; 
 	 	 	 d a t a . v a l   =   d a t a . f i e l d   = =   " f u l l N a m e "   ?   d a t a . d a t a . c o n t a c t . g e t F u l l N a m e F o r D i s p l a y ( i s P h o n e t i c )   :   d a t a . d a t a . c o n t a c t . g e t A t t r ( d a t a . f i e l d ) ; 
 	 	 }   
 	   i f   ( d a t a . v a l   ! =   n u l l   & &   d a t a . v a l   ! =   " " )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   v a l i g n = ' t o p ' > < t d   c l a s s = ' Z m T o o l t i p L a b e l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x M e s s a g e F o r m a t . f o r m a t ( Z m M s g . m a k e L a b e l , 
 	 	 	 	 	 	 	 	 	 	 	   A j x S t r i n g U t i l . h t m l E n c o d e ( Z m C o n t a c t . _ A B _ F I E L D [ d a t a . f i e l d ] ) )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 	   i f   ( d a t a . t r u n c a t e )   {   
 	 b u f f e r [ _ i + + ]   =   " < t d > " ; 
 	 b u f f e r [ _ i + + ]   =     A j x M e s s a g e F o r m a t . f o r m a t ( Z m M s g . m a k e L a b e l , 
 	 	 	 	 	 	 	 	 	 	 	 A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . v a l . s u b s t r i n g ( 0 , d a t a . t r u n c a t e ) ) )   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 	   }   e l s e   { 
 	 	 	 	 v a r   f i e l d   =   " " ; 
 	 	 	 	 i f   ( d a t a . f i e l d   = =   " f u l l N a m e "   )   { 
 	 	 	 	 	 f i e l d   =   i s P h o n e t i c   ?   d a t a . v a l   :   A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . v a l ) ;   
 	 	 	 	 } 
 	 	 	 	 e l s e   { 
 	 	 	 	 	 f i e l d   =   A j x S t r i n g U t i l . h t m l E n c o d e ( d a t a . v a l ) ; 
 	 	 	 	 } 
 	 	 	 
 	 b u f f e r [ _ i + + ]   =   " < t d   s t y l e = ' w h i t e - s p a c e : n o w r a p ; ' > " ; 
 	 b u f f e r [ _ i + + ]   =     f i e l d   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t r > " ; 
 	   }   
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # A d d T o o l t i p E n t r y " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m C o n t a c t P i c k e r " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < d i v   c l a s s = ' Z m C o n t a c t P i c k e r ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % ' > < t r > < t d   w i d t h = ' 6 0 0 ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h T a b l e ' > " ; 
 	   i f   ( d a t a . d e t a i l e d )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h N a m e R o w ' > < t d   a l i g n = ' r i g h t ' > < s p a n   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h N a m e F i e l d L b l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . n a m e L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > < / t d > < t d > < i n p u t   t y p e = ' t e x t '   p l a c e h o l d e r = \ " " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . c o n t a c t P i c k e r H i n t   ; 
 	 b u f f e r [ _ i + + ]   =   " \ "   a u t o c o m p l e t e = ' o f f '   s i z e = ' 3 0 '   n o w r a p   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h N a m e F i e l d '   a r i a - l a b e l l e d b y = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h N a m e F i e l d L b l ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h B u t t o n '   r o w s p a n = ' 3 '   v a l i g n = ' t o p ' > < / t d > < t d   w i d t h = ' 2 0 '   v a l i g n = ' m i d d l e ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h I c o n '   c l a s s = ' I m g S e a r c h ' > < / d i v > < / t d > < / t r > " ; 
 	   i f   ( a p p C t x t . g e t ( Z m S e t t i n g . P H O N E T I C _ C O N T A C T _ F I E L D S ) )   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h P h o n e t i c R o w ' > < t d   a l i g n = ' r i g h t ' > < s p a n   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h P h o n e t i c N a m e F i e l d L b l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . p h o n e t i c N a m e L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > < / t d > < t d > < i n p u t   t y p e = ' t e x t '   p l a c e h o l d e r = \ " " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . c o n t a c t P i c k e r P h o n e t i c H i n t   ; 
 	 b u f f e r [ _ i + + ]   =   " \ "   a u t o c o m p l e t e = ' o f f '   s i z e = ' 3 0 '   n o w r a p   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h P h o n e t i c F i e l d '   a r i a - l a b e l l e d b y = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h P h o n e t i c N a m e F i e l d L b l ' > < / t d > < / t r > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h E m a i l R o w ' > < t d   a l i g n = ' r i g h t ' > < s p a n   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h E m a i l F i e l d L b l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . e m a i l A d d r L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > < / t d > < t d > < i n p u t   t y p e = ' t e x t '   p l a c e h o l d e r = \ " " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . c o n t a c t P i c k e r E m a i l H i n t   ; 
 	 b u f f e r [ _ i + + ]   =   " \ " a u t o c o m p l e t e = ' o f f '   s i z e = ' 3 0 '   n o w r a p   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h E m a i l F i e l d '   a r i a - l a b e l l e d b y = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h E m a i l F i e l d L b l ' > < / t d > < / t r > < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h D e p a r t m e n t R o w ' > < t d   a l i g n = ' r i g h t ' > < s p a n   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h D e p a r t m e n t F i e l d L b l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . d e p a r t m e n t L a b e l   ; 
 	 b u f f e r [ _ i + + ]   =   " < / s p a n > < / t d > < t d > < i n p u t   t y p e = ' t e x t '   p l a c e h o l d e r = \ " " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . c o n t a c t P i c k e r D e p a r t m e n t H i n t   ; 
 	 b u f f e r [ _ i + + ]   =   " \ "   a u t o c o m p l e t e = ' o f f '   s i z e = ' 3 0 '   n o w r a p   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h D e p a r t m e n t F i e l d '   a r i a - l a b e l l e d b y = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h D e p a r t m e n t F i e l d L b l ' > < / t d > < / t r > " ; 
 	   }   e l s e   {   
 	 b u f f e r [ _ i + + ]   =   " < t r   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h R o w ' > < t d > < i n p u t   t y p e = ' t e x t '   p l a c e h o l d e r = \ " " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . c o n t a c t P i c k e r H i n t   ; 
 	 b u f f e r [ _ i + + ]   =   " \ "   a u t o c o m p l e t e = ' o f f '   n o w r a p   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h F i e l d '   s t y l e = ' w i d t h : 2 5 e m ; '   a r i a - l a b e l = ' " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . s e a r c h ; 
 	 b u f f e r [ _ i + + ]   =   " ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h B u t t o n ' > < / t d > < t d   w i d t h = ' 2 0 '   v a l i g n = ' m i d d l e ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h I c o n '   c l a s s = ' I m g S e a r c h ' > < / d i v > < / t d > < / t r > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t a b l e > < / t d > < t d   a l i g n = ' r i g h t '   v a l i g n = ' b o t t o m ' > " ; 
 	   i f   ( d a t a . s h o w S e l e c t )   {   
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < t d   c l a s s = ' L a b e l   n o b r e a k '   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l i s t S e l e c t L b l ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . s h o w N a m e s   ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ l i s t S e l e c t ' > < / t d > < / t r > < / t a b l e > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > < / t a b l e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ c h o o s e r ' > < / d i v > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ p a g i n g '   s t y l e = ' m a r g i n - l e f t : 5 p x ; ' > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % ' > < t r > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ p a g e L e f t ' > < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ p a g e R i g h t '   a l i g n = ' r i g h t ' > < / t d > < / t r > < / t a b l e > < / d i v > < / d i v > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m C o n t a c t P i c k e r " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Z m C o n t a c t S e a r c h " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ p r e a m b l e ' > < / d i v > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   w i d t h = ' 1 0 0 % ' > < t r > < t d > < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > < t r > < t d   w i d t h = ' 2 0 '   v a l i g n = ' m i d d l e ' > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h I c o n '   c l a s s = ' I m g S e a r c h ' > < / d i v > < / t d > < t d > < i n p u t   t y p e = ' t e x t '   a u t o c o m p l e t e = ' o f f '   s i z e = ' 3 0 '   n o w r a p   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h F i e l d ' > & n b s p ; < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ s e a r c h B u t t o n ' > < / t d > < / t r > < / t a b l e > < / t d > < t d   a l i g n = ' r i g h t ' > " ; 
 	   i f   ( d a t a . s h o w S e l e c t )   {   
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ " > < t r > < t d   c l a s s = ' L a b e l   n o b r e a k ' > " ; 
 	 b u f f e r [ _ i + + ]   =     Z m M s g . s h o w N a m e s   ; 
 	 b u f f e r [ _ i + + ]   =   " & n b s p ; < / t d > < t d   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ f o l d e r s ' > < / t d > < / t r > < / t a b l e > " ; 
 	   }   
 	 b u f f e r [ _ i + + ]   =   " < / t d > < / t r > < / t a b l e > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ r e s u l t s '   c l a s s = ' c o n t a c t S e a r c h R e s u l t s D i v ' > < / d i v > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Z m C o n t a c t S e a r c h " 
 } ,   f a l s e ) ; 
 
 A j x T e m p l a t e . r e g i s t e r ( " a b o o k . C o n t a c t s # Q u i c k A d d P r o m p t " ,   
 f u n c t i o n ( n a m e ,   p a r a m s ,   d a t a ,   b u f f e r )   { 
 	 v a r   _ h a s B u f f e r   =   B o o l e a n ( b u f f e r ) ; 
 	 d a t a   =   ( t y p e o f   d a t a   = =   " s t r i n g "   ?   {   i d :   d a t a   }   :   d a t a )   | |   { } ; 
 	 b u f f e r   =   b u f f e r   | |   [ ] ; 
 	 v a r   _ i   =   b u f f e r . l e n g t h ; 
 
 	 b u f f e r [ _ i + + ]   =   " < t a b l e   r o l e = \ " p r e s e n t a t i o n \ "   c l a s s = ' Z P r o p e r t y S h e e t '   c e l l s p a c i n g = ' 6 ' > < t r > < t d   c l a s s = ' Z m F i e l d L a b e l R i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . f i r s t N a m e L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ F I R S T _ N A M E ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = ' Z m F i e l d L a b e l R i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . l a s t N a m e L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   "   < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ L A S T _ N A M E ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = ' Z m F i e l d L a b e l R i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . e m a i l L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   " < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ E M A I L ' > < / d i v > < / t d > < / t r > < t r > < t d   c l a s s = ' Z m F i e l d L a b e l R i g h t ' > " ; 
 	 b u f f e r [ _ i + + ]   =   Z m M s g . a d d r e s s B o o k L a b e l ; 
 	 b u f f e r [ _ i + + ]   =   "   < / t d > < t d > < d i v   i d = ' " ; 
 	 b u f f e r [ _ i + + ]   =   d a t a [ " i d " ] ; 
 	 b u f f e r [ _ i + + ]   =   " _ A D D R _ B O O K ' > < / d i v > < / t d > < / t r > < / t a b l e > " ; 
 
 	 r e t u r n   _ h a s B u f f e r   ?   b u f f e r . l e n g t h   :   b u f f e r . j o i n ( " " ) ; 
 } , 
 { 
 	 " i d " :   " a b o o k . C o n t a c t s # Q u i c k A d d P r o m p t " 
 } ,   f a l s e ) ; 
 
 } 
    ;       https://email.gov.in/js/ContactsCore_all.js?v=190211031025        *              !!            +H!!          ZmAddrBookC U                   n    f     
                           !!      params   .this       +H;   1      W   QT      5   6   Q      
V   T  l Q	    ZmOrganizer   ADDRBOOK	   type   ZmFolder	   call       5!!       ;   ZmAddrBook.prototype.toStringb  g    _    ^   (          5!!       9   ZmAddrBook.prototype.getIconb  %  E    E  h      R       5!!       S   ZmAddrBook.prototype.supportsPublicAccessb    C    C  v             5!!       ?   ZmAddrBook.prototype.mayContainb     |    ~   *   c       5!!          ZmContactC                      4"    4"   
                          !!      id	   list	   type   newDl   arguments   .this       +H!!            !!    
   !!   isMember!!!!   isOwner!!!!%   subscriptionPolicy!!!!)   unsubscriptionPolicy!!!!   description!!!!   displayName!!!!   notes!!!!   hideInGal!!!!   mailPolicy!!!!   owners!!    ;   p  }   	W   QW  QV       >         T D   	   Q   5      U Q      
V  T T  T l QV  [    6   QV  V  5   E      QV  5   5      D      QT    6   QT       V     5   6	   QV  [   B]
   C]   @]   @]   =   ]   =   ]   =   ]   B]   @]   Z         
   5   : `    ]   6   Q-   V     A,  R  6   Q    	      length   ZmItem   CONTACT	   call	   attr	   list   isGal   ZmFolder   ID_DLS   folderId   isMember   isOwner%   subscriptionPolicy)   unsubscriptionPolicy      description   displayName   notes   hideInGal   mailPolicy   appCtxt   get   ZmSetting   USERNAME   owners   dlInfo   AjxVector   participants3       5!!       C    `                    6  8  6  8                              !!      i         +H;	      8   ?W   Q    V   W   Q6   Q    V   W   Q6   Q    V   W   Q6   Q    V   W   Q6   Q    V   W   Q6   Q    V   W   Q6   Q    V   W   Q6   Q    V   W   Q6   Q	    ZmContact   FA_LAST_C_FIRST   FA_FIRST_LAST   FA_COMPANY/   FA_LAST_C_FIRST_COMPANY+   FA_FIRST_LAST_COMPANY/   FA_COMPANY_LAST_C_FIRST+   FA_COMPANY_FIRST_LAST   FA_CUSTOM5!!      !!	   work!!	   home!!   other    !!      !!   Street!!	   City!!   State!!   PostalCode!!   Country    !!       =   ZmContact.updateFieldConstantsc     )                 C  (G   C  (G       F                      !!      i   j         +H!!            ;          j                "   7     >W   Q    m   >W  Q P   m       5      
    5   V   7    5   V  7 Q   V  W  QQ   V      5         V   W   QQ   V       5      Y       Z       
    5       5       5	       5
       5       5       5   : 6   Q    Z       
    5       5       5   Z       5   `    : 6   Q    Z       
    5       5   : 6   Q    [    6   Q    5       5   C8Q    5       5   C8Q          
    5   : 6   Q    d6   Q    =   6   Q    =   6   Q    =    6!   Q&       &P>j  6   5            ZmContact)   IGNORE_NORMALIZATION	   push   ADDR_PREFIXES   ADDR_SUFFIXES   length   concat   ADDRESS_FIELDS   EMAIL_FIELDS   IM_FIELDS   OTHER_FIELDS   PHONE_FIELDS   PRIMARY_FIELDS   URL_FIELDS   DISPLAY_FIELDS   GAL_FIELDS   MYCARD_FIELDS   X_FIELDS   F_imagepart   IGNORE_FIELDS   ALL_FIELDS   IS_DATE   F_birthday   F_anniversary   AjxUtil   arrayAsHash   IS_IGNORE   DL_PAGE_SIZE   C#   GROUP_CONTACT_REF   G   GROUP_GAL_REF   I!   GROUP_INLINE_REF0       5!!            !!       5   ZmContact.getAttributeNamec    %                  FJ  J  >J  J                              !!   	   name   index        +H;   `      T D      Q?   U QT ?D      Q    5   T  7	      
   T  T       T         ZmContact   IS_ADDONE       5!!       9   ZmContact.prototype.toStringb  TK  oK  LK  oK  !            5!!       /   ZmContact.createFromDomc  /                   [L  eP  SL  eP      /                       !!   	   node	   args   contact       +H!!            ;   /            
T  5   : W   QV   @D,   	   QV   E   
   QV   5   T  5               AT  5   T 5   ,  R W   QT 5         V   T 5   6   Q   V      
T   Q       
	   5
   :    
:     
V    Q  !   T  5   '   #   V   5      5   T  5   8Q(   T  5      *   V   T  5   6   Q,   T  5   !   .   V      
T  5    Q1         
V   5   T  5    QV   T 5   D   8   Q   A@,  R :   6   QV   [    6   QV   5   V   5   5   C8QA   T  5      C   V   T  5   6   QE   V   
    appCtxt   cacheGet   id   rev   ZmContact	   list   isGal   _loadFromDom   getApp   ZmApp   CONTACTS   getContactList   add   m	   attr   F_groups   ref   tn   _parseTagNames   AjxUtil   hashUpdate   _attrs   ZmContactList   _list   certificate       5!!       3   ZmContact.compareByFileAsb Q  R  Q  R  \            5!!       /   ZmContact.computeFileAsc  k                   S  ]  S  ]      d                        !!      contact	   attr   val   fa   idx	   name       +H;       T      r      T     
:        T     W   QV       	   	   V       5   7      V       5   7         V   5   : W  Q>W  QV  x    5   Hy          5   Hy         5   Hy         5   Hy         5	   Hy$  "       5
   Hyq  %       5   Hy  (       5   Hy  +   z   +   T  E   ,   QT  5   -      .   V   5   G   0   V   5      r   4   V   5   >7   6   V   5   7   7   V   5      r   ;   V   5   >7   =   V   5   >   >          
V   5   V   5   V   5   V   5   : W  Q  E          
V   5   V   5   V   5   V   5   : W  Q  L   V   5      N   V   5   W  QO     O          
V   5   V   5   V   5   V   5   : W  Q       
V  V   5   : W  Q*  Z          
V   5   V   5   V   5   V   5   : W  Q       
V  V   5   : W  Q   e          
V   5   V   5   : W  Q       
V  V   5   : W  Qv   n          
V   5   V   5   : W  Q       
V  V   5   : W  Q%   w   V   5      
:    z   V  D$   {   QV   5   D   }   Q=   }    r(  u  {	t x x x x x x x x      ```
`
`
`
`  `    ZmContact   getAttrs   F_dlDisplayName   parseInt   fileAs   FA_LAST_C_FIRST   FA_FIRST_LAST   FA_COMPANY/   FA_LAST_C_FIRST_COMPANY+   FA_FIRST_LAST_COMPANY/   FA_COMPANY_LAST_C_FIRST+   FA_COMPANY_FIRST_LAST   FA_CUSTOM   isGal   fullName   Array   email   fileAsLastFirst   firstName   lastName   nickname   fileAsFirstLast   company#   fileAsNameCompany#   fileAsCompanyName   substring          5!!       3   ZmContact.fileAsFirstLastb ^  _  ^  _              5!!       3   ZmContact.fileAsLastFirstc                      `  va  `  va                              !!      first	   last   fullname   nickname        +H;      )   T  E      QT    9             
   5   Z   T  `    T `   :    T D:      QT  D,      QT D      QT D      Q=      7  !   AjxMessageFormat   format   ZmMsg   fileAsLastFirst          5!!       7   ZmContact.fileAsNameCompanyb Jb  ,c  Bb  ,c              5!!       7   ZmContact.fileAsCompanyNameb d  d  c  d              5!!       ;   ZmContact.computeCustomFileAsb e  f  e  f              5!!       #   ZmContact.getAttrc                      g  ph  g  ph                              !!      contact	   attr        +H;   p      T      r      T     
T : F      T  E   	   QT  5   
         T  5   T 7      @       ZmContact   getAttr   _attrs       5!!       '   ZmContact.getPrefixb Xi  i  Pi  i               5!!       9   ZmContact.getNormalizedAttrsb {l  o  sl  o  0  '   P       5!!   ^(.*?)(\d+)$    !!       1   ZmContact.__BY_ATTRIBUTEb oo  >p  go  >p  J  #          5!!       #   ZmContact.setAttrb  q  q  p  q  X            5!!       '   ZmContact.isInTrashb 8r  r  0r  r  f            5!!       1   ZmContact.prototype.loadb s  v  s  v  p     R       5!!       O   ZmContact.prototype._handleLoadResponseb w  k{  w  k{       b       5!!       3   ZmContact.prototype.clearb  {  {  {  {              5!!       7   ZmContact.prototype.isEmptyb  |  |  w|  |       "       5!!       9   ZmContact.prototype.isSharedc                     M}  }  E}  }   
                            !!      .this         +H;   /   	   W   QV   5    E      QV   5    5          addrbook	   link       5!!       =   ZmContact.prototype.isReadOnlyb  ~  ~  ~  ~       "       5!!       9   ZmContact.prototype.isLockedb  F  P  >  P       R       5!!       7   ZmContact.prototype.isGroupb    2    2              5!!       M   ZmContact.prototype.isDistributionListc                              
                            !!      .this         +H;   /      W   QV   5    E      QV      
:         isGal   isGroup       5!!       G   ZmContact.prototype.getGroupMembersb               "       5!!       M   ZmContact.prototype.getAllGroupMembersb    E    E              5!!       M   ZmContact.prototype.gatherExtraDlStuffb z    r    D     "       5!!       Y   ZmContact.prototype._handleGetDlInfoResponseb         P            5!!       C   ZmContact.prototype.loadDlMembersb L    D    g     R       5!!       _   ZmContact.prototype._handleGetDlMembersResponseb         ~     2       5!!       =   ZmContact.prototype._getOwnersb H  1  @  1               5!!       E   ZmContact.prototype._getMailPolicyb a  f  Y  f              5!!       =   ZmContact.prototype.loadDlInfob                     5!!       M   ZmContact.prototype.toggleSubscriptionb R    J                5!!       3   ZmContact.prototype.getIdb   m    m       "       5!!       7   ZmContact.prototype.getIconb   !    !       R       5!!       A   ZmContact.prototype.getIconLargeb  O    G         "       5!!       ?   ZmContact.prototype.getFolderIdb  c    [                5!!       7   ZmContact.prototype.getAttrc                    J    B     
                           !!   	   name   val   .this       +H;   i      W  QV  5    T  7W   QV   <      V      r      V   >7   	   V   	      	   =   	    	   attr   Array          5!!       7   ZmContact.prototype.setAttrb R  }  J  }  !            5!!       Q   ZmContact.prototype.setParticipantStatusb   >    >  +            5!!       Q   ZmContact.prototype.getParticipantStatusb          5            5!!       M   ZmContact.prototype.setParticipantRoleb w    o    ?            5!!       M   ZmContact.prototype.getParticipantRoleb    A    A  I            5!!       =   ZmContact.prototype.removeAttrb         S            5!!       9   ZmContact.prototype.getAttrsc  ]  '         
                
                         !!      prefix   attrs   aname   namePrefix   .this       +H!!            ;      ;   e         M   W  QV  5    W   QT        [    W   QV  5    KV   m   W        
V  : W  QV  T  H"      V   V  V  5    V  78Q      QLM   QN   V   8_
 a h 	   attr   ZmContact   getPrefixB       5!!       M   ZmContact.prototype.getNormalizedAttrsb         {  1          5!!       5   ZmContact.prototype.createb 8    0                5!!       S   ZmContact.prototype._handleResponseCreateb "  O    O       r       5!!       G   ZmContact.prototype.createFromVCardb                     5!!       ]   ZmContact.prototype._handleResponseCreateVCardb )  u  !  u              5!!       W   ZmContact.prototype._handleErrorCreateVCardb   +    +              5!!       5   ZmContact.prototype.modifyb B  _  :  _              5!!       ;   ZmContact.prototype._createDlb         F            5!!       _   ZmContact.prototype._addMailPolicyAndOwnersReqsb   ;    ;  _     2       5!!       M   ZmContact.prototype._addMemberModsReqsb q  =  i  =  q     R       5!!       ;   ZmContact.prototype._modifyDlb h  
  `  
       R       5!!       M   ZmContact.prototype._getAddOrRemoveReqb >    6         "       5!!       G   ZmContact.prototype._getRenameDlReqb   b    b              5!!       I   ZmContact.prototype._getSetOwnersReqb              "       5!!       Q   ZmContact.prototype._getSetMailPolicyReqb              r       5!!       G   ZmContact.prototype._addDlAttributeb                      5!!       I   ZmContact.prototype._getDlAttributesb   !    !  '            5!!       G   ZmContact.prototype._getCreateDlReqb S    K    5            5!!       [   ZmContact.prototype._getModifyDlAttributesReqb         ?     "       5!!       Y   ZmContact.prototype._modifyDlResponseHandlerb J    B    Q     "       5!!       Y   ZmContact.prototype._createDlResponseHandlerb         d     "       5!!       9   ZmContact.prototype._popViewb &        o     0       5!!       E   ZmContact.prototype._handleErrorDlb   h    h  }     0       5!!       ?   ZmContact.prototype.clearDlInfob    u    u    	          5!!       S   ZmContact.prototype._handleResponseModifyb              b       5!!       O   ZmContact.prototype._handleResponseMoveb   J    J       "       5!!       =   ZmContact.prototype._setFolderb              R       5!!       A   ZmContact.prototype.notifyModifyb +    #                5!!       A   ZmContact.prototype.notifyDeleteb  T    L                5!!       C   ZmContact.prototype.initFromEmailb "        *     2       5!!       C   ZmContact.prototype.initFromPhoneb   %    %  :            5!!       9   ZmContact.prototype.getEmailb         F     2       5!!       9   ZmContact.prototype.getPhoneb          _            5!!       E   ZmContact.prototype.getLookupEmailb !        q     "       5!!       ;   ZmContact.prototype.getEmailsb               2       5!!       ?   ZmContact.prototype.getFullNameb P    H         b       5!!       S   ZmContact.prototype.getFullNameForDisplayc                           
   =                        !!   	   html   prefix   first   middle   maiden	   last   suffix   pattern   fileAsId   formatter	   args   .this       +H;!        W
  QV
      
:  F      V
     
   5   : D   
   QV
     
=   :       V
     
   5   : W   QV
     
   5   : W  QV
     
   5   : W  QV
     
   5   : W  QV
     
   5	   : W  QV
     
   5
   : W  Q   5   W  QV  E   '   V     (      5      *      5   ,   W  Q'   ,   V     -      5   W  Q/         
   5   : =   H   6   V
     
   5   : W  Q      
V  :  E?   ?   QV  =   IE*   A   QV  =   IE   C   QV  =   ID      E   =   W  QE      AV  ,  R W  QZ   V   `    V  `   V  `   V  `   V  `   V  `   W	  QT   -   P         
V     
V	  : C: U   V
      
V  V	  : +  	 $  %   isDistributionList   getAttr   ZmContact   F_dlDisplayName   fullName   F_namePrefix   F_firstName   F_middleName   F_maidenName   F_lastName   F_nameSuffix   ZmMsg   fullname)   fullnameMaidenSuffix   fullnameSuffix   fullnameMaiden   appCtxt   get   ZmSetting   LOCALE_NAME   ja   F_fileAs   AjxUtil   isEmpty   1   4   6   {0} {1} {2} {4}!   AjxMessageFormat   AjxStringUtil	   trim   format!   _getFullNameHtmlr       5!!       I   ZmContact.prototype._getFullNameHtmlb $	  	    /   2       5!!       =   ZmContact.prototype.getToolTipb ; u 3 u 	            5!!       ;   ZmContact.prototype.getFileAsb Y  Q  	     2       5!!       G   ZmContact.prototype.getFileAsNoNameb  3 l + l +	  .          5!!       ;   ZmContact.prototype.getHeaderb      5	            5!!       ?   ZmContact.prototype.getImageUrlb @  8  F	     B       5!!       _   ZmContact.prototype.addModifyZimletImageToBatchb     ]	     "       5!!       G   ZmContact.prototype.getCompanyFieldb  (     n	     r       5!!       I   ZmContact.prototype.getWorkAddrFieldb u  ! m  ! 	            5!!       I   ZmContact.prototype.getHomeAddrFieldb ! h" ! h" 	            5!!       K   ZmContact.prototype.getOtherAddrFieldb # # # # 	            5!!       E   ZmContact.prototype.getAddressBookb  ;$ $ 3$ $ 	     "       5!!       I   ZmContact.prototype._getAddressFieldb $ 1' $ 1' 	     @       5!!       C   ZmContact.prototype._initFullNameb ' _) ' _) 	     B       5!!       A   ZmContact.prototype._setFullNameb * + * + 
     2       5!!       C   ZmContact.prototype.__setFullNameb + 6- + 6- "
  ,   2       5!!       I   ZmContact.prototype.__setFullName_jab g- / _- / +
  /   2       5!!       G   ZmContact.prototype._addRequestAttrb :0 ;2 20 ;2 @
     p       5!!       Q   ZmContact.prototype._addContactGroupAttrb s2 3 k2 3 Z
     @       5!!       M   ZmContact.prototype._resetCachedFieldsb  S4 4 K4 4 p
            5!!       A   ZmContact.prototype._loadFromDomc  z
           	       4 p? 4 p?  
   Z                      !!   	   node   groups   ac   emails   i   .this       +H!!            !!       !!   isMinimal!!!!   isMember!!!!   isOwner!!!!%   subscriptionPolicy!!!!)   unsubscriptionPolicy!!!!   displayName!!!!   hideInGal!!    ;       X  Q   ?       W  QV  C6    QV  T  5   6   QV  T  5   D      QT  5   5   	   6   QV  5          V  T  5   6   Q   V  T  5   6   QV  T  5	   6
   QV  T  5   D      Q[       6   QT  5   '      V  5      5   T  5   8Q   V  T  5   D       QV  5   5   "   6   QT  5   '   %   V  5      5   T  5   8Q*   T  5   '   ,   V  5      5   T  5   8Q1   T  5   '   3   V  5      5   T  5   8Q8   V        
V  5   : 6   QV  5      5   7W   QV    D+   C   QV      rE   F   QV      >H   #   I   V     5   6   Q   L   V     5   6   QO      5   D   R   Q   5    T   W  QV  V  !   
V  5   : 6"   QV  #   
T  5$    QV  %   
:   &   _   V  &   
T  5'    Q   b   V  B6    Qc   V     (   
V  : 6)   QV  V  *   
:  6+   QV  5+   G  l   V  [   C],   T  5-   ]-   T  5.   ].   V  5   5/   ]0   V  5   51   ]2   T  53   D   z   Q=4   z   ]5   V  5   56   =7   ]8   69   QV  T  5:   BI6;   QV  <   
:  W  Q   5   D      Q   5       W  Q>W  Q =   m   V  =   
V  V  7V  5;    Q   V  W  QQ   V  V        T  5>         V  T  5>   6>   Q    

 
&=+Q 
 
% 
 
 
    isLoaded   rev   sf   _attrs   isGal   l   folderId   cd   created   md   modified	   attr   m   ZmContact   F_groups   ref   dn   email   F_email   email2   F_email2   email3   F_email3   mapAttrs   Array   length   ZmItem   CONTACT	   type   GROUP   window   parentAppCtxt   appCtxt   getById   addrbook   _parseTagNames   tn   isShared   _parseFlags   f   computeFileAs   _fileAs%   isDistributionList	   isDL   isMinimal   isMember   isOwnerQ   zimbraDistributionListSubscriptionPolicy%   subscriptionPolicyU   zimbraDistributionListUnsubscriptionPolicy)   unsubscriptionPolicy   d      displayName   zimbraHideInGal	   TRUE   hideInGal   dlInfo   exp   canExpand   getEmails#   setIsExpandableDL   certificate       5!!       G   ZmContact.prototype.getAttendeeTextb @ A @ A 
            5!!       E   ZmContact.prototype.getAttendeeKeyb  .B B &B B 
            5!!       I   ZmContact.prototype.getUnknownFieldsb pC E hC E 
  /   B       5!!       ;   ZmContact.prototype.getFieldsb E H E H      R       5!!       A   ZmContact.prototype.getDLMembersb I GO I GO '     b       5!!       _   ZmContact.prototype._handleResponseGetDLMembersb O rS |O rS O     r       5!!       G   ZmContact.prototype.getAllDLMembersb 5T U -T U v     2       5!!       G   ZmContact.prototype._getNextDLChunkb V JW 	V JW      2       5!!       ;   ZmContact.getContactFromCacheb !X Y X Y      @       5!!            !!            !!       5   ZmContact.initAttrVariantsc                       Y[ _ Q[ _                          !!
      attrClass	   keys   len   key   i	   attr   attrs   ignoreVariant   numRegex	   base      +H!!            !!%   ^([a-zA-Z]+)(\d+)$    !!       9   ZmContact.initAttrVariants/<c                     U] e^ M] e^     
                        !!      a   b   aMatch   bMatch       +H;      ?   T      
   : W   QT     
   : W  QV   E'   
   QV  E      QV   ?7V  ?7H         V   7V  7J      T  T       ?(      T  T             >            match0       5!!	   \d+$    ;       ]                                 
T  : W   QV      W  QZ    W  QT  5   D   	   Q[    
   W  Q>W  Q }   m
   V   V  7W  QV     
=   : >H>      T  V  7W  QV  V  7       V     
V   Q   V  W  QQ   V  V  y         QV     
    Q>W  Q    m   V  V  7W  QV     
   =	   : 
   
:  W  Q   5   V  7    %      5   V  Z    8Q)      5   V  7   
V   Q.   V  W  QQ/   V  V     N3   
&}k        &               Object	   keys   length'   IGNORE_ATTR_VARIANT   indexOf   F_	   push	   sort   replace      toLowerCase   ZmContact   ATTR_VARIANTS5!!       %   ZmContact.mapAttrsc                     =c 6e 5c 6e                           !!      attrs	   attr   value   baseAttrs   newAttrs   len   i       +H!!            ;         C                 /     [    W  QT  K  m   W   T  V   7W  QV            5   V      
:  7W  QV              
V  : W  Q      
V     V     : W  Q>W  Q 4   m   V  V  V  7V  V  78Q   V  W  QQ   V  V           V  V   V  8Q      QLM   QNV  (= )	&4"C          ZmContact   ATTR_VARIANTS   toLowerCase   AjxUtil   toArray	   Math   min   length`       5!!    1   !!   firstName!!!!   lastName!!!!   middleName!!!!   fullName!!!!   jobTitle!!!!   company!!!!   department!!!!   email!!!!   email2!!!!   email3!!!!   imAddress1!!!!   imAddress2!!!!   imAddress3!!!!   image!!!!   attachment!!!!   workStreet!!!!   workCity!!!!   workState!!!!   workPostalCode!!!!   workCountry!!!!   workURL!!!!   workPhone!!!!   workPhone2!!!!   workFax!!!!   assistantPhone!!!!   companyPhone!!!!   callbackPhone!!!!   homeStreet!!!!   homeCity!!!!   homeState!!!!   homePostalCode!!!!   homeCountry!!!!   homeURL!!!!   homePhone!!!!   homePhone2!!!!   homeFax!!!!   mobilePhone!!!!   pager!!!!   carPhone!!!!   otherStreet!!!!   otherCity!!!!   otherState!!!!   otherPostalCode!!!!   otherCountry!!!!   otherURL!!!!   otherPhone!!!!   otherFax!!!!   notes!!!!   birthday!!    !!          ZmContactListC x                  x z x z  
                          !!      search   isGal	   type   arguments   .this       +H!!            ;     v   	W   QW  QV       >         T D      Q   5   
   U Q      
V  T T  l QV  T CH6   QV  B6   QV  B6   QV     	   

   5   : 6   QV  5    $      V  V  [    6   6   Q   V  V  5   5   6   QV  V  5   5   6   QV  C6   Q  {      length   ZmItem   CONTACT   ZmList	   call   isGal   isCanonical   isLoaded   appCtxt   getApp   ZmApp   CONTACTS	   _app   _phoneToContact   _emailToContact   _byEmail   _byPhone'   _alwaysUpdateHashes3       5!!       A   ZmContactList.prototype.toStringb  { { { {   +          5!!       !!   fmt!!   cf!!   t!!   !!   all!!   all   !!       !!   id!!!!   l!!!!   d!!!!   fileAsStr!!!!   rev!!   !!       S   ZmContactList.prototype.addLoadedCallbackb _~ 	 W~ 	      2       5!!       M   ZmContactList.prototype._finishLoadingc                     Q % I %  
                           !!      callback   .this         +H;       S   6   	      G   W  Q       
=   V     
:  =    QV  C6   QV  5   E         m   V      
  Q   V  5      
:  W      "(6 	 	!    DBG   timePt   done loading 	   size    contacts   isLoaded!   _loadedCallbacks   run   shift2       5!!       9   ZmContactList.prototype.loadc                         
   -                       !!      callback   errorCallback   accountName   respCallback	   args   params   .this       +H!!       !!   asyncMode!!!!   noBusyOverlay!!!!   callback!!!!   errorCallback!!!!   offlineCallback!!    !!       !!	   path!!!!   qsArgs!!!!   qsReset!!    ;(        W  QV  C6    Q   AV  V  5   Z   T  `    ,  R W   Q      
=   C Q      
:  ,      T        T     
  Q      	   5
   W  Q   5   ;            
V  : W  QV        
:  6   Q    [    C]   C]   V   ]   T ]   T  ]   W  QV        
[   Z   =   `    T D   ,   Q      
:  /   `   	   5   `      
=   : ]   V  ]   C]   : 6    Q   !   
"   5#   =$   V  5     Q   %   
:  &   
V   Q	   '   
  Q1	        isCanonical   AjxCallback'   _handleResponseLoad   DBG   timePt/   requesting contact list   appCtxt#   isExternalAccount   run   ZmContactList   URL_ARGS   AjxEnv	   isIE   AjxUtil   hashCopy   ZmCsfeCommand   getSessionId   sid   asyncMode   noBusyOverlay   callback   errorCallback   offlineCallback   formatUrl   /home/   getUsername   URL	   join   	   path   qsArgs   qsReset   restUri   println   AjxDebug	   DBG1-   loading contacts from !   getAppController   sendRequest   addDlFolderB       5!!       W   ZmContactList.prototype._handleResponseLoadc                    7 $ / $  
   C                      !!      callback   result	   text   derefList   contacts   derefBatchCmd   i   len   fields   contact   attrs   groupMembers   foundDeref   j	   len1   value   dummy   .this       +H!!            !!            !!       !!	   type!!!!   value!!    !!       !!	   type!!!!   value!!    !!       !!	   type!!!!   value!!    ;       2                "       W  Q       
=    QT    
:  W   QV   E   	   QV   '=   I         V   5   W   Q   Z    W  QV   g     V      
   5   : W  Q	   AC@C,  R W  Q>W  QV  
   W  Q   m   V  V  7   
   5   : W  Q[    W  Q[   W  QZ    W	  QBW
  Q>W  QV  
   W  Q   m      5   V  V  77)   $   V  V  V  7V  V  ?78Q7  (   V  V  ?7W  QV  V  7x   5   Hy;   .      5   Hya   1      5   Hy   4   z   4   V	     
[      5   ]   V  ]    QCW
  Q   ;   V	     
[      5   ]   V  ]    QCW
  QY   B   V	     
[      5   ]   V  ]    QCW
  Q   I   V  V  V  7V  8QK   V  W  QL   V  V  lO   V     5   7=   H   T   V     5   V	  8QW   V
  r   X      AV  5   V  ,  R W  QV     
   AV  V  5   Z   @`    @`   V  `   C`   ,  R  Qe   V  V  6   QV     
V   Qh   V  W  QQi   V  V  l   V      
  Qn   V  !   
  QT     q   T      
  Qs   	     
   y   p xxx  #``"`  3   ) 6 2 ! ) "	    DBG   timePt!   got contact list   getResponse   string   _data   split   ZmContactList%   CONTACT_SPLIT_CHAR   ZmBatchCommand   length!   FIELD_SPLIT_CHAR!   IS_CONTACT_FIELD   ZmContact   F_memberC   F_memberG   F_memberI	   push#   GROUP_CONTACT_REF	   type   value   GROUP_GAL_REF!   GROUP_INLINE_REF   F_type   group   F_groups   id   add   AjxCallback	   load   _attrs   _addContact   run   _finishLoading       5!!       3   ZmContactList.addDlFolderc   0                   ^ _ V _      "                       !!      dlsFolder	   root   params         +H!!       !!   id!!!!	   name!!!!   parent!!!!	   tree!!!!	   type!!!!   numTotal!!!!   noTooltip!!    ;               
   5   :                  
   5   : W   Q       
   5   : W  QV            V   E#      QV     
   5   :             V          [       5   ]   	   5
   ]   V  ]   V  5   ]      5   ]   @]   C]   W  Q   AV  ,  R W   QV  5      
V    QV   C6   Q0   1   V   V  6   QV  5      
V    Q5   	 U 6	 U ; U @    appCtxt   get   ZmSetting%   DLS_FOLDER_ENABLED   getById   ZmOrganizer   ID_DLS   ID_ROOT   id   ZmMsg#   distributionLists	   name   parent	   tree   ADDRBOOK	   type   numTotal   noTooltip   ZmAddrBook   children   add   _isDL`       5!!       7   ZmContactList.prototype.addc  X                   A  A  
                           !!   	   item   index   .this       +H;      1   W   QT  5     D      QV   5   T  5    7 
   d      V   5      
T  T  QT  5           V   5   T  5    T  8Q   V      
T  C Q       id   _idHash   _vector   add   _updateHashes2       5!!       ;   ZmContactList.prototype.cacheb m = e = c     B          getId   B      d            5   B     g            55!!       G   ZmContactList.prototype._addContactc  |                    z   
   A                        !!      contact   fn   fl   .this       +H;        W  QT  V  6    QV     
T  C QZ    W   QZ    W  QT  5      5   7,      V      
T  5      5   7 Q   T  5      5   7,      V      
T  5      5   7 Q   T  5      5   7,   "   V      
T  5      5   7 Q(   V      1   *   T  5      5	   V   
   
=   : 8Q0   T  5      5   7,   5   V     
T  5      5   7 Q;   T  5      5   7,   @   V     
T  5      5   7 QF   T  5      5   V  
   
=   : 8QV     
T   Q
	)*(*)(+ 	   list   _updateHashes   _attrs   ZmContact   F_firstName	   push   F_middleName   F_lastName   length   X_fullName	   join       X_firstLast   addr       5!!       O   ZmContactList.prototype._realizeContactc                           `
  /                       !!      contact   idx	   args   obj   realContact   a   arguments   .this       +H!!       !!	   list!!    ;        	   Q 	  Q   ;    r               E    
   Q   5   ;   5                  [     	  ]      Q;      ;   5    	  5   7{ w     Q   E$      Q      
      : "      Q 	  5	      %    	  
   
:     Q   D$   *   Q 	     
   5   : /      Q         8Q 	     
   C Q 	  5      5      8Q=         -  
    ZmContact	   type   ZmItem   CONTACT	   list	   eval   ZmList   ITEM_CLASS   createFromDom   isCanonical   getArray   getIndexById   id   _updateHashes   _idHash5!!       I   ZmContactList.prototype.getIndexByIdc                     U  U  
                          !!      id   a   i   .this       +H;       %   Q      ~   S   W  QV      
:  W   Q>W  Q =   m   V   V  75   T        V     V  W  QQ	   V  V         @	&=+Q         getArray   id   length2       5!!       E   ZmContactList.prototype.getSubListb  L  L             5!!       ?   ZmContactList.prototype.getByIdb B  :              5!!       S   ZmContactList.prototype.getContactByEmailc                         
                           !!      address   contact   .this       +H;      Q   W  QT   D      QV  5              @   V  5   T     
:  7W   QV   8      V     
V   : W   QV   T  6   QV         @      
    isCanonical   _emailToContact   toLowerCase   _realizeContact   _lookupEmail2       5!!       S   ZmContactList.prototype.getContactByPhoneb M J E J      2       5!!       C   ZmContactList.prototype.moveItemsb  [  [ 2            5!!       g   ZmContactList.prototype._handleResponseMoveBatchCmdb  ~  ~ c     0       5!!       _   ZmContactList.prototype._handleResponseLoadMoveb     u            5!!       a   ZmContactList.prototype._handleResponseBatchLoadb  e  e             5!!       G   ZmContactList.prototype._getCopyCmdb          "       5!!       G   ZmContactList.prototype.deleteItemsb $ ;  ;      2       5!!       G   ZmContactList.deleteGalItemsAllowedb l U d U      @       5!!       E   ZmContactList.prototype._deleteDlsb  j } j      2       5!!       c   ZmContactList.prototype._deleteDlsResponseHandlerb  }  }      2       5!!       A   ZmContactList.prototype.setIsGalb  6  6             5!!       I   ZmContactList.prototype.notifyCreateb h [ ` [      3     @5!!       C   ZmContactList.prototype.moveLocalb  0  0      2       5!!       G   ZmContactList.prototype.deleteLocalb  R  R $     "       5!!       G   ZmContactList.prototype.modifyLocalb     1     b       5!!       G   ZmContactList.prototype.createLocalb  @  @ \            5!!       K   ZmContactList.prototype._updateHashesc  d                       
   +                      !!	      contact   doAdd   index   field   i   aname   avalue   digits   .this       +H!!       !!   contact!!!!   field!!    ;       L             ,                          3       |  W  QV  5       
T  T  Q>W   Q    m      5   V   7W  Q?W  Q m	   	         
V  V  : W  Q      
T  V  : W  QV         m      T +      V  5   V     
:  T  8Q#      V  5   V     
:  &Q   V  W  QQG   V   W   QQ   V      5      "   	   
   
   5   : D   (   QV  5   )   I  *   >W   Q   m*      5   V   7W  Q?W  Q m-   -         
V  V  : W  Q      
T  V  : W  QV      6      6   V     
V  : W  QV  U   9   T 4   :   V  5   V  [    T  ]   V  ]   8Q   ?   V  5   V  &Q@   V  W  QQ#A   V   W   QQB   V      5      H   
&      i&       k

	P# k t i< u i x&   3 y&       {

	P	  {  y=  y  	   _app   updateCache   ZmContact   EMAIL_FIELDS!   getAttributeName   getAttr   _emailToContact   toLowerCase   length   appCtxt   get   ZmSetting   VOICE_ENABLED'   _alwaysUpdateHashes   PHONE_FIELDS   _getPhoneDigits   _phoneToContact   contact   field       5!!       O   ZmContactList.prototype._getPhoneDigitsc                      q  i                             !!      phone        +H!!   [^\d]   ;         T      
    =   :     replace          5!!       E   ZmContactList.prototype._sortIndexb =  5       2       5!!       C   ZmContactList.prototype.getIdHashb  f  ^              5!!       c   ZmContactList.prototype._handleResponseModifyItemb  j  j             5!!       !   ZmContactsHelperB                  5!!       /   ZmContactsHelper.searchb                  5!!       O   ZmContactsHelper._processSearchResponseb h  `  	     `       5!!       E   ZmContactsHelper._addContactToListb  j  j &            5!!       ;   ZmContactsHelper._wrapContactb  =  = 4             5!!       G   ZmContactsHelper._wrapInlineContactb     S             5!!       ?   ZmContactsHelper._getEmailFieldb 9  1  f     `       5!!          ZmContactPickerB                 5!!       E   ZmContactPicker.prototype.toStringb    ~    -          5!!       ?   ZmContactPicker.prototype.popupb  |
 y |
             5!!       O   ZmContactPicker.prototype._resetResultsb  
  
              5!!       C   ZmContactPicker.prototype.popdownb  c [ [ [ !     "       5!!       A   ZmContactPicker.prototype.searchb  :#  :# 4           5!!       M   ZmContactPicker.prototype._contentHtmlb # o& z# o&      R       5!!       S   ZmContactPicker.prototype._resetSelectDivb  & 11 & 11             5!!       [   ZmContactPicker.prototype.getSearchFieldValueb l1 12 d1 12 (     "       5!!       U   ZmContactPicker.prototype._getDialogHeightb  j2 2 b2 2 2            5!!       W   ZmContactPicker.prototype._getSectionHeightb 2 N3 2 N3 7            5!!       Q   ZmContactPicker.prototype._resizeChooserb  3 5 |3 5 =            5!!       K   ZmContactPicker.prototype._initializeb 5 6C 5 6C P            5!!       G   ZmContactPicker.prototype.mapFieldsb gC F _C F      2       5!!       _   ZmContactPicker.prototype._searchButtonListenerb %G TG G TG             5!!       _   ZmContactPicker.prototype._handleResponseSearchb G N G N      b       5!!       M   ZmContactPicker.prototype._showResultsb N U N U      R       5!!       c   ZmContactPicker.prototype.loadSharedGroupContactsb U [ U [      R       5!!       k   ZmContactPicker.prototype.handleSharedContactResponseb [ f [ f P            5!!       W   ZmContactPicker.prototype._setResultsInViewb f f f f             5!!       W   ZmContactPicker.prototype._setNoResultsHtmlb ug g mg g             5!!       W   ZmContactPicker.prototype._updateSearchRowsb g j g j      B       5!!       Y   ZmContactPicker.prototype._handleErrorSearchb  hj j `j j             5!!       O   ZmContactPicker.prototype._pageListenerb j k j k      2       5!!       I   ZmContactPicker.prototype.getSubListb  l m yl m      "       5!!       [   ZmContactPicker.prototype._searchTypeListenerb m n m n      "       5!!       a   ZmContactPicker.prototype._resetSearchColHeadersb  n r n r   	   b       5!!       W   ZmContactPicker.prototype._okButtonListenerb `s s Xs s             5!!       _   ZmContactPicker.prototype._cancelButtonListenerb ?t t 7t t !            5!!       ;   ZmContactPicker._keyPressHdlrb t u t u *             5!!       !   ZmContactChooserB <w hw 4w hw C            5!!       a   ZmContactChooser.prototype._createSourceListViewb  #x [x x [x N            5!!       a   ZmContactChooser.prototype._createTargetListViewb  x y x y V            5!!       O   ZmContactChooser.prototype._isDuplicateb y :z y :z c            5!!       =   ZmContactChooserSourceListViewB { &| { &| t  )          5!!       c   ZmContactChooserSourceListView.prototype.toStringb  } } ~} }             5!!       u   ZmContactChooserSourceListView.prototype.getToolTipContentb }  }       B          ttParams   B ~ E ~ E             55!!       o   ZmContactChooserSourceListView.prototype._getHeaderListb                  5!!       o   ZmContactChooserSourceListView.prototype._resetColWidthb   E  E      B       5!!       w   ZmContactChooserSourceListView.prototype._calcRelativeWidthb  E  E      "       5!!       s   ZmContactChooserSourceListView.prototype._mouseOverActionb  |  |             5!!       s   ZmContactChooserSourceListView.prototype._getCellContentsb          0       5!!       s   ZmContactChooserSourceListView.prototype._getCellAttrTextb  @  @              5!!       =   ZmContactChooserTargetListViewB       )          5!!       c   ZmContactChooserTargetListView.prototype.toStringb   =  =             5!!       o   ZmContactChooserTargetListView.prototype._getHeaderListb            "       5!!       s   ZmContactChooserTargetListView.prototype._getCellContentsb  5  5 6     @       5!!       o   ZmContactChooserTargetListView.prototype._resetColWidthb   w  w L     B       5!!       w   ZmContactChooserTargetListView.prototype._calcRelativeWidthb  w  w b     "       5!!       s   ZmContactChooserTargetListView.prototype._getCellAttrTextb     v             5!!       B                 5!!       !!   id!!A   abook.Contacts#ZmEditContactView   !!       B          0       5!!       !!   id!!O   abook.Contacts#ZmEditContactView_header   !!       B H  @               5!!       !!   id!!W   abook.Contacts#ZmEditContactView_headerName   !!       B   w               5!!       !!   id!!]   abook.Contacts#ZmEditContactView_headerJobInfo   !!       B     3            5!!       !!   id!!K   abook.Contacts#ZmEditContactView_body   !!       B     ^            5!!       !!   id!!I   abook.Contacts#ZmEditContactViewRows   !!       B  o  o o            5!!       !!   id!![   abook.Contacts#ZmEditContactViewDetailsButton   !!       B                 5!!       !!   id!!W   abook.Contacts#ZmEditContactViewInputSelect   !!       B  $  $             5!!       !!   id!!c   abook.Contacts#ZmEditContactViewInputDoubleSelect   !!       B  S  S             5!!       !!   id!!K   abook.Contacts#ZmEditContactViewOther   !!       B                 5!!       !!   id!!U   abook.Contacts#ZmEditContactViewAddressRow   !!       B P  H              5!!       !!   id!![   abook.Contacts#ZmEditContactViewAddressSelect   !!       B  &  &             5!!       !!   id!!O   abook.Contacts#ZmEditContactViewAddress!!   class!!A   DwtForm ZmEditContactViewAddress   !!       B  &  &             5!!       !!   id!!1   abook.Contacts#SplitView   !!       B  T  T             5!!       !!   id!!A   abook.Contacts#SplitView_content   !!       B  U  U 9            5!!       !!   id!!=   abook.Contacts#SplitView_group   !!       B                 5!!       !!   id!!?   abook.Contacts#SplitView_header   !!       B  N  N             5!!       !!   id!!G   abook.Contacts#SplitView_headerName   !!       B     E     `       5!!       !!   id!!M   abook.Contacts#SplitView_headerJobInfo   !!       B h	  `	  u            5!!       !!   id!!W   abook.Contacts#SplitView_dlmember-collapsed   !!       B =  5              5!!       !!   id!!U   abook.Contacts#SplitView_dlmember-expanded   !!       B  }  }      `       5!!       !!   id!!M   abook.Contacts#SplitView_address_value   !!       B          0       5!!       !!   id!!E   abook.Contacts#SplitView_list_item   !!       B I  A               5!!       !!   id!!;   abook.Contacts#SplitViewGroup   !!       B s   " k   " ,            5!!       !!   id!!G   abook.Contacts#SimpleView-NoResults   !!       B w" N$ o" N$ =            5!!       !!   id!!1   abook.Contacts#GroupView   !!       B $ & $ & O            5!!       !!   id!!+   abook.Contacts#DlView   !!       B ' n= & n= b             5!!       !!   id!!?   abook.Contacts#DlPropertiesView   !!       B = M = M      P       5!!       !!   id!!?   abook.Contacts#GroupViewMembers   !!       B N Q M Q )     0       5!!       !!   id!!9   abook.Contacts#ZmAlphabetBar   !!       B Q [ Q [ I            5!!       !!   id!!-   abook.Contacts#Tooltip   !!       B (\ `  \ `      @       5!!       !!   id!!G   abook.Contacts#TooltipNotInAddrBook   !!       B Aa Pf 9a Pf      p       5!!       !!   id!!=   abook.Contacts#AddTooltipEntry   !!       B f x f x      P       5!!       !!   id!!=   abook.Contacts#ZmContactPicker   !!       B !y } y } ?             5!!       !!   id!!=   abook.Contacts#ZmContactSearch   !!       B A~ p 9~ p `            5!!       !!   id!!;   abook.Contacts#QuickAddPrompt   ;@  *           
=   : %            
=   :                 Q      A,  R  6   Q   5      6   Q   5   C6   Q   5      6	   Q   
   5   6   Q   5      6   Q   5      6   Q   5      6   Q%          
=   : n  )      5    Y  -            Q      A,  R  6   Q   5      6   Q   5   C6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6    Q   =!   6"   Q   =#   6$   Q   =%   6&   Q   ='   6(   Q   =)   6*   Q   =+   6,   Q   =-   6.   Q   =/   60   Q   =1   62   Q   =3   64   Q   =5   66   Q   =7   68   Q   =9   6:   Q   =;   6<   Q   ==   6>   Q   =?   6@   Q   =A   6B   Q   =C   6D   Q   =E   6F   Q   =G   6H   Q   =I   6J   Q   =K   6L   Q   =M   6N   Q   =O   6P   Q   =Q   6R   Q   =S   6T   Q   =U   6V   Q   =W   6X   Q   =Y   6Z   Q   =[   6\   Q   =]   6^   Q   =_   6`   Q   =a   6b   Q   =c   6d   Q   =e   6f   Q   =g   6h   Q   =i   6j   Q   =k   6l   Q   =m   6n   Q   =o   6p   Q   =q   6r   Q   =s   6t   Q   =u   6v   Q   =w   6x   Q   =y   6z   Q   ={   6|   Q   =}   6~   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =_   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q   =   6   Q     Q   Z      5h   `       5j   `      5r   `      5t   `      5v   `      5   `      5   `      5   `      5   `      5   `	      5   `
      5   `      5   `      5   `      5   `   6   Q   Z      5@   `       5   `      5   `      5   `   6   Q   Z      5|   `    6   Q   Z      5   `       5   `      5&   `   6   Q   Z      5   `       5   `      5   `      5$   `      5n   `      5l   `      5   `      5   `      5   `      5    `	      5   `
      5   `      5   `      5   `   6   Q   Z      5z   `       5   `      5b   `      5   `      5   `      5   `      5   `      5   `      5   `      5   `	      5   `
      5*   `      5"   `      5   `      5`   `      5d   `      5   `   6   Q   Z      5x   `       5   `      5   `   6   Q   Z      5   `       5   `      5   `      5   `      5   `      5   `      5   `      5   `   6   Q   Z      5   `       5   `      5   `      5   `      5   `   6   Q   Z      5   `       5   `      5   `   6   Q   Z    6   Q   P   6  Q   P   6  Q   	   6  Q     
  Q   [
   6  Q   5     5&   C8Q   5     5|   C8Q   5     5   C8Q      6  Q   5      6	   Q      6  Q      6  Q      6  Q      6	  Q      6
  Q      6  Q      6  Q      6  Q      6  Q      6  Q      6  Q      6  Q      6  Q      6  Q      6  Q   5      6  Q   5      6  Q   5      6  Q   5      6  Q   5       6  Q   5   !   6  Q   5   "   6  Q   5   #   6  Q   5   $   6  Q   5   %   6  Q   5   &   6  Q   5   '   6   Q   5   (   6!  Q   5   )   6"  Q   5   *   6#  Q   5   +   6$  Q   5   ,   6%  Q   5   -   6&  Q   5   .   6'  Q   5   /   6(  Q   5   0   6   Q   5   1   6)  Q   5   2   6*  Q   5   3   6  Q   5   4   6  Q   5   5   6+  Q   5   6   6,  Q   5   7   6-  Q   5   8   6.  Q   5   9   6/  Q   5   :   60  Q   5   ;   6  Q   5   <   61  Q   5   =   62  Q   5   >   63  Q   5   ?   64  Q   5   @   65  Q   5   A   66  Q   5   B   67  Q   5   C   68  Q   5   D   69  Q   5   E   6:  Q   5   F   6;  Q   5   G   6<  Q   5   H   6=  Q   5   I   6>  Q   5   J   6?  Q   5   K   6@  Q   5   L   6A  Q   5   M   6B  Q   5   N   6C  Q   5   O   6D  Q   5   P   6E  Q   5   Q   6F  Q   5   R   6G  Q   5   S   6H  Q   5   T   6I  Q   5   U   6J  Q   5   V   6K  Q   5   W   6L  Q   5   X   6M  Q   5   Y   6N  Q   5   Z   6O  Q   5   [   6P  Q   5   \   6Q  Q   5   ]   6R  Q   5   ^   6S  Q   5   _   6T  Q   5   `   6U  Q   Z   @`       5   `   @`   @`      5   `   @`   6V  Q   5   a   6W  Q   5   b   6X  Q   5   c   6Y  Q   5   d   6Z  Q      6[  6\  Q   5   e   6]  Q   5   f   6^  Q   5   g   6_  Q   5   h   6`  Q   5   i   6a  Q   5   j   6b  Q   5   k   6c  Q   5   l   6d  Q   5   m   6e  Q   5   n   6f  Q   5   o   6g  Q   5   p   6h  Q   5      5   5h  6i  Q   5   q   6j  Q   5   r   6k  Q   5   s   6l  Q   5   t   6m  Q   5   u   6n  Q   5   v   6o  Q   5   w   6p  Q   5   x   6q  Q   5   y   6r  Q   5   z   6s  Q   5   {   6t  Q   5   |   6u  Q   }   6v  Q   [~   6w  Q   [   6x  Q   5x     5f   C8Q      6y  Q   y  
    Q      6z  Q   [   {  5|  ]a   {  5}  ]   {  5~  ]   {  5  ]   {  5  ]   {  5  ]!   {  5  ])   {  5  ]?   {  5  ]A   {  5  ]C   {  5  ]}   {  5  ]   {  5  ]   {  5  ]y   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]#   {  5  ]   {  5  ]u   {  5  ]g   {  5  ]s   {  5  ]q   {  5  ]i   {  5  ]w   {  5  ]m   {  5  ]o   {  5  ]k   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5  ]   {  5   ]   {  5  ]   6  Q   Y    ?{  5  ^{  5  ^{  5  ^{  5  ^{  5  ^{  5  ^{  5  ^6  QT         
=  : }  X         Q    A,  R  6   Q  5     6   Q  5   C6  Q  5      6	   Q  =  6  Q  P   6  Q  =  6  Q  =  6  Q  P   6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q     6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q     6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q         
=  : z            Q     6  Q     6  Q     6  Q     6  Q     6  Q     6  Q         
=  : @           Q    A,  R  6   Q  5     6   Q  5   C6  Q  5      6	   Q  X6  Q  =  6  Q  =  6  Q  =?   6  Q  =  6  Q  =  6  Q  Z     5  `      5  `     5  `     5  `   6  Q  Z     5  `      5  `     5  `     5  `   6  Q  Z     5  `      5  `     5  `     5  `     5  `   6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6   Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q     6  Q       Q  	  A,  R  6   Q  5     6   Q  5      6
  Q  5      6  Q  5      6  Q       Q    A,  R  6   Q  5     6   Q  5      6	   Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q       Q    A,  R  6   Q  5     6   Q  5      6	   Q  5      6  Q  5     5   5  6  Q  5      6  Q  5      6  Q  5      6  Q  5      6  Q         
=  :         
=     P   B Q    
=      
=  :     
=  :  Q    
=     P   B Q    
=     P   B Q    
=     P   B Q    
=      P   B Q    
=!     P   B Q    
="     P   B Q    
=#     P   B Q    
=$     P   B Q    
=%     P   B Q    
=&     P   B Q    
='     P   B Q    
=(     P   B Q    
=)     P   B Q    
=*     P   B Q    
=+     P  B Q    
=,    P  B Q    
=-    P  B Q    
=.    P  B Q    
=/    P	  B Q    
=0  
  P  B Q    
=1    P  B Q    
=2    P  B Q    
=3    P  B Q    
=4    P  B Q    
=5    P  B Q    
=6    P  B Q    
=7    P  B Q    
=8    P  B Q    
=9    P  B Q    
=:    P  B Q    
=;     P!  B Q    
=<  "  P#  B Q    
==  $  P%  B Q    
=>  &  P'  B Q    
=?  (  P)  B Q[  #UZ]cgu~         j 
     . [ j        0 I W e o           C O f }            * 4 > H R ] {       E ^ p       & 4 > P c n |       ) 9 E ^ p      	 	 	+ 	4 	9 	E 	\ 	m 	 	 	 	 	 	 
 
" 
+ 
: 
? 
Y 
o 
y 
 
 
  & N u    
   F x       / W b {       1 b t          # 0 [ c         % 3 R e w  "!!     3   ' 1 6 < O      O            ) C M U b t y+          +   - 5 K a u }  ~ 3=       .  2 Y 2 ] j ] n } n                       4  8  8     @  D p D t  t           '  + 8 + < J < N ] N a  a  $  ( D ( H  H        :  > [ > _ z _     AjxPackage   define   ContactsCoreC   zimbraMail.abook.model.ZmAddrBook   ZmAddrBook   ZmFolder   prototype   constructor   isZmAddrBook   toString   ZmOrganizer   ID_ADDRBOOK   ID_ADDRESSBOOK   getIcon)   supportsPublicAccess   mayContainA   zimbraMail.abook.model.ZmContact   window   ZmContact   ZmItem   isZmContact   anniversary   F_anniversary   assistantPhone!   F_assistantPhone   attachment   F_attachment   birthday   F_birthday   callbackPhone   F_callbackPhone   carPhone   F_carPhone   company   F_company   companyPhone   F_companyPhone   custom   F_custom   description   F_description   department   F_department   dlist   F_dlist   dldisplayname   F_dlDisplayName   dldesc   F_dlDesc   dlhideingal   F_dlHideInGal   dlnotes   F_dlNotes   dlsubspolicy-   F_dlSubscriptionPolicy   dlmailpolicy   F_dlMailPolicy7   dlmailpolicyspecificmailers;   F_dlMailPolicySpecificMailers   dlunsubspolicy1   F_dlUnsubscriptionPolicy   dllistowners   F_dlListOwners   email   F_email   email2   F_email2   email3   F_email3   email4   F_email4   email5   F_email5   email6   F_email6   email7   F_email7   email8   F_email8   email9   F_email9   email10   F_email10   email11   F_email11   email12   F_email12   email13   F_email13   email14   F_email14   email15   F_email15   email16   F_email16   fileAs   F_fileAs   firstName   F_firstName   folderId   F_folderId   groups   F_groups   homeCity   F_homeCity   homeCountry   F_homeCountry   homeFax   F_homeFax   homePhone   F_homePhone   homePhone2   F_homePhone2   homePostalCode!   F_homePostalCode   homeState   F_homeState   homeStreet   F_homeStreet   homeURL   F_homeURL   image   F_image   imAddress   F_imAddress   imAddress1   F_imAddress1   imAddress2   F_imAddress2   imAddress3   F_imAddress3   jobTitle   F_jobTitle   lastName   F_lastName   maidenName   F_maidenName   memberC   F_memberC   memberG   F_memberG   memberI   F_memberI   middleName   F_middleName   mobilePhone   F_mobilePhone   namePrefix   F_namePrefix   nameSuffix   F_nameSuffix   nickname   F_nickname   notes   F_notes   otherCity   F_otherCity   otherCountry   F_otherCountry   otherFax   F_otherFax   otherPhone   F_otherPhone   otherPostalCode#   F_otherPostalCode   otherState   F_otherState   otherStreet   F_otherStreet   otherURL   F_otherURL   pager   F_pager#   phoneticFirstName'   F_phoneticFirstName!   phoneticLastName%   F_phoneticLastName   phoneticCompany#   F_phoneticCompany	   type   F_type   workAltPhone   F_workAltPhone   workCity   F_workCity   workCountry   F_workCountry   workEmail1   F_workEmail1   workEmail2   F_workEmail2   workEmail3   F_workEmail3   workFax   F_workFax   workMobile   F_workMobile   workPhone   F_workPhone   workPhone2   F_workPhone2   workPostalCode!   F_workPostalCode   workState   F_workState   workStreet   F_workStreet   workURL   F_workURL   imagepart   F_imagepart   zimletImage   F_zimletImage   X_fileAs   firstLast   X_firstLast   fullName   X_fullName   vcardXProps   X_vcardXProps!   outlookUserField%   X_outlookUserField   cardOwner   MC_cardOwner   workCardMessage%   MC_workCardMessage   homeCardMessage%   MC_homeCardMessage   homePhotoURL   MC_homePhotoURL   workPhotoURL   MC_workPhotoURL   modifyTimeStamp)   GAL_MODIFY_TIMESTAMP   createTimeStamp)   GAL_CREATE_TIMESTAMP   zimbraId   GAL_ZIMBRA_ID   objectClass!   GAL_OBJECT_CLASS7   zimbraMailForwardingAddress1   GAL_MAIL_FORWARD_ADDRESS!   zimbraCalResType!   GAL_CAL_RES_TYPE?   zimbraCalResLocationDisplayName)   GAL_CAL_RES_LOC_NAME   ADDRESS_FIELDS   EMAIL_FIELDS   IM_FIELDS   OTHER_FIELDS   PHONE_FIELDS   PRIMARY_FIELDS   URL_FIELDS   GAL_FIELDS   MYCARD_FIELDS   X_FIELDS)   IGNORE_NORMALIZATION   ADDR_PREFIXES   ADDR_SUFFIXES)   updateFieldConstants   IS_ADDONE!   getAttributeName   createFromDom   compareByFileAs   computeFileAs   fileAsFirstLast   fileAsLastFirst#   fileAsNameCompany#   fileAsCompanyName'   computeCustomFileAs   getAttr   getPrefix%   getNormalizedAttrs   __RE_ATTRIBUTE   __BY_ATTRIBUTE   setAttr   isInTrash	   load'   _handleLoadResponse   clear   isEmpty   isShared   isReadOnly   isLocked   isGroup%   isDistributionList   getGroupMembers%   getAllGroupMembers%   gatherExtraDlStuff1   _handleGetDlInfoResponse   loadDlMembers7   _handleGetDlMembersResponse   _getOwners   _getMailPolicy   loadDlInfo%   toggleSubscription   getId   getIconLarge   getFolderId)   setParticipantStatus)   getParticipantStatus%   setParticipantRole%   getParticipantRole   removeAttr   getAttrs   create+   _handleResponseCreate   createFromVCard5   _handleResponseCreateVCard/   _handleErrorCreateVCard   modify   _createDl7   _addMailPolicyAndOwnersReqs%   _addMemberModsReqs   _modifyDl%   _getAddOrRemoveReq   _getRenameDlReq!   _getSetOwnersReq)   _getSetMailPolicyReq   _addDlAttribute!   _getDlAttributes   _getCreateDlReq3   _getModifyDlAttributesReq1   _modifyDlResponseHandler1   _createDlResponseHandler   _popView   _handleErrorDl   clearDlInfo+   _handleResponseModify'   _handleResponseMove   _setFolder   notifyModify   notifyDelete   initFromEmail   initFromPhone   getEmail   getPhone   getLookupEmail   getEmails   getFullName+   getFullNameForDisplay!   _getFullNameHtml   __RUBY_FIELDS   getToolTip   getFileAs   getFileAsNoName   getHeader'   NO_MAX_IMAGE_HEIGHT%   NO_MAX_IMAGE_WIDTH   getImageUrl7   addModifyZimletImageToBatch   getCompanyField!   getWorkAddrField!   getHomeAddrField#   getOtherAddrField   getAddressBook!   _getAddressField   _initFullName   _setFullName   __setFullName!   __setFullName_ja'   __setFullName_ja_JP   _addRequestAttr)   _addContactGroupAttr%   _resetCachedFields   _loadFromDom   getAttendeeText   getAttendeeKey!   getUnknownFields   getFields   getDLMembers7   _handleResponseGetDLMembers   getAllDLMembers   _getNextDLChunk'   getContactFromCache   ATTR_VARIANTS'   IGNORE_ATTR_VARIANT!   initAttrVariants   mapAttrs   ZmMsg%   AB_FIELD_firstName#   AB_FIELD_lastName'   AB_FIELD_middleName#   AB_FIELD_fullName#   AB_FIELD_jobTitle!   AB_FIELD_company'   AB_FIELD_department   AB_FIELD_email   AB_FIELD_email2   AB_FIELD_email3'   AB_FIELD_imAddress1'   AB_FIELD_imAddress2'   AB_FIELD_imAddress3   AB_FIELD_image'   AB_FIELD_attachment   AB_FIELD_street   AB_FIELD_city   AB_FIELD_state'   AB_FIELD_postalCode!   AB_FIELD_country   AB_FIELD_URL%   AB_FIELD_workPhone'   AB_FIELD_workPhone2!   AB_FIELD_workFax/   AB_FIELD_assistantPhone+   AB_FIELD_companyPhone-   AB_FIELD_callbackPhone%   AB_FIELD_homePhone'   AB_FIELD_homePhone2!   AB_FIELD_homeFax)   AB_FIELD_mobilePhone   AB_FIELD_pager#   AB_FIELD_carPhone'   AB_FIELD_otherPhone#   AB_FIELD_otherFax#   AB_FIELD_birthday   _AB_FIELD)   AB_FILE_AS_lastFirst)   AB_FILE_AS_firstLast%   AB_FILE_AS_company7   AB_FILE_AS_lastFirstCompany7   AB_FILE_AS_firstLastCompany7   AB_FILE_AS_companyLastFirst7   AB_FILE_AS_companyFirstLast   _AB_FILE_ASI   zimbraMail.abook.model.ZmContactList   ZmContactList   ZmList   isZmContactList   /Contacts   URL   URL_ARGS   %   CONTACT_SPLIT_CHAR   !   FIELD_SPLIT_CHAR!   IS_CONTACT_FIELD#   addLoadedCallback   _finishLoading'   _handleResponseLoad   addDlFolder   add   cache   _addContact   _realizeContact   getIndexById   getSubList   getById#   getContactByEmail#   getContactByPhone   moveItems7   _handleResponseMoveBatchCmd/   _handleResponseLoadMove1   _handleResponseBatchLoad   _getCopyCmd   deleteItems+   deleteGalItemsAllowed   _deleteDls3   _deleteDlsResponseHandler   setIsGal   notifyCreate   moveLocal   deleteLocal   modifyLocal   createLocal   _updateHashes   _getPhoneDigits   _sortIndex   getIdHash3   _handleResponseModifyItemM   zimbraMail.abook.view.ZmContactsHelper!   ZmContactsHelper   search-   _processSearchResponse#   _addContactToList   _wrapContact%   _wrapInlineContact   _getEmailFieldK   zimbraMail.abook.view.ZmContactPicker   ZmContactPicker   DwtDialog#   isZmContactPicker   DIALOG_HEIGHT   SEARCH_BASIC	   name   SEARCH_NAME   SEARCH_EMAIL	   dept   SEARCH_DEPT   phonetic   SEARCH_PHONETIC   SHOW_ON_GAL   SHOW_ON_NONGAL   ALL   popup   _resetResults   popdown   _contentHtml   _resetSelectDiv'   getSearchFieldValue!   _getDialogHeight#   _getSectionHeight   _resizeChooser   _initialize   mapFields+   _searchButtonListener+   _handleResponseSearch   _showResults/   loadSharedGroupContacts7   handleSharedContactResponse#   _setResultsInView#   _setNoResultsHtml#   _updateSearchRows%   _handleErrorSearch   _pageListener'   _searchTypeListener-   _resetSearchColHeaders#   _okButtonListener+   _cancelButtonListener   _keyPressHdlr!   ZmContactChooser   DwtChooser+   _createSourceListView+   _createTargetListView   _isDuplicate=   ZmContactChooserSourceListView%   DwtChooserListView#   getToolTipContent   _getHeaderList   _resetColWidth%   _calcRelativeWidth!   _mouseOverAction!   _getCellContents!   _getCellAttrText=   ZmContactChooserTargetListView   abook.Contacts   AjxTemplate   registerA   abook.Contacts#ZmEditContactView   getTemplate   getParamsO   abook.Contacts#ZmEditContactView_headerW   abook.Contacts#ZmEditContactView_headerName]   abook.Contacts#ZmEditContactView_headerJobInfoK   abook.Contacts#ZmEditContactView_bodyI   abook.Contacts#ZmEditContactViewRows[   abook.Contacts#ZmEditContactViewDetailsButtonW   abook.Contacts#ZmEditContactViewInputSelectc   abook.Contacts#ZmEditContactViewInputDoubleSelectK   abook.Contacts#ZmEditContactViewOtherU   abook.Contacts#ZmEditContactViewAddressRow[   abook.Contacts#ZmEditContactViewAddressSelectO   abook.Contacts#ZmEditContactViewAddress1   abook.Contacts#SplitViewA   abook.Contacts#SplitView_content=   abook.Contacts#SplitView_group?   abook.Contacts#SplitView_headerG   abook.Contacts#SplitView_headerNameM   abook.Contacts#SplitView_headerJobInfoW   abook.Contacts#SplitView_dlmember-collapsedU   abook.Contacts#SplitView_dlmember-expandedM   abook.Contacts#SplitView_address_valueE   abook.Contacts#SplitView_list_item;   abook.Contacts#SplitViewGroupG   abook.Contacts#SimpleView-NoResults1   abook.Contacts#GroupView+   abook.Contacts#DlView?   abook.Contacts#DlPropertiesView?   abook.Contacts#GroupViewMembers9   abook.Contacts#ZmAlphabetBar-   abook.Contacts#TooltipG   abook.Contacts#TooltipNotInAddrBook=   abook.Contacts#AddTooltipEntry=   abook.Contacts#ZmContactPicker=   abook.Contacts#ZmContactSearch;   abook.Contacts#QuickAddPrompt       ])7])7@y]Om   ;    :https://email.gov.in/js/ContactsCore_all.js?v=190211031025 necko:classified 1 strongly-framed 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAAAAgAAAAAAAAAAAAAAAAAAAAEAMQFmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAdDMIIHPzCCBiegAwIBAgISA0DgdGX7pgreZyUpLn1NNde3MA0GCSqGSIb3DQEBCwUAMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQDExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xOTA2MDgxMzUyMjRaFw0xOTA5MDYxMzUyMjRaMBkxFzAVBgNVBAMTDm1haWwubXAuZ292LmluMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1HsZVwyOhpgXE4XwQNk7S+OdVJvp/dp8eDm4oquIUSHbs0leuoTpOVDUmTwcMQKjiDG9W8tt7U275tJrUMcmTh0Rny/LD+W3MVOBVT5HUfRvPIbceBUbo5walMOgjQTSjI7GTftLvf9LBgfKXHbpF+q8FfsCfddNZBsIqKwtN/JysKWEjZDQe7h91kyiclDpjLf6mojVw4EM7FlchWkYt8dfrduErPmqyC9Td8n107CF4AWYGaBusqM/ZpQvaZHQEh76zAG8Vt2fBfkg7b9GoEmbvl892qmFy2DJR/x7vOtI/iwshbT/5eZrkwRW2vWCP9ExumE8MCyaUnE+d2TeDwIDAQABo4IETjCCBEowDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBRwnV4DZ23j8GGDj0DbaMNFUrNvFDAfBgNVHSMEGDAWgBSoSmpjBH3duubRObemRWXv86jsoTBvBggrBgEFBQcBAQRjMGEwLgYIKwYBBQUHMAGGImh0dHA6Ly9vY3NwLmludC14My5sZXRzZW5jcnlwdC5vcmcwLwYIKwYBBQUHMAKGI2h0dHA6Ly9jZXJ0LmludC14My5sZXRzZW5jcnlwdC5vcmcvMIICAgYDVR0RBIIB+TCCAfWCCmFpai5nb3YuaW6CDmFwc3RhdGUubmljLmlugg9jYWwubWFpbC5nb3YuaW6CDGVtYWlsLmdvdi5pboIKaWFmLm5pYy5pboIQaW1hcC5tYWlsLmdvdi5pboIWaW5kaWFuanVkaWNpYXJ5Lmdvdi5pboIUamhhcmtoYW5kbWFpbC5nb3YuaW6CCWthLmdvdi5pboIRbWFpbC5hc3NhbS5nb3YuaW6CF21haWwuYXNzYW1wb2xpY2UuZ292LmlughFtYWlsLmVpcy5lcm5ldC5pboILbWFpbC5nb3YuaW6CD21haWwubWVhLmdvdi5pboIObWFpbC5tcC5nb3YuaW6CC21haWwubmljLmlugg5tYWlsLnVwLm5pYy5pboIVbWlncmF0aW9uLm1haWwuZ292Lmlugg5uYXVzZW5hLm5pYy5pboIPcG9wLm1haWwuZ292LmlughFwdW5qYWJtYWlsLmdvdi5pboINc2Fuc2FkLm5pYy5pboIQc210cC5tYWlsLmdvdi5pboIOdG5zdGF0ZS5uaWMuaW6CEXZhanJhLm1haWwuZ292LmlughN3ZWJtYWlsLmFpcmluZGlhLmlughF3ZWJtYWlsLmVpbC5jby5pboIOd2VibWFpbC5uaWMuaW6CEHd3dy5lbWFpbC5nb3YuaW4wTAYDVR0gBEUwQzAIBgZngQwBAgEwNwYLKwYBBAGC3xMBAQEwKDAmBggrBgEFBQcCARYaaHR0cDovL2Nwcy5sZXRzZW5jcnlwdC5vcmcwggEEBgorBgEEAdZ5AgQCBIH1BIHyAPAAdgB0ftqDMa0zEJEhnM4lT0Jwwr/9XkIgCMY3NXnmEHvMVgAAAWs3k4wUAAAEAwBHMEUCIQC4sQlweBMvoRaGWEzAxP3I+iDA+57hqsVYHfnUYzXugAIgeo6ukCPhDIeqdkuYm6XSTnEp7OSgFOl4kar8F1JHWNgAdgBj8tvN6DvMLM8LcoQnV2szpI1hd4+9daY4scdoVEvYjQAAAWs3k4wxAAAEAwBHMEUCIETuvDxSFju4BVvumv1jIxLYVNoHLoNyrrsiQEo6AihCAiEAnSX25bPM9SUBVUa1/6SKe4LcRpDJsOUdTmlLph+kCo4wDQYJKoZIhvcNAQELBQADggEBAJOK5+R6NsDyyMDmfneJutJfGx1g2VdFV7w5sPZ+VfJqp41MmvK3eYgZEsKctYztpH8cCqtWYymxp4FIXQo7lKqlnN5vndfBts6YjqX2vWWW2+Si1LGyYMwNEKvmVs5jgzxSAxoauJMKPtTz4uSgnOX4oPo0VqWjE65gVE8sQaDA0/JqqFEtrUmCompqMiTNsGz69SUtDVM+T3G0GIgIUy8CamBp00GdnLIb42NT4/mlK9VzzwZn4foy307f3/W30xTQefSiUZXI14gElMQlpCu3jRyzWSe+oagOvK9nXQ63AjNF1DLl3kO5KiKMSo9uRKLuFaHQbGt4NAg+Ne5QmgLAMAADAAAAAAEBAAAAAAAABG5vbmUAAAAQUlNBLVBLQ1MxLVNIQTUxMgGVn7FlZRdIf6ub2JE75TGXrnTNpc0vRz+W9fC3//YsaAAAAANmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAdDMIIHPzCCBiegAwIBAgISA0DgdGX7pgreZyUpLn1NNde3MA0GCSqGSIb3DQEBCwUAMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQDExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xOTA2MDgxMzUyMjRaFw0xOTA5MDYxMzUyMjRaMBkxFzAVBgNVBAMTDm1haWwubXAuZ292LmluMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1HsZVwyOhpgXE4XwQNk7S+OdVJvp/dp8eDm4oquIUSHbs0leuoTpOVDUmTwcMQKjiDG9W8tt7U275tJrUMcmTh0Rny/LD+W3MVOBVT5HUfRvPIbceBUbo5walMOgjQTSjI7GTftLvf9LBgfKXHbpF+q8FfsCfddNZBsIqKwtN/JysKWEjZDQe7h91kyiclDpjLf6mojVw4EM7FlchWkYt8dfrduErPmqyC9Td8n107CF4AWYGaBusqM/ZpQvaZHQEh76zAG8Vt2fBfkg7b9GoEmbvl892qmFy2DJR/x7vOtI/iwshbT/5eZrkwRW2vWCP9ExumE8MCyaUnE+d2TeDwIDAQABo4IETjCCBEowDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBRwnV4DZ23j8GGDj0DbaMNFUrNvFDAfBgNVHSMEGDAWgBSoSmpjBH3duubRObemRWXv86jsoTBvBggrBgEFBQcBAQRjMGEwLgYIKwYBBQUHMAGGImh0dHA6Ly9vY3NwLmludC14My5sZXRzZW5jcnlwdC5vcmcwLwYIKwYBBQUHMAKGI2h0dHA6Ly9jZXJ0LmludC14My5sZXRzZW5jcnlwdC5vcmcvMIICAgYDVR0RBIIB+TCCAfWCCmFpai5nb3YuaW6CDmFwc3RhdGUubmljLmlugg9jYWwubWFpbC5nb3YuaW6CDGVtYWlsLmdvdi5pboIKaWFmLm5pYy5pboIQaW1hcC5tYWlsLmdvdi5pboIWaW5kaWFuanVkaWNpYXJ5Lmdvdi5pboIUamhhcmtoYW5kbWFpbC5nb3YuaW6CCWthLmdvdi5pboIRbWFpbC5hc3NhbS5nb3YuaW6CF21haWwuYXNzYW1wb2xpY2UuZ292LmlughFtYWlsLmVpcy5lcm5ldC5pboILbWFpbC5nb3YuaW6CD21haWwubWVhLmdvdi5pboIObWFpbC5tcC5nb3YuaW6CC21haWwubmljLmlugg5tYWlsLnVwLm5pYy5pboIVbWlncmF0aW9uLm1haWwuZ292Lmlugg5uYXVzZW5hLm5pYy5pboIPcG9wLm1haWwuZ292LmlughFwdW5qYWJtYWlsLmdvdi5pboINc2Fuc2FkLm5pYy5pboIQc210cC5tYWlsLmdvdi5pboIOdG5zdGF0ZS5uaWMuaW6CEXZhanJhLm1haWwuZ292LmlughN3ZWJtYWlsLmFpcmluZGlhLmlughF3ZWJtYWlsLmVpbC5jby5pboIOd2VibWFpbC5uaWMuaW6CEHd3dy5lbWFpbC5nb3YuaW4wTAYDVR0gBEUwQzAIBgZngQwBAgEwNwYLKwYBBAGC3xMBAQEwKDAmBggrBgEFBQcCARYaaHR0cDovL2Nwcy5sZXRzZW5jcnlwdC5vcmcwggEEBgorBgEEAdZ5AgQCBIH1BIHyAPAAdgB0ftqDMa0zEJEhnM4lT0Jwwr/9XkIgCMY3NXnmEHvMVgAAAWs3k4wUAAAEAwBHMEUCIQC4sQlweBMvoRaGWEzAxP3I+iDA+57hqsVYHfnUYzXugAIgeo6ukCPhDIeqdkuYm6XSTnEp7OSgFOl4kar8F1JHWNgAdgBj8tvN6DvMLM8LcoQnV2szpI1hd4+9daY4scdoVEvYjQAAAWs3k4wxAAAEAwBHMEUCIETuvDxSFju4BVvumv1jIxLYVNoHLoNyrrsiQEo6AihCAiEAnSX25bPM9SUBVUa1/6SKe4LcRpDJsOUdTmlLph+kCo4wDQYJKoZIhvcNAQELBQADggEBAJOK5+R6NsDyyMDmfneJutJfGx1g2VdFV7w5sPZ+VfJqp41MmvK3eYgZEsKctYztpH8cCqtWYymxp4FIXQo7lKqlnN5vndfBts6YjqX2vWWW2+Si1LGyYMwNEKvmVs5jgzxSAxoauJMKPtTz4uSgnOX4oPo0VqWjE65gVE8sQaDA0/JqqFEtrUmCompqMiTNsGz69SUtDVM+T3G0GIgIUy8CamBp00GdnLIb42NT4/mlK9VzzwZn4foy307f3/W30xTQefSiUZXI14gElMQlpCu3jRyzWSe+oagOvK9nXQ63AjNF1DLl3kO5KiKMSo9uRKLuFaHQbGt4NAg+Ne5QmgJmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAASWMIIEkjCCA3qgAwIBAgIQCgFBQgAAAVOFc2oLheynCDANBgkqhkiG9w0BAQsFADA/MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMTDkRTVCBSb290IENBIFgzMB4XDTE2MDMxNzE2NDA0NloXDTIxMDMxNzE2NDA0NlowSjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxIzAhBgNVBAMTGkxldCdzIEVuY3J5cHQgQXV0aG9yaXR5IFgzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnNMM8FrlLke3cl03g7NoYzDq1zUmGSXhvb418XCSL7e4S0EFq6meNQhY7LEqxGiHC6PjdeTm86dicbp5gWAf15Gan/PQeGdxyGkOlZHP/uaZ6WA8SMx+yk13EiSdRxta67nsHjcAHJyse6cF6s5K671B5TaYucv9bTyWaN8jKkKQDIZ0Z8h/pZq4UmEUEz9l6YKHy9v6Dlb2honzhT+Xhq+w3Brvaw2VFn3EK6BlspkENnWAa6xK8xuQSXgvopZPKiAlKQTGdMDQMc2PMTiVFrqoM7hD8bEfwzB/onkxEz0tNvjj/PIzark5McWvxI0NHWQWM6r6hCm21AvA2H3DkwIDAQABo4IBfTCCAXkwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwfwYIKwYBBQUHAQEEczBxMDIGCCsGAQUFBzABhiZodHRwOi8vaXNyZy50cnVzdGlkLm9jc3AuaWRlbnRydXN0LmNvbTA7BggrBgEFBQcwAoYvaHR0cDovL2FwcHMuaWRlbnRydXN0LmNvbS9yb290cy9kc3Ryb290Y2F4My5wN2MwHwYDVR0jBBgwFoAUxKexpHsscfrb4UuQdf/EFWCFiRAwVAYDVR0gBE0wSzAIBgZngQwBAgEwPwYLKwYBBAGC3xMBAQEwMDAuBggrBgEFBQcCARYiaHR0cDovL2Nwcy5yb290LXgxLmxldHNlbmNyeXB0Lm9yZzA8BgNVHR8ENTAzMDGgL6AthitodHRwOi8vY3JsLmlkZW50cnVzdC5jb20vRFNUUk9PVENBWDNDUkwuY3JsMB0GA1UdDgQWBBSoSmpjBH3duubRObemRWXv86jsoTANBgkqhkiG9w0BAQsFAAOCAQEA3TPXEfNjWDjdGBX7CVW+dla5cEilaUcne8IkCJLxWh9KEik3JHRRHGJouM2VcGfl96S8TihRzZvoroed6ti6WqEBmtzw3Wodatg+VyOeph4EYpr/1wXKtx8/wApIvJSwtmVi4MFU5aMqrSDE6ea73Mj2tcMyo5jMd6jmeWUHK8so/joWUoHOUgwuX4Po1QYz+3dszkDqMp4fklxBwXRsW10KXzPMTZ+sOPAveyxindmjkW8lGy+QsRlGPfZ+G6Z6h7mjem0Y+iWlkYcV4PIWL1iwBi8saCbGS5jN2p8M+X+Q7UNKEkROb3N6KOqkqm57TH2H3eDJAkSnh6/DNFu0QmYKMiaRXE/7uyCJhaYy3wW9w5eaVCJM1YWJaWtuluqDAAAAAAAAA04wggNKMIICMqADAgECAhBEr7CA1qMnuokwOYYu+EBrMA0GCSqGSIb3DQEBBQUAMD8xJDAiBgNVBAoTG0RpZ2l0YWwgU2lnbmF0dXJlIFRydXN0IENvLjEXMBUGA1UEAxMORFNUIFJvb3QgQ0EgWDMwHhcNMDAwOTMwMjExMjE5WhcNMjEwOTMwMTQwMTE1WjA/MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMTDkRTVCBSb290IENBIFgzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA36/pl1AIg1e0zGJl9pCC7MfTLGswylvs2cN9x0DBGBSL4Ogzdkkq4z8hSZOsTg6vPkjLZe780yEPZdIq2TKPjOX3d7ASe7WVwImjqbrtcy56DAYyg6J+ihQwzRGg4So4uXkKMf1QvYBl37dRY4PI4ohh6kthgexSa7mi4ksaKJ9Io54M2gmOPhcuHt0g31vGKoqrLr1wrcULGiWQdHLFe2qrNNYwif/laBN7VAvI1q7sWpySHj1ks4zG37/JQXDsFnLVJuw4VTlD0Pz9GFxA8Zfr1ZqbjR262iW5xtjfwRUCOqvabvE+LvVcCJw81oNp5BCbGSq2KVfj5T2bn/ACXQIDAQABo0IwQDAPBgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAdBgNVHQ4EFgQUxKexpHsscfrb4UuQdf/EFWCFiRAwDQYJKoZIhvcNAQEFBQADggEBAKMaLJsXAFypHu4oZjc6v4PHP0vDCaCVIF3j2VlE0j4NPr2KS6B0H84Qgpx0Gh1+mBrdyxNLsyBE5JHpzPx9pdtq5f7m/eBO3bcAOrVwSa/y5esC8dECixnLlDpeSMQYHlgZXx4CWvAM8bGtqdxZhotu6ZH1hsr6uWYzqllbzuKnFnNHyyvMmbA3SM/jVkv1zw8McjKHxvBEu1NybUP1JkiaUme3WKv+Z3ZxeNsNolYUEzkkMYWiqAJaMEfh3VAHvAIJkADrZGNgmxa8iMkS5tJ9kYv5PTKNZbTpfLFXdurFtig5vxVlHMj2d5ZqCo13C9iRCwSOB9sptgrunYI1NRAA request-method GET request-Accept-Encoding gzip, deflate, br request-User-Agent Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:67.0) Gecko/20100101 Firefox/67.0 response-head HTTP/1.1 200 OK
Server: nginx
Date: Fri, 12 Jul 2019 00:21:33 GMT
Content-Type: application/x-javascript
X-Frame-Options: SAMEORIGIN
Expires: Sun, 11 Aug 2019 01:21:33 GMT
Cache-Control: public, max-age=2595600
Last-Modified: Sun, 03 Mar 2019 15:01:10 GMT
Accept-Ranges: bytes
Vary: Accept-Encoding, User-Agent
 original-response-headers Server: nginx
Date: Fri, 12 Jul 2019 00:21:33 GMT
Content-Type: application/x-javascript
Connection: keep-alive
X-Frame-Options: SAMEORIGIN
Expires: Sun, 11 Aug 2019 01:21:33 GMT
Cache-Control: public, max-age=2595600
Last-Modified: Sun, 03 Mar 2019 15:01:10 GMT
Accept-Ranges: bytes
Vary: Accept-Encoding, User-Agent
Transfer-Encoding: chunked
 uncompressed-len 0 net-response-time-onstart 45 net-response-time-onstop 64 alt-data 1;230057,javascript/moz-bytecode-20190620092152 alt-data-from-child 1  