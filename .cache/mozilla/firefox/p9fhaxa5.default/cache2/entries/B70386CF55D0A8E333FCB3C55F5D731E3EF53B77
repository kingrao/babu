// retourne un objet xmlHttpRequest.
// méthode compatible entre tous les navigateurs (IE/Firefox/Opera)
function getXMLHTTP(){
  var xhr=null;
  if(window.XMLHttpRequest) // Firefox et autres
  xhr = new XMLHttpRequest();
  else if(window.ActiveXObject){ // Internet Explorer
    try {
      xhr = new ActiveXObject("Msxml2.XMLHTTP");
    } catch (e) {
      try {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      } catch (e1) {
        xhr = null;
      }
    }
  }
  else { // XMLHttpRequest non supporté par le navigateur
    alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
  }
  return xhr;
}

var _documentForm=null; // le formulaire contenant notre champ texte
var _inputField=null; // le champ texte lui-même
//var _submitButton=null; // le bouton submit de notre formulaire

function initAutoComplete(form,field){
  _documentForm=form;
  _inputField=field;
  //_submitButton=submit;
  _inputField.autocomplete="off";
  creeAutocompletionDiv();
  _currentInputFieldValue=_inputField.value;
  _oldInputFieldValue=_currentInputFieldValue;
  cacheResults("",new Array())
  document.onkeydown=onKeyDownHandler;
  _inputField.onkeyup=onKeyUpHandler;
  _inputField.onblur=onBlurHandler;
  window.onresize=onResizeHandler;
  // Premier déclenchement de la fonction dans 200 millisecondes
  setTimeout("mainLoop()",200)
}

var _oldInputFieldValue=""; // valeur précédente du champ texte
var _currentInputFieldValue=""; // valeur actuelle du champ texte
var _resultCache=new Object(); // mécanisme de cache des requetes

// tourne en permanence pour suggerer suite à un changement du champ texte
function mainLoop(){
  if(_oldInputFieldValue!=_currentInputFieldValue){
    var valeur=escapeURI(_currentInputFieldValue);
    var suggestions=_resultCache[_currentInputFieldValue];
    if(suggestions){ // la réponse était encore dans le cache
      metsEnPlace(valeur,suggestions)
    }else{
      callSuggestions(valeur) // appel distant
    }
    _inputField.focus()
  }
  _oldInputFieldValue=_currentInputFieldValue;
  setTimeout("mainLoop()",200); // la fonction se redéclenchera dans 200 ms
  return true
}

// echappe les caractère spéciaux
function escapeURI(La){
  if(encodeURIComponent) {
    return encodeURIComponent(La);
  }
  if(escape) {
    return escape(La)
  }
}

var _xmlHttp = null; //l'objet xmlHttpRequest utilisé pour contacter le serveur
var _adresseRecherche = "/defacerlist" //l'adresse à interroger pour trouver les suggestions

function callSuggestions(valeur){
  if(_xmlHttp&&_xmlHttp.readyState!=0){
    _xmlHttp.abort()
  }
  _xmlHttp=getXMLHTTP();
  if(_xmlHttp){
    //appel à l'url distante
    _xmlHttp.open("GET",_adresseRecherche+"/"+valeur,true);
    _xmlHttp.onreadystatechange=function() {
      if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
        var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
        cacheResults(valeur,liste)
        metsEnPlace(valeur,liste)
      }
    };
    // envoi de la requete
    _xmlHttp.send(null)
  }
}

// Mecanisme de caching des réponses
function cacheResults(debut,suggestions){
  _resultCache[debut]=suggestions
}

// Transformation XML en tableau
function traiteXmlSuggestions(xmlDoc) {
  var options = xmlDoc.getElementsByTagName('option');
  var optionsListe = new Array();
  for (var i=0; i < options.length; ++i) {
    optionsListe.push(options[i].firstChild.data);
  }
  return optionsListe;
}

//insère une règle avec son nom
function insereCSS(nom,regle){
  if (document.styleSheets) {
    var I=document.styleSheets[0];
    if(I.addRule){ // méthode IE
      I.addRule(nom,regle)
    }else if(I.insertRule){ // méthode DOM
      I.insertRule(nom+" { "+regle+" }",I.cssRules.length)
    }
  }
}

function initStyle(){
  var AutoCompleteDivListeStyle="font-size: 13px; font-family: arial,sans-serif; word-wrap:break-word; ";
  var AutoCompleteDivStyle="display: block; padding-left: 3; padding-right: 3; height: 16px; overflow: hidden; background-color: white;";
  var AutoCompleteDivActStyle="background-color: #3366cc; color: white ! important; ";
  insereCSS(".AutoCompleteDivListeStyle",AutoCompleteDivListeStyle);
  insereCSS(".AutoCompleteDiv",AutoCompleteDivStyle);
  insereCSS(".AutoCompleteDivAct",AutoCompleteDivActStyle);
}

function setStylePourElement(c,name){
  c.className=name;
}

// calcule le décalage à gauche
function calculateOffsetLeft(r){
  return calculateOffset(r,"offsetLeft")
}

// calcule le décalage vertical
function calculateOffsetTop(r){
  return calculateOffset(r,"offsetTop")
}

function calculateOffset(r,attr){
  var kb=0;
  while(r){
    kb+=r[attr];
    r=r.offsetParent
  }
  return kb
}

// calcule la largeur du champ
function calculateWidth(){
  return _inputField.offsetWidth-2*1
}

function setCompleteDivSize(){
  if(_completeDiv){
    _completeDiv.style.left=calculateOffsetLeft(_inputField)+"px";
    _completeDiv.style.top=calculateOffsetTop(_inputField)+_inputField.offsetHeight-1+"px";
    _completeDiv.style.width=calculateWidth()+"px"
  }
}

function creeAutocompletionDiv() {
  initStyle();
  _completeDiv=document.createElement("DIV");
  _completeDiv.id="completeDiv";
  var borderLeftRight=1;
  var borderTopBottom=1;
  _completeDiv.style.borderRight="black "+borderLeftRight+"px solid";
  _completeDiv.style.borderLeft="black "+borderLeftRight+"px solid";
  _completeDiv.style.borderTop="black "+borderTopBottom+"px solid";
  _completeDiv.style.borderBottom="black "+borderTopBottom+"px solid";
  _completeDiv.style.zIndex="1";
  _completeDiv.style.paddingRight="0";
  _completeDiv.style.paddingLeft="0";
  _completeDiv.style.paddingTop="0";
  _completeDiv.style.paddingBottom="0";
  setCompleteDivSize();
  _completeDiv.style.visibility="hidden";
  _completeDiv.style.position="absolute";
  _completeDiv.style.backgroundColor="white";
  document.body.appendChild(_completeDiv);
  setStylePourElement(_completeDiv,"AutoCompleteDivListeStyle");
}

function metsEnPlace(valeur, liste){
  while(_completeDiv.childNodes.length>0) {
    _completeDiv.removeChild(_completeDiv.childNodes[0]);
  }
  // mise en place des suggestions
  for(var f=0; f<liste.length; ++f){
    var nouveauDiv=document.createElement("DIV");
    nouveauDiv.onmousedown=divOnMouseDown;
    nouveauDiv.onmouseover=divOnMouseOver;
    nouveauDiv.onmouseout=divOnMouseOut;
    setStylePourElement(nouveauDiv,"AutoCompleteDiv");
    var nouveauSpan=document.createElement("SPAN");
    nouveauSpan.innerHTML=decodeURIComponent(liste[f]) // le texte de la suggestion
    nouveauDiv.appendChild(nouveauSpan);
    _completeDiv.appendChild(nouveauDiv)
  }
  PressAction();
  if(_completeDivRows>0) {
    _completeDiv.height=16*_completeDivRows+4;
  } else {
    hideCompleteDiv();
  }

}

var _lastKeyCode=null;

// Handler pour le keydown du document
var onKeyDownHandler=function(event){
  // accès evenement compatible IE/Firefox
  if(!event&&window.event) {
    event=window.event;
  }
  // on enregistre la touche ayant déclenché l'evenement
  if(event) {
    _lastKeyCode=event.keyCode;
  }
}

var _eventKeycode = null;

// Handler pour le keyup de lu champ texte
var onKeyUpHandler=function(event){
  // accès evenement compatible IE/Firefox
  if(!event&&window.event) {
    event=window.event;
  }
  _eventKeycode=event.keyCode;
  // Dans les cas touches touche haute(38) ou touche basse (40)
  if(_eventKeycode==40||_eventKeycode==38) {
    // on autorise le blur du champ (traitement dans onblur)
    blurThenGetFocus();
  }
  // taille de la selection
  var N=rangeSize(_inputField);
  // taille du texte avant la selection (selection = suggestion d'autocomplétion)
  var v=beforeRangeSize(_inputField);
  // contenu du champ texte
  var V=_inputField.value;
  if(_eventKeycode!=0){
    if(N>0&&v!=-1) {
      // on recupere uniquement le champ texte tapé par l'utilisateur
      V=V.substring(0,v);
    }
    // 13 = touche entrée
    if(_eventKeycode==13||_eventKeycode==3){
      var d=_inputField;
      // on mets en place l'ensemble du champ texte en repoussant la selection
      if(_inputField.createTextRange){
        var t=_inputField.createTextRange();
        t.moveStart("character",_inputField.value.length);
        _inputField.select()
      } else if (d.setSelectionRange){
        _inputField.setSelectionRange(_inputField.value.length,_inputField.value.length)
      }
    } else {
      // si on a pas pu agrandir le champ non selectionné, on le mets en place violemment.
      if(_inputField.value!=V) {
        _inputField.value=V
      }
    }
  }
  // si la touche n'est ni haut, ni bas, on stocke la valeur utilisateur du champ
  if(_eventKeycode!=40&&_eventKeycode!=38) {
    // le champ courant n est pas change si key Up ou key Down
  	_currentInputFieldValue=V;
  }
  if(handleCursorUpDownEnter(_eventKeycode)&&_eventKeycode!=0) {
    // si on a préssé une touche autre que haut/bas/enter
    PressAction();
  }
}

// Change la suggestion selectionné.
// cette méthode traite les touches haut, bas et enter
function handleCursorUpDownEnter(eventCode){
  if(eventCode==40){
    highlightNewValue(_highlightedSuggestionIndex+1);
    return false
  }else if(eventCode==38){
    highlightNewValue(_highlightedSuggestionIndex-1);
    return false
  }else if(eventCode==13||eventCode==3){
    return false
  }
  return true
}

var _completeDivRows = 0;
var _completeDivDivList = null;
var _highlightedSuggestionIndex = -1;
var _highlightedSuggestionDiv = null;

// gère une touche pressée autre que haut/bas/enter
function PressAction(){
  _highlightedSuggestionIndex=-1;
  var suggestionList=_completeDiv.getElementsByTagName("div");
  var suggestionLongueur=suggestionList.length;
  // on stocke les valeurs précédentes
  // nombre de possibilités de complétion
  _completeDivRows=suggestionLongueur;
  // possiblités de complétion
  _completeDivDivList=suggestionList;
  // si le champ est vide, on cache les propositions de complétion
  if(_currentInputFieldValue==""||suggestionLongueur==0){
    hideCompleteDiv()
  }else{
    showCompleteDiv()
  }
  var trouve=false;
  // si on a du texte sur lequel travailler
  if(_currentInputFieldValue.length>0){
    var indice;
    // T vaut true si on a dans la liste de suggestions un mot commencant comme l'entrée utilisateur
    for(indice=0; indice<suggestionLongueur; indice++){
      if(getSuggestion(suggestionList.item(indice)).toUpperCase().indexOf(_currentInputFieldValue.toUpperCase())==0) {
        trouve=true;
        break
      }
    }
  }
  // on désélectionne toutes les suggestions
  for(var i=0; i<suggestionLongueur; i++) {
    setStylePourElement(suggestionList.item(i),"AutoCompleteDiv");
  }
  // si l'entrée utilisateur (n) est le début d'une suggestion (n-1) on sélectionne cette suggestion avant de continuer
  if(trouve){
    _highlightedSuggestionIndex=indice;
    _highlightedSuggestionDiv=suggestionList.item(_highlightedSuggestionIndex);
  }else{
    _highlightedSuggestionIndex=-1;
    _highlightedSuggestionDiv=null
  }
  var supprSelection=false;
  switch(_eventKeycode){
    // cursor left, cursor right, page up, page down, others??
    case 8:
    case 33:
    case 34:
    case 35:
    case 35:
    case 36:
    case 37:
    case 39:
    case 45:
    case 46:
      // on supprime la suggestion du texte utilisateur
      supprSelection=true;
      break;
    default:
      break
  }
  // si on a une suggestion (n-1) sélectionnée
  if(!supprSelection&&_highlightedSuggestionDiv){
    setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
    var z;
    if(trouve) {
      z=getSuggestion(_highlightedSuggestionDiv).substr(0);
    } else {
      z=_currentInputFieldValue;
    }
    if(z!=_inputField.value){
      if(_inputField.value!=_currentInputFieldValue) {
        return;
      }
      // si on peut créer des range dans le document
      if(_inputField.createTextRange||_inputField.setSelectionRange) {
        _inputField.value=z;
      }
      // on sélectionne la fin de la suggestion
      if(_inputField.createTextRange){
        var t=_inputField.createTextRange();
        t.moveStart("character",_currentInputFieldValue.length);
        t.select()
      }else if(_inputField.setSelectionRange){
        _inputField.setSelectionRange(_currentInputFieldValue.length,_inputField.value.length)
      }
    }
  }else{
    // sinon, plus aucune suggestion de sélectionnée
    _highlightedSuggestionIndex=-1;
  }
}

var _cursorUpDownPressed = null;

// permet le blur du champ texte après que la touche haut/bas ai été pressé.
// le focus est récupéré après traitement (via le timeout).
function blurThenGetFocus(){
  _cursorUpDownPressed=true;
  _inputField.blur();
  setTimeout("_inputField.focus();",10);
  return
}

// taille de la selection dans le champ input
function rangeSize(n){
  var N=-1;
  if(n.createTextRange){
    var fa=document.selection.createRange().duplicate();
    N=fa.text.length
  }else if(n.setSelectionRange){
    N=n.selectionEnd-n.selectionStart
  }
  return N
}

// taille du champ input non selectionne
function beforeRangeSize(n){
  var v=0;
  if(n.createTextRange){
    var fa=document.selection.createRange().duplicate();
    fa.moveEnd("textedit",1);
    v=n.value.length-fa.text.length
  }else if(n.setSelectionRange){
    v=n.selectionStart
  }else{
    v=-1
  }
  return v
}

// Place le curseur à la fin du champ
function cursorAfterValue(n){
  if(n.createTextRange){
    var t=n.createTextRange();
    t.moveStart("character",n.value.length);
    t.select()
  } else if(n.setSelectionRange) {
    n.setSelectionRange(n.value.length,n.value.length)
  }
}


// Retourne la valeur de la possibilite (texte) contenu dans une div de possibilite
function getSuggestion(uneDiv){
  if(!uneDiv) {
    return null;
  }
  return trimCR(uneDiv.getElementsByTagName('span')[0].firstChild.data)
}

// supprime les caractères retour chariot et line feed d'une chaine de caractères
function trimCR(chaine){
  for(var f=0,nChaine="",zb="\n\r"; f<chaine.length; f++) {
    if (zb.indexOf(chaine.charAt(f))==-1) {
      nChaine+=chaine.charAt(f);
    }
  }
  return nChaine
}

// Cache completement les choix de completion
function hideCompleteDiv(){
  _completeDiv.style.visibility="hidden"
}

// Rends les choix de completion visibles
function showCompleteDiv(){
  _completeDiv.style.visibility="visible";
  setCompleteDivSize()
}

// Change la suggestion en surbrillance
function highlightNewValue(C){
  if(!_completeDivDivList||_completeDivRows<=0) {
    return;
  }
  showCompleteDiv();
  if(C>=_completeDivRows){
    C=_completeDivRows-1
  }
  if(_highlightedSuggestionIndex!=-1&&C!=_highlightedSuggestionIndex){
    setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDiv");
    _highlightedSuggestionIndex=-1
  }
  if(C<0){
    _highlightedSuggestionIndex=-1;
    _inputField.focus();
    return
  }
  _highlightedSuggestionIndex=C;
  _highlightedSuggestionDiv=_completeDivDivList.item(C);
  setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
  _inputField.value=getSuggestion(_highlightedSuggestionDiv);
}

// Handler de resize de la fenetre
var onResizeHandler=function(event){
  // recalcule la taille des suggestions
  setCompleteDivSize();
}

// Handler de blur sur le champ texte
var onBlurHandler=function(event){
  if(!_cursorUpDownPressed){
    // si le blur n'est pas causé par la touche haut/bas
    hideCompleteDiv();
    // Si la dernière touche préssé est tab, on passe au bouton de validation
    if(_lastKeyCode==9){
      //_submitButton.focus();
      _lastKeyCode=-1
    }
  }
  _cursorUpDownPressed=false
};

// declenchee quand on clique sur une div contenant une possibilite
var divOnMouseDown=function(){
  _inputField.value=getSuggestion(this);
  
};

// declenchee quand on passe sur une div de possibilite. La div précédente est passee en style normal
var divOnMouseOver=function(){
  if(_highlightedSuggestionDiv) {
    setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDiv");
  }
  setStylePourElement(this,"AutoCompleteDivAct")
};

// declenchee quand la sourie quitte une div de possiblite. La div repasse a l'etat normal
var divOnMouseOut = function(){
  setStylePourElement(this,"AutoCompleteDiv");
};







        20190620092152                        F?      F?        F?      / /   r e t o u r n e   u n   o b j e t   x m l H t t p R e q u e s t . 
 / /   m ýÿt h o d e   c o m p a t i b l e   e n t r e   t o u s   l e s   n a v i g a t e u r s   ( I E / F i r e f o x / O p e r a ) 
 f u n c t i o n   g e t X M L H T T P ( ) { 
     v a r   x h r = n u l l ; 
     i f ( w i n d o w . X M L H t t p R e q u e s t )   / /   F i r e f o x   e t   a u t r e s 
     x h r   =   n e w   X M L H t t p R e q u e s t ( ) ; 
     e l s e   i f ( w i n d o w . A c t i v e X O b j e c t ) {   / /   I n t e r n e t   E x p l o r e r 
         t r y   { 
             x h r   =   n e w   A c t i v e X O b j e c t ( " M s x m l 2 . X M L H T T P " ) ; 
         }   c a t c h   ( e )   { 
             t r y   { 
                 x h r   =   n e w   A c t i v e X O b j e c t ( " M i c r o s o f t . X M L H T T P " ) ; 
             }   c a t c h   ( e 1 )   { 
                 x h r   =   n u l l ; 
             } 
         } 
     } 
     e l s e   {   / /   X M L H t t p R e q u e s t   n o n   s u p p o r t ýÿ  p a r   l e   n a v i g a t e u r 
         a l e r t ( " V o t r e   n a v i g a t e u r   n e   s u p p o r t e   p a s   l e s   o b j e t s   X M L H T T P R e q u e s t . . . " ) ; 
     } 
     r e t u r n   x h r ; 
 } 
 
 v a r   _ d o c u m e n t F o r m = n u l l ;   / /   l e   f o r m u l a i r e   c o n t e n a n t   n o t r e   c h a m p   t e x t e 
 v a r   _ i n p u t F i e l d = n u l l ;   / /   l e   c h a m p   t e x t e   l u i - m ýÿm e 
 / / v a r   _ s u b m i t B u t t o n = n u l l ;   / /   l e   b o u t o n   s u b m i t   d e   n o t r e   f o r m u l a i r e 
 
 f u n c t i o n   i n i t A u t o C o m p l e t e ( f o r m , f i e l d ) { 
     _ d o c u m e n t F o r m = f o r m ; 
     _ i n p u t F i e l d = f i e l d ; 
     / / _ s u b m i t B u t t o n = s u b m i t ; 
     _ i n p u t F i e l d . a u t o c o m p l e t e = " o f f " ; 
     c r e e A u t o c o m p l e t i o n D i v ( ) ; 
     _ c u r r e n t I n p u t F i e l d V a l u e = _ i n p u t F i e l d . v a l u e ; 
     _ o l d I n p u t F i e l d V a l u e = _ c u r r e n t I n p u t F i e l d V a l u e ; 
     c a c h e R e s u l t s ( " " , n e w   A r r a y ( ) ) 
     d o c u m e n t . o n k e y d o w n = o n K e y D o w n H a n d l e r ; 
     _ i n p u t F i e l d . o n k e y u p = o n K e y U p H a n d l e r ; 
     _ i n p u t F i e l d . o n b l u r = o n B l u r H a n d l e r ; 
     w i n d o w . o n r e s i z e = o n R e s i z e H a n d l e r ; 
     / /   P r e m i e r   d ýÿc l e n c h e m e n t   d e   l a   f o n c t i o n   d a n s   2 0 0   m i l l i s e c o n d e s 
     s e t T i m e o u t ( " m a i n L o o p ( ) " , 2 0 0 ) 
 } 
 
 v a r   _ o l d I n p u t F i e l d V a l u e = " " ;   / /   v a l e u r   p r ýÿc ýÿd e n t e   d u   c h a m p   t e x t e 
 v a r   _ c u r r e n t I n p u t F i e l d V a l u e = " " ;   / /   v a l e u r   a c t u e l l e   d u   c h a m p   t e x t e 
 v a r   _ r e s u l t C a c h e = n e w   O b j e c t ( ) ;   / /   m ýÿc a n i s m e   d e   c a c h e   d e s   r e q u e t e s 
 
 / /   t o u r n e   e n   p e r m a n e n c e   p o u r   s u g g e r e r   s u i t e   ýÿ  u n   c h a n g e m e n t   d u   c h a m p   t e x t e 
 f u n c t i o n   m a i n L o o p ( ) { 
     i f ( _ o l d I n p u t F i e l d V a l u e ! = _ c u r r e n t I n p u t F i e l d V a l u e ) { 
         v a r   v a l e u r = e s c a p e U R I ( _ c u r r e n t I n p u t F i e l d V a l u e ) ; 
         v a r   s u g g e s t i o n s = _ r e s u l t C a c h e [ _ c u r r e n t I n p u t F i e l d V a l u e ] ; 
         i f ( s u g g e s t i o n s ) {   / /   l a   r ýÿp o n s e   ýÿt a i t   e n c o r e   d a n s   l e   c a c h e 
             m e t s E n P l a c e ( v a l e u r , s u g g e s t i o n s ) 
         } e l s e { 
             c a l l S u g g e s t i o n s ( v a l e u r )   / /   a p p e l   d i s t a n t 
         } 
         _ i n p u t F i e l d . f o c u s ( ) 
     } 
     _ o l d I n p u t F i e l d V a l u e = _ c u r r e n t I n p u t F i e l d V a l u e ; 
     s e t T i m e o u t ( " m a i n L o o p ( ) " , 2 0 0 ) ;   / /   l a   f o n c t i o n   s e   r e d ýÿc l e n c h e r a   d a n s   2 0 0   m s 
     r e t u r n   t r u e 
 } 
 
 / /   e c h a p p e   l e s   c a r a c t ýÿr e   s p ýÿc i a u x 
 f u n c t i o n   e s c a p e U R I ( L a ) { 
     i f ( e n c o d e U R I C o m p o n e n t )   { 
         r e t u r n   e n c o d e U R I C o m p o n e n t ( L a ) ; 
     } 
     i f ( e s c a p e )   { 
         r e t u r n   e s c a p e ( L a ) 
     } 
 } 
 
 v a r   _ x m l H t t p   =   n u l l ;   / / l ' o b j e t   x m l H t t p R e q u e s t   u t i l i s ýÿ  p o u r   c o n t a c t e r   l e   s e r v e u r 
 v a r   _ a d r e s s e R e c h e r c h e   =   " / d e f a c e r l i s t "   / / l ' a d r e s s e   ýÿ  i n t e r r o g e r   p o u r   t r o u v e r   l e s   s u g g e s t i o n s 
 
 f u n c t i o n   c a l l S u g g e s t i o n s ( v a l e u r ) { 
     i f ( _ x m l H t t p & & _ x m l H t t p . r e a d y S t a t e ! = 0 ) { 
         _ x m l H t t p . a b o r t ( ) 
     } 
     _ x m l H t t p = g e t X M L H T T P ( ) ; 
     i f ( _ x m l H t t p ) { 
         / / a p p e l   ýÿ  l ' u r l   d i s t a n t e 
         _ x m l H t t p . o p e n ( " G E T " , _ a d r e s s e R e c h e r c h e + " / " + v a l e u r , t r u e ) ; 
         _ x m l H t t p . o n r e a d y s t a t e c h a n g e = f u n c t i o n ( )   { 
             i f ( _ x m l H t t p . r e a d y S t a t e = = 4 & & _ x m l H t t p . r e s p o n s e X M L )   { 
                 v a r   l i s t e   =   t r a i t e X m l S u g g e s t i o n s ( _ x m l H t t p . r e s p o n s e X M L ) 
                 c a c h e R e s u l t s ( v a l e u r , l i s t e ) 
                 m e t s E n P l a c e ( v a l e u r , l i s t e ) 
             } 
         } ; 
         / /   e n v o i   d e   l a   r e q u e t e 
         _ x m l H t t p . s e n d ( n u l l ) 
     } 
 } 
 
 / /   M e c a n i s m e   d e   c a c h i n g   d e s   r ýÿp o n s e s 
 f u n c t i o n   c a c h e R e s u l t s ( d e b u t , s u g g e s t i o n s ) { 
     _ r e s u l t C a c h e [ d e b u t ] = s u g g e s t i o n s 
 } 
 
 / /   T r a n s f o r m a t i o n   X M L   e n   t a b l e a u 
 f u n c t i o n   t r a i t e X m l S u g g e s t i o n s ( x m l D o c )   { 
     v a r   o p t i o n s   =   x m l D o c . g e t E l e m e n t s B y T a g N a m e ( ' o p t i o n ' ) ; 
     v a r   o p t i o n s L i s t e   =   n e w   A r r a y ( ) ; 
     f o r   ( v a r   i = 0 ;   i   <   o p t i o n s . l e n g t h ;   + + i )   { 
         o p t i o n s L i s t e . p u s h ( o p t i o n s [ i ] . f i r s t C h i l d . d a t a ) ; 
     } 
     r e t u r n   o p t i o n s L i s t e ; 
 } 
 
 / / i n s ýÿr e   u n e   r ýÿg l e   a v e c   s o n   n o m 
 f u n c t i o n   i n s e r e C S S ( n o m , r e g l e ) { 
     i f   ( d o c u m e n t . s t y l e S h e e t s )   { 
         v a r   I = d o c u m e n t . s t y l e S h e e t s [ 0 ] ; 
         i f ( I . a d d R u l e ) {   / /   m ýÿt h o d e   I E 
             I . a d d R u l e ( n o m , r e g l e ) 
         } e l s e   i f ( I . i n s e r t R u l e ) {   / /   m ýÿt h o d e   D O M 
             I . i n s e r t R u l e ( n o m + "   {   " + r e g l e + "   } " , I . c s s R u l e s . l e n g t h ) 
         } 
     } 
 } 
 
 f u n c t i o n   i n i t S t y l e ( ) { 
     v a r   A u t o C o m p l e t e D i v L i s t e S t y l e = " f o n t - s i z e :   1 3 p x ;   f o n t - f a m i l y :   a r i a l , s a n s - s e r i f ;   w o r d - w r a p : b r e a k - w o r d ;   " ; 
     v a r   A u t o C o m p l e t e D i v S t y l e = " d i s p l a y :   b l o c k ;   p a d d i n g - l e f t :   3 ;   p a d d i n g - r i g h t :   3 ;   h e i g h t :   1 6 p x ;   o v e r f l o w :   h i d d e n ;   b a c k g r o u n d - c o l o r :   w h i t e ; " ; 
     v a r   A u t o C o m p l e t e D i v A c t S t y l e = " b a c k g r o u n d - c o l o r :   # 3 3 6 6 c c ;   c o l o r :   w h i t e   !   i m p o r t a n t ;   " ; 
     i n s e r e C S S ( " . A u t o C o m p l e t e D i v L i s t e S t y l e " , A u t o C o m p l e t e D i v L i s t e S t y l e ) ; 
     i n s e r e C S S ( " . A u t o C o m p l e t e D i v " , A u t o C o m p l e t e D i v S t y l e ) ; 
     i n s e r e C S S ( " . A u t o C o m p l e t e D i v A c t " , A u t o C o m p l e t e D i v A c t S t y l e ) ; 
 } 
 
 f u n c t i o n   s e t S t y l e P o u r E l e m e n t ( c , n a m e ) { 
     c . c l a s s N a m e = n a m e ; 
 } 
 
 / /   c a l c u l e   l e   d ýÿc a l a g e   ýÿ  g a u c h e 
 f u n c t i o n   c a l c u l a t e O f f s e t L e f t ( r ) { 
     r e t u r n   c a l c u l a t e O f f s e t ( r , " o f f s e t L e f t " ) 
 } 
 
 / /   c a l c u l e   l e   d ýÿc a l a g e   v e r t i c a l 
 f u n c t i o n   c a l c u l a t e O f f s e t T o p ( r ) { 
     r e t u r n   c a l c u l a t e O f f s e t ( r , " o f f s e t T o p " ) 
 } 
 
 f u n c t i o n   c a l c u l a t e O f f s e t ( r , a t t r ) { 
     v a r   k b = 0 ; 
     w h i l e ( r ) { 
         k b + = r [ a t t r ] ; 
         r = r . o f f s e t P a r e n t 
     } 
     r e t u r n   k b 
 } 
 
 / /   c a l c u l e   l a   l a r g e u r   d u   c h a m p 
 f u n c t i o n   c a l c u l a t e W i d t h ( ) { 
     r e t u r n   _ i n p u t F i e l d . o f f s e t W i d t h - 2 * 1 
 } 
 
 f u n c t i o n   s e t C o m p l e t e D i v S i z e ( ) { 
     i f ( _ c o m p l e t e D i v ) { 
         _ c o m p l e t e D i v . s t y l e . l e f t = c a l c u l a t e O f f s e t L e f t ( _ i n p u t F i e l d ) + " p x " ; 
         _ c o m p l e t e D i v . s t y l e . t o p = c a l c u l a t e O f f s e t T o p ( _ i n p u t F i e l d ) + _ i n p u t F i e l d . o f f s e t H e i g h t - 1 + " p x " ; 
         _ c o m p l e t e D i v . s t y l e . w i d t h = c a l c u l a t e W i d t h ( ) + " p x " 
     } 
 } 
 
 f u n c t i o n   c r e e A u t o c o m p l e t i o n D i v ( )   { 
     i n i t S t y l e ( ) ; 
     _ c o m p l e t e D i v = d o c u m e n t . c r e a t e E l e m e n t ( " D I V " ) ; 
     _ c o m p l e t e D i v . i d = " c o m p l e t e D i v " ; 
     v a r   b o r d e r L e f t R i g h t = 1 ; 
     v a r   b o r d e r T o p B o t t o m = 1 ; 
     _ c o m p l e t e D i v . s t y l e . b o r d e r R i g h t = " b l a c k   " + b o r d e r L e f t R i g h t + " p x   s o l i d " ; 
     _ c o m p l e t e D i v . s t y l e . b o r d e r L e f t = " b l a c k   " + b o r d e r L e f t R i g h t + " p x   s o l i d " ; 
     _ c o m p l e t e D i v . s t y l e . b o r d e r T o p = " b l a c k   " + b o r d e r T o p B o t t o m + " p x   s o l i d " ; 
     _ c o m p l e t e D i v . s t y l e . b o r d e r B o t t o m = " b l a c k   " + b o r d e r T o p B o t t o m + " p x   s o l i d " ; 
     _ c o m p l e t e D i v . s t y l e . z I n d e x = " 1 " ; 
     _ c o m p l e t e D i v . s t y l e . p a d d i n g R i g h t = " 0 " ; 
     _ c o m p l e t e D i v . s t y l e . p a d d i n g L e f t = " 0 " ; 
     _ c o m p l e t e D i v . s t y l e . p a d d i n g T o p = " 0 " ; 
     _ c o m p l e t e D i v . s t y l e . p a d d i n g B o t t o m = " 0 " ; 
     s e t C o m p l e t e D i v S i z e ( ) ; 
     _ c o m p l e t e D i v . s t y l e . v i s i b i l i t y = " h i d d e n " ; 
     _ c o m p l e t e D i v . s t y l e . p o s i t i o n = " a b s o l u t e " ; 
     _ c o m p l e t e D i v . s t y l e . b a c k g r o u n d C o l o r = " w h i t e " ; 
     d o c u m e n t . b o d y . a p p e n d C h i l d ( _ c o m p l e t e D i v ) ; 
     s e t S t y l e P o u r E l e m e n t ( _ c o m p l e t e D i v , " A u t o C o m p l e t e D i v L i s t e S t y l e " ) ; 
 } 
 
 f u n c t i o n   m e t s E n P l a c e ( v a l e u r ,   l i s t e ) { 
     w h i l e ( _ c o m p l e t e D i v . c h i l d N o d e s . l e n g t h > 0 )   { 
         _ c o m p l e t e D i v . r e m o v e C h i l d ( _ c o m p l e t e D i v . c h i l d N o d e s [ 0 ] ) ; 
     } 
     / /   m i s e   e n   p l a c e   d e s   s u g g e s t i o n s 
     f o r ( v a r   f = 0 ;   f < l i s t e . l e n g t h ;   + + f ) { 
         v a r   n o u v e a u D i v = d o c u m e n t . c r e a t e E l e m e n t ( " D I V " ) ; 
         n o u v e a u D i v . o n m o u s e d o w n = d i v O n M o u s e D o w n ; 
         n o u v e a u D i v . o n m o u s e o v e r = d i v O n M o u s e O v e r ; 
         n o u v e a u D i v . o n m o u s e o u t = d i v O n M o u s e O u t ; 
         s e t S t y l e P o u r E l e m e n t ( n o u v e a u D i v , " A u t o C o m p l e t e D i v " ) ; 
         v a r   n o u v e a u S p a n = d o c u m e n t . c r e a t e E l e m e n t ( " S P A N " ) ; 
         n o u v e a u S p a n . i n n e r H T M L = d e c o d e U R I C o m p o n e n t ( l i s t e [ f ] )   / /   l e   t e x t e   d e   l a   s u g g e s t i o n 
         n o u v e a u D i v . a p p e n d C h i l d ( n o u v e a u S p a n ) ; 
         _ c o m p l e t e D i v . a p p e n d C h i l d ( n o u v e a u D i v ) 
     } 
     P r e s s A c t i o n ( ) ; 
     i f ( _ c o m p l e t e D i v R o w s > 0 )   { 
         _ c o m p l e t e D i v . h e i g h t = 1 6 * _ c o m p l e t e D i v R o w s + 4 ; 
     }   e l s e   { 
         h i d e C o m p l e t e D i v ( ) ; 
     } 
 
 } 
 
 v a r   _ l a s t K e y C o d e = n u l l ; 
 
 / /   H a n d l e r   p o u r   l e   k e y d o w n   d u   d o c u m e n t 
 v a r   o n K e y D o w n H a n d l e r = f u n c t i o n ( e v e n t ) { 
     / /   a c c ýÿs   e v e n e m e n t   c o m p a t i b l e   I E / F i r e f o x 
     i f ( ! e v e n t & & w i n d o w . e v e n t )   { 
         e v e n t = w i n d o w . e v e n t ; 
     } 
     / /   o n   e n r e g i s t r e   l a   t o u c h e   a y a n t   d ýÿc l e n c h ýÿ  l ' e v e n e m e n t 
     i f ( e v e n t )   { 
         _ l a s t K e y C o d e = e v e n t . k e y C o d e ; 
     } 
 } 
 
 v a r   _ e v e n t K e y c o d e   =   n u l l ; 
 
 / /   H a n d l e r   p o u r   l e   k e y u p   d e   l u   c h a m p   t e x t e 
 v a r   o n K e y U p H a n d l e r = f u n c t i o n ( e v e n t ) { 
     / /   a c c ýÿs   e v e n e m e n t   c o m p a t i b l e   I E / F i r e f o x 
     i f ( ! e v e n t & & w i n d o w . e v e n t )   { 
         e v e n t = w i n d o w . e v e n t ; 
     } 
     _ e v e n t K e y c o d e = e v e n t . k e y C o d e ; 
     / /   D a n s   l e s   c a s   t o u c h e s   t o u c h e   h a u t e ( 3 8 )   o u   t o u c h e   b a s s e   ( 4 0 ) 
     i f ( _ e v e n t K e y c o d e = = 4 0 | | _ e v e n t K e y c o d e = = 3 8 )   { 
         / /   o n   a u t o r i s e   l e   b l u r   d u   c h a m p   ( t r a i t e m e n t   d a n s   o n b l u r ) 
         b l u r T h e n G e t F o c u s ( ) ; 
     } 
     / /   t a i l l e   d e   l a   s e l e c t i o n 
     v a r   N = r a n g e S i z e ( _ i n p u t F i e l d ) ; 
     / /   t a i l l e   d u   t e x t e   a v a n t   l a   s e l e c t i o n   ( s e l e c t i o n   =   s u g g e s t i o n   d ' a u t o c o m p l ýÿt i o n ) 
     v a r   v = b e f o r e R a n g e S i z e ( _ i n p u t F i e l d ) ; 
     / /   c o n t e n u   d u   c h a m p   t e x t e 
     v a r   V = _ i n p u t F i e l d . v a l u e ; 
     i f ( _ e v e n t K e y c o d e ! = 0 ) { 
         i f ( N > 0 & & v ! = - 1 )   { 
             / /   o n   r e c u p e r e   u n i q u e m e n t   l e   c h a m p   t e x t e   t a p ýÿ  p a r   l ' u t i l i s a t e u r 
             V = V . s u b s t r i n g ( 0 , v ) ; 
         } 
         / /   1 3   =   t o u c h e   e n t r ýÿe 
         i f ( _ e v e n t K e y c o d e = = 1 3 | | _ e v e n t K e y c o d e = = 3 ) { 
             v a r   d = _ i n p u t F i e l d ; 
             / /   o n   m e t s   e n   p l a c e   l ' e n s e m b l e   d u   c h a m p   t e x t e   e n   r e p o u s s a n t   l a   s e l e c t i o n 
             i f ( _ i n p u t F i e l d . c r e a t e T e x t R a n g e ) { 
                 v a r   t = _ i n p u t F i e l d . c r e a t e T e x t R a n g e ( ) ; 
                 t . m o v e S t a r t ( " c h a r a c t e r " , _ i n p u t F i e l d . v a l u e . l e n g t h ) ; 
                 _ i n p u t F i e l d . s e l e c t ( ) 
             }   e l s e   i f   ( d . s e t S e l e c t i o n R a n g e ) { 
                 _ i n p u t F i e l d . s e t S e l e c t i o n R a n g e ( _ i n p u t F i e l d . v a l u e . l e n g t h , _ i n p u t F i e l d . v a l u e . l e n g t h ) 
             } 
         }   e l s e   { 
             / /   s i   o n   a   p a s   p u   a g r a n d i r   l e   c h a m p   n o n   s e l e c t i o n n ýÿ,   o n   l e   m e t s   e n   p l a c e   v i o l e m m e n t . 
             i f ( _ i n p u t F i e l d . v a l u e ! = V )   { 
                 _ i n p u t F i e l d . v a l u e = V 
             } 
         } 
     } 
     / /   s i   l a   t o u c h e   n ' e s t   n i   h a u t ,   n i   b a s ,   o n   s t o c k e   l a   v a l e u r   u t i l i s a t e u r   d u   c h a m p 
     i f ( _ e v e n t K e y c o d e ! = 4 0 & & _ e v e n t K e y c o d e ! = 3 8 )   { 
         / /   l e   c h a m p   c o u r a n t   n   e s t   p a s   c h a n g e   s i   k e y   U p   o u   k e y   D o w n 
     	 _ c u r r e n t I n p u t F i e l d V a l u e = V ; 
     } 
     i f ( h a n d l e C u r s o r U p D o w n E n t e r ( _ e v e n t K e y c o d e ) & & _ e v e n t K e y c o d e ! = 0 )   { 
         / /   s i   o n   a   p r ýÿs s ýÿ  u n e   t o u c h e   a u t r e   q u e   h a u t / b a s / e n t e r 
         P r e s s A c t i o n ( ) ; 
     } 
 } 
 
 / /   C h a n g e   l a   s u g g e s t i o n   s e l e c t i o n n ýÿ. 
 / /   c e t t e   m ýÿt h o d e   t r a i t e   l e s   t o u c h e s   h a u t ,   b a s   e t   e n t e r 
 f u n c t i o n   h a n d l e C u r s o r U p D o w n E n t e r ( e v e n t C o d e ) { 
     i f ( e v e n t C o d e = = 4 0 ) { 
         h i g h l i g h t N e w V a l u e ( _ h i g h l i g h t e d S u g g e s t i o n I n d e x + 1 ) ; 
         r e t u r n   f a l s e 
     } e l s e   i f ( e v e n t C o d e = = 3 8 ) { 
         h i g h l i g h t N e w V a l u e ( _ h i g h l i g h t e d S u g g e s t i o n I n d e x - 1 ) ; 
         r e t u r n   f a l s e 
     } e l s e   i f ( e v e n t C o d e = = 1 3 | | e v e n t C o d e = = 3 ) { 
         r e t u r n   f a l s e 
     } 
     r e t u r n   t r u e 
 } 
 
 v a r   _ c o m p l e t e D i v R o w s   =   0 ; 
 v a r   _ c o m p l e t e D i v D i v L i s t   =   n u l l ; 
 v a r   _ h i g h l i g h t e d S u g g e s t i o n I n d e x   =   - 1 ; 
 v a r   _ h i g h l i g h t e d S u g g e s t i o n D i v   =   n u l l ; 
 
 / /   g ýÿr e   u n e   t o u c h e   p r e s s ýÿe   a u t r e   q u e   h a u t / b a s / e n t e r 
 f u n c t i o n   P r e s s A c t i o n ( ) { 
     _ h i g h l i g h t e d S u g g e s t i o n I n d e x = - 1 ; 
     v a r   s u g g e s t i o n L i s t = _ c o m p l e t e D i v . g e t E l e m e n t s B y T a g N a m e ( " d i v " ) ; 
     v a r   s u g g e s t i o n L o n g u e u r = s u g g e s t i o n L i s t . l e n g t h ; 
     / /   o n   s t o c k e   l e s   v a l e u r s   p r ýÿc ýÿd e n t e s 
     / /   n o m b r e   d e   p o s s i b i l i t ýÿs   d e   c o m p l ýÿt i o n 
     _ c o m p l e t e D i v R o w s = s u g g e s t i o n L o n g u e u r ; 
     / /   p o s s i b l i t ýÿs   d e   c o m p l ýÿt i o n 
     _ c o m p l e t e D i v D i v L i s t = s u g g e s t i o n L i s t ; 
     / /   s i   l e   c h a m p   e s t   v i d e ,   o n   c a c h e   l e s   p r o p o s i t i o n s   d e   c o m p l ýÿt i o n 
     i f ( _ c u r r e n t I n p u t F i e l d V a l u e = = " " | | s u g g e s t i o n L o n g u e u r = = 0 ) { 
         h i d e C o m p l e t e D i v ( ) 
     } e l s e { 
         s h o w C o m p l e t e D i v ( ) 
     } 
     v a r   t r o u v e = f a l s e ; 
     / /   s i   o n   a   d u   t e x t e   s u r   l e q u e l   t r a v a i l l e r 
     i f ( _ c u r r e n t I n p u t F i e l d V a l u e . l e n g t h > 0 ) { 
         v a r   i n d i c e ; 
         / /   T   v a u t   t r u e   s i   o n   a   d a n s   l a   l i s t e   d e   s u g g e s t i o n s   u n   m o t   c o m m e n c a n t   c o m m e   l ' e n t r ýÿe   u t i l i s a t e u r 
         f o r ( i n d i c e = 0 ;   i n d i c e < s u g g e s t i o n L o n g u e u r ;   i n d i c e + + ) { 
             i f ( g e t S u g g e s t i o n ( s u g g e s t i o n L i s t . i t e m ( i n d i c e ) ) . t o U p p e r C a s e ( ) . i n d e x O f ( _ c u r r e n t I n p u t F i e l d V a l u e . t o U p p e r C a s e ( ) ) = = 0 )   { 
                 t r o u v e = t r u e ; 
                 b r e a k 
             } 
         } 
     } 
     / /   o n   d ýÿs ýÿl e c t i o n n e   t o u t e s   l e s   s u g g e s t i o n s 
     f o r ( v a r   i = 0 ;   i < s u g g e s t i o n L o n g u e u r ;   i + + )   { 
         s e t S t y l e P o u r E l e m e n t ( s u g g e s t i o n L i s t . i t e m ( i ) , " A u t o C o m p l e t e D i v " ) ; 
     } 
     / /   s i   l ' e n t r ýÿe   u t i l i s a t e u r   ( n )   e s t   l e   d ýÿb u t   d ' u n e   s u g g e s t i o n   ( n - 1 )   o n   s ýÿl e c t i o n n e   c e t t e   s u g g e s t i o n   a v a n t   d e   c o n t i n u e r 
     i f ( t r o u v e ) { 
         _ h i g h l i g h t e d S u g g e s t i o n I n d e x = i n d i c e ; 
         _ h i g h l i g h t e d S u g g e s t i o n D i v = s u g g e s t i o n L i s t . i t e m ( _ h i g h l i g h t e d S u g g e s t i o n I n d e x ) ; 
     } e l s e { 
         _ h i g h l i g h t e d S u g g e s t i o n I n d e x = - 1 ; 
         _ h i g h l i g h t e d S u g g e s t i o n D i v = n u l l 
     } 
     v a r   s u p p r S e l e c t i o n = f a l s e ; 
     s w i t c h ( _ e v e n t K e y c o d e ) { 
         / /   c u r s o r   l e f t ,   c u r s o r   r i g h t ,   p a g e   u p ,   p a g e   d o w n ,   o t h e r s ? ? 
         c a s e   8 : 
         c a s e   3 3 : 
         c a s e   3 4 : 
         c a s e   3 5 : 
         c a s e   3 5 : 
         c a s e   3 6 : 
         c a s e   3 7 : 
         c a s e   3 9 : 
         c a s e   4 5 : 
         c a s e   4 6 : 
             / /   o n   s u p p r i m e   l a   s u g g e s t i o n   d u   t e x t e   u t i l i s a t e u r 
             s u p p r S e l e c t i o n = t r u e ; 
             b r e a k ; 
         d e f a u l t : 
             b r e a k 
     } 
     / /   s i   o n   a   u n e   s u g g e s t i o n   ( n - 1 )   s ýÿl e c t i o n n ýÿe 
     i f ( ! s u p p r S e l e c t i o n & & _ h i g h l i g h t e d S u g g e s t i o n D i v ) { 
         s e t S t y l e P o u r E l e m e n t ( _ h i g h l i g h t e d S u g g e s t i o n D i v , " A u t o C o m p l e t e D i v A c t " ) ; 
         v a r   z ; 
         i f ( t r o u v e )   { 
             z = g e t S u g g e s t i o n ( _ h i g h l i g h t e d S u g g e s t i o n D i v ) . s u b s t r ( 0 ) ; 
         }   e l s e   { 
             z = _ c u r r e n t I n p u t F i e l d V a l u e ; 
         } 
         i f ( z ! = _ i n p u t F i e l d . v a l u e ) { 
             i f ( _ i n p u t F i e l d . v a l u e ! = _ c u r r e n t I n p u t F i e l d V a l u e )   { 
                 r e t u r n ; 
             } 
             / /   s i   o n   p e u t   c r ýÿe r   d e s   r a n g e   d a n s   l e   d o c u m e n t 
             i f ( _ i n p u t F i e l d . c r e a t e T e x t R a n g e | | _ i n p u t F i e l d . s e t S e l e c t i o n R a n g e )   { 
                 _ i n p u t F i e l d . v a l u e = z ; 
             } 
             / /   o n   s ýÿl e c t i o n n e   l a   f i n   d e   l a   s u g g e s t i o n 
             i f ( _ i n p u t F i e l d . c r e a t e T e x t R a n g e ) { 
                 v a r   t = _ i n p u t F i e l d . c r e a t e T e x t R a n g e ( ) ; 
                 t . m o v e S t a r t ( " c h a r a c t e r " , _ c u r r e n t I n p u t F i e l d V a l u e . l e n g t h ) ; 
                 t . s e l e c t ( ) 
             } e l s e   i f ( _ i n p u t F i e l d . s e t S e l e c t i o n R a n g e ) { 
                 _ i n p u t F i e l d . s e t S e l e c t i o n R a n g e ( _ c u r r e n t I n p u t F i e l d V a l u e . l e n g t h , _ i n p u t F i e l d . v a l u e . l e n g t h ) 
             } 
         } 
     } e l s e { 
         / /   s i n o n ,   p l u s   a u c u n e   s u g g e s t i o n   d e   s ýÿl e c t i o n n ýÿe 
         _ h i g h l i g h t e d S u g g e s t i o n I n d e x = - 1 ; 
     } 
 } 
 
 v a r   _ c u r s o r U p D o w n P r e s s e d   =   n u l l ; 
 
 / /   p e r m e t   l e   b l u r   d u   c h a m p   t e x t e   a p r ýÿs   q u e   l a   t o u c h e   h a u t / b a s   a i   ýÿt ýÿ  p r e s s ýÿ. 
 / /   l e   f o c u s   e s t   r ýÿc u p ýÿr ýÿ  a p r ýÿs   t r a i t e m e n t   ( v i a   l e   t i m e o u t ) . 
 f u n c t i o n   b l u r T h e n G e t F o c u s ( ) { 
     _ c u r s o r U p D o w n P r e s s e d = t r u e ; 
     _ i n p u t F i e l d . b l u r ( ) ; 
     s e t T i m e o u t ( " _ i n p u t F i e l d . f o c u s ( ) ; " , 1 0 ) ; 
     r e t u r n 
 } 
 
 / /   t a i l l e   d e   l a   s e l e c t i o n   d a n s   l e   c h a m p   i n p u t 
 f u n c t i o n   r a n g e S i z e ( n ) { 
     v a r   N = - 1 ; 
     i f ( n . c r e a t e T e x t R a n g e ) { 
         v a r   f a = d o c u m e n t . s e l e c t i o n . c r e a t e R a n g e ( ) . d u p l i c a t e ( ) ; 
         N = f a . t e x t . l e n g t h 
     } e l s e   i f ( n . s e t S e l e c t i o n R a n g e ) { 
         N = n . s e l e c t i o n E n d - n . s e l e c t i o n S t a r t 
     } 
     r e t u r n   N 
 } 
 
 / /   t a i l l e   d u   c h a m p   i n p u t   n o n   s e l e c t i o n n e 
 f u n c t i o n   b e f o r e R a n g e S i z e ( n ) { 
     v a r   v = 0 ; 
     i f ( n . c r e a t e T e x t R a n g e ) { 
         v a r   f a = d o c u m e n t . s e l e c t i o n . c r e a t e R a n g e ( ) . d u p l i c a t e ( ) ; 
         f a . m o v e E n d ( " t e x t e d i t " , 1 ) ; 
         v = n . v a l u e . l e n g t h - f a . t e x t . l e n g t h 
     } e l s e   i f ( n . s e t S e l e c t i o n R a n g e ) { 
         v = n . s e l e c t i o n S t a r t 
     } e l s e { 
         v = - 1 
     } 
     r e t u r n   v 
 } 
 
 / /   P l a c e   l e   c u r s e u r   ýÿ  l a   f i n   d u   c h a m p 
 f u n c t i o n   c u r s o r A f t e r V a l u e ( n ) { 
     i f ( n . c r e a t e T e x t R a n g e ) { 
         v a r   t = n . c r e a t e T e x t R a n g e ( ) ; 
         t . m o v e S t a r t ( " c h a r a c t e r " , n . v a l u e . l e n g t h ) ; 
         t . s e l e c t ( ) 
     }   e l s e   i f ( n . s e t S e l e c t i o n R a n g e )   { 
         n . s e t S e l e c t i o n R a n g e ( n . v a l u e . l e n g t h , n . v a l u e . l e n g t h ) 
     } 
 } 
 
 
 / /   R e t o u r n e   l a   v a l e u r   d e   l a   p o s s i b i l i t e   ( t e x t e )   c o n t e n u   d a n s   u n e   d i v   d e   p o s s i b i l i t e 
 f u n c t i o n   g e t S u g g e s t i o n ( u n e D i v ) { 
     i f ( ! u n e D i v )   { 
         r e t u r n   n u l l ; 
     } 
     r e t u r n   t r i m C R ( u n e D i v . g e t E l e m e n t s B y T a g N a m e ( ' s p a n ' ) [ 0 ] . f i r s t C h i l d . d a t a ) 
 } 
 
 / /   s u p p r i m e   l e s   c a r a c t ýÿr e s   r e t o u r   c h a r i o t   e t   l i n e   f e e d   d ' u n e   c h a i n e   d e   c a r a c t ýÿr e s 
 f u n c t i o n   t r i m C R ( c h a i n e ) { 
     f o r ( v a r   f = 0 , n C h a i n e = " " , z b = " \ n \ r " ;   f < c h a i n e . l e n g t h ;   f + + )   { 
         i f   ( z b . i n d e x O f ( c h a i n e . c h a r A t ( f ) ) = = - 1 )   { 
             n C h a i n e + = c h a i n e . c h a r A t ( f ) ; 
         } 
     } 
     r e t u r n   n C h a i n e 
 } 
 
 / /   C a c h e   c o m p l e t e m e n t   l e s   c h o i x   d e   c o m p l e t i o n 
 f u n c t i o n   h i d e C o m p l e t e D i v ( ) { 
     _ c o m p l e t e D i v . s t y l e . v i s i b i l i t y = " h i d d e n " 
 } 
 
 / /   R e n d s   l e s   c h o i x   d e   c o m p l e t i o n   v i s i b l e s 
 f u n c t i o n   s h o w C o m p l e t e D i v ( ) { 
     _ c o m p l e t e D i v . s t y l e . v i s i b i l i t y = " v i s i b l e " ; 
     s e t C o m p l e t e D i v S i z e ( ) 
 } 
 
 / /   C h a n g e   l a   s u g g e s t i o n   e n   s u r b r i l l a n c e 
 f u n c t i o n   h i g h l i g h t N e w V a l u e ( C ) { 
     i f ( ! _ c o m p l e t e D i v D i v L i s t | | _ c o m p l e t e D i v R o w s < = 0 )   { 
         r e t u r n ; 
     } 
     s h o w C o m p l e t e D i v ( ) ; 
     i f ( C > = _ c o m p l e t e D i v R o w s ) { 
         C = _ c o m p l e t e D i v R o w s - 1 
     } 
     i f ( _ h i g h l i g h t e d S u g g e s t i o n I n d e x ! = - 1 & & C ! = _ h i g h l i g h t e d S u g g e s t i o n I n d e x ) { 
         s e t S t y l e P o u r E l e m e n t ( _ h i g h l i g h t e d S u g g e s t i o n D i v , " A u t o C o m p l e t e D i v " ) ; 
         _ h i g h l i g h t e d S u g g e s t i o n I n d e x = - 1 
     } 
     i f ( C < 0 ) { 
         _ h i g h l i g h t e d S u g g e s t i o n I n d e x = - 1 ; 
         _ i n p u t F i e l d . f o c u s ( ) ; 
         r e t u r n 
     } 
     _ h i g h l i g h t e d S u g g e s t i o n I n d e x = C ; 
     _ h i g h l i g h t e d S u g g e s t i o n D i v = _ c o m p l e t e D i v D i v L i s t . i t e m ( C ) ; 
     s e t S t y l e P o u r E l e m e n t ( _ h i g h l i g h t e d S u g g e s t i o n D i v , " A u t o C o m p l e t e D i v A c t " ) ; 
     _ i n p u t F i e l d . v a l u e = g e t S u g g e s t i o n ( _ h i g h l i g h t e d S u g g e s t i o n D i v ) ; 
 } 
 
 / /   H a n d l e r   d e   r e s i z e   d e   l a   f e n e t r e 
 v a r   o n R e s i z e H a n d l e r = f u n c t i o n ( e v e n t ) { 
     / /   r e c a l c u l e   l a   t a i l l e   d e s   s u g g e s t i o n s 
     s e t C o m p l e t e D i v S i z e ( ) ; 
 } 
 
 / /   H a n d l e r   d e   b l u r   s u r   l e   c h a m p   t e x t e 
 v a r   o n B l u r H a n d l e r = f u n c t i o n ( e v e n t ) { 
     i f ( ! _ c u r s o r U p D o w n P r e s s e d ) { 
         / /   s i   l e   b l u r   n ' e s t   p a s   c a u s ýÿ  p a r   l a   t o u c h e   h a u t / b a s 
         h i d e C o m p l e t e D i v ( ) ; 
         / /   S i   l a   d e r n i ýÿr e   t o u c h e   p r ýÿs s ýÿ  e s t   t a b ,   o n   p a s s e   a u   b o u t o n   d e   v a l i d a t i o n 
         i f ( _ l a s t K e y C o d e = = 9 ) { 
             / / _ s u b m i t B u t t o n . f o c u s ( ) ; 
             _ l a s t K e y C o d e = - 1 
         } 
     } 
     _ c u r s o r U p D o w n P r e s s e d = f a l s e 
 } ; 
 
 / /   d e c l e n c h e e   q u a n d   o n   c l i q u e   s u r   u n e   d i v   c o n t e n a n t   u n e   p o s s i b i l i t e 
 v a r   d i v O n M o u s e D o w n = f u n c t i o n ( ) { 
     _ i n p u t F i e l d . v a l u e = g e t S u g g e s t i o n ( t h i s ) ; 
     
 } ; 
 
 / /   d e c l e n c h e e   q u a n d   o n   p a s s e   s u r   u n e   d i v   d e   p o s s i b i l i t e .   L a   d i v   p r ýÿc ýÿd e n t e   e s t   p a s s e e   e n   s t y l e   n o r m a l 
 v a r   d i v O n M o u s e O v e r = f u n c t i o n ( ) { 
     i f ( _ h i g h l i g h t e d S u g g e s t i o n D i v )   { 
         s e t S t y l e P o u r E l e m e n t ( _ h i g h l i g h t e d S u g g e s t i o n D i v , " A u t o C o m p l e t e D i v " ) ; 
     } 
     s e t S t y l e P o u r E l e m e n t ( t h i s , " A u t o C o m p l e t e D i v A c t " ) 
 } ; 
 
 / /   d e c l e n c h e e   q u a n d   l a   s o u r i e   q u i t t e   u n e   d i v   d e   p o s s i b l i t e .   L a   d i v   r e p a s s e   a   l ' e t a t   n o r m a l 
 v a r   d i v O n M o u s e O u t   =   f u n c t i o n ( ) { 
     s e t S t y l e P o u r E l e m e n t ( t h i s , " A u t o C o m p l e t e D i v " ) ; 
 } ; 
 
 
 
 
 
 
 
    )       http://zone-h.com/js/autocomplete-3-2.js        #               !«!ÿÿÿÿ1   /   _currentInputFieldValue   divOnMouseDown   divOnMouseOut   PressAction   callSuggestions   getXMLHTTP!   initAutoComplete   cacheResults+   creeAutocompletionDiv   _xmlHttp   trimCR   _lastKeyCode#   _adresseRecherche   divOnMouseOver)   traiteXmlSuggestions   metsEnPlace   onBlurHandler3   _highlightedSuggestionDiv   beforeRangeSize   _inputField/   handleCursorUpDownEnter   mainLoop   insereCSS%   calculateOffsetTop   escapeURI   onKeyUpHandler!   _completeDivRows'   setStylePourElement!   onKeyDownHandler!   cursorAfterValue   rangeSize!   blurThenGetFocus   _documentForm   showCompleteDiv   onResizeHandler'   _oldInputFieldValue'   calculateOffsetLeft   calculateOffset7   _highlightedSuggestionIndex#   highlightNewValue%   setCompleteDivSize   hideCompleteDiv)   _cursorUpDownPressed   initStyle   getSuggestion'   _completeDivDivList   _eventKeycode   calculateWidth   _resultCache1   1   «+H!«!          getXMLHTTP  |   x  i   x               ÿÿÿÿÊ5!«!       !   initAutoComplete                       L  L  3  L                              !«!ÿÿÿÿ   	   form   field        «+H;ø   Ö   U   Ö    T      QÖ   T    Q   =   6   Q      ç  QÖ      5      QÖ         Q      =	   
   A,  R  ç Q      6   Q      6   Q      6   Q      6   Q      =   XÈ ç Q ¸°Î ¸°Î¨ ¸°Ð ¸°Î ¸°Õ ¸°Ð ¸°Ù°ÿÿÿð¤¸°Ð ¸°Ð ¸°Ð ¸°Ð¨*¸°Ö °    _documentForm   _inputField   off   autocomplete+   creeAutocompletionDiv/   _currentInputFieldValue   value'   _oldInputFieldValue   cacheResults      Array   document!   onKeyDownHandler   onkeydown   onKeyUpHandler   onkeyup   onBlurHandler   onblur   window   onResizeHandler   onresize   setTimeout   mainLoop()       ÿÿÿÿÊ5!«!          mainLoop  o  _  ^  _  2      @       ÿÿÿÿÊ5!«!          escapeURI   	    	  C      0       ÿÿÿÿÊ5!«!          callSuggestions Ï	  Í  ·	  Í  O      @      ÿÿÿÿ    valeur   B  Ä
    ¼
    W   (           ÿÿÿÿÊ5Ê5!«!          cacheResults  d                     	  A  ô  A                              !«!ÿÿÿÿ      debut   suggestions        «+H;ø      	       T  T 8Q ¸°Í °    _resultCache       ÿÿÿÿÊ5!«!       )   traiteXmlSuggestions   _  d  _  i              ÿÿÿÿÊ5!«!          insereCSS  s                                                        !«!ÿÿÿÿ      nom   regle   I       «+H;ø       6       5      æ       5   >7W   QV   5   $   æ   V   ¸   
T  T ç QM   æ   V   5   :   æ   V   ¸   
T  =   T =   V   5   Ù   ç Qæ    ¸°ÊÊ 
¸°Ñ ¸°ÉÊ ¸°Ñ°Î ¸°ÉÊ ¸°ì°É¨|°    document   styleSheets   addRule   insertRule    {     }   cssRules   length@       ÿÿÿÿÊ5!«!          initStyle   ~                    ¢  ©    ©                               !«!ÿÿÿÿ   3   AutoCompleteDivListeStyle)   AutoCompleteDivStyle/   AutoCompleteDivActStyle         «+H;ø   d   '   =    W   Q=   W  Q=   W  Q      =   V   ç Q      =   V  ç Q      =   V  ç Q  ¸°Ê ¸°Ê ¸°Ê ¸°× ¸°× ¸°× °    font-size: 13px; font-family: arial,sans-serif; word-wrap:break-word; ×   display: block; padding-left: 3; padding-right: 3; height: 16px; overflow: hidden; background-color: white;k   background-color: #3366cc; color: white ! important;    insereCSS5   .AutoCompleteDivListeStyle!   .AutoCompleteDiv'   .AutoCompleteDivAct       ÿÿÿÿÊ5!«!       '   setStylePourElement                       Ç  æ  «  æ                               !«!ÿÿÿÿ      c	   name        «+H;ø      	   T  T 6    Q ¸°Ì °    className       ÿÿÿÿÊ5!«!       '   calculateOffsetLeft                       $  S    S                              !«!ÿÿÿÿ      r        «+H;ø                 T  =   :  ¸°Ò°£±    calculateOffset   offsetLeft       ÿÿÿÿÊ5!«!       %   calculateOffsetTop                         ¾  u  ¾                              !«!ÿÿÿÿ      r        «+H;ø                 T  =   :  ¸°Ò°£±    calculateOffset   offsetTop       ÿÿÿÿÊ5!«!          calculateOffset                      Ø  1  À  1                             !«!ÿÿÿÿ      r	   attr   kb       «+H;ø          0      K   2   >W   Qæ   '   m   V   T  T 7W   QT  5    U  Qã   T  Õÿÿÿæ   V    	¸°Ë(0¥ ­   ¸°Ñ ¸°Ì¨  ¾°Í    ¸°¤±    offsetParent        ÿÿÿÿÊ5!«!          calculateWidth                        i    R                                 !«!ÿÿÿÿ              «+H;ø      	       5   × ¸°Í ±    _inputField   offsetWidth       ÿÿÿÿÊ5!«!       %   setCompleteDivSize   £                     °                                     !«!ÿÿÿÿ              «+H;ø      )          æ       5            : =   6   Q    5            :    5   ?=   6   Q    5   	   	   :  =   6
   Qæ    ¸°Ê ¸°Ù°Ï ¸°Ù°Ü ¸°Ô°Ô  °    _completeDiv   style'   calculateOffsetLeft   _inputField   px	   left%   calculateOffsetTop   offsetHeight   top   calculateWidth   width        ÿÿÿÿÊ5!«!       +   creeAutocompletionDiv   «                    ¿  ,  ¡  ,       (                        !«!ÿÿÿÿ      borderLeftRight   borderTopBottom         «+H;ø    ²             ç  QÖ      ¸   
=   :    Q   =   6   Q?W   Q?W  Q   5   =   V   =	   6
   Q   5   =   V   =	   6   Q   5   =   V  =	   6   Q   5   =   V  =	   6   Q   5   =   6   Q   5   =   6   Q   5   =   6   Q   5   =   6   Q   5   =   6   Q      ç  Q   5   =   6   Q   5   =   6   Q   5   =   6   Q   5   ¸   
   ç Q         =   ç Q ¸°Î ¸°Ö°É ¸°Ð ¸°¦¸°¦¸°à ¸°à ¸°à ¸°à ¸°Õ ¸°Õ ¸°Õ ¸°Õ ¸°Õ ¸°Î ¸°Õ ¸°Õ ¸°Õ ¸°Ö°¤¸°Ø °    initStyle   _completeDiv   document   createElement   DIV   completeDiv   id   style   black    px solid   borderRight   borderLeft   borderTop   borderBottom   1   zIndex   0   paddingRight   paddingLeft   paddingTop   paddingBottom%   setCompleteDivSize   hidden   visibility   absolute   position   white   backgroundColor	   body   appendChild'   setStylePourElement3   AutoCompleteDivListeStyle       ÿÿÿÿÊ5!«!          metsEnPlace B  N  .  N  Â      P       ÿÿÿÿÊ5!«!       /   handleCursorUpDownEnter C#  [$  ##  [$  !      @       ÿÿÿÿÊ5!«!          PressAction  ,%  x0  %  x0  4     0      ÿÿÿÿÊ5!«!       !   blurThenGetFocus  >1  ¨1  %1  ¨1              ÿÿÿÿÊ5!«!          rangeSize ê1  ¹2  Ø1  ¹2       0       ÿÿÿÿÊ5!«!          beforeRangeSize ü2  ú3  ä2  ú3  ¦     @       ÿÿÿÿÊ5!«!       !   cursorAfterValue ;4  5  "4  5  µ     0       ÿÿÿÿÊ5!«!          getSuggestion 5  ø5  j5  ø5  Á             ÿÿÿÿÊ5!«!          trimCR [6  
7  L6  
7  É     0       ÿÿÿÿÊ5!«!          hideCompleteDiv  R7  7  :7  7  Ó            ÿÿÿÿÊ5!«!          showCompleteDiv  Ä7  8  ¬7  8  Ø            ÿÿÿÿÊ5!«!       #   highlightNewValue O8  Î:  58  Î:  Þ     P       ÿÿÿÿÊ5!«!       !   onKeyDownHandlerB ¬    ¤    Þ      0       ÿÿÿÿÊ5!«!          onKeyUpHandlerB è  Å"  à  Å"  ì      À       ÿÿÿÿÊ5!«!          onResizeHandlerB ;  Z;  ;  Z;  ö            ÿÿÿÿÊ5!«!          onBlurHandlerB ;  Ö<  ;  Ö<  ü     0       ÿÿÿÿÊ5!«!          divOnMouseDownB  8=  i=  0=  i=  
            ÿÿÿÿÊ5!«!          divOnMouseOverB  í=  >  å=  >       "       ÿÿÿÿÊ5!«!          divOnMouseOutB  	?  =?  ?  =?              ÿÿÿÿÊ5;ø   C  ¬                               	   
                                                             	   
                                                      Ö   @   QÖ	   @	   QÖ   =      QÖ    =       QÖ      A,  R     QÖ   @   QÖ   =      QÖ   @   QÖ         QÖ   @   QÖ
      
   QÖ   >   QÖ   @   QÖ   ×ÿ   QÖ   @   QÖ   @   QÖ         QÖ         QÖ          QÖ   !      QÖ   "      QÿÿÿÿÕ¨¸°§¸°¯-¸°Ë ¸°Ë ¸°Ó¨L¸°§¸°Ë¨  Û¸°§  ¸°Ë¨  é¸°§  ¸°Ë¨ .¸°§¸°§"¸°È  ¸°¯ ¸°¯ ö¸°Ë¨ ü¸°Ë¨ 
¸°Ë¨ ¸°Ë¨ ¸°Ë¨ "° /   _currentInputFieldValue   divOnMouseDown   divOnMouseOut   _xmlHttp   _lastKeyCode#   _adresseRecherche   divOnMouseOver   onBlurHandler3   _highlightedSuggestionDiv   _inputField   onKeyUpHandler!   _completeDivRows!   onKeyDownHandler   _documentForm   onResizeHandler'   _oldInputFieldValue7   _highlightedSuggestionIndex)   _cursorUpDownPressed'   _completeDivDivList   _eventKeycode   _resultCache      Object   /defacerlistñ5 í      &])U~])TÒ@¦ý])í   )    :http://zone-h.com/js/autocomplete-3-2.js strongly-framed 1 request-method GET response-head HTTP/1.1 200 OK
Content-Type: application/javascript
Content-Length: 16198
ETag: "4cefee99-3f46"
Accept-Ranges: bytes
Server: nginx
Date: Fri, 12 Jul 2019 14:41:21 GMT
Last-Modified: Fri, 26 Nov 2010 17:30:01 GMT
Expires: Sat, 13 Jul 2019 14:41:21 GMT
Cache-Control: max-age=86400
X-Frame-Options: DENY
 original-response-headers Server: nginx
Date: Fri, 12 Jul 2019 01:04:15 GMT
Content-Type: application/javascript
Content-Length: 16198
Connection: keep-alive
Last-Modified: Fri, 26 Nov 2010 17:30:01 GMT
ETag: "4cefee99-3f46"
Expires: Sat, 13 Jul 2019 01:04:15 GMT
Cache-Control: max-age=86400
X-Frame-Options: DENY
Accept-Ranges: bytes
 uncompressed-len 0 net-response-time-onstart 1656 net-response-time-onstop 1923 necko:classified 1 alt-data 1;16198,javascript/moz-bytecode-20190620092152 alt-data-from-child 1   ã